;
; IOCS
;
; SAMSUNG 8bit Personal Computer SPC-1000
; Old ROM Assembler Source 
; Reconstructed by Miso Kim
;
; 2014.04.16 1st Released
; 
		ORG	0
ENTRY	EQU	0FB00H
BOOT:	
JT1:	JP	ENTRY
JT2:	JP	INPUTF
JT3:	JP	CR1
JT4:	JP	CR2
JT5:	JP	SPPRT
JT6:	JP	TABPRT
JT7:	JP	ACCPRT
JT8:	JP	DEPRT
JT9:	JP	DEPRT
JT10:	JP	ASCGET
JT11:	JP	BRKEY		;ZERO=1 RET
JT12:	JP	FSAVE
JT13:	JP	MSAVE
JT14:	JP	FLOAD
JT15:	JP	MLOAD
JT16:	JP	MVRFY
JT17:	JP	MUSIC		;MELDY
JT18:	JP	NOPRET		;CLKSET
TICONT: DEFW	17
JT19:	JP	COUNTR
JT20:	JP	NOPRET		;CLKRD
JT21:	JP	BELL		;BELL
JT22:	JP	XTEMPO		;TEMPO
JT23:	JP	SOUNDS		;MSTA
JT24:	JP	SOUNDS		;MSTAS
	;004A
MAIN:	LD	SP,00000h
	IM	1
	EI
	CALL	INITSB
	JP	$BASIC
;
INITSB: LD	A,0
	CALL	IO20SB
	CALL	IO60SB
	CALL	CLR2
NOPRET: RET
;
IO20SB: LD	BC,02000h
	OUT	(C),A
	LD	(IO2000),A
	RET
;
IO60SB: LD	BC,06000h
	OUT	(C),A
	LD	(IO6000),A
	RET
;
;
COUNTR: PUSH	HL
	LD	HL,(TICONT)
	INC	HL
	LD	(TICONT),HL
	POP	HL
	EI
	RETI
;
;
;
; FILE INFORMATION SAVE
;
; START ADR=FILMOD
; LENGTH   =128 BYTES
;   CARRY FLAG: BREAK KEY IN
;
FSAVE:	DI
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	D,0D7h
	LD	E,0CCh
	LD	HL,FILMOD
	LD	BC,00080H
;
FSAVE0: CALL	CKSUM
	CALL	MOTON
	JP	C,CLOAD4
	LD	A,E
	CP	0CCh
	JR	NZ,FSAVE1
	CALL	CR2
	PUSH	DE
	LD	DE,WRITEM
	CALL	DEPRT		;'WRITING '
	LD	DE,FILNAM
	CALL	DEPRT		;FILE NAME
	POP	DE
;
FSAVE1: CALL	WRMRK		;GAP
	CALL	SAVE		;STADR=HL/LEN=BC
	JP	CLOAD4
;
;
;
; BODY SAVE
; START ADR	= (MTADRS=13AAH)
; LENGTH	= (MTBYTE=13A8H)
; CARRY FLAG	= 0... OK
; CARRY FLAG	= 1... BREAK IN
;
MSAVE:	DI
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	D,0D7h
	LD	E,053h
	LD	HL,(MTBYTE)
	PUSH	HL
	POP	BC
	LD	HL,(MTADRS)
	LD	A,B
	OR	C
	JP	Z,SAVE4
	JP	FSAVE0
;
SAVE:	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	D,001h		;원래값은 002h
SAVE1:	LD	A,(HL)		;~
	CALL	WRACC		;1BYTE WRITE
	LD	A,080h		;8000H
	IN	A,(000h)
	AND	012h		;BREAK+SHIFT
	JR	NZ,SAVE0
	SCF
	JP	SAVE4
;
SAVE0:	INC	HL
	DEC	BC		;BC BYTES CHECK
	LD	A,B
	OR	C
	JP	NZ,SAVE1
	LD	HL,(CKSMF1)	;CHECK SUM WRITE
	LD	A,H
	CALL	WRACC
	LD	A,L
	CALL	WRACC
	CALL	WRITEL		;BIT 1 WRITE
	DEC	D
	JP	NZ,SAVE2
	OR	A
	JP	SAVE4
;
SAVE2:	
	LD	BC, 04005h
	OUT (C), A
	POP	HL
	POP	BC
	PUSH	BC
	PUSH	HL
	JP	SAVE1
;
SAVE4:	POP	HL
	POP	BC
	POP	DE
	RET
;
FLOAD:	DI
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	D,0D2h
	LD	E,0CCh
	LD	BC,FSAVE
	LD	HL,FILMOD
;
FLOAD1: CALL	MOTON
	JP	C,CLOAD5
	CALL	MKRD
	JP	C,CLOAD5
	CALL	CLOAD
	JP	CLOAD4
;
MLOAD:	DI
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	D,0D2h
	LD	E,053h
	LD	HL,(MTBYTE)
	PUSH	HL
	POP	BC
	LD	HL,(MTADRS)
	LD	A,B
	OR	C
	JP	Z,CLOAD4
	JP	FLOAD1
;
CLOAD:	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	H,002h		;원래값은 002h - 소스 수정
;
CLOAD7: LD	BC,04000h
	LD	A,14
	OUT	(C),A
;
CLOAD0: CALL	EDGE
	JP	C,CLOAD5
	CALL	WAITR
;	LD	A,040h
;	IN	A,(1)	;IN A,(4001H)
;	AND	080h
	JP	Z,CLOAD0
	LD	D,H
	LD	HL,00000h
	LD	(CKSMF1),HL
	POP	HL
	POP	BC
	PUSH	BC
	PUSH	HL
;
CLOAD1: CALL	VBLOAD
	JP	C,CLOAD5
	LD	(HL),A
	INC	HL
	DEC	BC
	LD	A,B
	OR	C
	JP	NZ,CLOAD1
	LD	HL,(CKSMF1)
	CALL	VBLOAD
	JP	C,CLOAD5
	LD	E,A
	CALL	VBLOAD
	JP	C,CLOAD5
	CP	L
	JP	NZ,CLOAD2
	LD	A,E
	CP	H
	JP	NZ,CLOAD2
;
CLOAD8: XOR	A
;
CLOAD4: POP	HL
	POP	BC
	POP	DE
	CALL	MOTCH
	EI
	RET
;
CLOAD2: DEC	D
	JP	Z,CLOAD3
	LD	H,D
	JP	CLOAD7
;
CLOAD3: LD	A,001h
	SCF
	JP	CLOAD4
;
CLOAD5: LD	A,002h
	SCF
	JP	CLOAD4
;
MVRFY:	DI
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	HL,(MTBYTE)
	PUSH	HL
	POP	BC
	LD	HL,(MTADRS)
	LD	D,0D2h
	LD	E,053h
	LD	A,B
	OR	C
	JP	Z,CLOAD4
	CALL	CKSUM
	CALL	MOTON
	JP	C,CLOAD5
	CALL	MKRD
	JP	C,CLOAD5
	CALL	MVRFY1
	JP	CLOAD4
;
MVRFY1: PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	H,002h
;
MVRFYN: LD	BC,04000h
	LD	A,14
	OUT	(C),A
;
MVRFY2: CALL	EDGE
	JP	C,CLOAD5
	CALL	WAITR
;	LD	A,040h
;	IN	A,(1)
;	AND	080h
	JP	Z,MVRFY2
	LD	D,H
	POP	HL
	POP	BC
	PUSH	BC
	PUSH	HL
;
MVRFY3: CALL	VBLOAD
	JP	C,CLOAD5
	CP	(HL)
	JP	NZ,CLOAD3
	INC	HL
	DEC	BC
	LD	A,B
	OR	C
	JP	NZ,MVRFY3
	LD	HL,(CKSMF2)
	CALL	VBLOAD
	CP	H
	JP	NZ,CLOAD3
	CALL	VBLOAD
	CP	L
	JP	NZ,CLOAD3
	DEC	D
	JP	Z,CLOAD8
	LD	H,D
	JP	MVRFYN
;
MVRFY4: LD	A,080h
	IN	A,(0)		;IN A,(8000H)
	AND	012h
	JP	NZ,MVRFY5
	SCF
	RET
;
MVRFY5: 
	LD	A,040h
	IN	A,(1)		;IN A,(4001H)
	AND	080h
	JP	NZ,MVRFY4
;
MVRFY6: LD	A,080h
	IN	A,(0)		;IN A,(8001H)
	AND	012h
	JP	NZ,MVRFY7
	SCF
	RET
;
EDGE:
MVRFY7: LD	A,040h
	IN	A,(1)		;IN A,(4001H)
	AND	080h
;	JP	Z,MVRFY6
	RET
;
	ORG 0259H
VBLOAD: PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,00800h
	LD	BC,04000h
	LD	A,14
	OUT	(C),A
VBLOD1: CALL	EDGE
	JP	C,VBLOD3
	CALL	WAITR
;	LD	A,040h
;	IN	A,(1)		;IN A,(4001H)
;	AND	080h
	JP	Z,VBLOD2
	PUSH	HL
	LD	HL,(CKSMF1)
	INC	HL
	LD	(CKSMF1),HL
	POP	HL
	SCF
;
VBLOD2: LD	A,L
	RLA
	LD	L,A
	DEC	H
	JP	NZ,VBLOD1
	CALL	EDGE
	LD	A,L
;
VBLOD3: POP	HL
	POP	DE
	POP	BC
	RET
;
MKRD:	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,02828h
	LD	A,E
	CP	0CCh
	JP	Z,MKRD1
	LD	HL,01414h
;
MKRD1:	LD	(MKLEN),HL
	LD	BC,04000h
	LD	A,14
	OUT	(C),A
MKRD4:	LD	HL,(MKLEN)
;
MKRD5:	CALL	EDGE
	JP	C,MKRD3
	CALL	WAITR
;	LD	A,040h
;	IN	A,(1)		;IN A,(4001H)
;	AND	080h
	JP	Z,MKRD4
	DEC	H
	JP	NZ,MKRD5
;
MKRD2:	CALL	EDGE
	JP	C,MKRD3
	CALL	WAITR
;	LD	A,040h
;	IN	A,(1)		;IN A,(4001H)
;	AND	080h
	JP	NZ,MKRD4
	DEC	L
	JP	NZ,MKRD2
	CALL	EDGE
;
MKRD3:	POP	HL
	POP	DE
	POP	BC
	RET
;
	ORG 2E0h
MOTON:	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	BC,04000h
	LD	A,14		;A PORT SELECT
	OUT	(C),A
	LD	L,00Ah
	LD	BC,06000h
MOTON1: LD	A,040h
	IN	A,(1)		;IN A,(4001H)
	AND	040h
	JP	NZ,MOTON5
;
MOTON6: XOR	A
;
MOTON4: POP	HL
	POP	DE
	POP	BC
	RET
;
MOTON5: LD	A,(IO6000)
	RES	1,A
	OUT	(C),A
	SET	1,A
	OUT	(C),A
	LD	(IO6000),A
	DEC	L
	JP	NZ,MOTON1
	CALL	CR2
	LD	A,D
	CP	0D7h
	JR	Z,MOTON2
	LD	DE,MBUF6
	CALL	DEPRT
	JR	MOTON3
;
MOTON2: LD	DE,MBUF7
	CALL	DEPRT
	LD	DE,MBUF6A
	CALL	DEPRT
;
MOTON3: CALL	CR2
	LD	A,040h
	IN	A,(1)		;IN A,(4001H)
	AND	040h
	JP	Z,MOTON6
	LD	A,080h
	IN	A,(0)		;IN A,(8000H)
	AND	012h
	JP	NZ,MOTON3
	SCF
	JP	MOTON4
;
MOTCH:	PUSH	AF
	PUSH	BC
	PUSH	DE
	LD	D,00Ah
	LD	BC,04000h
	LD	A,14
	OUT	(C),A
	LD	BC,06000h
MOTCH1: LD	A,040h
	IN	A,(1)		;IN A,(4001H)
	AND	040h
	JR	Z,MOTCH2
	POP	DE
	POP	BC
	POP	AF
	RET
;
MOTCH2: LD	A,(IO6000)
	RES	1,A
	OUT	(C),A
	SET	1,A
	OUT	(C),A
	LD	(IO6000),A
	DEC	D
	JP	NZ,MOTCH1
	POP	DE
	POP	BC
	POP	AF
	RET
;
;
WRITEM: DEFM	'WRITING '
	DEFB	0
;
MBUF6:	DEFM	'PUSH '
MBUF6A: DEFM	'PLAY BUTTON'
	DEFB	0
;
MBUF7:	DEFM	'PUSH '
	DEFM	'RECORD & '

	DEFB	0
;
CKSUM:	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	DE,00000h
;
SUM1:	LD	A,B
	OR	C
	JR	NZ,SUM2
	EX	DE,HL
	LD	(CKSMF1),HL
	LD	(CKSMF2),HL
	POP	HL
	POP	DE
	POP	BC
	RET
;
SUM2:	LD	A,(HL)
	PUSH	HL
	LD	H,008h
;
SUM3:	RLCA
	JR	NC,SUM4
	INC	DE
;
SUM4:	DEC	H
	JR	NZ,SUM3
	POP	HL
	INC	HL
	DEC	BC
	JP	SUM1
;
;
;WAITR:	RET			;★원래는 이 자리가 3E
;	LD	E,D			;★원래는 LD A,90
WAITR:
	RET
;	LD  A,1		; 원래는 90
	RET
WAIT2:	DEC	A
	JP	NZ,WAIT2
	RET
;
WRITES: PUSH	AF
	PUSH	BC
	LD	BC,06000h
	LD	A,(IO6000)
;	SET	0,A
;	OUT	(C),A
;	PUSH	AF
;	LD	A,60		;MSX는 38
;	CALL	WAIT2
;	POP	AF
	RES	0,A
	OUT	(C),A
	LD	(IO6000),A
;	LD	A,55		;MSX는 45
;	CALL	WAIT2
	POP	BC
	POP	AF
	RET
;
WRITEL: PUSH	AF
	PUSH	BC
	LD	BC,06000h
	LD	A,(IO6000)
	SET	0,A
	OUT	(C),A
;	PUSH	AF
;	LD	A,120		;MSX는 83
;	CALL	WAIT2
;	POP	AF
;	RES	0,A
;	OUT	(C),A
	LD	(IO6000),A
;	LD	A,115		;MSX는 92
;	CALL	WAIT2
	POP	BC
	POP	AF
	RET
;
WRACC:	PUSH	BC
	LD	B,008h
	CALL	WRITEL		;BIT 1 WRITE
;
WRACC1: RLCA
	CALL	C,WRITEL
	CALL	NC,WRITES
	DEC	B
	JP	NZ,WRACC1
	POP	BC
	RET
;
WRMRK:	PUSH	BC
	PUSH	DE
	LD	A,E
	LD	BC,010h
	LD	DE,02828h
	CP	0CCh
	JP	Z,WMRK1
	LD	BC,010h
	LD	DE,01414h
;
WMRK1:	CALL	WRITES
	DEC	BC
	LD	A,B
	OR	C
	JR	NZ,WMRK1
;
WMRK2:	CALL	WRITEL
	DEC	D
	JR	NZ,WMRK2
;
WMRK3:	CALL	WRITES
	DEC	E
	JR	NZ,WMRK3
	CALL	WRITEL
	POP	DE
	POP	BC
	RET
;
;    MON (MONITOR)
;
;
	ORG 0450H 
MONOP:	PUSH	HL
	LD	(MONSTK),SP
MONCOM: CALL	CR2
	LD	A,'*'		;02AH
	CALL	ACCPRT
MONINP: CALL	MONEDT
	JR	NC,MONINP
	LD	BC,MONCOM
	PUSH	BC
	LD	A,(DE)
	INC	DE
	CP	'*'		;02AH
	RET	NZ
	CALL	DESMAL
	CP	'G'		;047H
	JR	Z,CALLAD		;★원래는 ADJUMP
	CP	'D'		;044H
	JR	Z,MEMDMP
	CP	'M'		;04DH
	JR	Z,MEMWRT
	CP	'S'		;053H
	JP	Z,MONSAH
	CP	'R'		;052H
	RET	NZ
	DEFB	031h		;LD SP,HHHH
MONSTK: DEFW	00000h
	POP	HL
	RET
;
MEMWRT: CALL	HLSET
WRTLP:	CALL	CRHLDS
	CALL	HLINDS
	PUSH	HL
	CALL	LEFT
	CALL	LEFT
	POP	HL
	CALL	MONEDT
	JR	NC,WRTLP
	RET
;
CALLAD: CALL	HLSET		;★원래는 ADJUMP
	RET	C
	JP	(HL)
;
;
MEMDMP: CALL	HLSET
	PUSH	HL
	CALL	HLSET
	JR	NC,HLSTOK
	POP	HL
	PUSH	HL
	LD	BC,0003Fh
	ADD	HL,BC
HLSTOK: LD	(HLEND),HL
	POP	HL
MEMDPL: CALL	DMPSUB
	RET	Z
	DEFB	011h		;LD DE,HHHH
HLEND:	DEFW	0FFFFh		;★원래는 0000H
	EX	DE,HL
	OR	A
	SBC	HL,DE
	EX	DE,HL
	JR	NC,MEMDPL
	RET
;
;
MONDPS: LD	B,C
	JR	DMPSB2
DMPSUB: DEFB	006h		;LD B,008H
LINCNT: DEFB	008h
DMPSB2: CALL	CRHLDS
MEMLP2: CALL	HLINDS
	INC	HL
	DJNZ	MEMLP2
SPCSTP: LD	A,080h
	IN	A,(001h)
	AND	004h
	JR	Z,SPCSTP
	CALL	CR2
	JP	BRKEY
;
MONEDT: LD	DE,KEYBUF
	CALL	INPUTF
	CALL	HLSET
	RET	C
	INC	DE
DATAST: INC	DE
	CALL	ACCSET
	CCF
	RET	NC
	LD	(HL),A
	INC	HL
	JR	DATAST
;
ACCSET: LD	A,(DE)
	CP	';'		;03BH
	JR	NZ,AHEXIN
	INC	DE
	LD	A,(DE)
	INC	DE
	OR	A
	RET
AHEXIN: PUSH	DE
	CALL	HEX2IN		;★원래는 2HEXIN인데 라벨이 숫자부터 시작이 가능했었나보다.
	POP	DE
	RET	C
	INC	DE
	INC	DE
	RET
;
HLSET:	LD	A,(DE)
	INC	DE
	CP	020h
	JR	Z,HLSET
	DEC	DE
	PUSH	HL
	CALL	HEX4IN		;★원래는 4HEXIN인데 라벨이 숫자부터 시작이 가능했었나보다.
	JR	C,HLHOLD
	POP	AF
	INC	DE
	INC	DE
	INC	DE
	INC	DE
	OR	A
	RET
HLHOLD: POP	HL
	RET
;
HEX4IN: PUSH	DE
	CALL	HEX2IN
	JR	C,HEX4ER	;★원래는 4HEXER인데 라벨이 숫자부터 시작이 가능했었나보다.
	LD	H,A
	CALL	HEX2IN
	LD	L,A
HEX4ER: POP	DE
	RET
;
HEX2IN: CALL	BHEXIN
	RET	C
	PUSH	BC
	RLCA
	RLCA
	RLCA
	RLCA
	LD	C,A
	CALL	BHEXIN
	PUSH	AF
	OR	C
	LD	C,A
	POP	AF
	LD	A,C
	POP	BC
	RET
;
BHEXIN: CALL	DESMAL
	SUB	030h
	RET	C
	CP	00Ah
	CCF
	RET	NC
	CP	011h
	RET	C
	SUB	007h
	CP	010h
	CCF
	RET
;
DESMAL: LD	A,(DE)
	INC	DE
	CP	'a'		;061h
	RET	C
	CP	'z'+1		;07Bh
	RET	NC
	SUB	' '		;020h
	RET
;
;
;
HLINDS: CALL	SPPRT
	LD	A,(HL)
HEX2PR: PUSH	AF		;★원래는 2HEXPR인데 라벨이 숫자부터 시작이 가능했었나보다.
	AND	0F0h
	RRCA
	RRCA
	RRCA
	RRCA
	CALL	ASCSET
	CALL	ACCPRT
	POP	AF
	AND	00Fh
	CALL	ASCSET
	JP	ACCPRT
ASCSET: ADD	A,'0'		;030h
	CP	'9'+1		;03Ah
	RET	C
	ADD	A,007h
	RET
;
CRHLDS: CALL	CR2
	LD	A,H
	CALL	HEX2PR
	LD	A,L
	CALL	HEX2PR
	JP	SPPRT
MONSAH: CALL	HLSET
	RET	C
	PUSH	HL
	CALL	HLSET
	POP	BC
	RET	C
	PUSH	HL
	PUSH	BC
	LD	HL,KEYBUF
	CALL	DATAST
	LD	DE,KEYBUF
	OR	A
	SBC	HL,DE
	LD	C,L
	POP	HL
	PUSH	HL
	EXX
	POP	HL
	POP	DE
	EXX
	RET	Z
MNSHLP: CALL	HLDECK
	CALL	Z,MONDPS
	RET	Z
	EXX
	INC	HL
	PUSH	HL
	SCF
	SBC	HL,DE
	POP	HL
	RET	NC
	PUSH	HL
	EXX
	POP	HL
	JR	MNSHLP
;
HLDECK: LD	A,(DE)
	CP	(HL)
	RET	NZ
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	B,C
HLDEC1: LD	A,(DE)
	CP	(HL)
	JR	NZ,HLDEC2
	INC	DE
	INC	HL
	DJNZ	HLDEC1
	XOR	A
HLDEC2: POP	HL
	POP	DE
	POP	BC
	RET
;
SCRNBC: LD	A,C		;SCREEN B,C
	CP	5
	RET	NC
	OR	A
	LD	HL,SCRN00
	JR	Z,SCRNS0
	LD	A,B
	LD	B,0
	DEC	C
	LD	HL,SCRNTB
	RL	C
	ADD	HL,BC
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	DEC	A
PATCH4:	
	RLCA
	RLCA
	RLCA
	RLCA
SCRNS0: LD	E,A
	LD	A,(IO2000)
	AND	0CFh
	OR	E
	CALL	IO20SB
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	LD	(LINEFR),HL
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	LD	(PAGE16+1),HL
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	LD	(PAGE11+1),HL
	LD	(PAGE17+1),HL
	LD	BC,2		;★이 2줄 4바이트는
	ADD	HL,BC		;INC HL 두 번 2바이트면 가능하다.
	LD	A,L
	LD	(PAGE23+1),A
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	LD	(CHRSTA),HL
	LD	(PAGE05+1),HL
	PUSH	HL
	SET	3,H
	LD	(ATRSTA),HL
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	LD	(CHRLEN),HL
	LD	BC,0FFE0h
	ADD	HL,BC
	LD	(CHRLE2),HL
	POP	BC
	ADD	HL,BC
	LD	BC,0001Fh
	ADD	HL,BC
	LD	(PAGE12+1),HL
	SET	3,H
	LD	(PAGE14+1),HL
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	LD	(PAGE02+1),HL
	SET	3,H
	LD	(PAGE04+1),HL
	RET
;
;
;
SCRNTB: DEFW	SCRN01
	DEFW	SCRN02
	DEFW	SCRN03
	DEFW	SCRN04
;
SCRN00: DEFW	LINEF		;LINEFR
	DEFW	LINEF+63	 ;PAGE16
	DEFW	63		 ;PAGE11
	DEFW	00000h		 ;CHRSTA
	DEFW	00800h		 ;CHRLEN
	DEFW	00200h		 ;PAGE02
;
SCRN01: DEFW	LINEF		;LINEFR
	DEFW	LINEF+15	 ;PAGE16
	DEFW	15		 ;PAGE11
	DEFW	00000h		 ;CHRSTA
	DEFW	00200h		 ;CHRLEN
	DEFW	00000h		 ;PAGE02
;
SCRN02: DEFW	LINEF+16	;LINEFR
	DEFW	LINEF+31	 ;PAGE16
	DEFW	15		 ;PAGE11
	DEFW	00200h		 ;CHRSTA
	DEFW	00200h		 ;CHRLEN
	DEFW	00200h		 ;PAGE02
;
SCRN03: DEFW	LINEF+32	;LINEFR
	DEFW	LINEF+47	 ;PAGE16
	DEFW	015		 ;PAGE11
	DEFW	00400h		 ;CHRSTA
	DEFW	00200h		 ;CHRLEN
	DEFW	00400h		 ;PAGE02
;
SCRN04: DEFW	LINEF+48	;LINEFR
	DEFW	LINEF+63	 ;PAGE16
	DEFW	015		 ;PAGE11
	DEFW	00600h		 ;CHRSTA
	DEFW	00200h		 ;CHRLEN
	DEFW	00600h		 ;PAGE02
;DE INPUT ASCII(END=0D 00)
INPUTF: PUSH	AF
	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	A,1
	LD	(FLASHF),A
INKYLP: LD	HL,INKYLP
	PUSH	HL
	CALL	ASCGET
	PUSH	AF
	LD	A,(BELLFG)
	OR	A
	CALL	NZ,BELL2
	POP	AF
	DEFB	0FEh		;CP 03H
BREAKI: DEFB	003h
	JP	Z,BRKJOB
	CP	00Dh
	JP	Z,CRJOB
	JP	ACCOUT
;
BELL:	LD	DE,BELLT2
	LD	HL,01000h
	JR	BELL3
;
BELL2:	LD	DE,BELLTB
	LD	HL,000C0h
BELL3:	LD	BC,04000h
	PUSH	HL
	LD	HL,BELLBF
	XOR	A
	OUT	(C),A
	INC	C
	IN	A,(C)
	LD	(HL),A
	LD	A,(DE)
	OUT	(C),A
	DEC	C
	INC	DE
	INC	HL
	LD	A,1
	OUT	(C),A
	INC	C
	IN	A,(C)
	LD	(HL),A
	LD	A,(DE)
	OUT	(C),A
	DEC	C
	INC	DE
	INC	HL
	LD	A,8
	OUT	(C),A
	INC	C
	IN	A,(C)
	LD	(HL),A
	LD	A,(DE)
	OUT	(C),A
	DEC	C
	INC	DE
	INC	HL
	LD	A,7
	OUT	(C),A
	INC	C
	IN	A,(C)
	LD	(HL),A
	LD	A,(DE)
	OUT	(C),A
	DEC	C
	POP	DE
L0715:	DEC	DE
	LD	A,D
	OR	E
	JR	NZ,L0715
	LD	A,7
	OUT	(C),A
	INC	C
	LD	A,(HL)
	OUT	(C),A
	DEC	C
	DEC	HL
	LD	A,8
	OUT	(C),A
	INC	C
	LD	A,(HL)
	OUT	(C),A
	DEC	C
	DEC	HL
	LD	A,1
	OUT	(C),A
	INC	C
	LD	A,(HL)
	OUT	(C),A
	DEC	C
	DEC	HL
	XOR	A
	OUT	(C),A
	INC	C
	LD	A,(HL)
	OUT	(C),A
	RET
;
BELLBF: DEFS	4
BELLTB: DEFB	208
	DEFB	0
	DEFB	00Ch
	DEFB	07Eh
;
BELLT2: DEFW	0007Fh
	DEFB	00Fh
	DEFB	07Eh
;
BRKJOB: POP	AF
	POP	HL
	PUSH	HL
	LD	(HL),003h
CRJOB2: INC	HL
	LD	(HL),00Dh
	INC	HL
	LD	(HL),000h
INPEND: CALL	CTRLM
ACCEND: POP	DE
	POP	HL
	POP	BC
	POP	AF
	RET
;
CRJOB:	POP	AF
	CALL	BCUYST
	PUSH	DE
	CALL	ECUYS2
	LD	A,E
	POP	DE
	SUB	E
	CP	8
	JR	C,L0770
	LD	A,7
L0770:	RLCA
	RLCA
	RLCA
	RLCA
	RLCA
	LD	D,A
	LD	H,E
	LD	L,0
	CALL	ADRCA2
	POP	HL
	PUSH	HL
CRJOBL: CALL	AINBC
	OR	A
	JR	NZ,L0786
	LD	A,020h
L0786:	LD	(HL),A
	INC	HL
	INC	BC
	DEC	D
	JR	NZ,CRJOBL
	LD	A,020h
CRJOBP: DEC	HL
	CP	(HL)
	JR	Z,CRJOBP
	JR	CRJOB2
;
AINBC:	PUSH	BC		;INSERT키가 눌리면 그 라인의 TEXT 끝부터 32번
	IN	A,(C)		;COLUMN 사이에 BLANK가 있는지 확인
	AND	07Fh
	SET	3,B
	IN	C,(C)
	BIT	2,C
	JR	Z,ALPHA
	BIT	3,C
	JR	NZ,SEMI6
	AND	00Fh
	ADD	A,0E0h
	JR	AINOK
ALPHA:	BIT	3,C
	JR	Z,AINOK
	CP	060h
	JR	NC,AINOK
	ADD	A,080h
AINOK:	POP	BC
	RET
SEMI6:	POP	BC
	XOR	A
	RET
;
BCUYST: CALL	CUTBHL
	XOR	A
LPBNST: CP	(HL)
	RET	Z
	DEC	HL
	DEC	E
	JR	NZ,LPBNST
	RET
;
ECUYST: CALL	CUTBHL
ECUYS2: INC	HL
	INC	E
	LD	A,E
	CP	16		;16라인(1페이지)를 통과했는지 체크
	RET	NC
	XOR	A
	CP	(HL)
	JR	NZ,ECUYS2
	RET
;
CUTBHL: LD	A,(CURY)
ATBHL:	LD	E,A
	LD	D,0
	LD	HL,(LINEFR)
	ADD	HL,DE		;CURY+LINEFR(01 OR 00)
	RET
;
; OUTPUT
CR1DEP: CALL	CR1
;
PRTSDC: PUSH	AF
	PUSH	BC
	PUSH	DE
	LD	A,B
	OR	A
	JR	Z,PRTSDE
PRTSDL: LD	A,(DE)
	INC	DE
	CALL	ACCPRT
	DJNZ	PRTSDL
PRTSDE: POP	DE
	POP	BC
	POP	AF
	RET
;
DEPRT:	PUSH	AF
	PUSH	DE
DEPRTL: LD	A,(DE)
	OR	A
	JR	Z,DEPRTR
	CALL	ACCPRT
	INC	DE
	JR	DEPRTL
DEPRTR: POP	DE
	POP	AF
	RET
;
;
TABPRT: PUSH	HL
	LD	A,(DISFLG)
	CP	2
	LD	HL,CURX
	JR	C,TABPRL
	LD	HL,PRINTN
	JR	Z,TABPRL
	LD	A,','		;02Ch
	CALL	ACCPRT
	POP	HL
	RET
;
TABPRL: CALL	SPPRT
	LD	A,(HL)
	AND	7
	JR	NZ,TABPRL
	POP	HL
	RET
;
CR2:	LD	A,(DISFLG)
	CP	2
	JR	C,CCR2
	JR	NZ,CR1
	LD	A,(PRINTN)
	OR	A
	RET	Z
	JR	CR1
CCR2:	LD	A,(CURX)
	OR	A
	JR	NZ,CR1
	PUSH	HL
	PUSH	DE
	CALL	CUTBHL
	LD	A,(HL)
	POP	DE
	POP	HL
	OR	A
	RET	Z
;
CR1:	LD	A,(DISFLG)
	OR	A
	JR	Z,CR1CTM
	CP	2
	LD	A,00Dh
	JR	NZ,ACCPRT
	LD	A,0FFh
	LD	(PRINTN),A
	LD	A,00Ah
	JR	ACCPRT
;
CR1CTM: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CTRLM
	POP	HL
	POP	DE
	POP	BC
	RET
;
SPPRT:	LD	A,' '		;020h
;
ACCPRT: PUSH	AF
	PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	ACCOUS
	POP	HL
	POP	DE
	POP	BC
	POP	AF
	RET
;
ACCOUS: LD	HL,(DISFLG)
	INC	L
	DEC	L
	JP	Z,ACCDIS
	DEC	L
	JP	Z,ACCOUT
	DEC	L
	JP	NZ,CTOUT
	LD	HL,(PRINTN)
	INC	L
	LD	(PRINTN),HL
;
PRINTR: PUSH	AF
	CALL	PSGST
	LD	E,000h
	CALL	PRTRDY
	LD	A,15
	OUT	(C),A
	INC	C
	POP	AF
	OUT	(C),A
	DEC	C
	LD	A,(IO6000)
	OR	004h
	CALL	IO60SB
	LD	A,(IO6000)
	AND	0FBh
	JP	IO60SB
;
PSGST:	LD	BC,04000h
	LD	A,7
	OUT	(C),A
	INC	C
	IN	A,(C)
	AND	03Fh
	OR	080h
	OUT	(C),A
	DEC	C
	RET
;
PRTRDY: LD	HL,01000h
	LD	D,0
	LD	A,14
	OUT	(C),A
WAITLP: INC	C
	IN	A,(C)
	DEC	C
	AND	020h
	CP	E
	RET	Z
	DEC	D
	JR	NZ,WAITLP
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,WAITLP
	LD	A,28
	JP	ERROR
;
ACCOUT: CP	' '		;020h
	JP	C,CTRLSB
ACCDIS: PUSH	AF
	LD	A,(GMODEF)	;GMODEF 2,3 X
	CP	2
	JR	C,ACCOL1
	CP	4
	POP	BC
	RET	C
	CALL	GACPRT
	JR	ACCOL2
ACCOL1: CALL	ADRCAL
	POP	AF
	CALL	BCOUTA ; 0a3fh
ACCOL2: LD	HL,(CURX)
	INC	L
	LD	A,L
	CP	020h		;다음줄 체크
	JR	C,CURSET
	INC	H
	LD	B,1
CTRLM?: LD	A,H
	CP	16
	JR	C,CURSE?
	PUSH	BC		;16줄(1페이지) 체크
PAGE02: LD	BC,00200h	;CLR CHR
	LD	A,000h			; 소스는 020h
	LD	D,020h
SCRLC1: OUT	(C),A
	INC	BC
	DEC	D
	JR	NZ,SCRLC1
PAGE04: LD	BC,00A00h
	LD	A,(COLORF)
	AND	003h
	LD	D,020h
SCRLC2: OUT	(C),A
	INC	BC
	DEC	D
	JR	NZ,SCRLC2
	CALL	SCRLUP
	LD	H,15
	POP	BC
CURSE?: LD	A,H
	PUSH	HL
	CALL	ATBHL
	LD	(HL),B
	POP	HL
	LD	L,0
CURSET: LD	(CURX),HL
	RET
;
; VIDEO RAM ADDRESS CALCULATION
ADRCAL: LD	HL,(CURX)
ADRCA2: XOR	A
	SRL	H
	RRA
	SRL	H
	RRA
	SRL	H
	RRA
	OR	L
PAGE05: LD	BC,0		;OFSET
	ADD	A,C
	LD	C,A
	LD	A,B
	ADC	A,H
	LD	B,A
	RET
;
;SEMI GRAPHIC
GACPRT: LD	A,B
	CP	060h
	JR	C,ROMACP
	AND	07Fh
	LD	DE,$CGBUF	;LD DE,0554Ah
	JR	GACPR1
ROMACP: SUB	' '		;020h
	LD	DE,CGCHR	;LD DE,0524Ah
GACPR1: LD	L,A
	LD	H,0
	ADD	HL,HL
	ADD	HL,HL
	LD	C,L		;BC=A*4
	LD	B,H
	ADD	HL,HL		;HL=A*8
	ADD	HL,BC		;HL=A*12
	ADD	HL,DE		;HL=A*12+BASE
	EX	DE,HL		;DE=A*12+BASE
	LD	HL,(CURX)
	LD	A,L
	LD	L,0
	LD	C,L
	LD	B,H
	SRL	B
	RR	C
	ADD	HL,BC
	LD	C,A
	LD	B,0
	ADD	HL,BC
	LD	C,L
	LD	B,H
	EX	DE,HL
	LD	E,12
GACPRL: LD	D,(HL)
	OUT	(C),D
	INC	HL
	LD	A,020h
	ADD	A,C
	LD	C,A
	LD	A,0
	ADC	A,B
	LD	B,A
	DEC	E
	JR	NZ,GACPRL
	RET
;
;
SCRLUP: EXX
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	BC,(CHRSTA)
	LD	DE,(CHRLE2)
	CALL	BCLDIR
	LD	BC,(ATRSTA)
	LD	DE,(CHRLE2)
	CALL	BCLDIR
;LINE FLG SCROLL
	LD	DE,(LINEFR)
	LD	H,D
	LD	L,E
	INC	HL
PAGE11: LD	BC,63
	LD	A,(DE)
	LDIR
	LD	(DE),A
	POP	HL
	POP	DE
	POP	BC
	EXX
	RET
;
BCLDIR: PUSH	BC
	EXX
	POP	BC
	LD	HL,SCRLBF
	LD	E,020h
BCLDL1: IN	A,(C)
	LD	(HL),A
	INC	BC
	INC	HL
	DEC	E
	JR	NZ,BCLDL1
BCLDL2: IN	A,(C)
	INC	BC
	EXX
	OUT	(C),A
	INC	BC
	DEC	DE
	LD	A,D
	OR	E
	EXX
	JR	NZ,BCLDL2
	EXX
	LD	HL,SCRLBF
	LD	E,020h
BCLDL3: LD	A,(HL)
	OUT	(C),A
	INC	HL
	INC	BC
	DEC	E
	JR	NZ,BCLDL3
	RET
;
;
;SCROLL DOWN
SCRLDW: EXX
	PUSH	BC
	PUSH	DE
	PUSH	HL
PAGE12: LD	BC,007FFh	;★원래는 DEPRTR
	LD	DE,(CHRLE2)
	CALL	BCLDDR
PAGE14: LD	BC,00FFFh
	DEFB	11h		; LD DE,
CHRLE2: DEFW	007E0h
	CALL	BCLDDR
;LINE FLG SCROLL
PAGE16: LD	DE,LINEF+63
	LD	L,E
	LD	H,D
	DEC	HL
PAGE17: LD	BC,63
	LD	A,(DE)
	LDDR
	LD	(DE),A
	POP	HL
	POP	DE
	POP	BC
	EXX
	RET
;
BCLDDR: PUSH	BC
	EXX
	POP	BC
	LD	HL,SCRLBF+01Fh
	LD	E,020h
BCLDD1: IN	A,(C)
	LD	(HL),A
	DEC	BC
	DEC	HL
	DEC	E
	JR	NZ,BCLDD1
BCLDD2: IN	A,(C)
	DEC	BC
	EXX
	OUT	(C),A
	DEC	BC
	DEC	DE
	LD	A,D
	OR	E
	EXX
	JR	NZ,BCLDD2
	EXX
	LD	HL,SCRLBF+01Fh
	LD	E,020h
BCLDD3: LD	A,(HL)
	OUT	(C),A
	DEC	HL
	DEC	BC
	DEC	E
	JR	NZ,BCLDD3
	RET
;
; 화면에 문자 출력
BCOUTA: CP	'a'-1		;060h
	JR	C,BCOTOK
	CP	0E0h
	JR	NC,SEMIOT
	AND	07Fh
	OUT	(C),A
	SET	3,B
	LD	A,(COLORF)
	AND	3
	OR	8
	OUT	(C),A
	RET
;
BCOTOK: OUT	(C),A
	SET	3,B
	LD	A,(COLORF)
	AND	3
	OUT	(C),A
	RET
;
SEMIOT: AND	00Fh
	PUSH	DE
	LD	D,A
	LD	A,(COLORF)
	DEC	A
	AND	7
	RLCA
	RLCA
	RLCA
	RLCA
	OR	D
	POP	DE
	OUT	(C),A
	SET	3,B
	LD	A,(COLORF)
	AND	3
	OR	4
	OUT	(C),A
	RET
;
CTRLSB: LD	L,A
	LD	H,0
	ADD	HL,HL
	LD	BC,CTRLTB
	ADD	HL,BC
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	JP	(HL)
;
DELETE: CALL	ADRCAL
	PUSH	BC
	CALL	ECUYST
	LD	H,E
	LD	L,0
	CALL	ADRCA2
	POP	DE
	LD	L,C
	LD	H,B
	OR	A
	SBC	HL,DE
	LD	D,000h		;★구버전,신버전 00H,20H ???
	LD	A,(COLORF)
	AND	3
	LD	E,A
DELLP1: DEC	BC
	IN	A,(C)
	OUT	(C),D
	LD	D,A
	SET	3,B
	IN	A,(C)
	OUT	(C),E
	LD	E,A
	RES	3,B
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,DELLP1
	LD	A,(CURX)
	OR	A
	JR	NZ,DELLP2
	PUSH	DE
	CALL	CUTBHL
	LD	A,(HL)
	POP	DE
	OR	A
	RET	Z
DELLP2: DEC	BC
	OUT	(C),D
	SET	3,B
	OUT	(C),E
	JP	LEFT
;
CLR2:	DEFB	001h		;LD BC,(CHRSTA)
CHRSTA: DEFW	00000h		;SEMIGRAPHIC ADR.+
	LD	HL,(CHRLEN)
	LD	D,000h		;★구버전,신버전 00H,20H ???
CLRLP:	OUT	(C),D
	INC	BC
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,CLRLP
	DEFB	001h		;LD BC,(ATRSTA)
ATRSTA: DEFW	00800h
	DEFB	021h		;LD HL,(CHRLEN)
CHRLEN: DEFW	00800h
	LD	A,(COLORF)
	AND	3
	LD	D,A
ATRCLS: OUT	(C),D
	INC	BC
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,ATRCLS
	DEFB	021h		;LD HL,(LINEFR)
LINEFR: DEFW	LINEF
PAGE23: LD	B,65
LINCLS: LD	(HL),0
	INC	HL
	DJNZ	LINCLS
HOME:	LD	HL,0
	JP	CURST2
;
INST:	CALL	ECUYST
	LD	H,E
	LD	L,0
	CALL	ADRCA2
	DEC	BC
	CALL	AINBC
	CP	021h
	RET	NC
	PUSH	BC
	CALL	ADRCAL
	POP	HL
	OR	A
	SBC	HL,BC
	LD	D,000h		;★구버전,신버전 00H,20H ???
	LD	A,(COLORF)
	AND	3
	LD	E,A
	INC	HL
INSTL1: IN	A,(C)
	OUT	(C),D
	LD	D,A
	SET	3,B
	IN	A,(C)
	OUT	(C),E
	LD	E,A
	RES	3,B
	INC	BC
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,INSTL1
	RET
;
LOCK:	LD	A,1
LOCKST: LD	(LOCKMD),A
	RET
;
UNLOCK: XOR	A
	JR	LOCKST
;
LEFT:	LD	HL,(CURX)
	DEC	L
	LD	A,L
	CP	0FFh
	JR	NZ,CURST2
	LD	L,01Fh
UPCUR:	DEC	H
	LD	A,H
	CP	0FFh
	JR	NZ,CURST2
	PUSH	HL
	CALL	SCRLDW
	POP	HL
	LD	H,0
	JR	CURST2
;
CTRLM:	CALL	ECUYST
	LD	H,E
	LD	B,0
	JP	CTRLM?
;
RIGHT:	LD	HL,(CURX)
	INC	L
	LD	A,L
	CP	020h
	JR	C,CURST2
	LD	L,0
DOWNLB: INC	H
	LD	A,H
	CP	16
	JR	C,CURST2
	PUSH	HL
	CALL	SCRLUP
	POP	HL
	LD	H,15
CURST2: LD	(CURX),HL
	RET
;
UP:	LD	HL,(CURX)
	JR	UPCUR
;
DOWN:	LD	HL,(CURX)
	JR	DOWNLB
;
CTRLG:	LD	A,(BELLFG)
	XOR	1
	LD	(BELLFG),A
	JP	BELL
;
CTRLB:	LD	DE,00000h
	LD	HL,LEFT
	LD	(CTRLBF+1),HL
CTRLB1: CALL	CBFCEK
	RET	Z
	JR	C,CTRLB1
CTRLB2: CALL	CBFCEK
	RET	Z
	JR	NC,CTRLB2
	JP	RIGHT
;
CTRLF:	LD	DE,00F1Fh
	LD	HL,RIGHT
	LD	(CTRLBF+1),HL
CTRLF1: CALL	CBFCEK
	RET	Z
	JR	NC,CTRLF1
CTRLF2: CALL	CBFCEK
	RET	Z
	JR	C,CTRLF2
	RET
;
CBFCEK: LD	HL,(CURX)
	OR	A
	SBC	HL,DE
	RET	Z
	PUSH	DE
CTRLBF: CALL	RIGHT
	CALL	ADRCAL
	CALL	AINBC
	POP	DE
	CP	'0'		;030h
	RET	C
	CP	'9'+1		;03Ah
	CCF
	RET	NC
	CP	'A'		;041h
	RET	C
	CP	080h
	JR	C,L0BEC
	OR	A
	RET
L0BEC:	AND	01Fh
	JR	Z,L0BF4
	CP	01Bh
	CCF
	RET	NC
L0BF4:	AND	1
	RET
;
CTRLY:	LD	D,0		;★라벨이 빠져있었음
	JR	CTRLYT
;
CTRLT:	LD	D,1
CTRLYT: LD	HL,(CURX)
	LD	H,0
	LD	BC,TABBUF
	ADD	HL,BC
	LD	(HL),D
	RET
;
CTRLI:	CALL	RIGHT
	LD	A,(CURX)
	CP	31
	RET	Z
	LD	L,A
	LD	H,0
	LD	BC,TABBUF
	ADD	HL,BC
	LD	A,(HL)
	OR	A
	JR	Z,CTRLI
	RET
;
CTRLE:	CALL	ECUYST
	LD	H,E
	LD	L,0
	JR	CTRLEZ
;
CTRLZ	CALL	CUTBHL
	LD	A,16
	SUB	E
	LD	B,A
	INC	HL
CTRLZ1: LD	(HL),0
	INC	HL
	DJNZ	CTRLZ1
	LD	HL,01000h
CTRLEZ: CALL	ADRCA2
	DEC	BC
	PUSH	BC
	CALL	ADRCAL
	POP	HL
	LD	D,B
	LD	E,C
	OR	A
	SBC	HL,DE
	INC	HL
	LD	D,000h		;구버전,신버전
	LD	A,(COLORF)
	AND	003h
	LD	E,A
CTRLZE: OUT	(C),D
	SET	3,B
	OUT	(C),E
	RES	3,B
	INC	BC
	DEC	HL
	LD	A,H
	OR	L
	JR	NZ,CTRLZE
	RET
;
; KEY GET
BRKEY:	LD	A,080h
	IN	A,(0)
	AND	012h
	RET
;
ASCGET: PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,(POINT1)
	LD	A,L
	CP	H
	JR	Z,BUFSET
BUFCEK: INC	A
	AND	03Fh
	LD	(POINT1),A
	LD	L,A
	LD	H,0
	LD	DE,INKYBF
	ADD	HL,DE
	LD	A,(HL)
GETRET: POP	HL
	POP	DE
	POP	BC
	RET
;
BUFSET: DEFB	03Eh		; LD A,
FLASHF: DEFB	001h		;
	OR	A
	JR	NZ,FLGET
	CALL	KEYSEN
	CALL	BRKEY
	JR	NZ,KEYGT
BRKGTR: CALL	NEWFLG
	LD	A,3
	JR	GETRET
KEYGT:	CALL	KEYSEN
	JR	Z,ZERORT
	CALL	NEWCEK
	JR	NZ,NEWKYS
	CALL	SAMECK
	JR	Z,REPETS
ZERORT: CALL	NEWFLG
ZEROR2: XOR	A
	JR	GETRET
FLGET:	CALL	FLSHGT
	LD	C,A
	LD	A,080h
	IN	A,(0)
	AND	012h
	JR	Z,BRKGTR
	LD	A,C
	OR	A
	JR	Z,NEWKYS
REPETS: CALL	NEWFLG
	DEFB	021h		; LD HL,(KEYBFA)
KEYBFA: DEFW	0FFFEh		;
	DEFB	03Eh		; LD A,(KEYBFD)
KEYBFD: DEFB	000h
	LD	(HL),A
	LD	HL,30
	JR	KEYST2
NEWKYS: CALL	NEWFLG
	DEFB	021h		; LD HL,300
REPTSW: DEFW	200		; auto repeat key duration
KEYST2: LD	(REPETF),HL
	LD	HL,NEWBUF
	LD	D,0
	LD	C,9
SETLP1: LD	B,8
	LD	A,(HL)
	CPL
	OR	A
	JR	Z,SETPL3
SETPL2: RRCA
	JP	C,KYBFST
	INC	D
	DJNZ	SETPL2
	JR	SETPL4
SETPL3: LD	A,D
	ADD	A,8
	LD	D,A
SETPL4: INC	HL
	DEC	C
	JR	NZ,SETLP1
KYBFSR: LD	HL,(POINT1)
	LD	A,L
	CP	H
	JP	Z,ZEROR2
	JP	BUFCEK
;
FLASHS: CALL	ADRCAL
	SET	3,B
	LD	(FLASHA),BC
	IN	A,(C)
	LD	(FLASHD),A
	OR	1
	OUT	(C),A
	LD	(FLASHO),A
	LD	A,(TICONT)
	LD	(FLASHC+1),A	;★"+1"이 빠져있었음.
	RET			;
;
;
FLASHG: DEFB	001h
FLASHA: DEFW	0
	DEFB	03Eh		; LD A,
FLASHD: DEFB	000h		;
	AND	0FEh
	LD	E,A
	LD	A,(TICONT)
FLASHC: SUB	0			; cursor blink time
	AND	010h
	LD	A,001h
	JR	Z,L0D28
	XOR	A
L0D28:	OR	E
	DEFB	0FEh		;CP
FLASHO: DEFB	000h
	RET	Z
	OUT	(C),A
	LD	(FLASHO),A
	RET
;
FLASHE: LD	BC,(FLASHA)
	LD	A,(FLASHD)
	OUT	(C),A
	RET
;
;
FLSHGT: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	FLASHS
FLGTLP: CALL	FLASHG
	CALL	KEYSEN
	JR	Z,FLSHL3
	CALL	NEWCEK
	LD	A,0
	JR	NZ,FLSHRT
	CALL	SAMECK
	JR	NZ,FLGTLP
	DEFB	021h		; LD HL,
REPETF: DEFW	00000h		;
	DEC	HL		;+
	LD	(REPETF),HL
	LD	A,H
	OR	L
	JR	NZ,FLGTLP
	LD	A,1
	JR	FLSHRT
FLSHL3: CALL	NEWFLG
FLGTL2: CALL	FLASHG
	CALL	KEYSEN
	JR	Z,FLGTL2
	XOR	A
FLSHRT: PUSH	AF
	CALL	FLASHE
	POP	AF
	POP	HL
	POP	DE
	POP	BC
	RET
;
;
;
KEYSEN: CALL	KEYSN2
KEYSN0: LD	B,4
KEYSN1: CALL	KEYSN2
	BIT	1,E
	JR	NZ,KEYSN0
	DJNZ	KEYSN1
	LD	A,E
	AND	1
	RET
;
KEYSN2: LD	HL,NEWBUF
	PUSH	BC
	LD	BC,08009h	;KEYIO
	LD	DE,00900h
KEYSN3: IN	A,(C)
	XOR	(HL)
	JR	Z,L0D9D
	SET	1,E
L0D9D:	XOR	(HL)
	LD	(HL),A
	CPL
	OR	A
	JR	Z,L0DA5
	SET	0,E
L0DA5:	INC	HL
	DEC	BC
	DEC	D
	JR	NZ,KEYSN3
	IN	A,(C)
	XOR	(HL)
	JR	Z,L0DB1
	SET	1,E
L0DB1:	XOR	(HL)
	LD	(HL),A
	AND	012h
	JR	NZ,L0DB9
	SET	0,E
L0DB9:	POP	BC
	RET
;
NEWCEK: LD	HL,OLDBUF
	LD	DE,NEWBUF
	LD	B,9
NEWPL1: LD	A,(DE)
	CPL
	AND	(HL)
	RET	NZ
	INC	DE
	INC	HL
	DJNZ	NEWPL1
	LD	A,(DE)
	CPL
	AND	(HL)
	AND	010h
	RET
;
SAMECK: LD	HL,OLDBUF
	LD	DE,NEWBUF
	LD	B,10
SAMELP: LD	A,(DE)
	XOR	(HL)
	RET	NZ
	INC	DE
	INC	HL
	DJNZ	SAMELP
	RET
;
NEWFLG: LD	HL,NEWBUF
	LD	DE,OLDBUF
	LD	B,9
FLGLP1: LD	A,(DE)
	CPL
	OR	(HL)
	LD	C,(HL)
	LD	(HL),A
	LD	A,C
	LD	(DE),A
	INC	DE
	INC	HL
	DJNZ	FLGLP1
	LD	A,(HL)
	LD	(DE),A
	LD	DE,NEWBUF
	LD	HL,OLDBUF
	LD	BC,00900h
FLGLP2: LD	A,(DE)
	CPL
	OR	A
	JR	Z,FLGLP3
	DEC	C
	JR	NZ,FLGLP5
	OR	(HL)
	LD	(HL),A
	LD	A,0FFh
	LD	(DE),A
FLGLP4: LD	C,1
FLGLP3: INC	DE
	INC	HL
	DJNZ	FLGLP2
	RET
FLGLP5: PUSH	BC
	LD	BC,00801h
FLGLP6: RRCA
	JR	C,FLGLP7
	RLC	C
	DJNZ	FLGLP6
	POP	BC
	JR	FLGLP4
FLGLP9: RRCA
	CALL	C,FLGLP8
FLGLP7: RLC	C
	DJNZ	FLGLP9
	POP	BC
	JR	FLGLP4
;
FLGLP8: PUSH	AF
	LD	A,C
	OR	(HL)
	LD	(HL),A
	LD	A,(DE)
	OR	C
	LD	(DE),A
	POP	AF
	RET
;
;
KYBFST: LD	A,(HL)
	LD	(KEYBFA),HL
	LD	(KEYBFD),A
	LD	C,D
	LD	B,0
	LD	HL,KEYDT1	;NORMAL DATA
	LD	A,(NEWMOD)
	BIT	1,A
	JR	NZ,L0E4C
	LD	HL,KEYDT2	;SHIFT DATA
L0E4C:	ADD	HL,BC
	LD	C,(HL)
	LD	B,A
	BIT	2,B
	JR	NZ,CTRLNO
	LD	A,C
	SUB	040h
	JR	C,NONKE?
	AND	01Fh
	JR	SETKY
CTRLNO: BIT	6,B
	JR	NZ,SETKY2
	LD	A,C
	SUB	040h
	JR	C,NONKEY
	AND	01Fh
	ADD	A,080h
SETKY:	CALL	BFSTSB
NONKEY: JP	KYBFSR
NONKE?: ADD	A,010h
	CP	004h
	JR	NC,NONKEY
	LD	(COLORF),A
	JR	NONKEY
;
;
SETKY2: LD	A,C
	CP	0F0h
	JR	NC,FUNCTN
	LD	A,(LOCKMD)
	OR	A
	LD	A,C
	JR	Z,SETKY
	CP	041h
	JR	C,SETKY
	AND	01Fh
	CP	01Bh
	LD	A,C
	JR	NC,SETKY
	XOR	020h
	JR	SETKY
FUNCTN: SUB	0F1h
	LD	L,A
	LD	H,0
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	BC,FUNBUF
	ADD	HL,BC
	LD	B,(HL)
	INC	HL
	LD	A,B
	OR	A
	JR	Z,NONKEY
FUNCLP: LD	A,(HL)
	CALL	BFSTSB
	INC	HL
	DJNZ	FUNCLP
	JR	NONKEY
BFSTSB: PUSH	HL
	PUSH	BC
	LD	C,A
	LD	HL,(POINT1)
	LD	A,H
	INC	A
	AND	03Fh
	CP	L
	JR	Z,NONSET
	LD	(POINT2),A
	LD	L,A
	LD	H,0
	LD	A,C
	LD	BC,INKYBF
	ADD	HL,BC
	LD	(HL),A
NONSET: POP	BC
	POP	HL
NORET:	RET
;
;
MUSIC:	PUSH	DE
MUSL1:	LD	A,(DE)
	CP	':'		;03Ah
	INC	DE
	JR	Z,MUSL2
	DJNZ	MUSL1
	JR	MUSL6
MUSL2:	LD	L,E
	LD	H,D
MUSL4:	DJNZ	MUSL3
	JR	MUSL7
MUSL3:	LD	A,(DE)
	INC	DE
	CP	':'		;03Ah
	JR	NZ,MUSL4
	JR	MUSL5
MUSL6:	LD	HL,MUSNUL
MUSL7:	LD	DE,MUSNUL
MUSL5:	POP	BC
; BC=SOUND A
; HL=SOUND B
; DE=SOUND C
;

MUSLOP: PUSH	BC
	EXX
	POP	DE
	LD	BC,LENG?A
	CALL	SOUSET
	PUSH	DE
	EXX
	POP	BC
	PUSH	HL
	EXX
	POP	DE
	LD	BC,LENG?B
	CALL	SOUSET
	PUSH	DE
	EXX
	POP	HL
	PUSH	DE
	EXX
	POP	DE
	LD	BC,LENG?C
	CALL	SOUSET
	PUSH	DE
	EXX
	POP	DE
	EXX
;
	CALL	DELAYS
;
	LD	BC,LENG?A
	CALL	SOUSTP
	LD	BC,LENG?B
	CALL	SOUSTP
	LD	BC,LENG?C
	CALL	SOUSTP
	EXX
;
	CALL	ENDCHK
	JR	NZ,MUSLOP
	RET
;
; SUB
SOUSET: LD	A,(BC)
	OR	A
	RET	NZ
	DEC	BC		;BC=OCT.A
;
SOUST2: LD	A,(DE)
	CP	':'		;03Ah
	RET	Z
;
	CP	'V'		;056h VOLUME
	JR	NZ,VOLOK
	INC	DE
	LD	A,(DE)
	SUB	'0'		;030h
	JR	C,SOUST2
	CP	10		 ;00Ah
	JR	NC,SOUST2
	INC	DE
	CP	1
	JR	NZ,VOLST
	LD	A,(DE)
	SUB	'0'		;030h
	JR	C,VOLST2
	CP	6
	JR	NC,VOLST2
	ADD	A,10
	INC	DE
	JR	VOLST
VOLST2: LD	A,1
VOLST:	LD	L,A
	INC	BC
	INC	BC
	LD	A,(BC)
	DEC	BC
	DEC	BC
	PUSH	BC
	LD	BC,04000h	;PSG ADR.
	OUT	(C),A
	INC	C		;PSG DATA AD.
	OUT	(C),L
	POP	BC
	JR	SOUST2
;
VOLOK:	CP	'O'		; OCTAVE
	JP	NZ,OCTOK
	INC	DE
	LD	A,(DE)
	SUB	'1'		;031h
	JR	C,SOUST2
	CP	8
	JR	NC,SOUST2
	LD	(BC),A		;OCT. SET
	INC	DE
	JR	SOUST2
;
OCTOK:	EX	AF,AF'
	LD	A,(BC)		;OCT. READ
	EX	AF,AF'
OCTOK2: LD	A,(DE)
	CP	'+'		;02Bh
	JR	NZ,OCTNOP
	INC	DE
	EX	AF,AF'
	CP	7
	JR	Z,OCTNO
	INC	A
OCTNO:	EX	AF,AF'
	JR	OCTOK2
OCTNOP: CP	'-'		;02Dh
	JR	NZ,OCTNOM
	INC	DE
	EX	AF,AF'
	OR	A
	JR	Z,L0F9A
	DEC	A
L0F9A:	JR	OCTNO
;
OCTNOM: LD	HL,NUMTBL
	CP	'#'		;023h
	JR	NZ,NUMOK
	INC	DE
	LD	HL,UPTBL
	LD	A,(DE)
NUMOK:	INC	DE
	CP	'R'		;052h
	JR	Z,SOUOFF
	SUB	'A'		;041h
	JP	C,SOUST2
	CP	7
	JP	NC,SOUST2
	PUSH	DE
	LD	E,A
	LD	D,0
	EX	DE,HL
	ADD	HL,HL
	ADD	HL,DE
	DEC	BC		;PSG DATA7
	DEC	BC		;DATA HIGH
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	EX	AF,AF'
OCTDVL: OR	A
	JR	Z,OCTDIV
	RR	H
	RR	L
	DEC	A
	JR	NZ,OCTDVL
OCTDIV: EX	DE,HL
	LD	L,C
	LD	H,B
	LD	(HL),D
	DEC	HL		;DATA LOW
	LD	(HL),E
	DEC	HL		;DATA ADR.
	DEC	HL		;LEN.A
	POP	DE
	LD	A,(DE)
	SUB	'0'		;030h
	JR	C,SOUON
	CP	10;
	JR	NC,SOUON
	CALL	LENGSB
	INC	DE
	LD	(HL),A
SOUON:	PUSH	DE
	LD	E,(HL)		;LENG.?
	INC	HL
	LD	D,(HL)		;PSG ADR.
	INC	HL
	LD	BC,04000h	;PSG ADR
	LD	A,(HL)
	OUT	(C),D
	INC	C
	OUT	(C),A
	INC	HL
	DEC	C
	INC	D
	LD	A,(HL)
	OUT	(C),D
	INC	C
	OUT	(C),A
	INC	HL
	DEC	C
	LD	D,7
	OUT	(C),D
	INC	C
	IN	A,(C)
	AND	(HL)
	OUT	(C),A
	INC	HL		;OCT.A
	INC	HL		;LENG.A
	LD	(HL),E
	POP	DE
	RET
;
;
SOUOFF: DEC	BC
	DEC	BC
	DEC	BC
	DEC	BC
	DEC	BC
	LD	A,(DE)
	SUB	'0'		;030h
	JR	C,SOUOFE
	CP	10
	JR	NC,SOUOFE
	CALL	LENGSB
	INC	DE
	LD	(BC),A
SOUOFE: LD	A,(BC)
	INC	BC
	INC	BC
	INC	BC
	INC	BC
	INC	BC
	INC	BC
	LD	(BC),A
SOUOFS: DEC	BC
	DEC	BC
	LD	A,(BC)
	CPL
	LD	BC,04000h	;PSG ADR.
	LD	L,7
	OUT	(C),L
	INC	C
	IN	H,(C)
	OR	H
	OUT	(C),A
	RET
;
SOUSTP: LD	A,(BC)
	OR	A
	JR	Z,SOUOFS
	DEC	A
	LD	(BC),A
	RET
;
BRKRET: LD	BC,04000h
	LD	L,7
	OUT	(C),L
	INC	C
	IN	A,(C)
	OR	7
	OUT	(C),A
	XOR	A
	RET
;
ENDCHK: LD	A,080h		;BREAK CHECK
	IN	A,(0)
	AND	012h
	JR	Z,BRKRET
	LD	A,(BC)
	CP	':'
	RET	NZ
	LD	A,(DE)
	CP	':'
	RET	NZ
	LD	A,(HL)
	CP	':'
	RET	NZ
	LD	A,(LENG?A)
	OR	A
	RET	NZ
	LD	A,(LENG?B)
	OR	A
	RET	NZ
	LD	A,(LENG?C)
	OR	A
	RET	NZ
	JR	BRKRET
;
;
;
DELAYS: LD	HL,(MSDT32)
; DELAY1MS SUB
DELAY1: LD	DE,152		;10
DELAY2: DEC	DE		;6
	LD	A,D		;4
	OR	E		;4
	JR	NZ,DELAY2	;12
	DEC	HL		;6
	LD	A,H		;4
	OR	L		;4
	JR	NZ,DELAY1	;12
	RET
LENGSB: PUSH	BC
	PUSH	HL
	LD	C,A
	LD	B,0
	LD	HL,LENGTB
	ADD	HL,BC
	LD	A,(HL)
	POP	HL
	POP	BC
	RET
;
;
XTEMPO: LD	(MSDT32),A
;
	RET
;
;
SOUNDS: LD	A,E
	OR	A
	LD	HL,000FEh
	JR	Z,SOUND1
	DEC	A
	LD	HL,002FDh
	JR	Z,SOUND1
	LD	HL,004FBh
SOUND1: LD	A,D
	AND	7
	JR	Z,SOUND2
	PUSH	HL
	LD	BC,NUMTBL
	BIT	3,D
	JR	Z,SOUND3
	LD	BC,UPTBL
SOUND3: DEC	A
	LD	L,A
	LD	H,0
	ADD	HL,HL
	ADD	HL,BC
	LD	A,D
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	RRCA
	RRCA
	RRCA
	RRCA
	AND	00Fh
	JR	Z,SOUND4
SOUND5: SRL	D
	RR	E
	DEC	A
	JR	NZ,SOUND5
SOUND4: POP	HL
	LD	BC,04000h
	OUT	(C),H
	INC	C
	OUT	(C),E
	INC	H
	DEC	C
	OUT	(C),H
	INC	C
	OUT	(C),D
	DEC	C
	LD	A,7
	OUT	(C),A
	INC	C
	IN	A,(C)
	AND	L
	OUT	(C),A
	RET
;
SOUND2: LD	BC,04000h
	LD	A,7
	OUT	(C),A
	INC	C
	IN	H,(C)
	LD	A,L
	CPL
	OR	H
	OUT	(C),A
	RET
;
;
; DATA TABLE
;
;
MSDT32: DEFW	62
;
MUSNUL: DEFM	':'		;:
;
LENGTB: DEFB	1
	DEFB	2
	DEFB	3
	DEFB	4
	DEFB	6
	DEFB	8
	DEFB	00CH
	DEFB	010h
	DEFB	018h
	DEFB	020h
;
LEN?A:	DEFB	008h		;R5
	DEFB	000h
DATA?A: DEFW	00000h
	DEFB	0FEh
OCT?A:	DEFB	003h
LENG?A: DEFB	000h
	DEFB	008h
;
LEN?B:	DEFB	008h
	DEFB	002h
DATA?B: DEFW	00000h
	DEFB	0FDh
OCT?B:	DEFB	3
LENG?B: DEFB	0
	DEFB	9
;
LEN?C:	DEFB	8
	DEFB	4
DATA?C: DEFW	00000h
	DEFB	0FBh
OCT?C:	DEFB	3
LENG?C: DEFB	0
	DEFB	10
;
;
NUMTBL: DEFW	007F2h		;A
	DEFW	00714h		;B
	DEFW	00D5Dh		;C
	DEFW	00BE7h		;D
	DEFW	00A9Bh		;E
	DEFW	00A02h		;F
	DEFW	008EBh		;G
;
UPTBL:	DEFW	00780h		;A#
	DEFW	00714h		;B
	DEFW	00C9Ch		;C#
	DEFW	00B3Ch		;D#
	DEFW	00A9Bh		;E
	DEFW	00973h		;F#
	DEFW	0086Bh		;G#
;
CTRLTB: DEFW	NORET		;@
	DEFW	NORET		;A
	DEFW	CTRLB		;B
	DEFW	CTRLM		;C
	DEFW	SCRLDW		;D
	DEFW	CTRLE		;E
	DEFW	CTRLF		;F
	DEFW	CTRLG		;G
	DEFW	DELETE		;H 315ah ?? 
	DEFW	CTRLI		;I
	DEFW	NORET		;J
	DEFW	HOME		;K HOME
	DEFW	CLR2		;L CLR
	DEFW	CTRLM		;M CR
	DEFW	NORET		;N
	DEFW	NORET		;O
	DEFW	NORET		;P
	DEFW	NORET		;Q
	DEFW	INST		;R INST
	DEFW	NORET		;S
	DEFW	CTRLT		;T
	DEFW	SCRLUP		;U
	DEFW	LOCK		;V LOCK
	DEFW	UNLOCK		;W UNLOCK
	DEFW	NORET		;X
	DEFW	CTRLY		;Y
	DEFW	CTRLZ		;Z
	DEFW	NORET		;ESC
	DEFW	RIGHT		;RIGHT
	DEFW	LEFT		;LEFT
	DEFW	UP		;UP
	DEFW	DOWN		;DOWN


BELLFG: DEFB	0		;CTRL-G
;
COLORF: DEFB	0		; Color Flag
GCOLOR: DEFB	0		; Graphic Color
SCRLBF: DEFS	020h	; scroll buffer
LINEF:  DEFS	65		; line return flag
;
CKSMF1: DEFW	0		; checksum field
CKSMF2: DEFW	0		; checksum field
MKLEN:	DEFW	0
;
IO6000: DEFB	0		; 6000H I/O data
IO2000: DEFB	0		; 2000H I/O data
DISFLG: DEFB	1		; output flag (console=1, printer=2)
PRINTN: DEFB	0		; printer header
;
CURX:	DEFB	0		; cursor X
CURY:	DEFB	0		; cursor Y
OLDBUF: DEFS	10		; keyboard matrix old buffer
NEWBUF: DEFS	9		; keyboard matrix new buffer
NEWMOD: DEFB	0FFh	; keyboard matrix mode flag
;
LOCKMD: DEFB	0		; LOCK mode
POINT1: DEFB	0		; key input buffer 
POINT2: DEFB	0		; key input buffer 
INKYBF: DEFS	040h	; key input buffer
TABBUF: DEFS	32		; TAB flag
;
;
FUNBUF: DEFB	5		; function definition
	DEFM	'AUTO'
	DEFB	00Dh
	DEFS	10
	DEFB	6
	DEFM	'SCREEN'

	DEFB	0
	DEFS	8
	DEFB	3
	DEFM	'KEY'
	DEFB	0
	DEFS	11
	DEFB	5
	DEFM	'LIST'
	DEFB	00Dh
	DEFS	00Ah
	DEFB	4
	DEFM	'RUN'
	DEFB	00Dh
	DEFS	11
	DEFB	5
	DEFM	'LOAD'
	DEFB	00Dh
	DEFS	10
	DEFB	5
	DEFM	'BEEP'
	DEFB	00Dh
	DEFS	10
	DEFB	5
	DEFM	'CHR$('

	DEFB	0
	DEFS	9
	DEFB	4
	DEFM	'EDIT'
	DEFB	0
	DEFS	10
	DEFB	5
	DEFM	'CONT'
	DEFB	00Dh
	DEFS	10
;
KEYDT1: DEFW	0F500h		;8009  No Shift
	DEFM	'-0;'		;'
	DEFW	06F6Ch		;LO
	DEFM	'9'		;9
	DEFW	0F400h		;8008
	DEFB	01Fh
	DEFM	':/'		;/
	DEFW	0696Bh		;KI
	DEFM	'8'
	DEFW	0F300h		;8007
	DEFW	0701Eh		;P
	DEFM	'.'		;★원래는3F(?)였음
	DEFW	0756Ah		;JU
	DEFM	'7'
	DEFW	0F200h		;8006
	DEFW	07840h		;X
	DEFM	','
	DEFW	07968h		;HV
	DEFM	'6'
	DEFW	0F100h		;8005
	DEFW	05D1Dh
	DEFW	0676Dh		;MG
	DEFW	03574h		;T5
	DEFW	00000h		;8004
	DEFW	07C1Ch
	DEFW	0666Eh		;NF
	DEFW	03472h		;R4
	DEFW	00008h		;DEL ;8003
	DEFW	05B1Bh
	DEFW	06462h		;BD
	DEFW	03365h		;E3
	DEFW	00016h		;LOCK ;8002
	DEFW	05D7Ah		;Z^
	DEFW	07376h		;VS
	DEFW	03277h		;W2
	DEFW	00B5Eh		;HOME ;8001
	DEFW	00D20h
	DEFW	06163h		;CA
	DEFW	03171h		;Q1
;
;
;
KEYDT2: DEFW	0FA00h	; Shift
	DEFM	'=0+LO)'

	DEFW	0F900h
	DEFB	01Fh
	DEFM	'*?KI('

	DEFW	0F800h
	DEFB	01Eh
	DEFM	'P>JU'
	DEFB	027h
	DEFW	0F700h
	DEFB	060h
	DEFM	'X<HY&'

	DEFW	0F600h
	DEFW	07D1Dh
	DEFM	'MGT%'
	DEFW	00000h
	DEFW	07F1Ch
	DEFM	'NFR$'
	DEFW	00012h		;INST
	DEFW	07B1Bh
	DEFM	'BDE#'
	DEFW	00017h		;LOCK
	DEFM	'Z'
	DEFB	07Dh
	DEFM	'VSW"'
	DEFW	00C7Eh		;CLR
	DEFW	00D20h
	DEFM	'CAQ!'
;
; FILE
;  CONTROL
;   BLOCK
;
;
FILMOD: DEFB	0001h	; 1=기계어, 2=베이직
FILNAM: DEFS	17		; 프로그램 이름 17 BYTE
MTBYTE: DEFW	1		; 프로그램 크기
MTADRS: DEFW	0		; 프로그램 저장번지
MTEXEC: DEFW	0		; CP/M에서 시작번지
PROTCT: DEFW	0		; 3A 00 이 들어있으면 베이직 자동실행
	DEFS	01416h - $		; 102 BYTE

;
; HUDSON BASIC V1.0
;

;SPBUF   EQU  02232h
	JR	HOTENT
$BASIC:
COLDST: LD	DE,KEYBUF
	LD	B,64
MESOFF: CALL	PRTSDC
	LD	A,001h
	LD	(MESOFF),A
PATCH1:	
	LD	HL,KEYBUF
	LD	D,0FFh		;MEM.MAX
L0014:
	XOR	A
	LD	(HL),A
	CP	(HL)
	JR	NZ,L001E
	INC	HL
	LD	A,H
	CP	D
	JR	NZ,L0014
L001E:    
	LD	(MEMMAX),HL
	CALL	MEMSET
	CALL	GSAVES		;PCG SET
START:	CALL	NEW
	LD	HL,00000h
	LD	(PROTCT),HL	;CMT BUFF
HOTENT: CALL	CLR
	LD	SP,(STRTOP)
	LD	HL,0FFFFh
	PUSH	HL
	LD	(SPBUF),SP
	XOR	A
	LD	(CONTFG),A
	LD	(ERRORF),A
	LD	(FILEFG),A
	CALL	TROFF
OK:	CALL	CR2
	LD	A,1
	LD	(DISFLG),A
	LD	DE,OKMES
	LD	B,2
	CALL	PRTSDC
	LD	B,020h
	LD	A,(CONTFG)
	OR	A
	JR	Z,CONTDS
	LD	B,02Eh
CONTDS: LD	A,B
	CALL	ACCPRT
	LD	A,(GMODEF)
	CP	2
PATCH6:	
	CALL	NC,GRAPHI
;
NMESOK: CALL	CR2
AUTOBK: LD	SP,(SPBUF)
	CALL	SETSSP
KEYINP: LD	HL,KEYINP
	PUSH	HL
	CALL	AUTOVC
MERGEV: LD	DE,KEYBUF
	DEFB	0CDH		;CALL
LODVEC: DEFW	LININP
	JP	C,AUTOFF
BLNKSK: LD	A,(DE)
	CP	020h
	INC	DE
	JR	Z,BLNKSK
	DEC	DE
	OR	A
	RET	Z
	CP	027h
	RET	Z
	CP	030h
	JR	NC,L00A5
	LD	HL,0FFFFh
	LD	(LNOBUF),HL
	JP	SERROR
L00A5:	CP	03Ah
	JP	C,EDITOR
	POP	HL
	LD	HL,IMDBUF
	PUSH	HL
	CALL	CVIMTX
	XOR	A
	INC	HL
	LD	(NXTLPT),HL
	LD	(HL),A
	INC	HL
	LD	(HL),A
	INC	A
	LD	(DISFLG),A
	LD	HL,0FFFFh
	LD	(LNOBUF),HL
	POP	HL
ONELIN: LD	(SPBUF),SP
SPCCUT: LD	A,(HL)
	CP	020h
	INC	HL
	JR	Z,SPCCUT
	CP	03Ah
	JR	Z,SPCCUT
	OR	A
	JP	Z,NXLINE
	LD	(CURTXT),HL
	LD	C,A
	LD	A,080h		;BREAK CHECK
	IN	A,(0)
	AND	012h
BREAKJ: DEFB	0CAH		;JP Z,?
	DEFW	BREAK
PAUSEP: LD	A,C
	LD	DE,SPCCUT
	PUSH	DE
LETDA': CP	027h		;'
	JP	Z,REM
	CP	081h
	JP	NC,STMNTS
	CP	041h
	JP	C,SERROR
LETDAI: LD	C,L
	LD	B,H
	LD	DE,(INTFAC)
DAINUE: CALL	GETVAR
	CP	003h
	JR	Z,DAISTR
DAINV': PUSH	AF
	CALL	BCFTCH
	CP	0F5h
	JP	NZ,SERROR
	EX	(SP),HL
	PUSH	HL
	CALL	FLEXPR
	POP	AF
	CP	002h
	JR	Z,INTDAI
	POP	DE
DAIMID: PUSH	BC
	LD	B,A
DAITRS: LD	A,(HL)
	LD	(DE),A
	INC	HL
	INC	DE
	DJNZ	DAITRS
	POP	BC
DAIRET: LD	L,C
	LD	H,B
	DEC	HL
	RET
;
INTDAI: CALL	HLFLTO
	POP	DE
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	JR	DAIRET
;
DAISTR: CALL	BCFTCH
	CP	0F5h
	JP	NZ,SERROR
	PUSH	HL
	CALL	STEXPR
STRMDM: CALL	CONDMZ
	CALL	CVDSAD
	PUSH	BC
	PUSH	HL
	OR	A
	JR	Z,ESKTRS
	LD	C,A
	LD	B,0
	EX	DE,HL
	LD	DE,KEYBUF
	PUSH	DE
	LDIR
	POP	DE
	POP	HL
	PUSH	HL
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
ESKTRS: POP	HL
	POP	BC
	POP	DE
INPENT: PUSH	DE
	EX	DE,HL
	CALL	CONDM'
	EX	DE,HL
	PUSH	HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	HL,(STRTOP)
	OR	A
	SBC	HL,DE
	CCF
	JR	NC,DAIMD'
	LD	HL,TEXTST
	SBC	HL,DE
DAIMD': POP	HL
	POP	DE
	CALL	NC,GETSTR
	LD	A,003h
	JR	DAIMID
;
LININP: EI
	CALL	INPUTF
	LD	A,(DE)
	CP	3		;BREAK CODE
	SCF
	RET	Z
	PUSH	DE
ZEROMK: LD	A,(DE)
	INC	DE
	CP	00Dh
	JR	NZ,ZEROMK
	DEC	DE
	XOR	A
	PUSH	BC
	LD	B,10
KBCLLP: LD	(DE),A
	INC	DE
	DJNZ	KBCLLP
	POP	BC
	POP	DE
	RET
;
ENDTXT: LD	A,(ERRORF)
	OR	A
OKFVC:	JP	Z,OK
	LD	HL,(LNOBUF)
	INC	HL
	LD	A,L
	OR	H
	JR	Z,OKFVC
	LD	A,19
	JP	ERROR
;
RUN:	CALL	CLR
	XOR	A
	LD	(FILEFG),A
	LD	(CONTFG),A
	LD	(ERRCOD),A
	LD	(ERRORF),A
	PUSH	HL
	LD	HL,TEXTST
	DEC	HL
	LD	(HL),A
	LD	(DATAPO),HL
	LD	HL,LININP
	LD	(LODVEC),HL
	POP	HL
	LD	SP,(STRTOP)
	PUSH	HL
	LD	HL,0
	LD	(ERRLNO),HL
	LD	(ERRORV),HL
	DEC	HL
	EX	(SP),HL
	LD	(SPBUF),SP
	CALL	HLFTCH
	CP	00Bh
	JR	NZ,RUNBOT
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	CALL	LNOSER
	JP	C,UDFLNO
	JR	RUNMID
RUNBOT: LD	HL,TEXTST
RUNMID: LD	(NXTLPT),HL
NXLINE:
	DEFB	021H		;LD HL,?
NXTLPT: DEFS	2
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,D
	OR	E
	JR	Z,ENDTXT
	LD	(NXTLPT),DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	(LNOBUF),DE
	DEFB	03EH		;LD A,?
TRACEF:DEFS	1
	OR	A
	CALL	NZ,DEBUGR
	JP	ONELIN
;
DEBUGR: PUSH	AF
	XOR	A
	LD	(DISFLG),A
	LD	(DEBGHL),A
	POP	AF
	RRCA
	JR	NC,NXSPL0
	LD	C,L
	LD	B,H
	PUSH	HL
	LD	HL,(CURX)
	PUSH	HL
	LD	HL,0
	LD	(CURX),HL
	LD	L,C
	LD	H,B
	CALL	NXSPL0
	POP	HL
	LD	(CURX),HL
	POP	HL
	RET
;
NXSPL0: PUSH	HL
	RRCA
	JR	NC,NXSPL1
	PUSH	AF
	LD	A,2
	LD	(DISFLG),A
	LD	A,023h
	LD	(DEBGHL),A
	POP	AF
NXSPL1: RRCA
	JR	NC,NXSPL2
	PUSH	AF
	LD	A,05Bh
	CALL	ACCPRT
	EX	DE,HL
	CALL	FIVEPR
	EX	DE,HL
	LD	A,05Dh
	CALL	ACCPRT
	POP	AF
NXSPL2: RRCA
	JR	NC,NXSPL3
	POP	HL
	PUSH	HL
	PUSH	AF
	CALL	ONELST
	LD	A,5
	CALL	ACCPRT
	CALL	CR1
	POP	AF
NXSPL3: RRCA
	PUSH	AF
	CALL	C,FLSHGT
	POP	AF
	RRCA
	LD	HL,DEBGHL
	CALL	C,DUMP
	LD	A,1
	LD	(DISFLG),A
	POP	HL
	RET
;
DEBGHL: DEFS	1
;
;
BREAK$: POP	BC
	INC	HL
BREAK:	DEC	HL
	LD	(BTEXTP),HL
	LD	HL,(LNOBUF)
	LD	A,H
	AND	L
	INC	A
	JR	Z,BRDRCT
	LD	A,1
BRDRCT: LD	(BLNOBF),HL
	LD	(SPBUF),SP
	LD	(CONTFG),A
	LD	HL,(NXTLPT)
	LD	(BNXTLP),HL
	CALL	CR2
	LD	DE,BREAKM
	LD	B,5
	CALL	PRTSDC
LNOPRT: DB	021H		;LD HL,?
LNOBUF: DEFS	2
	LD	A,H
	AND	L
	INC	A
	JP	Z,OK
	LD	(EDLINE),HL
	LD	DE,INMES
	LD	B,4
	CALL	PRTSDC
	CALL	FIVEPR
	JP	OK
;
FIVEPR: PUSH	DE
	LD	DE,KEYBUF
	CALL	ASCHL
	LD	B,4
SKIPFZ: LD	A,(DE)
	CP	030h
	JR	NZ,PRTNUM
	INC	DE
	DJNZ	SKIPFZ
LSTODP: LD	A,(DE)
	CALL	ACCPRT
	POP	DE
	RET

PRTNUM: LD	A,(DE)
	CALL	ACCPRT
	INC	DE
	DJNZ	PRTNUM
	JR	LSTODP
;
BREAKM: DEFM	'BREAK'

INMES:	DEFM	' IN '
;
CVDSAD: PUSH	HL
	CALL	INDRCT
	LD	A,(HL)
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	POP	HL
	LD	(HL),A
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	DEC	HL
	DEC	HL
	RET
;
STMNTS: CP	0FFh
	JR	Z,FUNCTN1
	CP	0D0h
	JP	NC,SERROR
	PUSH	HL
	LD	HL,SJPTBL
	CALL	GETJPA
	EX	(SP),HL
	RET
;
TYPEMS: LD	A,13
	JR	ERJUMP
;
IFCALL: LD	A,5
	JR	ERJUMP
;
SERROR: LD	A,2
ERJUMP: JP	ERROR
;
FUNCTN1: LD	A,(HL)
	CP	0B4h
	JP	Z,MIDDAI
;
;	TIME$="00:00:00"
;
MEMDAI: CP	0B8h
MEMDSE: JP	NZ,SERROR
	LD	C,L
	LD	B,H
	INC	BC
	CALL	CH28H
	CALL	IHLEXP
	PUSH	HL
	CALL	CH2CH
	CALL	IHLEXP
	CALL	CH29H
	CALL	HCHECK
	PUSH	AF
	CALL	BCFTCH
	CP	0F5h
	JR	NZ,MEMDSE
	CALL	STREXX
	DEC	BC
	POP	HL
	CP	H
	JR	C,SKMDAI
	LD	A,H
SKMDAI: POP	HL
	PUSH	BC
	OR	A
	JR	Z,NOMDAI
	LD	C,A
	LD	B,0
	EX	DE,HL
	LDIR
NOMDAI: POP	HL
	RET
;
MIDDAI: INC	HL
	LD	C,L
	LD	B,H
	CALL	CH28H
	LD	DE,(INTFAC)
	CALL	GETVAB
	CP	003h
	JP	NZ,TYPEMS
	PUSH	HL
	CALL	BCFTCH
	CALL	CH2CH
	CALL	IHLEXP
	PUSH	AF
	CALL	HCHECK
	LD	D,A
	LD	E,0FFh
	POP	AF
	CP	029h
	JR	Z,MIDRAL
	CALL	CH2CH
	PUSH	DE
	CALL	IHLEXP
	CALL	CH29H
	CALL	HCHECK
	POP	DE
	LD	E,A
MIDRAL: PUSH	DE
	CALL	BCFTCH
	CP	0F5h
	JP	NZ,SERROR
	CALL	STREXX
	EXX			; HL BC
	POP	DE		; D TO E
	POP	HL		; VAR DARD
	LD	A,(HL)
	OR	A
	LD	B,A
	LD	C,A
	PUSH	HL		; VAR ADRS
	JR	Z,NOEFT1
	PUSH	DE		; D TO E
	INC	HL
	CALL	INDRCT
	LD	DE,KEYBUF
	PUSH	DE		; KEYBUF
MDTLLD: LD	A,(HL)
	LD	(DE),A
	INC	DE
	INC	HL
	DJNZ	MDTLLD
	POP	HL		; KEYBUF
	POP	DE		; D,E
	LD	A,D
	DEC	A
	CP	C
	JR	NC,NOEFT1
	ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A		; HL <- REPLACE ADRS
	LD	A,C
	SUB	D
	INC	A		; REPLACE LEN
	CP	E
	JR	C,RPSTSW
	LD	A,E
RPSTSW: LD	B,A
	PUSH	HL
	PUSH	BC
	EXX
	POP	AF		; B <- RP LEN
	POP	DE		; REPLACE ADRS
	PUSH	BC		; TEXTPOINTER
	PUSH	AF
	POP	BC		; B <- RP LEN
	LD	A,(HL)
	CP	B
	JR	NC,SKIOMR
	LD	B,A
SKIOMR: LD	A,B
	OR	A
	JR	Z,NOEFT2
	INC	HL
	CALL	INDRCT
LSTRPL: LD	A,(HL)
	LD	(DE),A
	INC	HL
	INC	DE
	DJNZ	LSTRPL
	LD	B,C
	LD	DE,00008h
	LD	HL,(INTFAC)
	ADD	HL,DE
	LD	DE,KEYBUF
	CALL	ENTSTR
	POP	BC
	JP	STRMDM
;
NOEFT2: POP	BC
RETNOE: POP	HL
	JP	RETIRQ
;
NOEFT1: EXX
	JR	RETNOE
;
DFLTCL: PUSH	BC
	LD	A,004h
	LD	B,26
	LD	DE,DFTABL
	CALL	FILL
	XOR	A
	LD	DE,USRTBL
	LD	B,20
	CALL	FILL
	POP	BC
	RET
;
REM:	POP	HL
	JP	NXLINE
;
FILEER: LD	A,31
	JP	ERROR
;
PRTSTR: PUSH	BC
	CALL	CONDMZ
	CALL	CVDSAD
	LD	B,A
	CALL	PRTSDC
	JP	SKIPP
;
RGPRMT: PUSH	AF
	JP	RGPRM'
;
PRINT:	LD	A,1
	LD	(DISFLG),A
	LD	C,L
	LD	B,H
	CALL	BCFTCH
	CP	023h
	JR	NZ,PRINT'
	CALL	IHLEXP
	DEC	BC
	OR	A
	JR	Z,PRDVSW
	CP	03Ah
	JR	Z,PRDVSW
	CP	02Ch
	JP	NZ,SERROR
	INC	BC
PRDVSW: LD	A,H
	OR	L
	JR	Z,PRSCRV
	INC	HL
	LD	A,H
	OR	L
	JR	NZ,PRTERM
	LD	A,(FILEFG)
	CP	2
	JR	NZ,FILEER
	INC	A
	LD	(DISFLG),A
	JR	PRSCRV
PRTERM: LD	A,2		; PRINTER
	LD	(DISFLG),A
	JR	PRSCRV
;
;
PRINT': LD	C,L
	LD	B,H
PRSCRV: CALL	SETSSP
	LD	(IY+0),0
	CALL	BCFTCH
	CP	0E2h
	JP	Z,USING
	OR	A
	JR	Z,CRLFR'
	CP	03Ah
	JR	Z,CRLFR'
	CP	02Ch
	JP	Z,RGPRMT
	CP	03Bh
	JP	Z,RGPRMT
	CP	0E7h
	JR	Z,TABOPR
	CP	0E8h
	JP	Z,SPCOPR
	DEC	BC
	CALL	EXPRSN
	PUSH	AF
	LD	A,(IY+0)
	CP	003h
	JP	Z,PRTSTR
	OR	A
RGPRM': PUSH	BC
	JR	Z,SKIPP
	CALL	CVNMFL
	CALL	PRTSDC
	CALL	SPPRT
SKIPP:	POP	HL
	POP	AF
PRTYUI: OR	A
	JR	Z,CRLFRT
	CP	03Ah
	JR	Z,CRLFRT
	CP	03Bh
	JR	Z,SEMIS
	CP	02Ch
	JR	NZ,DECBCL
	CALL	TABPRT
SEMIS:	CALL	HLFTCH
	OR	A
	JR	Z,DISCLR
	CP	03Ah
	JR	NZ,PRINT'
DISCLR: LD	A,1
	LD	(DISFLG),A
	RET
;
CRLFR': LD	H,B
	LD	L,C
CRLFRT: CALL	CR1
	DEC	HL
	JR	DISCLR
DECBCL: DEC	HL
	CP	022h
	JR	Z,PRINT'
	CP	041h
	JR	NC,PRINT'
	CP	021h
	JR	C,PRINT'
	JP	SERROR
;
TABOPR: CALL	CH28H
	CALL	IHLEXP
	CALL	CH29H
	CALL	HCHECK
	LD	A,(DISFLG)
	CP	2
	JR	C,CRTTAS
	LD	A,(PRINTN)
	JR	TSUBLS
CRTTAS: LD	A,(CURX)
TSUBLS: SUB	L
	JR	NC,NOTABO
	NEG
TABPPP: LD	D,A
TABPPT: CALL	SPPRT
	DEC	D
	JR	NZ,TABPPT
NOTABO: CALL	BCFTCH
	LD	L,C
	LD	H,B
	JR	PRTYUI
;
SPCOPR: CALL	CH28H
	CALL	IHLEXP
	CALL	CH29H
	CALL	HCHECK
	OR	A
	JR	Z,NOTABO
	JR	TABPPP
;
CLR:	PUSH	HL
	PUSH	DE
	LD	HL,(VSTART)
	XOR	A
	LD	(HL),A
	LD	(STKLMT),HL
	LD	HL,(STRBTM)
	LD	(STRPTR),HL
	LD	DE,2000
	SBC	HL,DE
	LD	(STRTOP),HL
	CALL	DFLTCL
	POP	DE
	POP	HL
	RET
;
FOR:	POP	BC
	LD	(FLJPVC),BC
	LD	C,L
	LD	B,H
	LD	DE,(INTFAC)
	CALL	GETVAB
	LD	(FVTYPE),A
	EX	DE,HL
	LD	HL,0
	ADD	HL,SP
FTSKIP: LD	A,(HL)
	OR	A
	JR	NZ,FORPUS
	PUSH	DE
	LD	DE,6
	ADD	HL,DE
	POP	DE
	PUSH	HL
	CALL	INDRCT
	OR	A
	SBC	HL,DE
	POP	HL
	JR	NZ,NXTSFT
	PUSH	DE
	LD	DE,18
	ADD	HL,DE
	POP	DE
	LD	(SPBUF),HL
	LD	SP,HL
	JR	FORPUS
;
NXTSFT: PUSH	DE
	LD	DE,16
	ADD	HL,DE
	POP	DE
	JR	FTSKIP
;
FORPUS: EX	DE,HL
	PUSH	HL
	LD	A,(FVTYPE)
	CALL	DAINV'
	LD	A,(HL)
	CP	0DFh
	JP	NZ,SERROR
	INC	HL
	LD	C,L
	LD	B,H
	CALL	FLEXPR
	POP	DE
	PUSH	HL
	EXX
	POP	DE
	LD	HL,0FFF8h
	ADD	HL,SP
	LD	SP,HL
	EX	DE,HL
	CALL	LDIR8
	EXX
	CP	0E0h
	LD	HL,FLONE
	JR	NZ,STEPON
	PUSH	DE
	CALL	FLEXPR
	POP	DE
STEPON: PUSH	HL
	EXX
	POP	DE
	LD	HL,0FFF8h
	ADD	HL,SP
	LD	SP,HL
	EX	DE,HL
	CALL	LDIR8
	EXX
	PUSH	DE
	DEC	BC
	PUSH	BC
	LD	HL,(NXTLPT)
	PUSH	HL
	DEFB	021H		;LD HL,?
	DEFB	000H		;low
FVTYPE: DEFS	1		;high

	PUSH	HL
	LD	L,C
	LD	H,B
	CALL	MEMCHK
	DEFB	0C3H		; JP ?
FLJPVC: DEFS	2
;
NXFVAR: CALL	BCFTCH
	OR	A
	JR	Z,NXWFOR
	CP	03Ah
	JR	NZ,AGINCV
NXWFOR: LD	A,1
	JP	ERROR
;
NEXT:	CALL	HLFTCH
	OR	A
	JP	Z,DFLTNX
	CP	03Ah
	JP	Z,DFLTNX
NEXTAG: LD	C,L
	LD	B,H
	CALL	BCFTCH
AGINCV: LD	DE,(INTFAC)
	CALL	GETVAR
	EX	DE,HL
	LD	HL,2
	ADD	HL,SP
SKSTKS: LD	A,(HL)
	OR	A
	JR	NZ,NXFVAR
	PUSH	DE
	LD	DE,6
	ADD	HL,DE
	POP	DE
	PUSH	HL
	CALL	INDRCT
	OR	A
	SBC	HL,DE
	POP	HL
	JR	NZ,NXFPOR
	LD	DE,6
	OR	A
	SBC	HL,DE
	POP	DE
	LD	SP,HL
	LD	(NXTNXT),DE
	LD	L,C
	LD	H,B
	CALL	DFLTNX
	DEFB	011H		; LD DE,??
NXTNXT: DEFS	2
	PUSH	DE
	RET	NC
	CALL	HLFTCH
	CP	02Ch
	RET	NZ
	INC	HL
	JR	NEXTAG
;
NXFPOR: PUSH	DE
	LD	DE,012H
	ADD	HL,DE
	POP	DE
	JR	SKSTKS
;
DFLTNX: PUSH	HL
	LD	HL,00004h
	ADD	HL,SP
	XOR	A
	CP	(HL)
	JR	NZ,NXWFOR
	INC	HL
	LD	A,0F0h
	AND	(HL)
	JR	NZ,NXWFOR
	LD	A,(HL)
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	PUSH	DE
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	PUSH	DE
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	DE,HL
	CP	002h
	JP	Z,INTFOR
	LD	(IY+0),A
	CALL	ADD
	INC	DE
	LD	A,(DE)
	DEC	DE
	EX	AF,AF'
	PUSH	HL
	LD	HL,00008h
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	EX	AF,AF'
	RLCA
	JR	NC,FPCOMP
	CALL	CMP
	JR	C,NEXTRT
	JR	OMODED
FPCOMP: CALL	CMP
	JR	Z,OMODED
	JR	NC,NEXTRT
OMODED: POP	DE
	POP	HL
	LD	(NXTLPT),HL
	EX	DE,HL
	POP	BC
	OR	A
	RET
;
NEXTRT: LD	HL,00008h
	ADD	HL,DE
	POP	BC
	POP	BC
	POP	DE
	POP	IX
	LD	SP,HL
	EX	DE,HL
	SCF
	JP	(IX)
;
INTFOR: PUSH	DE		; STEP
	PUSH	HL		; VARADRS
	EX	DE,HL
	CALL	HLFLTO		; STEP
	LD	A,H
	EX	AF,AF'
	EX	DE,HL
	POP	HL
	PUSH	HL
	CALL	INDRCT
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	POP	HL
	LD	BC,00008h
	ADD	HL,BC
	PUSH	HL
	CALL	HLFLTO
	EX	AF,AF'
	RLCA
	JR	NC,MNIFOR
	CALL	INTCMP
	POP	DE
	JR	Z,OMODED
	JR	C,OMODED
	JR	NEXTRT
;
MNIFOR: CALL	INTCMP
	POP	DE
	JR	NC,OMODED
	JR	NEXTRT
;
INTCMP: LD	A,H
	RLCA
	JR	C,ICHMNS
	LD	A,D
	RLCA
	CCF
	JR	NC,NCICMT
INTCPM: OR	A
	SBC	HL,DE
	RET	C
	LD	A,H
	OR	L
	RET
;
ICHMNS: LD	A,D
	RLCA
	CCF
	JR	C,CPRTMY
	JR	INTCPM
;
CPRTMY: LD	A,1
	OR	A
	SCF
	RET
;
NCICMT: LD	A,1
	OR	A
	RET
;
ERTEST: LD	C,L
	LD	B,H
	CALL	IBYTE
ERRTST: JP	ERROR
;
LET:	CALL	HLFTCH
	INC	HL
	JP	LETDA'
;
POKE:	LD	C,L
	LD	B,H
	CALL	IHLEXP
POKELP: CP	02Ch
	JR	NZ,RETIRQ
	PUSH	HL
	CALL	IBYTE
	POP	HL
	LD	(HL),A
	INC	HL
	DEC	BC
	CALL	BCFTCH
	JR	POKELP
;
RETIRQ: LD	L,C
	LD	H,B
	DEC	HL
	LD	A,1
	LD	(DISFLG),A
	RET
;
CLS:	LD	A,(GMODEF)
	CP	2
	LD	A,12
	JP	C,ACCPRT
CLSSB:
	LD	BC,01800h
	LD	D,000h
CLS1LP: DEC	BC
	OUT	(C),D
	LD	A,B
	OR	C
	JR	NZ,CLS1LP
	RET
;
;
SCREEN: LD	C,L
	LD	B,H
	CALL	IHLEXP
	CALL	CH2CH
	CALL	HCHECK
	CP	5
	JP	NC,IFCALL
	PUSH	AF
	CALL	IHLEXP
	CALL	CH2CH
	CALL	HCHECK
	CP	5
	JP	NC,IFCALL
	PUSH	AF
	CALL	IBYTE
	CP	6
	JP	NC,IFCALL
	POP	DE
	LD	E,D
	LD	L,A
	POP	AF
	LD	D,A
	PUSH	BC
	PUSH	DE
PATCH5:	
	CALL	GRAPH
	POP	BC
	CALL	SCRNBC
	POP	BC
	JP	RETIRQ
;
GRAPHI: LD	L,0
GRAPH:	LD	A,(GMODEF)
	CP	L
	JR	Z,GRAPOK
	CP	2
	JR	NC,GM2345
	LD	A,L
	CP	2
	JR	C,GRAPOK
	PUSH	AF
	CALL	CLSSB
	POP	AF
	JR	GRAPOK
GM2345: LD	A,L
	CP	2
	JR	NC,GRAPOK
	PUSH	AF
	CALL	CLSSB
	CALL	GSAVES
	POP	AF
GRAPOK: LD	(GMODEF),A
	LD	L,A
	LD	E,A
	LD	H,0
	LD	D,H
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,DE
	LD	DE,SCRTAB
	ADD	HL,DE
	LD	A,(HL)
	LD	(SCRNYE+1),A
	INC	HL
	LD	A,(HL)
	LD	(SCRNXE+1),A
	LD	A,0FFh
	LD	(SCRNYE+2),A
	LD	(SCRNXE+2),A
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	(CALADR+1),DE
	INC	HL
	LD	A,(IO2000)
	AND	030h
	OR	(HL)
	JP	IO20SB
;
;
GSAVES: PUSH	HL
	LD	HL,$CGBUF
	LD	BC,01000h
	LD	D,080h
GSAVEL: LD	E,12
GSAVEP: LD	A,(HL)
	OUT	(C),A
	INC	HL
	INC	BC
	DEC	E
	JR	NZ,GSAVEP
	INC	BC
	INC	BC
	INC	BC
	INC	BC
	DEC	D
	JR	NZ,GSAVEL
	POP	HL
	RET
;
;
GMODEF: DEFB	0
;
SCRTAB: DEFB	0E0H		;-32	G0
	DEFB	0C0H		;-64
	DEFW	CALAD0
	DEFB	000H
;
	DEFB	0D0H		;G1	;-48
	DEFB	0C0H		;-64
	DEFW	CALAD1
	DEFB	000H
;
	DEFB	040H		;G2	;-192
	DEFB	080H		;-128
	DEFW	CALAD2
	DEFB	00AH
;
	DEFB	040H		;G3
	DEFB	080H
	DEFW	CALAD3
	DEFB	08AH
;
	DEFB	040H		;G4	;-192
	DEFB	000H		;-256
	DEFW	CALAD4
	DEFB	00EH
;
	DEFB	040H		;G5
	DEFB	000H
	DEFW	CALAD5
	DEFB	08EH
;
LOCATE: LD	C,L
	LD	B,H
	CALL	IHLEXP
	CALL	CH2CH
	CALL	HCHECK
	CP	32		; CURX LIMI
LCTIFC: JP	NC,IFCALL
	LD	(CURX),A
	CALL	IBYTE
	CP	16		; CURY LIMIT
	JR	NC,LCTIFC
	LD	(CURY),A
	JP	RETIRQ
;
READ:	LD	C,L
	LD	B,H
	LD	HL,DATASK
	LD	(READVC),HL
	LD	HL,LNG+1
	LD	(DATAFV),HL
	LD	HL,00000h
	LD	(DATAV1),HL
	LD	HL,00428h
	LD	(DATAV2),HL
DATASK: DEFB	021H		; LD HL,?
DATAPO: DEFS	2
DATAS': LD	A,(HL)
	CP	03Ah
	JR	Z,MIDDAR
	OR	A
	JR	NZ,DATAFD
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,E
	OR	D
	LD	A,4
	JP	Z,ERROR
	INC	HL
	INC	HL
	INC	HL
MIDDAR: CALL	HLFTCH
	OR	A
	JR	Z,DATAS'
	CP	08Fh		; DATA IM
	JR	Z,DATAFD
	CALL	DATA
	JR	C,DATAS'
	INC	HL
	JR	MIDDAR
;
DATAFD: INC	HL
	LD	(DATAPO),HL
	EX	DE,HL
	JP	INPLOP
;
RESLBL: PUSH	HL
	CALL	LBLSER
	LD	HL,(CURLPT)
	DEC	HL
	LD	(DATAPO),HL
	POP	HL
	CALL	IFDQSK
	OR	A
	RET	Z
	INC	HL
	RET
;
RESTOR: CALL	HLFTCH
	CP	022h
	JR	Z,RESLBL
	CP	00Bh
	PUSH	HL
	LD	HL,TEXTST
	JR	NZ,RESTTT
	POP	HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	PUSH	HL
	EX	DE,HL
	CALL	LNOSER
	JP	C,UDFLNO
RESTTT: DEC	HL
	LD	(DATAPO),HL
	POP	HL
	RET
;
DATA:	DEC	HL
DATALZ: CALL	IFSKSB
	OR	A
	SCF
	RET	Z
	CP	03Ah
	RET	Z
	JR	DATALZ
;
LINCIN: CALL	IHLEXP
	CP	02Ch
	JP	NZ,SERROR
	LD	HL,CINPUT
	LD	(LINVEC),HL
	CALL	BCFTCH
	JR	LINPNP
;
LINE:	LD	(IBREKH),HL
	LD	C,L
	LD	B,H
	CALL	BCFTCH
	CP	08Dh
	JP	NZ,LINE@
	CALL	BCFTCH
	CP	023h
	JR	Z,LINCIN
	LD	HL,LININP
	LD	(LINVEC),HL
	CP	022h
	JR	NZ,LINPNP
LINPOL: LD	A,(BC)
	INC	BC
	OR	A
	JP	Z,SERROR
	CP	022h
	JR	Z,PMTOUE
	CALL	ACCPRT
	JR	LINPOL
PMTOUE: CALL	BCFTCH
	CP	03Bh
	CALL	Z,BCFTCH
LINPNP: LD	DE,(INTFAC)
	CALL	GETVAR
	CP	003h
	JP	NZ,TYPEMS
	CALL	BCFTCH
	PUSH	HL
	LD	DE,KEYBUF
	DEFB	0CDH		; CALL ?
LINVEC: DEFW	LININP
	JR	C,IBREAK
	PUSH	BC
	PUSH	DE
	LD	B,0
LINESR: LD	A,(DE)
	OR	A
	JR	Z,ESLINE
	INC	DE
	INC	B
	JR	LINESR
ESLINE: EX	DE,HL
	POP	DE
	CALL	ENTSTR
	POP	BC
	JP	STRMDM
;
IBREAK: POP	HL
	POP	HL
	DEFB	021H		; LD HL,?
IBREKH: DEFS	2
	JP	BREAK
;
CINP'#: LD	HL,CIRPUT
	LD	(PMASVC),HL
	INC	BC
	CALL	IHLEXP
	CP	02Ch
	JP	NZ,SERROR
	LD	A,(FILEFG)
	DEC	A
	JP	NZ,FILEER
	LD	A,0C3h
	LD	(NRLDED),A
CIRPUT: LD	DE,KEYBUF
	CALL	CINPUT
	JR	INPLOP
;
INPUT:	PUSH	HL
	LD	(IBREKH),HL
	LD	HL,PMTASK
	LD	(READVC),HL
	LD	HL,00000h
	LD	(DATAFV),HL
	LD	(DATAV2),HL
	LD	HL,00418h
	LD	(DATAV1),HL
	POP	HL
	CALL	HLFTCH
	LD	C,L
	LD	B,H
	PUSH	HL
	LD	HL,LINEKB
	LD	(PMASVC),HL
	POP	HL
	CP	023h
	JP	Z,CINP'#
	CP	022h
	JR	NZ,PMTASK
PMTOUL: INC	HL
	LD	A,(HL)
	CP	022h
	JR	Z,NPASK?
	OR	A
	JP	Z,SERROR
	CALL	ACCPRT
	JR	PMTOUL
NPASK?: CALL	INCHLF
	INC	HL
	LD	C,L
	LD	B,H
	CP	02Ch
	JR	Z,NOPPMT
	CP	03Bh
	JP	NZ,SERROR
;
PMTASK: DEFB	0C3H		; JP ?
PMASVC: DEFS	2
LINEKB: LD	A,03Fh
	CALL	ACCPRT
	CALL	SPPRT
;
NOPPMT: LD	HL,(CURX)	; ??DISPN
	PUSH	HL
	LD	DE,KEYBUF
	CALL	LININP
	JP	C,IBREAK
	POP	HL
	LD	H,0
	ADD	HL,DE
	EX	DE,HL
;
INPLOP: CALL	BCFTCH
DATAV1: JR	DASKIO
	LD	(DATAPO),DE
DASKIO: OR	A
	JP	Z,RETIRQ
	CP	03Ah
	JP	Z,RETIRQ
	EX	AF,AF'
	CALL	DEFTCH
	DEC	DE
	OR	A
	DEC	BC
    JR	Z,PMTERM
	CP	03Ah
DATAFV:	
	JR	Z,PMTERM
	INC	BC
	EX	AF,AF'
	PUSH	DE
	LD	DE,(INTFAC)
	CALL	GETVAR
	POP	DE
	CP	003h
	JP	Z,STRINP
	PUSH	HL
	PUSH	AF
	CALL	DEFTCH
	DEC	DE
	CP	02Eh
	JR	Z,INNMOK
	CP	02Dh
	JR	Z,INNMOK
	CP	026h
	JR	Z,INNMOK
	CP	02Bh
	JR	Z,INNMOK
	CP	030h
	JP	C,TYPEMS
	CP	03Ah
	JP	NC,TYPEMS
INNMOK: LD	HL,ZFAC
	PUSH	BC
	CALL	OVFLAG
	POP	BC
	POP	AF
	CP	002h
	JR	Z,INITDI
	POP	HL
	PUSH	BC
	LD	C,A
	LD	B,0
	PUSH	DE
	EX	DE,HL
	LD	HL,ZFAC
	LDIR
	POP	DE
	POP	BC
NXTIN?: CALL	BCFTCH
	CP	02Ch
	DEC	BC
	JR	NZ,INPLOP
	INC	BC
	CALL	DEFTCH
    CP	02Ch    ; BCOUTA?
	JR	Z,INPLOP
;
PMTERM: DEFB	0C3H		; JP ?
READVC: DEFS	2
;
INITDI: CALL	HLFLTO
	POP	IX
	LD	(IX+0),L
	LD	(IX+1),H
	JR	NXTIN?
;
STRINP: PUSH	BC		; TEXT POINTR
	PUSH	HL		; VAR ADRS
	LD	(INPSDC),DE
	LD	B,0
	CALL	DEFTCH
	CP	022h
	JR	Z,DATA22
	DEC	DE
SRINPL: LD	A,(DE)
	INC	DE
	INC	B
	OR	A
	JR	Z,ESCINS
	CP	03Ah
DATAV2: JR	Z,ESCINS
	CP	02Ch
	JR	NZ,SRINPL
ESCINS: DEC	DE
ESCIN': DEC	B
	LD	HL,INSDC
	LD	(HL),B
	LD	C,E
	LD	B,D
	POP	DE
	PUSH	BC
	CALL	INPENT
	POP	DE
	POP	BC
	JR	NXTIN?
;
DATA22: LD	(INPSDC),DE
DATADN: LD	A,(DE)
	INC	B
	OR	A
	JR	Z,ESCIN'
	INC	DE
	CP	022h
	JR	NZ,DATADN
	JR	ESCIN'
INSDC:	DEFS	1
INPSDC: DEFS	2
;
HMEMCK: PUSH	HL
	PUSH	DE
	EX	DE,HL
	JR	MCHKMD
;
MEMCHK: PUSH	HL
	PUSH	DE
	LD	DE,(STKLMT)
MCHKMD: PUSH	AF
	LD	HL,0
	ADD	HL,SP
	DEC	H
	OR	A
	SBC	HL,DE
	JR	NC,MCHCKR
	CALL	MEMPUR
	LD	HL,0
	ADD	HL,SP
	DEC	H
	OR	A
	SBC	HL,DE
	JP	C,OMERR
MCHCKR: POP	AF
	POP	DE
	POP	HL
	RET

GETVAC: LD	DE,(INTFAC)
GETVAB: CALL	BCFTCH
GETVAR: PUSH	DE
	CALL	VSRTST
	CP	028h
	JP	Z,ARRAY
	DEC	BC
	PUSH	BC
	LD	A,E
	EX	DE,HL
	LD	B,A
	LD	HL,(VSTART)
VARCLP: LD	A,(HL)
	OR	A
	JR	Z,CRNVAR
	CP	B
	JR	NZ,SKIPUS
	INC	HL
	LD	A,E
	CP	(HL)
	LD	A,B
	JP	NZ,SKIPVT
	INC	HL
	LD	A,D
	CP	(HL)
	LD	A,B
	JP	NZ,SKIPVU
	INC	HL
GVARRT: POP	BC
	POP	DE
	RET
;
SKIPUS: INC	A
	JP	P,SKIPVT
	DEC	A
	AND	0C0h
	CP	0C0h
	LD	A,5
	JR	Z,SKIPVV
	INC	HL
	CALL	INDRCT
	JP	VARCLP
;
SKIPVT: INC	A
SKIPVU: INC	A
SKIPVV: ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	JP	VARCLP
;
CRNVAR: LD	(HL),B
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	LD	C,B
	PUSH	HL
	EX	DE,HL
	INC	B
	XOR	A
LZFIL1: LD	(DE),A
	INC	DE
	DJNZ	LZFIL1
	DEC	DE
	EX	DE,HL
	CALL	HMEMCK
	EX	DE,HL
	LD	(STKLMT),DE
	POP	HL
	LD	A,C
	JP	GVARRT
;
ARRAY:	LD	D,0
	EXX
	POP	HL
	PUSH	HL
	PUSH	HL
	EXX
	EX	(SP),HL
	PUSH	HL
TSALOP: POP	HL
	PUSH	HL
	PUSH	DE
	DEC	IY
	CALL	HLEXP
	INC	IY
	CP	029h
	JR	Z,TSFARY
	CP	02Ch
	JP	NZ,SERROR
	POP	DE
	INC	D
	EXX
	POP	HL
	POP	DE
	EXX
	PUSH	HL
	EXX
	PUSH	DE
	PUSH	HL
	EXX
	JR	TSALOP
;
TSFARY: POP	DE
	EXX
	POP	HL
	POP	DE
	EXX
	INC	D
	PUSH	HL
	PUSH	BC
	EXX
	PUSH	DE
	EXX
	POP	BC
	LD	HL,(VSTART)
ASLOP:	LD	A,(HL)
	OR	A
	JP	Z,SORERR
	JP	M,ARYATA
	INC	A
	INC	A
	INC	A
ARSKFN: ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	JR	ASLOP
;
ARYATA: AND	0C0h
	CP	0C0h
	LD	A,005h
	JR	Z,ARSKFN
	LD	A,(HL)
	AND	07Fh
	CP	E
	JR	Z,ARMSN1
	INC	HL
MIDNAM: CALL	INDRCT
	JP	ASLOP
;
NXTVR:	DEC	HL
NXTVR1: 	DEC	HL
	DEC	HL
	JP	MIDNAM
;
ARMSN1: EXX
	LD	C,A
	LD	B,000h
	LD	HL,00000h
	EXX
	INC	HL
	INC	HL
	INC	HL
	LD	A,C
	CP	(HL)
	JP	NZ,NXTVR1
	INC	HL
	LD	A,B
	CP	(HL)
	JP	NZ,NXTVR
	INC	HL
	LD	A,D
	CP	(HL)
	JP	NZ,SORERR
	POP	BC
	LD	(ARBCBF),BC
	LD	B,(HL)
	INC	HL
ADRCL:	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	EX	(SP),HL
	PUSH	DE
	EXX
	POP	DE
	CALL	IMUL
	EXX
	PUSH	HL
	SBC	HL,DE
	JP	NC,SORERR
	EXX
	POP	DE
	ADD	HL,DE
	EXX
	POP	HL
	DJNZ	ADRCL
	PUSH	HL
	EXX
	LD	E,C
	LD	D,B
	LD	A,C
	CALL	IMUL
	PUSH	HL
	EXX
	POP	DE
	POP	HL
	ADD	HL,DE
	DEFB	001H		; LD BC,?
ARBCBF: DEFS	2
	POP	DE
	RET
;
CHALNM: CP	030h
	RET	C
	CP	05Bh
	CCF
	RET	C
	CP	041h
	RET	NC
	CP	03Ah
	CCF
	RET
;
DIM:	CALL	HLFTCH
	OR	A
	RET	Z
	CP	03Ah
	RET	Z
	LD	C,L
	LD	B,H
	CALL	BCFTCH
	CALL	VSRTST
	CP	028h
	JP	NZ,SERROR
	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	C,L
	LD	B,H
	LD	HL,(VSTART)
DASLOP: LD	A,(HL)
	OR	A
	JR	Z,DIMFDD
	JP	M,DRYATA
	INC	A
	INC	A
	INC	A
DRSKFN: ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	JR	DASLOP
;
DRYATA: AND	0C0h
	CP	0C0h
	LD	A,5
	JR	Z,DRSKFN
	LD	A,(HL)
	AND	07Fh
	CP	E
	JP	Z,MOPDIM
	INC	HL
DIDNAM: CALL	INDRCT
	JR	DASLOP
;
DXTVR1: DEC	HL
DXTVR:	DEC	HL
	DEC	HL
	JR	DIDNAM
;
MOPDIM: INC	HL
	INC	HL
	INC	HL
	LD	A,C
	CP	(HL)
	JP	NZ,DXTVR
	INC	HL
	LD	A,B
	CP	(HL)
	JP	NZ,DXTVR1
	JP	DUPDEF
;
DIMFDD: POP	HL
	POP	DE
	POP	BC
	LD	D,0
	PUSH	HL
ARGLOP: PUSH	DE
	CALL	IHLEXP
	CP	029h
	JR	Z,DEFARY
	CALL	CH2CH
	POP	DE
	INC	D
	INC	HL
	PUSH	HL
	JR	ARGLOP
;
DEFARY: POP	DE
	INC	D
	INC	HL
	PUSH	HL
	LD	HL,(STKLMT)
	LD	A,E
	OR	080h
	LD	(HL),A
	EX	AF,AF'
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	LD	(HL),D
	INC	HL
	LD	A,D
	EXX
	LD	HL,00001h
AREPUT: POP	DE
	PUSH	DE
	CALL	IMUL
	EXX
	POP	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	DEC	A
	EXX
	JR	NZ,AREPUT
	EX	AF,AF'
	AND	07Fh
	LD	E,A
	LD	D,0
	CALL	IMUL
	PUSH	HL
	EXX
	POP	DE
	PUSH	HL
	ADD	HL,DE
	JP	C,OMERR
	PUSH	DE
	CALL	HMEMCK
	EX	DE,HL
	LD	HL,(STKLMT)
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	LD	(STKLMT),DE
	POP	DE
	INC	DE
	EX	(SP),HL
ARYCLL: LD	(HL),0
	INC	HL
	DEC	DE
	LD	A,D
	OR	E
	JR	NZ,ARYCLL
	POP	HL
	POP	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	LD	L,C
	LD	H,B
	CALL	HLFTCH
	INC	HL
	CP	02Ch
	JP	Z,DIM
	DEC	HL
	RET
;
OFF:	CALL	HLFTCH
	CP	09Ch
	JR	Z,BREAKL
	XOR	A		;NUL CODE
	LD	(BREAKI),A
	LD	A,011h		;LD DE,BREAK
OFFOFF: LD	(BREAKJ),A
	RET
;
BREAKL: LD	A,3		;BREAK CODE
	LD	(BREAKI),A
	LD	A,0CAh		;JP Z,BREAK
	INC	HL
	JR	OFFOFF
;
SORERR: LD	A,9
NIERRO: JP	ERROR
;
NINS:	LD	A,29
	JR	NIERRO
;
VSRTST: LD	HL,00000h
	CP	041h
	JP	C,SERROR
	CP	05Bh
	JP	NC,SERROR
	LD	L,A
	CALL	BCFTCH
	CALL	CHALNM
	JR	C,CHKTYP
	LD	H,A
SKIPDM: CALL	BCFTCH
	CALL	CHALNM
	JR	NC,SKIPDM
CHKTYP: CP	028h
	JR	NC,DFLTER
	OR	A
	JP	Z,DFLTER
	CP	025h		;%
	LD	E,2
	JP	Z,BCFTCH
	CP	024h		;$
	LD	E,3
	JP	Z,BCFTCH
	CP	021h		;!
	LD	E,4
	JP	Z,BCFTCH
	CP	023h		;#
	LD	E,8
	JP	Z,BCFTCH
DFLTER: PUSH	HL
	LD	H,0
	LD	DE,DFTABL-041H
	ADD	HL,DE
	LD	E,(HL)
	POP	HL
	RET
;
IMUL:	PUSH	AF
	PUSH	BC
	LD	A,L
	LD	C,H
	LD	HL,00000h
	LD	B,008h
IMADL1: RRCA
	JR	NC,IMNADD
	ADD	HL,DE
	JR	C,SORERR
IMNADD: RL	E
	RL	D
	DJNZ	IMADL1
	LD	A,C
	OR	A
	JR	Z,IMRET
	LD	B,008h
IMADL2: RRCA
	JR	NC,IMNAD1
	ADD	HL,DE
	JR	C,SORERR
IMNAD1: RL	E
	RL	D
	DJNZ	IMADL2
IMRET:	POP	BC
	POP	AF
	RET
;
ERROPR: LD	A,2
	LD	(ERRORF),A
	DEFB	021H
CURTXT: DEFS	2
	DEC	HL
	LD	(RESTXT),HL
	POP	AF
	DEFB	021H
ERRORV: DEFS	2
	JP	RUNMID
;
OMERRE:
OMERR:	CALL	CLR
	EI
	LD	SP,(STRTOP)
	LD	(SPBUF),SP
	LD	A,7
ERROR:	LD	SP,(SPBUF)
	PUSH	AF
	LD	HL,(LNOBUF)
	LD	A,H
	AND	L
	INC	A
	JR	Z,ERRSML
	POP	AF
	LD	(ERRLNO),HL
	LD	(ERRCOD),A
	LD	HL,(NXTLPT)
	LD	(ERNLPT),HL
	PUSH	AF
	LD	A,(ERRORF)
	DEC	A
	JR	Z,ERROPR
ERRSML: CALL	CR2
	LD	A,1
	LD	(DISFLG),A
	POP	AF
	OR	A
	JR	Z,UNPERR
	CP	32
	JR	NC,UNPERR
	LD	DE,ERRTXT
	LD	B,A
ERRTCO: LD	A,(DE)
	INC	DE
	OR	A
	JR	NZ,ERRTCO
	DEC	B
	JR	NZ,ERRTCO
	LD	A,(DE)
	INC	A
	JR	NZ,ERRLOP
UNPERR: LD	DE,UNPMES
ERRLOP: LD	A,(DE)
	OR	A
	JP	Z,LNOPRT
	CALL	ACCPRT
	INC	DE
	JR	ERRLOP

UNPMES: DEFM	'UNPRINTABLE ERROR'
	DEFB	000H
;
OKMES:	DEFM	'OK'
;
SETSSP: LD	HL,00000h
	LD	(FUNCNS),HL
	LD	HL,(INTFAC)
	LD	IY,(INTSSP)
	RET
;
CONT:	DEFB	03EH
CONTFG: DEFS	1
	OR	A
	JR	NZ,OKCONT
	LD	A,17
	JP	ERROR
;
OKCONT: XOR	A
	LD	(CONTFG),A
	DEFB	021H
BLNOBF: DEFS	2
	LD	(LNOBUF),HL
	DEFB	021H
BNXTLP: DEFS	2
	LD	(NXTLPT),HL
	DEFB	021H
BTEXTP: DEFS	2
	DEFB	031H
SPBUF:	DEFS	2
	JP	SPCCUT
;
AUTOFF: LD	A,(AUTOVC)
	OR	A
	RET	NZ
	LD	A,0C9h
	LD	(AUTOVC),A
	JP	HOTENT
;
AUTOVC: DEFB	0C9H
	DEFB	021H
AUTOLN: DEFS	2
	CALL	FIVEPR
	CALL	SPPRT
	LD	HL,(AUTOLN)
	DEFB	011H		;LD DE,?
AUTOST: DEFS	2
	ADD	HL,DE
	LD	(AUTOLN),HL
	JP	C,AUTOFF
	RET
;
RESUME: DEFB	03EH
ERRORF: DEFS	1
	CP	2
	LD	A,20
	JP	NZ,ERROR
	LD	A,1
	LD	(ERRORF),A
	PUSH	HL
	DEFB	021H		; LD HL,?
ERNLPT: DEFS	2
	LD	(NXTLPT),HL
	DEFB	021H		; LD HL,?
ERRLNO: DEFS	2
	LD	(LNOBUF),HL
	POP	HL
	CALL	HLFTCH
	CP	03Ah
	JR	Z,THISLN
	OR	A
	JR	Z,THISLN
	CP	0B5h
	JR	Z,RESERR
	CP	08Bh
	JP	NZ,GOTO
	LD	HL,(RESTXT)
	CALL	DATA
	RET	NC
	POP	HL
	JP	NXLINE
;
THISLN:
    DEFB	021H
RESTXT: DEFS	2
	RET
;
RESERR: XOR	A
	LD	(ERRORF),A
	CALL	THISLN
	DEFB	03EH
ERRCOD: DEFS	1
	JP	ERROR
;
;	CHAIN	,EXPR
FLEXPR: CALL	SETSSP
FLEXP': LD	(IY+0),0
	CALL	EXPRSN
	PUSH	AF
	LD	A,(IY+0)
	CP	003h
	JP	Z,TYPEMS
MOTEST: OR	A
	JP	Z,MOPRND
	POP	AF
	RET
;
STEXPR: CALL	SETSSP
STEXP': LD	(IY+0),0
	CALL	EXPRSN
	PUSH	AF
	LD	A,(IY+0)
	CP	003h
	JP	NZ,TYPEMS
	JR	MOTEST
;
HLEXP:	CALL	FLEXP'
	JR	MDLHLE
;
IHLEXP: CALL	FLEXPR
MDLHLE: PUSH	AF
	CALL	HLFLTO
	POP	AF
	RET
;
BYTE:	CALL	HLEXP
HCHECK: LD	A,H
	OR	A
	LD	A,L
	RET	Z
	JP	IFCALL
;
IBYTE:	CALL	IHLEXP
	JR	HCHECK
;
TYPECS: LD	A,(IY+0)
	CP	003h
	RET	NZ
	JP	TYPEMS
;
TOOCMP: LD	A,16
	JP	ERROR
;
EXPRSN: EX	DE,HL
	DEFB	021H
MEMFAC: DEFS	2
	OR	A
	SBC	HL,DE
	EX	DE,HL
	JR	C,TOOCMP
	CALL	EXPPH3
XORAGN: CP	0EBh
	RET	NZ
	CALL	TYPECS
	PUSH	HL
	LD	(IY+0),0
	CALL	EXPPH3
	PUSH	AF
	CALL	HLFLTO
	POP	AF
	EX	DE,HL
	POP	HL
	PUSH	AF
	PUSH	HL
	CALL	HLFLTO
	LD	A,H
	XOR	D
	LD	D,A
	LD	A,L
	XOR	E
	LD	E,A
	POP	HL
	CALL	FLTHEX
	POP	AF
	JR	XORAGN
;
EXPPH3: CALL	EXPPH4
ORAGN:	CP	0ECh
	RET	NZ
	CALL	TYPECS
	PUSH	HL
	LD	(IY+0),0
	CALL	EXPPH4
	PUSH	AF
	CALL	HLFLTO
	POP	AF
	EX	DE,HL
	POP	HL
	PUSH	AF
	PUSH	HL
	CALL	HLFLTO
	LD	A,H
	OR	D
	LD	D,A
	LD	A,L
	OR	E
	LD	E,A
	POP	HL
	CALL	FLTHEX
	POP	AF
	JR	ORAGN
;
EXPPH4: CALL	EXPPH5
ANDAGN: CP	0EDh
	RET	NZ
	CALL	TYPECS
	PUSH	HL
	LD	(IY+0),0
	CALL	EXPPH5
	PUSH	AF
	CALL	HLFLTO
	POP	AF
	EX	DE,HL
	POP	HL
	PUSH	AF
	PUSH	HL
	CALL	HLFLTO
	LD	A,H
	AND	D
	LD	D,A
	LD	A,L
	AND	E
	LD	E,A
	POP	HL
	CALL	FLTHEX
	POP	AF
	JP	ANDAGN
;
EXPPH5: CALL	BCFTCH
	DEC	BC
	CP	0EEh
	JP	NZ,EXPPH6
	INC	BC
	CALL	EXPPH6
	PUSH	AF
	CALL	TYPECS
	PUSH	HL
	CALL	HLFLTO
	LD	A,L
	CPL
	LD	L,A
	LD	A,H
	CPL
	LD	H,A
	EX	DE,HL
	POP	HL
	CALL	FLTHEX
	POP	AF
	RET
;
EXPPH6: CALL	EXPR1
LOGLP:	CP	0EFh
	RET	C
	PUSH	AF
	PUSH	HL
	CALL	EXPR1
	EX	DE,HL
	POP	HL
	EX	AF,AF'
	POP	AF
	EX	AF,AF'
	PUSH	AF
	EX	AF,AF'
	CP	0F6h
	JR	C,EQUALG
	JR	Z,GTTHAN
	CALL	CMP
LDGTCM: JR	Z,FALSE
	JR	NC,FALSE
TRUE:	PUSH	DE
	PUSH	HL
	PUSH	BC
	EX	DE,HL
	CALL	LDIR1
	POP	BC
	POP	HL
	CALL	TOGLE
	POP	DE
LGBACK: POP	AF
	JR	LOGLP
;
FALSE:	PUSH	BC
	LD	B,8
	EX	DE,HL
	CALL	ZFILL
	POP	BC
	EX	DE,HL
	JR	LGBACK
;
GTTHAN: CALL	CMP
	CCF
	JR	LDGTCM
;
PORTRU: POP	AF
	JR	TRUE
;
EQUALG: CP	0F5h
	JR	C,ALGLOG
	CALL	CMP
	JR	Z,TRUE
	JR	FALSE
;
ALGLOG: CP	0F1h
	JP	C,NOTEQU
	PUSH	AF
	CALL	CMP
	JR	Z,PORTRU
	EX	AF,AF'
	POP	AF
	CP	0F2h
	JR	Z,GTEQLG
	CP	0F4h
	JR	Z,GTEQLG
	EX	AF,AF'
	JR	LDGTCM
GTEQLG: EX	AF,AF'
	CCF
	JR	LDGTCM
;
NOTEQU: CALL	CMP
	JR	Z,FALSE
	JR	TRUE
;
EXPR1:	CALL	TERM
EXPR':	CP	0F8h
	RET	C
	PUSH	HL
	JR	Z,EXADD
	CALL	TERM
	EX	DE,HL
	POP	HL
	PUSH	BC
EXPRBK: PUSH	AF
	CALL	SUB
EXPRBK1:	
	POP	AF
	POP	BC
	JP	EXPR'
;
EXADD:	CALL	TERM
	EX	DE,HL
	POP	HL
	PUSH	BC
	PUSH	AF
	CALL	ADD
	JP	EXPRBK1
;
TERM:	CALL	MFACT
TERM':	CP	0FAh		; /
	RET	C
	PUSH	HL
	JR	NZ,TMDIV
	CALL	MFACT
	EX	DE,HL
	POP	HL
	PUSH	BC
	PUSH	AF
	CALL	MOD_
TERMBK: POP	AF
	POP	BC
	JP	TERM'
;
TMDIV:	CALL	MFACT
	EX	DE,HL
	POP	HL
	PUSH	BC
	PUSH	AF
	CALL	DIV
	CALL	INT
	JP	TERMBK
;
MFACT:	CALL	FACT
MFACT': CP	0FCh		; MOD
	RET	C
	PUSH	HL
	JR	Z,TMMOD
	CALL	FACT
	EX	DE,HL
	POP	HL
	PUSH	BC
	PUSH	AF
	CALL	MUL
MFACBK: POP	AF
	POP	BC
	JP	MFACT'
;
TMMOD:	CALL	FACT
	EX	DE,HL
	POP	HL
	PUSH	BC
	PUSH	AF
	CALL	DIV
	JP	MFACBK
;
POWZRR: POP	HL
	PUSH	HL
	EX	DE,HL
	PUSH	BC
	CALL	LDIR1
	POP	BC
	POP	HL
POWAGN: DEC	BC
	CALL	BCFTCH
	JR	MIDFAP
;
FACT:	CALL	FACT''
MIDFAP: CP	0FEh
	RET	NZ
	PUSH	HL
	CALL	FACT''
	LD	A,(HL)
	OR	A
	JR	Z,POWZRR
	INC	HL
	BIT	7,(HL)
	RES	7,(HL)
	DEC	HL
	JR	NZ,MPOWER
	EX	DE,HL
	POP	HL
	CALL	POWER
	JR	POWAGN
;
MPOWER: EX	DE,HL
	POP	HL
	PUSH	HL
	PUSH	DE
	CALL	POWER
	POP	DE
	PUSH	DE
	PUSH	BC
	CALL	LDIR1
	POP	BC
	POP	DE
	POP	HL
	CALL	PSWAP
	PUSH	BC
	CALL	DIV
	POP	BC
	JR	POWAGN
;
POWER:	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	HL,8
	ADD	HL,DE
	EX	DE,HL
	PUSH	DE
	CALL	LDIR8
	POP	HL
	CALL	INT
	EX	DE,HL
	POP	HL
	CALL	CMP
	JR	Z,IPOWER
RPOWER: POP	DE
	PUSH	DE
	CALL	PSWAP
	CALL	B_LOG
	EX	DE,HL
	POP	HL
	CALL	MUL
	CALL	B_EXP
	POP	BC
	RET

IPOWER: LD	A,(HL)
	CP	086h
	JR	NC,RPOWER
	EX	(SP),HL
	LD	A,(HL)
	EX	(SP),HL
	CP	088h
	JR	NC,RPOWER
	CALL	HLFLTO		; 0 END
	LD	A,L
	POP	HL
	PUSH	AF		; BIT-P
	PUSH	HL		; FAC
	LD	DE,KEYBUF
	PUSH	DE
	CALL	LDIR8
	POP	HL		;ZFAC
	LD	B,4		;RCOUNT
PWCLLP: PUSH	BC
	EX	DE,HL
	LD	HL,00008h
	ADD	HL,DE
	EX	DE,HL
	CALL	LDIR8
	LD	E,L
	LD	D,H
	CALL	MUL
	POP	BC
	DJNZ	PWCLLP
	POP	HL
	PUSH	HL
	EX	DE,HL
	CALL	LDIR1
	POP	HL
	POP	AF
	LD	DE,KEYBUF
	LD	B,5
PWCLL1: RRCA
	JR	NC,NEXTPL
	PUSH	AF
	PUSH	BC
	PUSH	DE
	CALL	MUL
	POP	DE
	POP	BC
	POP	AF
NEXTPL: PUSH	HL
	LD	HL,8
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	DJNZ	PWCLL1
	POP	BC
	RET
;
PSWAP:	PUSH	BC
	PUSH	HL
	PUSH	DE
	EX	DE,HL
	LD	DE,ZFAC
	CALL	LDIR8
	POP	DE
	POP	HL
	PUSH	DE
	PUSH	HL
	CALL	LDIR8
	POP	DE
	PUSH	DE
	LD	HL,ZFAC
	CALL	LDIR8
	POP	HL
	POP	DE
	POP	BC
	RET

FACT'': CALL	BCFTCH
	CP	020h
	JP	C,CONST
	CP	0F8h
	JR	Z,FACT''
	CP	0F9h
	JP	Z,INUSE
	CP	041h
	JP	NC,VARFUN
	CP	028h
	JR	Z,KAKKO
	CP	029h
	JP	Z,SERROR
	CP	022h
	JP	Z,STRFAC
	JR	MOCHCK
;
INUSE:	CALL	FACT''
	PUSH	AF
	LD	A,(IY+0)
	CP	003h
	JP	Z,TYPEMS
	CALL	TOGLE
	POP	AF
	RET
;
KAKKO:	DEC	IY
	LD	(IY+0),0
	CALL	EXPRSN
	CALL	CH29H
	LD	A,(IY+0)
	INC	IY
	CP	003h
	JR	Z,CONDSB
	CALL	CONDFL
	JP	BCFTCH
;
CONDSB: CALL	CONDSR
	JP	BCFTCH
;
MOCHCK: LD	D,A
	XOR	A
	CP	(IY+0)
	LD	A,D
	DEC	BC
	RET	Z
MOPRND: LD	A,22
	JP	ERROR
;
BCFTCH: LD	A,(BC)
	INC	BC
	CP	020h
	RET	NZ
	JP	BCFTCH
;
CONST:	CP	00Bh
	JR	NC,HXORFL
	OR	A
	JR	Z,MOPRND
	DEC	A
	LD	DE,00008h
	ADD	HL,DE
	LD	E,A
	LD	D,0
FLTHXB: LD	A,004h
	CALL	CONDFL
	CALL	FLTHEX
BCKFTR: JP	BCFTCH
;
HXORFL: CP	014h
	JR	NC,FLTPNT
	CP	00Bh
	LD	DE,00008h
	ADD	HL,DE
	JR	Z,LNOCON
LDELNO: LD	A,(BC)
	LD	E,A
	INC	BC
	LD	A,(BC)
	LD	D,A
	INC	BC
	JR	FLTHXB
;
LNOCON: CALL	LDELNO
	PUSH	AF
	CALL	ADJERL
	POP	AF
	RET
;
FLTPNT: CP	019h
	JP	NC,SERROR
	LD	DE,00008h
	ADD	HL,DE
	AND	00Fh
	CALL	CONDFL
	CP	004h
	CALL	Z,CLRFAC
	PUSH	HL
	EX	DE,HL
	LD	L,C
	LD	H,B
	LD	B,000h
	LD	C,A
	LDIR
	LD	C,L
	LD	B,H
	POP	HL
	JR	BCKFTR
;
VARFUN: CP	0FFh
	JP	Z,FCTION
	CP	05Ch
	JP	NC,SERROR
	DEFB	011H		;LD DE,
FUNCNS: DEFS	2
	EX	AF,AF'
	LD	A,E
	OR	D
	JR	NZ,FUNGVR
    EX	AF,AF'
VARFNE: LD	DE,00008h
	ADD	HL,DE
	EX	DE,HL
	CALL	GETVAR
	EX	DE,HL
	CALL	CLRFAC
	PUSH	HL
	PUSH	BC
	CP	003h
	JR	Z,STRVAR
	CP	002h
	JR	Z,INTVAR
	CALL	CONDFL
	LD	B,A
VARTR#: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	VARTR#
RTVARI: POP	BC
	POP	HL
	JP	BCFTCH
;
STRVAR: CALL	CONDSR
	LD	(HL),E
	INC	HL
	LD	(HL),D
	JR	RTVARI
;
INTVAR: LD	A,004h
	CALL	CONDFL
	EX	DE,HL
	CALL	INDRCT
	EX	DE,HL
	CALL	FLTHEX
	JR	RTVARI
;
FUNGVR: EX	AF,AF'
	PUSH	HL
	PUSH	AF
	PUSH	BC
	CALL	VSRTST
	LD	(FNBCPT),BC
	CP	028h
	JR	NZ,EFCT1
NFCVAR: POP	BC
	POP	AF
	POP	HL
	JR	VARFNE
;
EFCT1:	LD	A,E
	LD	(CPIMDP),A
	LD	(CPIMDQ),A
	XOR	A
	EX	AF,AF'
	EX	DE,HL
	LD	HL,(FUNCNS)
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
VRFLOP: PUSH	DE
	EX	AF,AF'
	INC	A
	EX	AF,AF'
	CALL	BCFTCH
	CALL	VSRTST
	CP	029h
	JR	Z,LSTCMP
	CP	02Ch
	JP	NZ,SERROR
	LD	A,E
	POP	DE
	DEFB	0FEH		;CP
CPIMDP: DEFS	1
	JR	NZ,VRFLOP
	OR	A
	SBC	HL,DE
	JR	NZ,VRFLOP
	JR	FVRFND
;
LSTCMP: LD	A,E
	POP	DE
	DEFB	0FEH		;CP
CPIMDQ: DEFS	1
	JR	NZ,NFCVAR
	OR	A
	SBC	HL,DE
	JR	NZ,NFCVAR
;
FVRFND: DEFB	001H		;LD BC,?
FNBCPT: DEFS	2
	EX	AF,AF'
	LD	E,A
	LD	A,(CPIMDQ)
	CP	003h
	JR	Z,FNLVRS
	CALL	CONDFL
	JR	FVRFDD
FNLVRS: CALL	CONDSR
FVRFDD: POP	HL
	POP	HL
	POP	HL
	DEC	BC
	PUSH	BC
	PUSH	HL
	LD	HL,(FUNCNS)
	INC	HL
	INC	HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
TSTARG: DEC	E
	JR	Z,FNCGS
	CALL	SNXT2C
	JR	TSTARG
;
FNCGS:	LD	HL,(FUNCNS)
	POP	DE
	PUSH	HL
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	CALL	INDRCT
	LD	(FUNCNS),HL
	EX	DE,HL
	CALL	EXPRSN
	POP	DE
	LD	(FUNCNS),DE
	POP	BC
	JP	BCFTCH
;
SNXT2C: CALL	SK2C2C
	CP	02Ch
	JR	NZ,SNXT2C
	RET
;
SK2C2C: CALL	SKPSBL
	CP	028h
	RET	NZ
S2C2CL: CALL	SK2C2C
	CP	029h
	RET	Z
	JR	S2C2CL
;
SK2829: CALL	SKPSBL
	CP	029h
	RET	Z
	CP	028h
	JR	NZ,SK2829
SK2BLO: CALL	SK2829
	JR	SK2829
;
SKPSBL: CALL	BCFTCH
	OR	A
SKSBER: JP	Z,SERROR
	CP	03Ah
	JR	Z,SKSBER
	CP	022h
	JR	Z,DQSKCM
	CP	020h
	RET	NC
	CP	012h
	JR	C,DWNERG
	AND	00Fh
HEXSKS: ADD	A,C
	LD	C,A
	LD	A,0
	ADC	A,B
	LD	B,A
	JR	SKPSBL
;
DWNERG: CP	00Bh
	JR	C,SKPSBL
	LD	A,002h
	JR	HEXSKS
;
DQSKCM: CALL	BCFTCH
	CP	022h
	JR	Z,SKPSBL
	OR	A
	JR	Z,SKSBER
	JR	DQSKCM
;
FCTION: LD	A,(BC)
	INC	BC
	CP	0A0h
	JP	NC,FUNCT1
	PUSH	HL
	LD	HL,FLFNRT
FTRMER: EX	(SP),HL
	PUSH	HL
	CALL	GETFJP
	EX	(SP),HL
	CALL	CH28H
	DEC	IY
	LD	(IY+0),0
	CALL	FLEXP'
	JP	CH29H
;
FLFNRT: LD	A,(IY+0)
	INC	IY
	CALL	CONDFL
FNCCON: JP	BCFTCH
;
FUNCT1: CP	0A9h
	JP	NC,FUNCT2
	PUSH	HL
	LD	HL,SRFNRT
	JR	FTRMER
;
SRFNRT: INC	IY
	JP	CONDSB
;
;
FUNCT2: CP	0B2h
	JP	NC,OTHERF
	PUSH	HL
	LD	HL,SRSRRT
	EX	(SP),HL
	PUSH	HL
	CALL	GETFJP
	EX	(SP),HL
	CALL	CH28H
	DEC	IY
	LD	(IY+0),0
	CALL	STEXP'
	JP	CH29H
;
SRSRRT: LD	A,(IY+0)
	INC	IY
	CALL	CONDFL
	JP	BCFTCH
;
OTHERF: PUSH	HL
	CALL	GETFJP
	EX	(SP),HL
	RET
;
LENSUB: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	JR	MIDERL
;
ASCSUB: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	OR	A
	JP	Z,IFCALL
	INC	HL
	CALL	INDRCT
MIDERL: LD	E,(HL)
	LD	D,0
	POP	HL
	LD	(IY+0),4
	CALL	CLRFAC
	CALL	FLTHEX
	POP	DE
	POP	BC
	RET
;
VALSUB: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	OR	A
	JR	Z,ZRVALR
	INC	HL
	CALL	INDRCT
	LD	B,A
	LD	DE,KEYBUF
VALTRL: LD	A,(HL)
	LD	(DE),A
	INC	HL
	INC	DE
	DJNZ	VALTRL
MIDVAL: XOR	A
	LD	(DE),A
	LD	DE,KEYBUF
	POP	HL
	CALL	OVFLAG
	POP	DE
	POP	BC
	RET
;
ZRVALR: LD	DE,KEYBUF
	JR	MIDVAL
;
NULSDC: DEFB	000H
	DEFW	0
;
INKEY:	LD	DE,00008h
	ADD	HL,DE
	CALL	BCFTCH
	CP	028h
	DEC	BC
	JR	NZ,NORGET
	INC	BC
	PUSH	HL
	DEC	IY
	LD	(IY+0),0
	CALL	FLEXP'
	CALL	CH29H
	INC	IY
	CALL	HLFLTO
	CALL	HCHECK
	POP	HL
	LD	(FLASHF),A
	CALL	ASCGET
	JP	INKMID
;
NORGET: XOR	A
	LD	(FLASHF),A
	CALL	ASCGET
	DEFB	0FEH		;CP
LSTGET: DEFB	000H
	JR	Z,NLINKY
	LD	(LSTGET),A
INKMID: OR	A
	JR	NZ,CHRMIS
NLINKY: LD	DE,NULSDC
	LD	(HL),E
	INC	HL
	LD	(HL),D
	DEC	HL
INKBCK: JP	CONDSB
;
;
CHRMIS: CALL	CHRMID
	JR	INKBCK
;
CHRSUB: PUSH	HL
	CALL	HLFLTO
	CALL	HCHECK
	POP	HL
CHRMID: PUSH	HL
	PUSH	DE
	LD	E,L
	LD	D,H
	INC	DE
	INC	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	PUSH	HL
	LD	(HL),1
	INC	HL
	INC	DE
	INC	DE
	INC	DE
	INC	DE
	INC	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	LD	(DE),A
	POP	HL
	LD	E,L
	LD	D,H
	CALL	GETSTR
	POP	DE
	POP	HL
	RET
;
GETFJP: LD	HL,FJPTBL
GETJPA: SUB	081h
	ADD	A,A
	LD	E,A
	LD	D,0
	ADD	HL,DE
	JP	INDRCT
;
CLRFAC: PUSH	HL
	PUSH	BC
	LD	B,8
CLFCLP: LD	(HL),0
	INC	HL
	DJNZ	CLFCLP
	POP	BC
	POP	HL
	RET
;
STRFAC: LD	DE,00008h
	ADD	HL,DE
	INC	HL
	INC	HL
	LD	(HL),0
	INC	HL
	LD	(HL),C
	INC	HL
	LD	(HL),B
	DEC	HL
	DEC	HL
STRSL:	LD	A,(BC)
	INC	(HL)
	OR	A
	JR	Z,LENOKS
	INC	BC
	CP	022h
	JR	NZ,STRSL
LENOKS: DEC	(HL)
	PUSH	DE
	LD	E,L
	LD	D,H
	DEC	HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	POP	DE
	JP	CONDSB
;
CONDSR: PUSH	AF
	LD	A,(IY+0)
	OR	A
	JR	Z,OKSTTH
	CP	003h
	JP	NZ,TYPEMS
OKSTTH: POP	AF
	LD	(IY+0),3
	RET
;
CONDFL: PUSH	AF
	LD	A,(IY+0)
	OR	A
	JR	Z,STFLMK
	CP	003h
	JP	Z,TYPEMS
	POP	AF
	CP	004h
	RET	Z
	JR	STDBL
STFLMK: POP	AF
STDBL:	LD	(IY+0),A
	RET
;
FLTHEX: CALL	CLRFAC
	LD	A,E
	OR	D
	RET	Z
	BIT	7,D
	JR	Z,NORFLH
	LD	A,D
	CPL
	LD	D,A
	LD	A,E
	CPL
	LD	E,A
	INC	DE
	CALL	NORFLH
	JP	TOGLE
;
NORFLH: LD	A,091h
SFL:	DEC	A
	BIT	7,D
	JR	NZ,FLHXRT
	RL	E
	RL	D
	JR	SFL
FLHXRT: LD	(HL),A
	INC	HL
	RES	7,D
	LD	(HL),D
	INC	HL
	LD	(HL),E
	DEC	HL
	DEC	HL
	RET
;
DEFINT: LD	C,002h
	JR	CONTDF
DEFSTR: LD	C,003h
	JR	CONTDF
DEFSNG: LD	C,004h
	JR	CONTDF
DEFDBL: LD	C,008h
CONTDF: CALL	HLFTCH
	CP	05Bh
	RET	NC
	SUB	041h
	RET	C
	LD	E,A
	LD	D,0
	LD	B,A
	PUSH	HL
	LD	HL,DFTABL
	ADD	HL,DE
	LD	(HL),C
	EX	DE,HL
	POP	HL
CDEFTP: CALL	INCHLF
;
	INC	HL
	CP	02Ch
	JR	Z,CONTDF
	DEC	HL
	CP	0F9h
	RET	NZ
	CALL	INCHLF
;
	CP	05Bh
	RET	NC
	SUB	041h
	RET	C
STRMDM2: SUB	B
	RET	C
	RET	Z
	EX	DE,HL
DFFIL1: INC	HL
	LD	(HL),C
	DEC	A
	JR	NZ,DFFIL1
	EX	DE,HL
	JR	CDEFTP
;
CALLUP: LD	C,L
	LD	B,H
	CALL	IHLEXP
	PUSH	BC
	PUSH	IY
	LD	BC,CALUPR
	PUSH	BC
	JP	(HL)
CALUPR: POP	IY
	POP	HL
	DEC	HL
	RET
;
INCHLF: INC	HL
HLFTCH:
    LD	A,(HL)
	CP	020h
	RET	NZ
	JR	INCHLF
;
INTG:	INC	HL
	BIT	7,(HL)
	DEC	HL
	JP	Z,INT
	PUSH	DE
	PUSH	HL
	LD	DE,00008h
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	PUSH	HL
	PUSH	DE
	PUSH	BC
	CALL	LDIR8
	POP	BC
	POP	HL
	CALL	INT
	EX	DE,HL
	POP	HL
	CALL	CMP
	JR	Z,MNINTR
	CALL	INT
	PUSH	BC
	CALL	ONESUB
	POP	BC
MNINTR: POP	DE
	RET
;
STRING: CALL	CH28H
	DEC	IY
	PUSH	HL
	CALL	FLEXP'
	CALL	CH2CH
	CALL	HLFLTO
	CALL	HCHECK
	POP	HL
	PUSH	AF
	CALL	FLEXP'
	INC	IY
	PUSH	HL
	CALL	HLFLTO
	CALL	HCHECK
	LD	(FILLCH),A
	POP	HL
	POP	AF
	CALL	SPCSU'
	JP	CONDSB
;
;
SPCSU': PUSH	BC
	PUSH	DE
	PUSH	HL
	JR	SPCSME
;
SPCSUB: LD	A,020h
	LD	(FILLCH),A
	PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	HLFLTO
	CALL	HCHECK
SPCSME: OR	A
	JR	Z,NULRET
	LD	B,A
	LD	C,B
	LD	HL,KEYBUF
SPCFLL: DEFB	036H		;LD (HL),?
FILLCH: DEFB	020H
	INC	HL
	DJNZ	SPCFLL
NULRET: POP	HL
	LD	DE,KEYBUF
	LD	B,C
	CALL	ENTSTR
	POP	DE
	POP	BC
	RET
;
FRACSB: PUSH	BC
	CALL	FRAC
	POP	BC
	RET
;
PEEK:	PUSH	DE
	PUSH	HL
	CALL	HLFLTO
	LD	E,(HL)
	LD	D,0
	POP	HL
	CALL	FLTHEX
	POP	DE
	LD	(IY+0),4
	RET
;
HEXD:	PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	HL
	LD	DE,KEYBUF
	CALL	HLFLTO
	CALL	HEXHL
	LD	B,4
MIDOCT: LD	A,(DE)
	CP	030h
	JR	NZ,MIDHEX
	INC	DE
	DEC	B
	JR	NZ,MIDOCT
	INC	B
	DEC	DE
	JR	MIDHEX
;
OCTD:	PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	HL
	LD	DE,KEYBUF
	CALL	HLFLTO
	CALL	OCTHL
	LD	B,6
	JR	MIDOCT
;
STRSUB: PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	HL
	CALL	CVNMFL
MIDHEX: EX	DE,HL
	EX	(SP),HL
	LD	E,L
	LD	D,H
	INC	DE
	INC	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	LD	(HL),B
	INC	HL
	POP	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	DEC	HL
	DEC	HL
	LD	E,L
	LD	D,H
	CALL	GETSTR
	POP	HL
	POP	DE
	POP	BC
	RET
;
MK1:	PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	HL
	CALL	HLFLTO
	LD	(INPSDC),HL
	LD	B,2
	LD	DE,INPSDC
	POP	HL
	PUSH	HL
	JR	MIDHEX
;
MKS:	PUSH	BC
	LD	BC,4
	JR	MKHILS
;
MKD:	PUSH	BC
	LD	BC,8
MKHILS: PUSH	DE
	PUSH	HL
	PUSH	HL
	LD	DE,ZFAC
	PUSH	DE
	PUSH	BC
	LDIR
	POP	BC
	POP	DE
	POP	HL
	PUSH	HL
	LD	B,C
	JR	MIDHEX
INDRCT: PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	POP	DE
	RET
;
CVI:	PUSH	BC
	PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	CP	002h
	JP	NZ,IFCALL
	INC	HL
	CALL	INDRCT
	CALL	INDRCT
	EX	DE,HL
	POP	HL
	CALL	FLTHEX
	POP	BC
	LD	(IY+0),4
	RET
;
CVD:	PUSH	BC
	LD	C,8
	JR	CVMIDE
;
CVS:	PUSH	BC
	LD	C,4
CVMIDE: PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	CP	C
	JP	NZ,IFCALL
	INC	HL
	CALL	INDRCT
	EX	DE,HL
	POP	HL
	PUSH	HL
	CALL	CLRFAC
	LD	B,C
CVTRLP: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	CVTRLP
	POP	HL
	LD	(IY+0),C
	POP	BC
	RET
;
PARI:	PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	JP	Z,IFCALL
	INC	HL
	CALL	INDRCT
	LD	A,(HL)
	AND	A
	LD	DE,00001h
	JP	PO,SKIMPL
	DEC	DE
SKIMPL: POP	HL
	CALL	FLTHEX
	POP	DE
	POP	BC
	LD	(IY+0),4
	RET
;
ENTSTR: PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	HL
	JP	MIDHEX
;
CDBL:	LD	A,8
	JP	CONDFL      ;CONDFL
;
CSNG:	LD	A,(HL)
	OR	A
	JR	Z,INRETY
	LD	A,(IY+0)
	CP	004h
	JR	Z,INRETY
	INC	HL
	LD	A,(HL)
	RES	7,(HL)
	DEC	HL
	PUSH	AF
	LD	A,(HL)
	PUSH	AF
	LD	(HL),099h
	PUSH	BC
	CALL	ONEADD
	POP	BC
	LD	A,(HL)
	CP	09Ah
	JR	NZ,EPREST
	POP	AF
	INC	A
	JP	Z,OVERFL
	PUSH	AF
EPREST: POP	AF
	LD	(HL),A
	POP	AF
	INC	HL
	AND	080h
	OR	(HL)
	LD	(HL),A
	DEC	HL
	LD	(IY+0),4
	JR	INRETY
;
CINT:	LD	A,(HL)
	OR	A
	JR	Z,INRETY
	PUSH	HL
	INC	HL
	LD	A,(HL)
	PUSH	AF
	RES	7,(HL)
	DEC	HL
	PUSH	BC
	INC	(HL)
	CALL	ONEADD
	DEC	(HL)
	POP	BC
	INC	HL
	POP	AF
	AND	080h
	ADD	A,(HL)
	LD	(HL),A
	DEC	HL
	CALL	HLFLTO
	EX	DE,HL
	POP	HL
	CALL	FLTHEX
INRETY: LD	A,004h
	JP	CONDFL
;
LEFT1:	CALL	CH28H
	LD	DE,00008h
	ADD	HL,DE
	PUSH	HL
	CALL	STEXP'
	CALL	CH2CH
	PUSH	HL
	DEC	IY
	LD	(IY+0),0
	CALL	HLEXP
	INC	IY
	CALL	CH29H
	CALL	HCHECK
	POP	HL
	PUSH	HL
	CALL	INDRCT
	CP	(HL)
	JR	C,LFTOLM
	LD	A,(HL)
LFTOLM: INC	HL
	CALL	INDRCT
	EX	DE,HL
LMIDET: POP	IX
	POP	HL
	PUSH	BC
	LD	B,A
	OR	A
	JR	Z,NOLENE
	PUSH	HL
	PUSH	BC
	EX	DE,HL
	LD	DE,KEYBUF
	PUSH	DE
	LD	C,B
	LD	B,0
	LDIR
	POP	DE
	POP	BC
	POP	HL
NOLENE: CALL	ENTSTR
	PUSH	HL
	PUSH	IX
	POP	HL
	CALL	CONDMZ
	POP	HL
	POP	BC
	JP	CONDSB
;
RIGHT1:	CALL	CH28H
	LD	DE,00008h
	ADD	HL,DE
	PUSH	HL
	CALL	STEXP'
	CALL	CH2CH
	PUSH	HL
	DEC	IY
	LD	(IY+0),0
	CALL	HLEXP
	INC	IY
	CALL	CH29H
	CALL	HCHECK
	POP	HL
	PUSH	HL
	CALL	INDRCT
	CP	(HL)
	JR	C,NOLSRD
	LD	A,(HL)
NOLSRD: PUSH	AF
	SUB	(HL)
	NEG
	INC	HL
	CALL	INDRCT
	ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	EX	DE,HL
	POP	AF
	JR	LMIDET
;
MID:	CALL	CH28H
	LD	DE,00008h
	ADD	HL,DE
	PUSH	HL
	CALL	STEXP'
	CALL	CH2CH
	PUSH	HL
	DEC	IY
	LD	(IY+0),0
	CALL	HLEXP
	INC	IY
	EX	AF,AF'
	CALL	HCHECK
	OR	A
	JP	Z,IFCALL
	LD	D,A
	EX	AF,AF'
	CP	029h
	LD	E,0FFh
	JR	Z,MIDALL
	CALL	CH2CH
	POP	HL
	PUSH	HL
	PUSH	DE
	DEC	IY
	LD	(IY+0),0
	CALL	HLEXP
	INC	IY
	CALL	CH29H
	CALL	HCHECK
	POP	DE
	LD	E,A
MIDALL: POP	HL
	PUSH	HL
	CALL	INDRCT
	LD	A,D
	DEC	A
	CP	(HL)
	JR	NC,MIDNUL
	EX	AF,AF'
	LD	A,(HL)
	SUB	D
	INC	A
	EX	AF,AF'
	INC	HL
	CALL	INDRCT
	ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	EX	AF,AF'
	CP	E
	JR	C,KMIJL
	LD	A,E
KMIJL:	EX	DE,HL
MNULIS: JP	LMIDET
;
MIDNUL: LD	DE,00000h
	XOR	A
	JR	MNULIS
;
INSTR:	PUSH	HL
	CALL	CH28H
	LD	D,001h
	DEC	IY
	LD	(IY+0),0
	PUSH	DE
	CALL	EXPRSN
	POP	DE
	CALL	CH2CH
	LD	A,(IY+0)
	CP	003h
	JR	Z,SINSEX
	CALL	HLFLTO
	CALL	HCHECK
	LD	D,A
	POP	HL
	PUSH	HL
	PUSH	DE
	CALL	STEXP'
	POP	DE
	CALL	CH2CH
SINSEX: PUSH	DE
	PUSH	HL
	CALL	STEXP'
	CALL	CH29H
	LD	(BCPOTR),BC
	INC	IY
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	OR	A
	JR	Z,INSZR1
	INC	HL
	CALL	INDRCT
	EX	DE,HL
	LD	C,A
	POP	HL
	CALL	CONDMZ
	CALL	INDRCT
	LD	A,(HL)
	OR	A
	JR	Z,INSZR2
	CP	C
	JR	C,INSZR2
	LD	B,A
	INC	HL
	CALL	INDRCT
	POP	AF
	DEC	A
INCPL1: CP	B
	JR	NC,INSZR3
	PUSH	AF
	SUB	B
	NEG
	CP	C
	JR	C,INSZR2
	POP	AF
	PUSH	BC
	PUSH	DE
	PUSH	HL
	PUSH	AF
	ADD	A,L
	LD	L,A
	LD	A,0
	ADC	A,H
	LD	H,A
	LD	B,C
INSCPL: LD	A,(DE)
	CP	(HL)
	JR	NZ,INMTCH
	INC	HL
	INC	DE
	DJNZ	INSCPL
	JR	INSRET
INMTCH: POP	AF
	POP	HL
	POP	DE
	POP	BC
	INC	A
	JR	INCPL1
;
INSRET: POP	AF
	POP	HL
	POP	DE
	POP	BC
	INC	A
INSZR:	LD	DE,00008h
	POP	HL
	ADD	HL,DE
	LD	E,A
	CALL	FLTHEX
	LD	A,004h
	DEFB	001H		;LD BC,?
BCPOTR: DEFS	2
	CALL	CONDFL
	JP	BCFTCH
;
INSZR1: POP	HL
INSZR2: POP	AF
INSZR3: XOR	A
	JR	INSZR
;
FRE:	CALL	CH28H
	CALL	FLEXP'
	CALL	CH29H
;
	PUSH	HL
	LD	DE,(STKLMT)
	LD	HL,00000h
	ADD	HL,SP
	OR	A
	SBC	HL,DE
	EX	DE,HL
	POP	HL
FREMID: CALL	FLTHEX
	LD	A,004h
	CALL	CONDFL
	JP	BCFTCH
;
VARPTR: CALL	CH28H
	PUSH	HL
	EX	DE,HL
	CALL	GETVAB
	CALL	BCFTCH
	CALL	CH29H
	EX	DE,HL
	POP	HL
	PUSH	DE
	LD	DE,00008h
	ADD	HL,DE
	POP	DE
	JR	FREMID
;
CH28H:	CALL	BCFTCH
	CP	028h
	RET	Z
SERVED: JP	SERROR
;
CH2CH:	CP	02Ch
	RET	Z
	JR	SERVED
;
CH29H:	CP	029h
	RET	Z
	JR	SERVED
;
MEM$:	CALL	CH28H
	DEC	IY
	PUSH	HL
	CALL	FLEXP'
	CALL	CH2CH
	CALL	HLFLTO
	EX	DE,HL
	POP	HL
	PUSH	DE
	CALL	FLEXP'
	CALL	CH29H
	INC	IY
	PUSH	HL
	CALL	HLFLTO
	CALL	HCHECK
	POP	HL
	POP	DE
	PUSH	BC
	LD	B,A
	CALL	ENTSTR
	POP	BC
	JP	CONDSB
;
;
HLFLTO: CALL	HLFLT
	RET	NC
	JP	OVERFL
;
GETSTR: PUSH	BC
	PUSH	HL
	PUSH	DE
	XOR	A
	LD	B,(HL)
	OR	B
	JR	Z,NULSTR
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	HL,(STRPTR)
	XOR	A
	LD	C,B
	LD	B,A
	SBC	HL,BC
	DEC	HL
	DEC	HL
	PUSH	HL
	PUSH	DE
	LD	DE,(STRTOP)
	OR	A
	SBC	HL,DE
	POP	DE
	POP	HL
	JR	C,PURGE
	LD	(STRPTR),HL
	EX	DE,HL
	EX	(SP),HL
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	EX	DE,HL
	EX	(SP),HL
	EX	DE,HL
	LD	B,C
	PUSH	HL
STRTRL: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	STRTRL
	POP	DE
NULBCK: POP	BC
	POP	HL
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	DEC	HL
	DEC	HL
	LD	D,B
	LD	E,C
	POP	BC
	RET
;
NULSTR: LD	DE,00000h
	JR	NULBCK
;
MEMPUR: LD	(BLTHLB),HL
	LD	(BLTDEB),DE
	LD	(BLTBCB),BC
	POP	HL
	LD	(BLTRTA),HL
	CALL	STRPRG
	LD	HL,(STRPTR)
	LD	DE,0FC00h	;-400H
	ADD	HL,DE
	LD	DE,(STRTOP)
	LD	(STRTOP),HL
	EX	DE,HL
	LD	(MEPDEB),HL
	EX	DE,HL
	LD	HL,0
	ADD	HL,SP
	EX	DE,HL
	OR	A
	SBC	HL,DE
	LD	C,L
	LD	B,H
	INC	BC
	LD	HL,(STRTOP)
	EX	DE,HL
	DEFB	021H		; LD HL,
MEPDEB: DEFS	2
	DI
	INC	DE
	INC	HL
	INC	BC
	LDDR
	EX	DE,HL
	INC	HL
	LD	SP,HL
	EI
	LD	DE,(STRTOP)
	LD	HL,(MEPDEB)
	OR	A
	SBC	HL,DE
	EX	DE,HL
	JP	MIDMPR
;
PURGE:	CALL	STRPRG
	LD	HL,(STRPTR)
	SBC	HL,BC
	DEC	HL
	DEC	HL
PURAGN: LD	DE,(STRTOP)
	OR	A
	SBC	HL,DE
	JR	C,SPBLTF
	POP	DE
	POP	HL
	POP	BC
	JP	GETSTR
;
SPBLTF: CALL	STKBLT
	JR	PURAGN
;
STKBLT: PUSH	HL
	PUSH	DE
	LD	HL,00000h
	ADD	HL,SP
	EX	DE,HL
	LD	HL,(STKLMT)
	INC	H
	INC	H
	INC	H
	OR	A
	SBC	HL,DE
	JP	NC,OMERR
	POP	DE
	POP	HL
	LD	(BLTHLB),HL
	LD	(BLTDEB),DE
	LD	(BLTBCB),BC
	POP	HL
	LD	(BLTRTA),HL
	LD	HL,0
	ADD	HL,SP
	EX	DE,HL
	LD	HL,(STRTOP)
	OR	A
	SBC	HL,DE
	LD	C,L
	LD	B,H
	INC	BC
	INC	BC
	LD	HL,0FE00h	;-200H
	ADD	HL,DE
	EX	DE,HL
	DI
	LDIR
	LD	HL,0FE00h	;-200H
	ADD	HL,SP
	LD	SP,HL
	EI
	LD	DE,0FE00h	;-200H
	LD	HL,(STRTOP)
	ADD	HL,DE
	LD	(STRTOP),HL
MIDMPR: LD	HL,(SPBUF)
	ADD	HL,DE
	LD	(SPBUF),HL
	LD	BC,FUNCNS
BLTAJL: LD	A,(BC)
	LD	L,A
	INC	BC
	LD	A,(BC)
	LD	H,A
	OR	L
	JR	Z,BLTRET
	ADD	HL,DE
	LD	A,H
	LD	(BC),A
	DEC	BC
	LD	A,L
	LD	(BC),A
	LD	C,L
	LD	B,H
	INC	BC
	INC	BC
	INC	BC
	INC	BC
	JR	BLTAJL
;
BLTRET: DEFB	021H		; LD HL,?
BLTHLB: DEFS	2
	DEFB	011H		; LD DE,?
BLTDEB: DEFS	2
	DEFB	001H		; LD BC,?
BLTBCB: DEFS	2
	DEFB	0C3H		; JP ?
BLTRTA: DEFS	2
;
STRPRG: PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,(STRPTR)
FSTRTP: CALL	SREDCK
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	XOR	A
	CP	B
	JP	NZ,FDSRTP
	ADD	HL,BC
	LD	(STRPTR),HL
	JP	FSTRTP
;
FDSRTP: LD	HL,(STRPTR)
SPRGLP: CALL	SREDCK
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	XOR	A
	CP	B
	JR	Z,SHORTN
	LD	A,(BC)
	LD	E,A
	LD	D,0
	ADD	HL,DE
	JP	SPRGLP
ESCSPR: POP	HL
	POP	DE
	POP	BC
	RET
;
SHORTN: PUSH	HL
SHRTNL: ADD	HL,BC
	EX	DE,HL
	LD	HL,(STRBTM)
	XOR	A
	SBC	HL,DE
	EX	DE,HL
	JR	Z,STRNST
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	CP	B
	JR	Z,SHRTNL
	DEC	HL
	DEC	HL
STRNST: POP	DE
	DEC	DE
	DEC	DE
	DEC	DE
	PUSH	HL
	DEC	HL
	EX	DE,HL
	PUSH	HL
	LD	BC,(STRPTR)
	OR	A
	SBC	HL,BC
	LD	C,L
	LD	B,H
	INC	BC
	POP	HL
	PUSH	HL
	PUSH	DE
	EX	DE,HL
	OR	A
	SBC	HL,DE
	EX	DE,HL
	LD	HL,(STRPTR)
	ADD	HL,DE
	LD	(STRPTR),HL
	POP	DE
	POP	HL
	LDDR
	LD	HL,(STRPTR)
	POP	DE
ADRSFL: LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	LD	A,(BC)
	EX	AF,AF'
	INC	BC
	LD	A,L
	LD	(BC),A
	INC	BC
	LD	A,H
	LD	(BC),A
	EX	AF,AF'
	ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
    LD	H,A
	PUSH	HL
	SBC	HL,DE
	POP	HL
	JR	NZ,ADRSFL
	JP	SPRGLP
;
SREDCK: EX	DE,HL
	LD	HL,(STRBTM)
	OR	A
	SBC	HL,DE
	EX	DE,HL
	JR	C,OVERST
	RET	NZ
OVERST: POP	HL
	JP	ESCSPR
;
SJPTBL: DEFW	GOTO		; GOTO
	DEFW	GOSUB		; GOSUB
	DEFW	RUN		; RUN
	DEFW	RETURN		; RETURN
	DEFW	RESTOR		; RESTORE
	DEFW	LIST		; LIST
	DEFW	LIST#		; LIST#
	DEFW	AUTO		; AUTO
	DEFW	DEL		; DELETE
	DEFW	FOR		; FOR
	DEFW	NEXT		; NEXT
	DEFW	PRINT		; PRINT
	DEFW	INPUT		; INPUT
	DEFW	IFF	; IF
	DEFW	DATA		; DATA
	DEFW	READ		; READ ; 90H
	DEFW	DIM		; DIM
	DEFW	REM		; REM
	DEFW	EDIT		; EDIT
	DEFW	BREAK$		; STOP
	DEFW	CONT		; CONT
	DEFW	CLS		; CLS
	DEFW	CLEAR		; CLEAR
	DEFW	ON		; ON
	DEFW	LET		; LET
	DEFW	START		; START
	DEFW	POKE		; POKE
	DEFW	OFF		; OFF
	DEFW	WHILE		; WHILE
	DEFW	WEND		; WEND
	DEFW	REPEAT		; REPEAT
	DEFW	UNTIL		; UNTIL ; A0H
	DEFW	TRACE		; TRACE
	DEFW	OK		; END
	DEFW	PLAY		; PLAY
	DEFW	BEEPOP		; BEEP
	DEFW	DEFINT		; DEFINT
	DEFW	DEFSNG		; DEFSNG
	DEFW	DEFDBL		; DEFDBL
	DEFW	DEFSTR		; DEFSTR
	DEFW	DEFFN		; DEF
	DEFW	DUMP		; DUMP
	DEFW	LOAD		; LOAD
	DEFW	SAVE$		; SAVE
	DEFW	MERGE		; MERGE
	DEFW	NINS		; CONSOLE/WIDTH
	DEFW	OUT		    ; OUT
	DEFW	SEARCH		; SEARCH ; B0H
	DEFW	SOUND		;SOUND
	DEFW	NINS		; WRITE
	DEFW	SWAP		; SWAP
	DEFW	NINS		; ERASE
	DEFW	ERTEST		; ERROR
	DEFW	RESUME		; RESUME
	DEFW	RENUM		; RENUM
	DEFW	REM		    ; ELSE
	DEFW	CALLUP		; CALL
	DEFW	LOCATE		; LOCATE
	DEFW	NINS		; MAT
	DEFW	MONOP		; MON
	DEFW	HCOPY		; HCOPY
	DEFW	KEY		    ; KEY
	DEFW	VPUSH		; PUSH
	DEFW	VPOP		; POP ; C0H
	DEFW	NINS		;BASE
	DEFW	DATA		; LABEL
	DEFW	NINS		; RANDOMIZE
	DEFW	SCREEN		;SCREEN
	DEFW	LINE		; LINE
	DEFW	COLOR		; COLOR
	DEFW	PSET		; PSET
	DEFW	PRESET		; PRESET
	DEFW	GSAVES		;CGINIT
	DEFW	PATTEN		;PATTERN
	DEFW	CIRCLE		;CIRCLE
	DEFW	PAINT		; PAINT
	DEFW	ROPEN		; ROPEN
	DEFW	WOPEN		; WOPEN
	DEFW	CLOSE		; CLOSE
;DEFW	NINS	; FILES
;DEFW	NINS	; RENAME
;DEFW	NINS	; KILL
;DEFW	NINS	; LSET
;DEFW	NINS	; RSET
;DEFW	NINS	; FORMAT
;DEFW	NINS	; INIT
;DEFW	NINS	; CHAIN
;DEFW	NINS	; PEN
;DEFW	NINS	; COM
;DEFW	NINS	; PAUSE ; DEH
;
FJPTBL: DEFW	INTG		; INT 81H
	DEFW	RESNHL		; ABS
	DEFW	B_SIN		; SIN
	DEFW	B_COS		; COS
	DEFW	B_TAN		; TAN
	DEFW	B_LOG		; LOG 078bdh
	DEFW	B_EXP		; EXP
	DEFW	B_SQR		; SQR
	DEFW	B_RND		; RND
	DEFW	PEEK		; PEEK
	DEFW	B_ATN		; ATN
	DEFW	B_SGN		; SGN
	DEFW	FRACSB		; FRAC
	DEFW	INT		    ; FIX
	DEFW	B_PAI		; PAI   776fh
	DEFW	B_RAD		; RAD 90H 776ah
	DEFW	B_INP		; INP   7788h
	DEFW	CDBL		; CDBL
	DEFW	CSNG		; CSNG
	DEFW	CINT		; CINT
	DEFW	NINS		; DSKF
	DEFW	NINS		; EOF
	DEFW	NINS		; FPOS
	DEFW	NINS		; LOC
	DEFW	NINS		; LOF
	DEFW	POS		    ; POS
	DEFW	LPOS		; LPOS
	DEFW	B_FACG		; FAC
	DEFW	B_SUM		; SUM
	DEFW	NINS		; REV
	DEFW	NINS		; DUMMY
	DEFW	CHRSUB		; CHR$ A0H
	DEFW	STRSUB		; STR$
	DEFW	HEXD		; HEX$
	DEFW	OCTD		; OCT$
	DEFW	MK1		; MK1$
	DEFW	MKS		; MKS$
	DEFW	MKD		; MKD$
	DEFW	SPCSUB		; SPACE$
	DEFW	SPCSUB		; SPC
	DEFW	ASCSUB		; ASC A9H
	DEFW	LENSUB		; LEN
	DEFW	VALSUB		; VAL
	DEFW	CVS		; CVS
	DEFW	CVD		; CVD
	DEFW	CVI		; CVI
    DEFW    NINS    ; STAT
    DEFW    PARI    ; PARITY
    DEFW    NINS    ; 
	DEFW	LEFT1	; LEFT$ (CVI)
	DEFW	RIGHT1		; RIGHT$
	DEFW	MID		; MID$
	DEFW	INKEY		; INKEY$
	DEFW	INSTR		; INSTR
	DEFW	FRE		; FRE
	DEFW	MEM$		; MEM$
	DEFW	SCRN$		; SCRN
	DEFW	VARPTR		; VARPTR
	DEFW	STRING		; STRING$
	DEFW	NINS		; TIME$
	DEFW	FNOPR		;
	DEFW	USROPR		; USR
	DEFW	ERR		; ERR
	DEFW	ERL		; ERL
	DEFW	CSRLIN		; CSRLIN
;
;
DFTABL: DEFS	26
;
USRTBL: DEFS	20
;
ADHLHL: ADD	HL,HL
	RET	NC
OVERFL: LD	A,6
	JP	ERROR
;
CVBCAS: PUSH	HL
	CALL	HEXCUL
	LD	C,L
	LD	B,H
	DEC	DE
	DEC	DE
	POP	HL
CVBABS: LD	A,(DE)
	CP	020h
	JR	NZ,INCRTM
	DEC	DE
	JR	CVBABS
;
INCRTM: INC	DE
	RET
;
HEXCUL: LD	HL,00000h
LNOCLP: CALL	DEFTCH
	SUB	030h
	RET	C
	CP	00Ah
	RET	NC
	CALL	ADHLHL
	LD	C,L
	LD	B,H
	CALL	ADHLHL
	CALL	ADHLHL
	ADD	HL,BC
	JR	C,OVERFL
	LD	C,A
	LD	B,0
	ADD	HL,BC
	JR	C,OVERFL
	JR	LNOCLP
;
EDITOR: CALL	CLR
	XOR	A
	LD	(CONTFG),A
	LD	(ERRORF),A
	CALL	RETLNO
	CALL	HEXCUL
	LD	(EDLINE),HL
	ADD	A,030h
	DEC	DE
	JR	Z,DELMIK
	DEC	DE
RSFGLP: LD	A,(DE)
	CP	020h
	DEC	DE
	JR	Z,RSFGLP
	INC	DE
	INC	DE
	LD	A,(DE)
	CP	020h
	JR	NZ,DELMIK
	INC	DE
DELMIK: PUSH	HL
	PUSH	AF
	LD	HL,IMDBUF
	CALL	CVIMTX
	LD	(IMLSTP),HL
	POP	AF
	POP	HL
	LD	E,L
	LD	D,H
	CALL	DELETE1
	OR	A
	RET	Z
	PUSH	HL
    DEFB	021H		; LD HL,?
IMLSTP:	DEFS	2
	LD	DE,IMDBUF
	OR	A
	SBC	HL,DE
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	EX	(SP),HL
	LD	C,L
	LD	B,H
	LD	HL,TEXTST
	JR	IMDENS
;
ENOSLP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
IMDENS: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	DEC	HL
	LD	A,D
	OR	E
	JR	Z,EAPEND
	INC	HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	SBC	HL,BC
	DEC	DE
	DEC	DE
	DEC	DE
	EX	DE,HL
	JR	C,ENOSLP
EAPEND: POP	DE
	PUSH	BC		; L NO
	PUSH	HL		; INS POINTER
	PUSH	DE		; LENGTH
	EX	DE,HL
	LD	HL,(VSTART)
	PUSH	HL
	SBC	HL,DE
	LD	C,L
	LD	B,H
	POP	HL
	POP	DE
	PUSH	DE
	EX	DE,HL
	ADD	HL,DE
	CALL	HMEMCK
	LD	(VSTART),HL
	EX	DE,HL
	INC	BC
	LDDR
	POP	BC		; LENGTH
	POP	DE		; INS POINTER
	POP	HL		; L NO
	PUSH	DE
	EX	DE,HL
	INC	HL
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	EX	DE,HL
	LD	HL,IMDBUF
	PUSH	BC
	DEC	BC
	DEC	BC
	DEC	BC
	DEC	BC
	LDIR
	POP	BC
	POP	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	EX	DE,HL
RELPTR: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,D
	OR	E
	RET	Z
	EX	DE,HL
	ADD	HL,BC
	EX	DE,HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	EX	DE,HL
	JR	RELPTR
;
DELETE1: PUSH	AF ; 315ah
	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	C,L
	LD	B,H
	LD	HL,TEXTST
FSTLOP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,E
	OR	D
	JR	NZ,FDDLST
RTDLTE: POP	DE
	POP	HL
	POP	BC
	POP	AF
	RET
;
POPDLR: POP	DE
	JR	RTDLTE
;
FDDLST: PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	LD	(LNOTBF),HL
	SBC	HL,BC
	POP	HL
	JR	C,FSTLOP
	DEC	DE
	DEC	DE
	DEC	DE
	POP	BC		; DELETE END LINE NO.
	PUSH	BC
	PUSH	DE		; DELETE START ADRS
	PUSH	HL		; NEXT LINE ADRS
	DEFB	021H		; LD HL,?
LNOTBF: DEFS	2
	SBC	HL,BC
	POP	HL
	JR	Z,DLSTRT	; DEL-LINE END FOUND
	JR	NC,POPDLR	; NOTHING OCCUR
SNDDLP: LD	E,(HL)		; END S-LOOP
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,D
	OR	E
	JR	Z,DLEFD'
	PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	SBC	HL,BC
	POP	HL
	JR	C,SNDDLP
	JR	Z,DLSTRT
	EX	DE,HL
	DEC	HL
DLEFD': DEC	HL
	DEC	HL
DLSTRT: POP	DE
	PUSH	DE
	PUSH	HL
	OR	A
	SBC	HL,DE
	LD	C,L
	LD	B,H
	POP	HL
	POP	DE
	PUSH	BC
	PUSH	DE
	PUSH	DE
	PUSH	HL
	EX	DE,HL
	LD	HL,(VSTART)
	OR	A
	SBC	HL,DE
	LD	C,L
	LD	B,H
	POP	HL
	POP	DE
	LDIR
	EX	DE,HL
	LD	(VSTART),HL
	CALL	CLR
	POP	HL
	POP	BC
DRNLOP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,D
	OR	E
	JP	Z,RTDLTE
	EX	DE,HL
	OR	A
	SBC	HL,BC
	EX	DE,HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	EX	DE,HL
	JR	DRNLOP
;
;
;	CHAIN	,LIST
;
;   LIST
;
SEARCH: XOR	A
	LD	(DISFLG),A
	CALL	HLFTCH
	CP	023h
	JR	NZ,SEARC'
	LD	A,2
	LD	(DISFLG),A
	INC	HL
SEARC': CALL	STREXZ
	OR	A
	JP	Z,IFCALL
	PUSH	BC
	LD	(SERLEN),A
	LD	(MATLEN),A
	LD	(SERDEB),DE
	LD	(MARDEB),DE
	CALL	SLIST
	POP	HL
	DEC	HL
	RET
;
SERVEC: PUSH	DE
	PUSH	HL
	LD	B,A
	DEFB	021H		; LD HL,?
MARDEB: DEFS	2
	CP	(HL)
	JR	NZ,SERNMT
	DEFB	03EH		; LD A,?
MATLEN: DEFS	1
	DEC	A
	LD	(MATLEN),A
	JR	Z,MATLIS
	INC	HL
	LD	(MARDEB),HL
SERRTT: POP	HL
	POP	DE
	JP	CTIRTR
;
SERNMT: CALL	SERINT
	JR	SERRTT
;
MATLIS: DEFB	011H		; LD DE,?
SERDIS: DEFS	2
SERLPP: LD	A,(DE)
	OR	A
	JR	Z,ESSRSP
	CALL	ACCPRT
	INC	DE
	JR	SERLPP
;
ESSRSP: CALL	CR2
	JR	SERRTT
;
SER0DH: CALL	SERINT
	JP	LISCRC
;
SERINT: DEFB	03EH		; LD A,?
SERLEN: DEFS	1
	LD	(MATLEN),A
	DEFB	021H		; LD HL,?
SERDEB: DEFS	2
	LD	(MARDEB),HL
	RET
;
TRACE:	CALL	HLFTCH
	OR	A
	JR	Z,TROFF
	CP	03Ah
	JR	Z,TROFF
	CALL	STREXZ
	LD	A,(HL)
	OR	A
	JR	Z,TRCOFF
	PUSH	BC
	INC	HL
	LD	B,A
	CALL	INDRCT
	CALL	TROFF
	EX	DE,HL
	LD	HL,TRACEF
TRLTPR: LD	A,(DE)
	CP	048h		; HOME?
	JR	NZ,TRACL0
	SET	0,(HL)
TRACL0: CP	050h
	JR	NZ,TRACL1	; PRINTER?
	SET	1,(HL)
TRACL1: CP	04Eh		; NUMBER?
	JR	NZ,TRACL2
	SET	2,(HL)
TRACL2: CP	04Ch		; LIST?
	JR	NZ,TRACL3
	SET	3,(HL)
TRACL3: CP	053h		; STEP?
	JR	NZ,TRACL4
	SET	4,(HL)
TRACL4: CP	044h		; DUMP?
	JR	NZ,TRACLP
	SET	5,(HL)
TRACLP: INC	DE
	DJNZ	TRLTPR
	POP	BC
	JR	RTTRAC
;
TRCOFF: CALL	TROFF
RTTRAC: JP	RETIRQ
;
TROFF:	XOR	A
	LD	(TRACEF),A
	RET
;
SWAP:	LD	C,L
	LD	B,H
	CALL	GETVAC
	PUSH	HL
	PUSH	AF
	CALL	BCFTCH
	CALL	CH2CH
	CALL	GETVAC
	POP	DE
	CP	D
	JP	NZ,TYPEMS
	POP	DE
	PUSH	AF
	PUSH	BC
	LD	B,A
	LD	C,B
	PUSH	HL
	PUSH	DE
	LD	(SWAPHL),DE
	LD	HL,ZFAC
SWTRL1: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	SWTRL1
	POP	DE
	POP	HL
	PUSH	HL
	PUSH	BC
	LDIR
	POP	BC
	POP	DE
	PUSH	DE
	LD	HL,ZFAC
	LDIR
	POP	DE
	POP	HL
	POP	AF
	CP	003h
	RET	NZ
	PUSH	HL		; TEXT POINT
	EX	DE,HL
	LD	A,(HL)
	OR	A
	JR	Z,NXTSAS
	LD	E,L
	LD	D,H
	INC	HL
	CALL	INDRCT
	PUSH	DE
	EX	DE,HL
	LD	HL,(STRPTR)
	OR	A
	SBC	HL,DE
	EX	DE,HL
	POP	DE
	JR	NC,NXTSAS
	DEC	HL
	LD	(HL),H
	DEC	HL
	LD	(HL),L
NXTSAS: DEFB	021H
SWAPHL: DEFS	2
	LD	A,(HL)
	OR	A
	JR	Z,NXTSAW
	LD	E,L
	LD	D,H
	INC	HL
	CALL	INDRCT
	PUSH	DE
	EX	DE,HL
	LD	HL,(STRPTR)
	OR	A
	SBC	HL,DE
	EX	DE,HL
	POP	DE
	JR	NC,NXTSAW
	DEC	HL
	LD	(HL),H
	DEC	HL
	LD	(HL),L
NXTSAW: POP	HL
	RET
;
OUT:	LD	C,L
	LD	B,H
	CALL	IHLEXP
	CALL	CH2CH
	LD	(OPORT),HL
	CALL	IHLEXP
	CALL	HCHECK
	PUSH	BC
	DEFB	001H		;LD BC,OPOR
OPORT:	DEFW	00000H
	OUT	(C),A
	POP	BC
	JP	RETIRQ
;
CLOSE:	DEFB	03EH		; LD A,?
FILEFG: DEFS	1
	CP	2
	LD	A,0
	LD	(FILEFG),A
	JR	NZ,CLSINP
	LD	A,00Dh
	CALL	CTOUT
	XOR	A
	CALL	CTOUT
	XOR	A
	CALL	CTOUT
	CALL	CTCLOS
CLSINP: PUSH	HL
	LD	HL,LININP
	LD	(LODVEC),HL
	POP	HL
	LD	A,001h
	LD	(DISFLG),A
	RET
;
CLEAR:	CALL	HLFTCH
	OR	A
	JP	Z,CLR
	CP	03Ah
	JP	Z,CLR
	LD	C,L
	LD	B,H
	CALL	IHLEXP
	PUSH	HL
	LD	DE,(MEMMAX)
	SCF
	SBC	HL,DE
	JP	NC,OMERR
	LD	DE,(VSTART)
	LD	HL,00800h
	ADD	HL,DE

	POP	DE
	PUSH	DE
	OR	A
	SBC	HL,DE
	JP	NC,OMERR
	POP	HL
	CALL	MEMSET
	LD	SP,(STRTOP)
	LD	DE,0FFFFh
	PUSH	DE
	LD	L,C
	LD	H,B
	DEC	HL
	JP	ONELIN
;
MEMSET: LD	(MEMEND),HL
	LD	DE,00010h
	OR	A
	SBC	HL,DE
	LD	(MEMFAC),HL
	LD	DE,000F1h
	SBC	HL,DE
	LD	(INTSSP),HL
	LD	DE,00007h
	SBC	HL,DE
	LD	(INTFAC),HL
	LD	DE,JT9
	SBC	HL,DE
	LD	(STRBTM),HL
	JP	CLR
;
USING:	CALL	STREXX
	DEC	BC
	CALL	BCFTCH
	CP	02Ch
	JR	Z,OKLIOP
	CP	03Bh
	JP	NZ,SERROR
OKLIOP: LD	A,(HL)
	CP	019h
USGIFC: JP	NC,IFCALL
	OR	A
	JR	Z,USGIFC
	INC	HL
	CALL	INDRCT
	LD	DE,USINGB
	PUSH	BC
	LD	C,A
	LD	B,000h
	LDIR
	POP	BC
	XOR	A
	LD	(DE),A
	INC	DE
	LD	(DE),A
IUSGLP: LD	DE,USINGB
	XOR	A
	LD	(PRTEDF),A
USNGLP: LD	A,(DE)
	INC	DE
	OR	A
	JP	Z,USINED
	CP	0C4h
	JR	Z,PESCCH
	CP	021h
	JP	Z,PSFRST
	CP	026h
	JP	Z,PSMIDL
	CP	023h
	JP	Z,PFLENG
	CP	02Ah
	JP	Z,ASTRSK
	CP	07Ch
	JP	Z,VENUSG
	CP	02Eh
	JP	Z,PRLEN?
	CP	02Bh
	JP	Z,PLUSUS
PUTCHS:	CALL	ACCPRT
	JR	USNGLP
;
USINED: DEFB	03EH		; LD A,?
PRTEDF: DEFS	1
	OR	A
	JP	Z,IFCALL
	LD	DE,USINGB
	XOR	A
	LD	(PRTEDF),A
ESPUVC: DEFB	0C3H	; JP ?
URTVEC: DEFW	RETIRQ
;
PESCCH: LD	A,(DE)
	INC	DE
	JR	PUTCHS
;
PSFRST: PUSH	DE
	CALL	STREXX
	CALL	CHCKRV
	POP	DE
	LD	A,1
	LD	(PRTEDF),A
	LD	A,(HL)
	OR	A
	LD	A,020h
	JR	Z,PUTCHS
	INC	HL
	CALL	INDRCT
	LD	A,(HL)
	JR	PUTCHS
;
CHCKRV: DEC	BC
	LD	A,(BC)
	INC	BC
	CP	03Bh
	JR	Z,USGCON
	CP	02Ch
	JR	Z,USGCMN
	PUSH	HL
	LD	HL,CRRTIR
	JR	PTPURV
;
USGCON: CALL	BCFTCH
	OR	A
	JR	Z,PUSEMR
	CP	03Ah
	JR	Z,PUSEMR
MGFDXZ: DEC	BC
	PUSH	HL
	LD	HL,USNGLP
PTPURV: LD	(URTVEC),HL
	POP	HL
	RET
;
USGCMN: CALL	BCFTCH
	OR	A
	JR	Z,PUCHRA
	CP	03Ah
	JR	NZ,MGFDXZ
PUCHRA: PUSH	HL
	LD	HL,PULSC#
	JR	PTPURV
;
PULSC#: CALL	TABPRT
	JP	RETIRQ
;
PUSEMR: PUSH	HL
	LD	HL,RETIRQ
	JR	PTPURV
;
CRRTIR: CALL	CR1
	JP	RETIRQ
;
PSMIDL: LD	H,1
COUUSP: LD	A,(DE)
	INC	H
	INC	DE
	CP	026h
	JR	Z,ESCCSP
	CP	020h
	JR	Z,COUUSP
	JP	IFCALL
;
ESCCSP: PUSH	DE
	PUSH	HL
	CALL	STREXX
	CALL	CHCKRV
	POP	AF
	CP	(HL)
	PUSH	BC
	JR	NC,PRSPNE
ZRPRUS: LD	B,A
	INC	HL
	CALL	INDRCT
USGMDL: LD	A,(HL)
	INC	HL
	CALL	ACCPRT
	DJNZ	USGMDL
RETIOE: POP	BC
	POP	DE
	LD	A,1
	LD	(PRTEDF),A
	JP	USNGLP
;
PRSPNE: JR	Z,ZRPRUS
	SUB	(HL)
	PUSH	AF
	LD	B,(HL)
	INC	HL
	CALL	INDRCT
USGMD': LD	A,(HL)
	INC	HL
	CALL	ACCPRT
	DJNZ	USGMD'
	POP	BC
SPACPT: CALL	SPPRT
	DJNZ	SPACPT
	JR	RETIOE
;
ASTRSK: LD	A,(DE)
	CP	02Ah
	LD	A,02Ah
	JP	NZ,PUTCHS
	LD	A,1
	LD	(PUASTF),A
	INC	DE
	LD	A,(DE)
	INC	DE
	LD	H,2
	CP	07Ch
	LD	A,0
	JR	NZ,PULSLS
	INC	DE
	INC	H
KIUYTJ: LD	A,1
	LD	(PUYENF),A
	XOR	A
	LD	(FPLUSF),A
	JR	MIDFUS
;
VENUSG: LD	A,(DE)
	CP	07Ch
	LD	A,07Ch
	JP	NZ,PUTCHS
	XOR	A
	LD	(PUASTF),A
	INC	DE
	INC	DE
	LD	H,2
	JR	KIUYTJ
;
PLUSUS: LD	A,1
	LD	(FPLUSF),A
	XOR	A
	LD	(PUASTF),A
	INC	DE
	LD	H,1
	JR	PULSLS
;
PRLEN?: LD	A,(DE)
	CP	023h
	LD	A,02Eh
	JP	NZ,PUTCHS
PFLENG: XOR	A
	LD	H,A
	LD	(FPLUSF),A
	LD	(PUASTF),A	; PUT *   FLG
PULSLS: LD	(PUYENF),A	;PUT * FLG
MIDFUS: LD	(PUAFMF),A	;AFTER-FLG
	LD	(PUCOMF),A	; PUT ,   FLG
	LD	(INTLEN),A	; INT LENGTH
	LD	(FRCLEN),A	; FRAC LENGTH
	LD	(RPLUSF),A	; ###+
	LD	(PUEXPF),A	; ^^^^
	DEC	DE
PUGTFC: INC	H
	LD	A,(DE)
	INC	DE
	CP	023h
	JR	Z,PUGTFC
	CP	02Ch
	JR	NZ,PUCOMP
	LD	A,1
	LD	(PUCOMF),A
	JR	PUGTFC
PUCOMP: CP	02Eh
	JR	Z,PUPOIT
	CP	02Dh
	JR	NZ,PUAFMO
	LD	A,1
	LD	(PUAFMF),A
	INC	DE
	JR	PUAFQO
PUAFMO: CP	02Bh
	JR	NZ,PUAFQO
	LD	A,1
	LD	(RPLUSF),A
	INC	DE
PUAFQO: DEC	DE
	DEC	H
	LD	A,H
	LD	(INTLEN),A
	JR	BEGUSG
;
PUPOIT: DEC	H
	LD	A,H
	LD	(INTLEN),A
	LD	H,1
PUPOFC: INC	H
	LD	A,(DE)
	INC	DE
	CP	023h
	JR	Z,PUPOFC
	CP	02Dh
	JR	NZ,PUCOPP
	LD	A,1
	LD	(PUAFMF),A
	INC	DE
PUCOPP: DEC	DE
	DEC	H
	LD	A,H
	LD	(FRCLEN),A
;
BEGUSG: LD	(USGDEB),DE
	PUSH	BC
	LD	B,4
CHEXPU: LD	A,(DE)
	INC	DE
	CP	05Eh
	JR	NZ,NEXPPU
	DJNZ	CHEXPU
	LD	(USGDEB),DE
	LD	A,1
	LD	(PUEXPF),A
NEXPPU: POP	BC
	CALL	FLEXPR
	CALL	CHCKRV
	LD	(USGBCB),BC
	INC	HL
	LD	A,(HL)
	RES	7,(HL)
	DEC	HL
	LD	(USGSGN),A
	LD	A,(INTLEN)
	LD	B,A
	DEFB	03EH		; LD A,?
FRCLEN: DEFS	1
	LD	C,A
	DEFB	03EH		; LD A,?
PUEXPF: DEFS	1
	CALL	USGNCV
	PUSH	HL
	LD	DE,KEYBUF
	LD	A,020h
	LD	(DE),A
	INC	DE
	DEFB	03EH		; LD A,?
PUCOMF: DEFS	1
	OR	A
	JR	Z,LADJS1
	PUSH	DE
	LD	A,(INTLEN)
	LD	L,A
	LD	H,000h
	ADD	HL,DE
	DEC	HL
	LD	DE,ZFAC
	LD	C,0
COMN3D: LD	B,3
COMSK3: LD	A,(HL)
	CP	020h
	JR	Z,ESCPUC
	INC	C
	LD	(DE),A
	INC	DE
	DEC	HL
	DJNZ	COMSK3
	LD	A,(HL)
	CP	020h
	JR	Z,ESCPUC
PURTJM: LD	A,02Ch
	LD	(DE),A
	INC	DE
	INC	C
	JR	COMN3D
;
ESCPUC: DEFB	03EH		; LD A,?
INTLEN: DEFS	1
	CP	C
	JP	C,FOVER
	LD	B,C
	LD	L,A
	LD	H,0
	POP	DE
	PUSH	DE
	ADD	HL,DE
	DEC	HL
	LD	DE,ZFAC
COMTPU: LD	A,(DE)
	LD	(HL),A
	DEC	HL
	INC	DE
	DJNZ	COMTPU
	POP	DE
LADJS1: DEFB	03EH		; LD A,?
PUAFMF: DEFS	1
	OR	A
NPUSGN: JP	NZ,LADJS2	; ###-
	DEFB	03EH		; LD A,?
RPLUSF: DEFS	1
	OR	A		; ###+
	JR	NZ,NPUSGN
	DEFB	03EH		; LD A,?
FPLUSF: DEFS	1
	OR	A		; +###
	JR	NZ,PTPLS1
	LD	A,(USGSGN)
	RLCA
	JP	NC,LADJS2
	LD	A,(DE)
	CP	020h
	JP	NZ,FOVER
	LD	B,02Dh
FPUTER: PUSH	DE
PUPTML: LD	A,(DE)
	INC	DE
	CP	020h
	JR	Z,PUPTML
	DEC	DE
	DEC	DE
	LD	A,B
	LD	(DE),A
	POP	DE
THISLN1: JP	LADJS2
;
PTPLS1: DEFB	03EH		; LD A,?
USGSGN: DEFS	1
	RLCA
	LD	B,02Bh
	JR	NC,FPUTER
	LD	B,02Dh
	JR	FPUTER
;
LADJS2: DEFB	03EH		; LD A,?
PUYENF: DEFS	1
	OR	A
	JR	Z,LADJS3
	LD	A,(DE)
	CP	020h
	JR	NZ,LADJS3
	PUSH	DE
LSDQW1: LD	A,(DE)
	INC	DE
	CP	020h
	JR	Z,LSDQW1
	DEC	DE
	DEC	DE
	LD	A,07Ch
	LD	(DE),A
	POP	DE
LADJS3: DEFB	03EH		; LD A,?
PUASTF: DEFS	1
	OR	A
	JR	Z,LADJS4
	PUSH	DE
ASTFIL: LD	A,(DE)
	CP	020h
	JR	NZ,LADJ4'
	LD	A,02Ah
	LD	(DE),A
	INC	DE
	JR	ASTFIL
LADJ4': POP	DE
LADJS4: POP	HL
	OR	A
	SBC	HL,DE
	LD	B,L
	CALL	PRTSDC
	LD	A,(RPLUSF)
	OR	A
	JR	Z,TST2DH
	LD	A,(USGSGN)
	RLCA
	LD	A,02Bh
LSDVZR: JR	NC,PULSTX
	LD	A,02Dh
PULSTX: CALL	ACCPRT
	JR	RETPU$
;
TST2DH: LD	A,(PUAFMF)
	OR	A
	JR	Z,RETPU$
	LD	A,(USGSGN)
	RLCA
	LD	A,020h
	JR	LSDVZR
;
RETPU$: DEFB	001H		; LD BC,?
USGBCB: DEFS	2
	DEFB	011H		; LD DE,?
USGDEB: DEFS	2
	LD	A,1
	LD	(PRTEDF),A
	JP	USNGLP
;
AUTO:	LD	C,L
	LD	B,H
	LD	HL,10		; 그냥 AUTO면 10부터 시작한다.
	LD	(AUTOST),HL
	LD	(AUTOLN),HL
	CALL	BCFTCH
	DEC	BC
	OR	A
	JR	Z,AUTOES
	CP	03Ah
	JR	Z,AUTOES
	CP	02Eh
	JR	NZ,AUTONE
	DEFB	021H		; LD HL,?
EDLINE: DEFS	2
	INC	BC
	CALL	BCFTCH
	JR	AUTNER
AUTONE: CALL	IHLEXP
AUTNER: CP	02Ch
	LD	(AUTOLN),HL
	JP	NZ,AUTOES
	CALL	IHLEXP
	LD	(AUTOST),HL
AUTOES: XOR	A
	LD	(AUTOVC),A
	JP	AUTOBK
;
LPOS:	LD	A,(PRINTN)
	JR	POSMID
;
POS:	LD	A,(CURX)
POSMID: LD	E,A
	LD	D,0
	JP	FLTHEX
;
ERR:	LD	A,(ERRCOD)
	LD	E,A
	LD	D,0
MIDERS: PUSH	DE
	LD	DE,8
	ADD	HL,DE
	POP	DE
	CALL	FLTHEX
	CALL	ADJERL
	LD	A,4
	CALL	CONDFL
	JP	BCFTCH
;
ERL:	LD	DE,(ERRLNO)
	JR	MIDERS
;
ADJERL: INC	HL
	LD	A,(HL)
	DEC	HL
	ADD	A,A
	RET	NC
	PUSH	BC
	LD	DE,FLMXD0
	CALL	ADD
	POP	BC
	RET
FLMXD0:
	DEFB	091H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
DEL:	CALL	HLFTCH
	OR	A
	RET	Z
	CP	03Ah
	RET	Z
	PUSH	HL
	CALL	RETLNO
	CALL	CLR
	POP	HL
	CALL	GTSTED
	EX	DE,HL
	LD	E,C
	LD	D,B
	CALL	DELETE1
	JP	HOTENT
;
RENUM:	LD	C,L
	LD	B,H
	LD	HL,10		; 그냥 RENUM이면 10부터 10씩 증가
	LD	(NEWNO),HL
	LD	(ADDNO),HL
	LD	L,0
	LD	(STLNO),HL
	CALL	BCFTCH
	DEC	BC
	OR	A
	JR	Z,RNSTRT
	CP	03Ah
	JR	Z,RNSTRT
	CP	02Ch
	JR	Z,SKIRE1
	CALL	IHLEXP
	LD	(NEWNO),HL
	CP	02Ch
	JR	NZ,RNSTRT
	DEC	BC
SKIRE1: INC	BC
	CALL	BCFTCH
	DEC	BC
	CP	02Ch
	JR	Z,SKMRNU
	CALL	IHLEXP
	LD	(STLNO),HL
	CP	02Ch
	JR	NZ,RNSTRT
	DEC	BC
SKMRNU: INC	BC
	CALL	BCFTCH
	DEC	BC
	OR	A
	JR	Z,RNSTRT
	CP	03Ah
	JR	Z,RNSTRT
	CALL	IHLEXP
	LD	(ADDNO),HL
RNSTRT: PUSH	BC
	LD	HL,(ADDNO)
	LD	A,H
	OR	L
	JP	Z,IFCALL
	LD	HL,(STLNO)
	EX	DE,HL
	LD	HL,(NEWNO)
	OR	A
	SBC	HL,DE
	JP	C,IFCALL
	CALL	LNOADR
	LD	HL,TEXTST
BEGRNS: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,D
	OR	E
	JR	Z,RNUMED'
	INC	HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	PUSH	HL
	DEFB	021H		; LD HL,?
STLNO:	DEFS	2
	OR	A
	SBC	HL,BC
	POP	HL
	JR	Z,BEGREN
	JR	C,BEGREN
	EX	DE,HL
	JR	BEGRNS
;
BEGREN: DEC	HL
	DEC	HL
	DEC	HL
	DEFB	001H		; LD BC,?
NEWNO:	DEFS	2
REKUML: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,D
	OR	E
	JR	Z,RNUMED'
	INC	HL
	LD	(HL),C
	INC	HL
	LD	(HL),B
	DEFB	021H		; LD HL,?
ADDNO:	DEFS	2
	ADD	HL,BC
	JR	C,RENOVR
	LD	C,L
	LD	B,H
	EX	DE,HL
	JR	REKUML
;
RNUMED':CALL	RETLNO
	POP	HL
	RET
;
RENOVR: LD	HL,10
	LD	(ADDNO),HL
	LD	(NEWNO),HL
	LD	L,0
	LD	(STLNO),HL
	CALL	RNSTRT
	JP	IFCALL
;
CROPEN: LD	A,(FILEFG)
	OR	A
	JP	NZ,FILEER
	LD	(LOADFN),A
	INC	A
	LD	(FILEFG),A
	CALL	BCFTCH
	DEC	BC
	OR	A
	JR	Z,LOADST
	CP	03Ah
	JR	Z,LOADST
	LD	A,001h
	LD	(LOADFN),A
	CALL	STREXX
	DEC	BC
	PUSH	BC
	OR	A
	JR	Z,LODIFC
	CP	17
LODIFC: JP	NC,IFCALL
	LD	B,A
	EX	DE,HL
	LD	DE,KEYBUF
LDFNTR: LD	A,(HL)
	LD	(DE),A
	INC	DE
	INC	HL
	DJNZ	LDFNTR
	XOR	A
	LD	(DE),A
	POP	BC
LOADST: CALL	FLOAD		;0027
	JP	C,BREAK
	CALL	CR2
	LD	DE,LFOUM
	PUSH	BC
	LD	B,6
	CALL	PRTSDC
	LD	DE,FILMOD	;10F0
LFDFNL: INC	DE
	LD	A,(DE)
	CP	000h
	JR	Z,FLFPRE
	CALL	ACCPRT
	JR	LFDFNL
FLFPRE: POP	BC
	CALL	CR2
	DEFB	03EH
LOADFN: DEFS	1
	OR	A
	JR	Z,LFNOK
	LD	HL,KEYBUF
	LD	DE,FILNAM	;10F1
FNCMPL: LD	A,(DE)
	CP	000h
	JR	Z,LFNLCP
	CP	(HL)
	INC	HL
	INC	DE
	JR	Z,FNCMPL
	JR	LOADST
LFNLCP: LD	A,(HL)
	OR	A
	JR	NZ,LOADST
LFNOK:	PUSH	BC
	CALL	BUFCLR
	LD	DE,LDINGM
	LD	B,8
	CALL	PRTSDC
	LD	DE,FILNAM
	CALL	DEPRT		;0015
	CALL	CR2
	POP	BC
	RET
;
ROPEN:	LD	C,L
	LD	B,H
	CALL	CROPEN
	LD	L,C
	LD	H,B
	RET
;
VERIFY: INC	HL
	LD	C,L
	LD	B,H
	CALL	CROPEN
	LD	A,(FILMOD)
	CP	016h
	JP	Z,FILEER
	CALL	CVSAVE
	CALL	MVRFY
	CALL	CVLOAD
	LD	A,27
	JP	C,ERROR
	RET
;
MERGE:	XOR	A
	LD	(FILEFG),A
	LD	C,L
	LD	B,H
	CALL	CROPEN
	LD	A,(FILMOD)
	CP	004h
	JP	C,FILEER
	JR	MRGEVC
;
LOAD:	XOR	A
	LD	(FILEFG),A
	LD	(CONTFG),A
	CALL	HLFTCH
	CP	08Ch
	JR	Z,VERIFY
	LD	C,L
	LD	B,H
	CALL	CROPEN
	LD	A,(FILMOD)
	CP	004h
	JR	C,BLOAD
	CALL	NEW
MRGEVC: CALL	CLR
	LD	SP,(STRTOP)
	LD	HL,0FFFFh
	PUSH	HL
	LD	(SPBUF),SP
	LD	HL,CINPUT
	LD	(LODVEC),HL
	LD	A,001h
	LD	(NRLDED),A
	CALL	BUFCLR
	JP	NMESOK
;
TPRDER: XOR	A
	LD	(FILEFG),A
	LD	A,(FILMOD)
	CP	002h
	CALL	Z,NEW
	JP	BREAK
;
BLOAD:	CP	002h ; basic이면 TEXTST에 로딩
	JR	NZ,MLLOAD
	LD	HL,TEXTST
	LD	(MTADRS),HL
	LD	DE,(MTBYTE)
	ADD	HL,DE
	LD	HL,(MEMEND)
	OR	A
	SBC	HL,DE
	JP	C,OMERR
	CALL	MLOAD
	JR	C,TPRDER
	CALL	CVLOAD
	LD	HL,PROTCT
	LD	A,(HL)
	CP	03Ah
	JP	Z,RUN
RTBLOD: LD	L,C
	LD	H,B
	RET
;
MLLOAD: CALL	MLOAD
	JP	C,TPRDER
	JR	RTBLOD
;
NEW:	LD	HL,TEXTST
	XOR	A
	LD	(HL),A
	INC	HL
	LD	(HL),A
	INC	HL
	LD	(HL),A
	LD	(VSTART),HL
	RET
;
CVLOAD: PUSH	AF
	PUSH	HL
	PUSH	DE
	LD	HL,TEXTST
CVLDLP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,E
	OR	D
	JR	Z,ESCCVL
	PUSH	HL
	ADD	HL,DE
	DEC	HL
	EX	DE,HL
	POP	HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	EX	DE,HL
	JR	CVLDLP
ESCCVL: INC	HL
	LD	(VSTART),HL
	LD	(HL),0
	LD	(STKLMT),HL
	POP	DE
	POP	HL
	POP	AF
	RET
;
CVSAVE: PUSH	AF
	PUSH	HL
	PUSH	DE
	LD	HL,TEXTST
CVSVLP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	A,D
	OR	E
	JR	Z,ESCCVL
	PUSH	DE
	EX	DE,HL
	OR	A
	DEC	DE
	SBC	HL,DE
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	POP	HL
	JR	CVSVLP
;
CINPUT: PUSH	DE
	CALL	CTINP
	JR	C,ABORT
	CP	00Dh
	JR	Z,NRLDED
	JR	MIDCIP
CLDLP1: CALL	CTINP
	JR	C,ABORT
MIDCIP: OR	A
	JP	Z,FILEER
	LD	(DE),A
	INC	DE
	CP	00Dh
	JR	NZ,CLDLP1
	DEC	DE
	XOR	A
	LD	(DE),A
	INC	DE
	LD	(DE),A
	INC	DE
	LD	(DE),A
	POP	DE
	RET
;
ABORT:	LD	HL,LININP
	LD	(LODVEC),HL
	LD	SP,(SPBUF)
CBREAK: XOR	A
	LD	(FILEFG),A
	LD	(CONTFG),A
	JP	BREAK
;
NRLDED: JP	FILEER
	LD	HL,LININP
	LD	(LODVEC),HL
	LD	SP,(SPBUF)
	CALL	CLOSE
	JP	OK
;
LFOUM:	DEFM	'FOUND:'
;
LDINGM: DEFM	'LOADING:'
;
WOPEN:	CALL	CWOPEN
	CALL	FSAVE
	JP	C,CBREAK
	LD	L,C
	LD	H,B
	RET
;
CWOPEN: LD	A,(FILEFG)
	OR	A
	JP	NZ,FILEER
	LD	A,2
	LD	(FILEFG),A
	LD	C,L
	LD	B,H
	CALL	BCFTCH
	DEC	BC
	LD	HL,NULSDC
	OR	A
	JR	Z,NULSAV
	CP	03Ah
	LD	A,0
	JR	Z,NULSAV
	CALL	STREXX
	DEC	BC
NULSAV: CP	17
WOPIFC: JP	NC,IFCALL
	PUSH	BC
	LD	B,A
	EX	DE,HL
	LD	DE,FILMOD
	LD	A,016h
	LD	(DE),A
	INC	DE
	LD	A,B
	OR	A
	JR	Z,NULFNM
SAVEFT: LD	A,(HL)
	LD	(DE),A
	INC	DE
	INC	HL
	DJNZ	SAVEFT
NULFNM: LD	A,000h
	LD	(DE),A
	POP	BC
	LD	HL,TEXTST
	LD	(MTADRS),HL
	EX	DE,HL
	LD	HL,(VSTART)
	OR	A
	SBC	HL,DE
	LD	(MTBYTE),HL
	LD	HL,0
	LD	(MTEXEC),HL
	LD	A,0
	LD	(PROTCT),A
	CALL	BUFCLR
	RET
;
SAVE$:	XOR	A
	LD	(FILEFG),A
	LD	A,(HL)
	CP	04Dh
	JR	Z,SAVEM
	CALL	CWOPEN
	CALL	BCFTCH
	CP	02Ch
	JR	NZ,BSAVE
	CALL	BCFTCH
	CP	041h
	JP	NZ,SERROR
	CALL	FSAVE
	JP	C,CBREAK
	PUSH	BC
	CALL	RETLNO
	CALL	CLIST
	LD	HL,CRTCR2
	LD	(LSCRVC),HL
	LD	HL,CRTVEC
	LD	(SAVEVC),HL
	JP	C,BREAK
	POP	HL
	JP	CLOSE
;
BSAVE:	DEC	BC
	PUSH	BC
	CALL	RETLNO
	CALL	CVSAVE
	LD	A,002h
	LD	(FILMOD),A
	CALL	FSAVE
	JR	C,CBREA'
	CALL	MSAVE
CBREA': CALL	CVLOAD
CBRSHM: POP	HL
	JP	C,CBREAK
	RET
;
SAVEM:	INC	HL
	CALL	CWOPEN
	CALL	BCFTCH
	CALL	CH2CH
	CALL	IHLEXP
	LD	(MTADRS),HL
	PUSH	HL
	CALL	CH2CH
	CALL	IHLEXP
	POP	DE
	OR	A
	SBC	HL,DE
	INC	HL
	LD	(MTBYTE),HL
	CP	02Ch
	JR	NZ,SVMNEA
	CALL	IHLEXP
	LD	(MTEXEC),HL
SVMNEA: DEC	BC
	PUSH	BC
	LD	A,1
	LD	(FILMOD),A
	CALL	FSAVE
	JR	C,CBRSHM
	CALL	MSAVE
	JR	CBRSHM
;
DEFFN:	CALL	HLFTCH
	INC	A
FNSERR: JP	NZ,SERROR
	INC	HL
	LD	A,(HL)
	CP	0A0h
	JP	Z,DEFCHR
	CP	0BEh
	JP	Z,DEFUSR
	CP	0BDh
	JR	NZ,FNSERR
	INC	HL
	LD	C,L
	LD	B,H
	CALL	ILDRCH
	CALL	BCFTCH
	CALL	GETFUN
	JR	NC,DUPDEF
	LD	HL,(STKLMT)
	OR	0C0h
	LD	(HL),A
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	INC	HL
	LD	(HL),C
	INC	HL
	LD	(HL),B
	INC	HL
	LD	(HL),000h
	LD	(STKLMT),HL
	LD	L,C
	LD	H,B
	JP	DATA
;
DUPDEF: LD	A,10
ERJVDE: JP	ERROR
;
ILDRCH: PUSH	HL
	LD	HL,(LNOBUF)
	INC	HL
	LD	A,H
	OR	L
	POP	HL
	RET	NZ
	LD	A,12
	JR	ERJVDE
;
UNDEFN: LD	A,012h
	JR	ERJVDE
;
GETFUN: CALL	VSRTST
	CP	028h
	JP	NZ,SERROR
	DEC	BC
	PUSH	BC
	LD	A,E
	OR	0C0h
	EX	DE,HL
	LD	B,A
	LD	HL,(VSTART)
GFNLP1: LD	A,(HL)
	OR	A
	JR	Z,FNNOTF
	CP	B
	JR	NZ,SKIPN1
	INC	HL
	LD	A,E
	CP	(HL)
	LD	A,004h
	JR	NZ,SKIPFN
	INC	HL
	LD	A,D
	CP	(HL)
	LD	A,3
	JR	NZ,SKIPFN
	INC	HL
	CALL	INDRCT
	LD	A,B
	AND	00Fh
	POP	BC
	RET
;
SKIPN1: INC	A
	JP	P,SKIPN2
	DEC	A
	AND	0C0h
	CP	0C0h
	LD	A,5
	JR	Z,SKIPFN
	INC	HL
	CALL	INDRCT
	JR	GFNLP1
;
SKIPN2: INC	A
	INC	A
SKIPFN: ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,H
	LD	H,A
	JR	GFNLP1
;
FNNOTF: LD	A,B
	AND	00Fh
	POP	BC
	SCF
	RET
;
FNOPR:	PUSH	HL
	CALL	BCFTCH
	CALL	GETFUN
	JR	C,UNDEFN
	CP	003h
	JR	Z,STRFNC
	CALL	CONDFL
	JR	ARGFUN
STRFNC: CALL	CONDSR
ARGFUN: EX	DE,HL
	LD	HL,(FUNCNS)
	EX	(SP),HL
	CALL	CH28H
	PUSH	BC
	LD	C,E
	LD	B,D
	CALL	CH28H
	PUSH	BC
	EX	DE,HL
	LD	HL,00000h
	ADD	HL,SP
	LD	(FUNCNS),HL
	EX	DE,HL
	CALL	SK2829
	CALL	BCFTCH
	CP	0F5h
	JP	NZ,SERROR
	CALL	EXPRSN
	POP	DE
	POP	BC
	CALL	SK2829
	POP	DE
	LD	(FUNCNS),DE
	JP	BCFTCH
;
DFLTUF: LD	A,0
	JR	DFLTZR
;
DEFUSR: INC	HL
	CALL	HLFTCH
	CP	0F5h
	JR	Z,DFLTUF
	OR	A
	JR	Z,USERSE
	CP	00Bh
	JR	NC,USERSE
	DEC	A
	INC	HL
DFLTZR: PUSH	AF
	CALL	HLFTCH
	CP	0F5h
	JR	NZ,USERSE
	INC	HL
	LD	C,L
	LD	B,H
	CALL	IHLEXP
	LD	DE,USRTBL
	POP	AF
	ADD	A,A
	ADD	A,E
	LD	E,A
	LD	A,0
	ADC	A,D
	LD	D,A
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	JP	RETIRQ
;
USERSE: JP	SERROR
;
USRDFZ: DEC	BC
	XOR	A
	JR	USRDZE
;
USROPR: CALL	BCFTCH
	CP	028h
	JR	Z,USRDFZ
	OR	A
	JR	Z,USERSE
	CP	00Bh
	JR	NC,USERSE
	DEC	A
USRDZE: PUSH	AF
	CALL	BCFTCH
	CP	028h
	JR	NZ,USERSE
	CALL	EXPRSN
	CP	029h
	JR	NZ,USERSE
	POP	AF
	PUSH	BC
	PUSH	HL
	ADD	A,A
	LD	DE,USRTBL
	ADD	A,E
	LD	E,A
	LD	A,0
	ADC	A,D
	LD	D,A
	EX	DE,HL
	CALL	INDRCT
	EX	DE,HL
	LD	A,D
	OR	E
	JP	Z,UNDEFN
	LD	A,(IY+0)
	CP	003h
	CALL	Z,INDRCT
	PUSH	HL
	LD	HL,USRBCK
	EX	(SP),HL
	PUSH	DE
	RET
;
USRBCK: POP	HL
	POP	BC
	JP	BCFTCH
;
TIME$:	JP	NINS
;
SCRN$:	PUSH	HL
	CALL	CH28H
	DEC	IY
	CALL	HLEXP
	CP	02Ch
SCRNER: JP	NZ,SERROR
	CALL	HCHECK
	CP	32
SCRIFC: JP	NC,IFCALL
	LD	E,A
	POP	HL
	PUSH	HL
	PUSH	DE
	CALL	HLEXP
	CP	02Ch
	JR	NZ,SCRNER
	CALL	HCHECK
	CP	16
	JR	NC,SCRIFC
	POP	HL
	LD	H,A
	PUSH	BC
	CALL	ADRCA2
	LD	D,B
	LD	E,C
	POP	BC
	POP	HL
	PUSH	HL
	PUSH	DE
	CALL	HLEXP
	CP	029h
	JR	NZ,SCRNER
	CALL	HCHECK
	POP	HL
	POP	DE
	PUSH	BC
	PUSH	DE
	PUSH	AF
	LD	C,L
	LD	B,H
	LD	H,A
	LD	DE,KEYBUF
	PUSH	DE
SCRNTL: CALL	AINBC
	OR	A
	JR	NZ,L2900
	LD	A,020h
L2900:	LD	(DE),A
	INC	BC
	INC	DE
	DEC	H
	JR	NZ,SCRNTL
	POP	DE
	POP	AF
	LD	B,A
	POP	HL
	PUSH	DE
	LD	DE,00008h
	ADD	HL,DE
	POP	DE
	CALL	ENTSTR
	INC	IY
	POP	BC
	JP	CONDSB
;
DUMP:	CALL	HLFTCH
	CP	023h
	LD	A,0
	JR	NZ,STDPDV
	INC	HL
	LD	A,2
STDPDV: LD	(DISFLG),A
	PUSH	HL
	LD	HL,(VSTART)
DMPLOP: LD	A,(HL)
	OR	A
	JP	Z,DUMPRT
	RLCA
	JR	NC,ONLYVR
	RLCA
	JR	NC,ARYSKP
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	JR	DMPLOP
ARYSKP: LD	A,(HL)
	INC	HL
	PUSH	HL
	INC	HL
	AND	00Fh
	CALL	PRDMVR
	LD	B,(HL)
	INC	HL
	LD	A,028h
ARDSLP: CALL	ACCPRT
	PUSH	HL
	CALL	INDRCT
	PUSH	BC
	CALL	FIVEPR
	POP	BC
	POP	HL
	INC	HL
	INC	HL
	LD	A,02Ch
	DJNZ	ARDSLP
	LD	A,029h
	CALL	ACCPRT
	CALL	CR1
	POP	HL
	CALL	INDRCT
	JR	DMPLOP
ONLYVR: PUSH	HL
	LD	A,(HL)
	PUSH	AF
	CALL	PRDMVR
	LD	A,03Dh
	CALL	ACCPRT
	LD	A,(IY+0)
	CP	003h
	JR	NZ,STRDMP
	LD	B,(HL)
	INC	HL
	CALL	INDRCT
	EX	DE,HL
	LD	A,022h
	CALL	ACCPRT
	CALL	PRTSDC
	LD	A,022h
	CALL	ACCPRT
	JR	NXTDMP
;
STRDMP: CP	002h
	JR	NZ,RALDMP
	CALL	INDRCT
	EX	DE,HL
	LD	HL,KEYBUF
	LD	(IY+0),4
	CALL	FLTHEX
RALDMP: LD	DE,USINGB
	PUSH	DE
	CALL	LDIR8
	POP	HL
	CALL	CVNMFL
	CALL	PRTSDC
NXTDMP: CALL	CR1
	POP	AF
	POP	HL
	INC	A
	INC	A
	INC	A
	LD	E,A
	LD	D,0
	ADD	HL,DE
	LD	A,080h
	IN	A,(1)
	AND	004h
	CALL	Z,FLSHGT
	CALL	BRKEY
	JP	NZ,DMPLOP
DUMPRT: POP	HL
	LD	A,1
	LD	(DISFLG),A
	RET
;
PRDMVR: PUSH	AF
	INC	HL
	LD	A,(HL)
	CALL	ACCPRT
	INC	HL
	LD	A,(HL)
	OR	A
	JR	NZ,NTNULD
	LD	A,020h
NTNULD: CALL	ACCPRT
	INC	HL
	POP	AF
	LD	B,021h
	CP	004h
	JR	Z,PTVSBL
	INC	B
	INC	B
	CP	008h
	JR	Z,PTVSBL
	INC	B
	CP	003h
	JR	Z,PTVSBL
	INC	B
PTVSBL: LD	IY,(INTSSP)
	LD	(IY+0),A
	LD	A,B
	CALL	ACCPRT
	RET
;
CONSOL: JP	NINS
;
KLIST:	PUSH	HL
	CALL	CR2
	LD	C,0
KLSTLP: LD	A,C
	CP	009h
	JR	Z,KLTEN
	ADD	A,031h
	CALL	ACCPRT
	JR	KLTAB
KLTEN:	LD	A,031h
	CALL	ACCPRT
	DEC	A
	CALL	ACCPRT
KLTAB:	CALL	TABPRT
	LD	A,C
	CALL	KEYBCL
	LD	B,(HL)
	INC	HL
	XOR	A
	CP	B
	JR	Z,KLESC
KLLP1:	LD	A,(HL)
	CALL	CTRLPR
	INC	HL
	DJNZ	KLLP1
KLESC:	CALL	CR2
	INC	C
	LD	A,C
	CP	10
	JR	NZ,KLSTLP
	POP	HL
	INC	HL
	RET
;
CTRLPR: CP	020h
	JP	NC,ACCPRT
	PUSH	AF
	LD	A,05Bh
	CALL	ACCPRT
	POP	AF
	ADD	A,040h
	CALL	ACCPRT
	LD	A,05Dh
	JP	ACCPRT
;
KEYON:	JP	NINS
;
KEYOFF: JP	NINS
;
KEY:	CALL	HLFTCH
	CP	086h
	JP	Z,KLIST
	CP	098h
	JR	Z,KEYON
	CP	09Ch
	JR	Z,KEYOFF
	LD	C,L
	LD	B,H
	CALL	IHLEXP
	CP	02Ch
	JP	NZ,SERROR
	CALL	HCHECK
	CP	11
KIFCVX: JP	NC,IFCALL
	OR	A
	JR	Z,KBUFST
	DEC	A
	CALL	KEYBCL
	PUSH	HL
	CALL	STREXX
	POP	DE
	LD	A,(HL)
	CP	16
	JR	C,KLNLMT
	LD	A,15
KLNLMT: LD	(DE),A
	INC	DE
	INC	HL
	PUSH	BC
	LD	B,A
	CALL	INDRCT
	XOR	A
	OR	B
	JR	Z,ESCKPT
KYPTLP: LD	A,(HL)
	LD	(DE),A
	INC	DE
INDRCT1: INC	HL
	DJNZ	KYPTLP
ESCKPT: POP	HL
	DEC	HL
	RET
;
KBUFST: CALL	STREXX
	DEC	DE
	INC	A
	INC	A
	LD	HL,POINT1
	LD	(HL),0
	CP	040h		;KEY BUFF LIMIT
	JR	C,KBUFSL
	LD	A,040h
KBUFSL: PUSH	BC
	LD	B,A
KBUFLP: INC	HL
	LD	(HL),A
	LD	A,(DE)
	INC	DE
	DJNZ	KBUFLP
	JR	ESCKPT
;
KEYBCL: ADD	A,A
	ADD	A,A
	ADD	A,A
	ADD	A,A
	LD	HL,FUNBUF
	ADD	A,L
	LD	L,A
	LD	A,0
	ADC	A,H
	LD	H,A
	RET
;
CSRLIN: LD	DE,00008h
	ADD	HL,DE
	LD	A,(CURY)
	LD	E,A
	LD	D,0
	CALL	FLTHEX
	LD	A,4
	CALL	CONDFL
	JP	BCFTCH
;
LNOADR: PUSH	DE
	PUSH	HL
	LD	HL,ADRNVC
	LD	(RETLNV),HL
	JR	MIDRLN
;
RETLNR: POP	HL
	POP	DE
	RET
;
RETLNO: PUSH	DE
	PUSH	HL
	LD	HL,RELNVC
	LD	(RETLNV),HL
MIDRLN: LD	HL,TEXTST
	DEC	HL
RTLLOP: INC	HL
	LD	A,(HL)
	INC	HL
	OR	(HL)
	JR	Z,RETLNR
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	(UDLBUF),DE
RETSTL: CALL	IFSKSB
	OR	A
	JR	Z,RTLLOP
	CP	00Bh
	JR	Z,CVRTLN
	CP	00Ch
	JR	NZ,RETSTL
;
CVRTLN: DEFB	0C3H		; JP ?
RETLNV: DEFW	RELNVC
RELNVC: CP	00Bh
	JR	Z,RETSTL
;
CVLNAD: DEC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	PUSH	HL
	EX	DE,HL
	INC	HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	POP	HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	DEC	HL
	LD	(HL),00Bh
	INC	HL
	INC	HL
RTLSHM: JR	RETSTL
;
ADRNVC: CP	00Ch
	JR	Z,RETSTL
	DEC	HL
	PUSH	HL
	CALL	INDRCT
	LD	E,L
	LD	D,H
	CALL	LNOSER
	JR	C,RENNTF
	EX	DE,HL
	POP	HL
	DEC	HL
	LD	(HL),00Ch
	INC	HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
RTRNAD: JR	RTLSHM
;
RENNTF: EX	DE,HL
	LD	DE,UDLMES
	LD	B,21
	CALL	PRTSDC
	CALL	SPPRT
	CALL	FIVEPR
	LD	DE,INMES
	LD	B,4
	CALL	PRTSDC
	DEFB	021H		; LD HL,?
UDLBUF: DEFS	2
	CALL	FIVEPR
	CALL	CR2
	POP	HL
	INC	HL
	JR	RTRNAD
;
LNOSER: PUSH	BC
	PUSH	DE
	EX	DE,HL
	LD	HL,TEXTST
	LD	(TMPUYS),HL
LNOSLP: PUSH	HL
	DEFB	021H		; LD HL,?
TMPUYS: DEFS	2
;
	POP	HL
	LD	(TMPUYS),HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	LD	A,B
	OR	C
	JR	Z,LMIDET1
	PUSH	BC
	INC	HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	LD	A,C
	CP	E
	JR	NZ,NOMTCH
	LD	A,B
	CP	D
	DEC	HL
	DEC	HL
	DEC	HL
	JR	NZ,NOMTCH
	POP	BC
	OR	A
NTFRET: POP	DE
	POP	BC
	RET
;
NOMTCH: PUSH	DE
	EX	DE,HL
	OR	A
	SBC	HL,BC
	POP	DE
	POP	HL
	JR	NC,LNOSLP
LMIDET1: SCF
	JR	NTFRET
;
GTSTED: LD	DE,00000h
	LD	BC,0FFFFh
	CALL	HLFTCH
	OR	A
	RET	Z
	CP	03Ah
	RET	Z
	CP	02Dh
	JR	Z,GTNXNM
	CP	02Ch
	JR	Z,GTNXNM
	CP	02Eh
	JR	NZ,FSTNUB
	LD	DE,(EDLINE)
	JR	NX2C2D
FSTNUB: CP	00Bh
GSESER: JP	NZ,SERROR
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
NX2C2D: INC	HL
	CALL	HLFTCH
	CP	02Dh
	JR	Z,GTNXNM
	CP	02Ch
	JR	Z,GTNXNM
	LD	C,E
	LD	B,D
	OR	A
	RET	Z
	CP	03AH
	RET	Z
	JR	GSESER
;
GTNXNM: INC	HL
	CALL	HLFTCH
	OR	A
	RET	Z
	CP	03Ah
	RET	Z
	CP	02Eh
	JR	NZ,GTEDNO
	LD	BC,(EDLINE)
	INC	HL
	RET
;
GTEDNO: CP	00Bh
	JR	NZ,GSESER
	INC	HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	INC	HL
	RET
;
EDIT:	CALL	GTSTED
	PUSH	DE
	EX	DE,HL
	CALL	LNOSER
	JP	C,UDFLNO
	XOR	A
	LD	(DISFLG),A
	EX	DE,HL
	POP	HL
	CALL	FIVEPR
	CALL	SPPRT
	EX	DE,HL
	LD	DE,4
	ADD	HL,DE
	CALL	ONELST
	LD	A,1
	LD	(DISFLG),A
EDBKLP: LD	A,29		;CURLEFT CODE
	CALL	ACCPRT
	DJNZ	EDBKLP
	JP	AUTOBK
;
SLIST:	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,SERVEC
	LD	(SAVEVC),HL
	LD	HL,SER0DH
	JR	SDXSET
;
CLIST:	PUSH	BC
	PUSH	DE
	PUSH	HL
	LD	HL,COUTCH
	LD	(SAVEVC),HL
	LD	HL,COUT0D
SDXSET: LD	DE,00000h
	LD	BC,0FFFFh
	JR	CLISTM
;
LIST#:	CALL	HLFTCH
	CP	02Ch
	JR	NZ,LIST##
	INC	HL
LIST##: LD	A,2
	JR	LIST#E
;
LIST:	XOR	A
LIST#E: LD	(DISFLG),A
	PUSH	BC
	PUSH	DE
	CALL	GTSTED
	PUSH	HL
	LD	HL,CRTVEC
	LD	(SAVEVC),HL
	LD	HL,CRTCR2
CLISTM: LD	(LSCRVC),HL
	LD	(LISTSN),DE
	LD	(LISTEN),BC
	LD	HL,TEXTST
LISTLP: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,D
	OR	E
	JR	Z,LISTE'
	PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	PUSH	HL
	DEFB	021H		; LD HL,?
LISTSN: DEFS	2
	OR	A
	SBC	HL,DE
	JR	C,LISTRT
	JR	Z,LISTRT
	POP	HL
	POP	HL
LISTL': JR	LISTLP
;
LISTRT: DEFB	021H		; LD HL,?
LISTEN: DEFS	2
	OR	A
	SBC	HL,DE
	JR	NC,LOKJMN
	POP	HL
	POP	HL
LISTE': JR	LISTED
;
LOKJMN: EX	DE,HL
	LD	(EDLINE),HL
	LD	DE,KEYBUF
	CALL	ASCHL
	LD	HL,00005h
	ADD	HL,DE
	LD	(HL),020h
	INC	HL
	EX	DE,HL
	POP	HL
	CALL	CVTXIM
	LD	DE,KEYBUF
	PUSH	BC
	LD	B,5
LZSKL:	LD	A,(DE)
	CP	030h
	INC	DE
	JR	NZ,LTSKZR
	DJNZ	LZSKL
LTSKZR: POP	BC
	DEC	DE
	LD	(SERDIS),DE
LIST0L: LD	A,(DE)
	OR	A
	JR	Z,ESCLOT
	DEFB	0C3H		; JP ?
SAVEVC: DEFS	2
COUTCH: CALL	CTOUT
	JR	CTIRTR
;
CRTVEC: CALL	ACCPRT
CTIRTR: INC	DE
	JR	LIST0L
ESCLOT: DEFB	0C3H		; JP ?
LSCRVC: DEFS	2
COUT0D: LD	A,00Dh
	CALL	CTOUT
	POP	HL
	JR	LSTCR'
CRTCR2: CALL	CR2
;
LISCRC: POP	HL
LSTCR': LD	A,080h		;SPACE STOP
	IN	A,(1)
	AND	4
	JR	Z,LSTCR'
	CALL	BRKEY
	JR	NZ,LISTL'

LISTED: POP	HL
	POP	DE
	POP	BC
	LD	A,1
	LD	(DISFLG),A
	RET
;
ONELST: PUSH	HL
	LD	DE,KEYBUF
	CALL	CVTXIM
	LD	B,0
ONLZLP: LD	A,(DE)
	OR	A
	JR	Z,ONLSRT
	CALL	ACCPRT
	INC	DE
	INC	B
	JR	ONLZLP
ONLSRT: POP	HL
	RET
;
UNTIL:	POP	DE
	POP	BC
	PUSH	BC
	INC	B
UNWTRP: LD	A,24
	JP	NZ,ERROR
	LD	A,C
	ADD	A,6
	JR	NZ,UNWTRP
	PUSH	DE
	LD	C,L
	LD	B,H
	CALL	FLEXPR
	LD	A,(HL)
	OR	A
	LD	L,C
	LD	H,B
	DEC	HL
	JR	NZ,ESCUTL
	LD	HL,4
UNTILM: ADD	HL,SP
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	(LNOBUF),DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	(NXTLPT),DE
	INC	HL
	JP	INDRCT
;
ESCUTL: POP	IX
	POP	BC
	POP	BC
	POP	BC
	POP	BC
	JP	(IX)
;
RETURN: POP	IX
RTAGPO: POP	BC
	INC	BC
	LD	A,B
	OR	C
	JR	Z,RTWGOS
	INC	BC
	LD	A,B
	OR	C
	JR	NZ,FPOPRT
	CALL	HLFTCH
	EX	DE,HL
	POP	HL
	LD	(LNOBUF),HL
	POP	HL
	LD	(NXTLPT),HL
	POP	HL
	PUSH	IX
	CP	03Ah
	RET	Z
	OR	A
	RET	Z
	EX	DE,HL
	JP	GOTO
;
RTWGOS: LD	A,3
	PUSH	BC
	JP	ERROR
;
FPOPRT: DEC	BC
	DEC	BC
	XOR	A
	CP	C
	JR	NZ,RTWGOS
	EX	DE,HL
	LD	HL,22
	ADD	HL,SP
	LD	SP,HL
	EX	DE,HL
	JR	RTAGPO
;
WHILE:	POP	BC
	PUSH	HL
	EX	DE,HL
	LD	HL,(NXTLPT)
	LD	(WHNLPT),HL
	PUSH	HL
	LD	HL,(LNOBUF)
	LD	(WHNLBF),HL
	PUSH	HL
	LD	HL,0FFF9h
	PUSH	HL
	CALL	MEMCHK
	EX	DE,HL
	DEC	HL
	CALL	SKIPWH
	EX	DE,HL
	DEFB	021H		; LD HL,?
WHNLPT: DEFS	2
	LD	(NXTLPT),HL
	DEFB	021H		; LD HL,?
WHNLBF: DEFS	2
	LD	(LNOBUF),HL
	EX	DE,HL
	PUSH	BC
	INC	HL
WEND:	POP	DE
	POP	BC
	PUSH	BC
	INC	B
WENDER: LD	A,26
	JP	NZ,ERROR
	LD	A,007h
	ADD	A,C
	JR	NZ,WENDER
	PUSH	DE
	PUSH	HL
	LD	HL,10
	ADD	HL,SP
	CALL	INDRCT
	LD	C,L
	LD	B,H
	CALL	FLEXPR
	LD	A,(HL)
	OR	A
	POP	HL
	JP	Z,ESCUTL
	PUSH	BC
	LD	HL,8
	CALL	UNTILM
	POP	HL
	DEC	HL
	RET
;
SKIPWH: CALL	IFSKSB
	OR	A
	JR	Z,SKWHEL
	CP	09Eh
	RET	Z
	CP	09Dh
	JR	NZ,SKIPWH
	CALL	SKIPWH
	JR	SKIPWH
;
SKWHEL: INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,D
	OR	E
	LD	A,25
	JP	Z,ERROR
	LD	(WHNLPT),DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	(WHNLBF),DE
	JR	SKIPWH
;
REPTON: LD	DE,200
	JR	REPTST
;
REPOFF: LD	DE,0FFFFh
REPTST: LD	(REPTSW),DE
	INC	HL
	RET
;
REPEAT: CALL	HLFTCH
	CP	098h
	JR	Z,REPTON
	CP	09Ch
	JR	Z,REPOFF
	POP	BC
	PUSH	HL
	EX	DE,HL
	LD	HL,(NXTLPT)
	PUSH	HL
	LD	HL,(LNOBUF)
	PUSH	HL
	LD	HL,0FFFAh	; REPEAT MARK
	PUSH	HL
	EX	DE,HL
	PUSH	BC
	JP	MEMCHK
;
GOSUB:	POP	BC
	CALL	HLFTCH
	CP	00Bh
	JR	Z,GOSNDQ
	CP	00Ch
	JR	Z,GOSNDQ
	PUSH	HL
	PUSH	BC
	CALL	STREXZ
	DEC	BC
	LD	L,C
	LD	H,B
	POP	BC
	EX	(SP),HL
	INC	HL
	INC	HL
	INC	HL
	LD	A,022h
	JR	GOSMID
GOSNDQ: INC	HL
	INC	HL
	INC	HL
	PUSH	HL
GOSMID: EX	DE,HL
	LD	HL,(NXTLPT)
	PUSH	HL
	LD	HL,(LNOBUF)
	PUSH	HL
	LD	HL,0FFFEh
	PUSH	HL
	EX	DE,HL
	PUSH	BC
	CALL	MEMCHK
	DEC	HL
	DEC	HL
	JP	MIDLAG
;
OGSJMP: PUSH	HL
	CALL	DATA
	POP	DE
	POP	BC
	PUSH	HL
	EX	DE,HL
	CALL	HLFTCH
	INC	HL
	INC	HL
	INC	HL
	JR	GOSMID
;
LBLGOT: DEC	HL
	CALL	LBLSER
	PUSH	HL
	LD	HL,(LBLNXT)
	LD	(NXTLPT),HL
	DEFB	021H		; LD HL,?
LBLLNO: DEFS	2
	LD	(LNOBUF),HL
	POP	HL
	RET
;
LBLSER: CALL	STREXZ
	OR	A
	JP	Z,UDFLNO
	LD	(LBLLEN),A
	LD	(LBLDEB),DE
	LD	HL,TEXTST
	LD	(LBLNXT),HL
LBLSLP: DEFB	021H		; LD HL,?
LBLNXT: DEFS	2
	LD	(CURLPT),HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,D
	OR	E
	JP	Z,UDFLNO
	LD	(LBLNXT),DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	(LBLLNO),DE
NOTLBL: CALL	IFSKSB		; SKIP SMBL
	OR	A
	JR	Z,LBLSLP
	CP	0C2h
	JR	NZ,NOTLBL
	INC	HL
	CALL	STREXZ
	DEC	BC
	PUSH	BC
	DEFB	0FEH		; CP ?
LBLLEN: DEFS	1
	JR	NZ,LBLNMT
	LD	C,A
	LD	B,000h
	EX	DE,HL
	LD	DE,KEYBUF
	PUSH	DE
	LDIR
	LD	B,A
	DEFB	011H		; LD DE,?
LBLDEB: DEFS	2
	POP	HL
LBLMTL: LD	A,(DE)
	CP	(HL)
	JR	NZ,LBLNMT
	INC	HL
	INC	DE
	DJNZ	LBLMTL
	POP	HL
	RET
;
LBLNMT: POP	HL
	DEC	HL
	JR	NOTLBL
;
ONERRG: INC	HL
	CALL	HLFTCH
	CP	081h
	JP	NZ,SERROR
	INC	HL
	CALL	HLFTCH
	CP	00Bh
	JR	NZ,ONERDQ
	INC	HL
	PUSH	HL
	CALL	INDRCT
	LD	A,L
	OR	H
	JR	Z,OEROFF
	CALL	LNOSER
	JP	C,UDFLNO
	LD	(ERRORV),HL
	LD	A,1
OEROF': LD	(ERRORF),A
	POP	HL
	INC	HL
	INC	HL
	RET
;
ONERDQ: CP	022h
	JP	NZ,UDFLNO
	PUSH	HL
	CALL	LBLSER
	DEFB	021H		; LD HL,?
CURLPT: DEFS	2
	LD	(ERRORV),HL
	POP	HL
	CALL	IFDQSK
	OR	A
	JR	Z,DQOENB
	INC	HL
DQOENB: LD	A,1
	LD	(ERRORF),A
	RET
;
OEROFF: LD	A,(ERRORF)
	CP	002h
	LD	A,0
	JR	NZ,OEROF'
	JP	RESERR
;
ON:	LD	C,L
	LD	B,H
	CALL	HLFTCH
	CP	0B5h
	JR	Z,ONERRG
	CALL	FLEXPR
	LD	DE,OGSJMP
	CP	082h
	JR	Z,OGOSUB
	LD	DE,GOTO
	CP	081h
	JP	NZ,SERROR
OGOSUB: PUSH	DE
	CALL	HLFLT
	JR	C,ODATA
	LD	A,H
	OR	A
	JR	NZ,ODATA
	LD	A,L
	OR	A
	JR	Z,ODATA
	LD	L,C
	LD	H,B
	LD	B,A
ONLNOS: DEC	B
	RET	Z
	CALL	LNRGCK
	CP	02Ch
	INC	HL
	JR	Z,ONLNOS
	DEC	HL
	POP	DE
	RET
;
ODATA:	POP	DE
	LD	L,C
	LD	H,B
	JP	DATA
;
GOTO:	CALL	HLFTCH
IFGOTO: INC	HL
MIDLAG: CP	00Ch
	JR	NZ,SERGOT
	CALL	INDRCT
LNSGOT: LD	(NXTLPT),HL	;"
;XOR A
;LD (CON
	POP	BC
	JP	NXLINE
;
SERGOT: CP	00Bh
	JP	NZ,LBLGOT
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	CALL	LNOSER
	JR	C,UDFLNO
	EX	DE,HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	DEC	HL
	LD	(HL),00Ch
	EX	DE,HL
	JP	LNSGOT
;
UDFLNO: LD	A,8
	JP	ERROR
;
ONGDQT: CALL	IFDQSK
	OR	A
	JR	Z,HLFVEC
	INC	HL
	JP	HLFTCH
;
LNRGCK: CALL	HLFTCH
	CP	022h
	JR	Z,ONGDQT
	INC	HL
	INC	HL
	INC	HL
	CP	00Bh
	JR	Z,HLFVEC
	CP	00Ch
HLFVEC: JP	Z,HLFTCH
	JP	SERROR
;
IFF:	LD	C,L
	LD	B,H
	CALL	FLEXPR
	EX	AF,AF'
	LD	A,(HL)
	OR	A
	LD	L,C
	LD	H,B
	DEC	HL
	JR	Z,IFALSE
	EX	AF,AF'
	CP	0E1h
	RET	NZ
ELSEMD: INC	HL
	CALL	HLFTCH
	CP	00Bh
	JR	Z,IFGOTO
	CP	00Ch
	JR	Z,IFGOTO
	CP	022h
	JR	Z,IFGOTO
	RET
;
IFALSE: DEC	HL
	CALL	IFSKIP
	JR	NC,ELSEMD
	POP	HL
	JP	NXLINE
;
IFSKIP: CALL	IFSKSB
	OR	A
	SCF
	RET	Z
	CP	0B8h
	RET	Z
	CP	08Eh
	JR	NZ,IFSKIP
IFSKMD: CALL	IFSKIP
	RET	C
	JR	IFSKIP
;
IFSKSB: INC	HL
	LD	A,(HL)
	OR	A
	RET	Z
	CP	0FFh
	JR	Z,FUNCRQ
	CP	022h
	JR	Z,IFDQSK
	CP	020h
	RET	NC
	CP	00Bh
	RET	C
	CP	014h
	JR	NC,ISKFLT
	INC	HL
FUNCRQ: INC	HL
	RET
;
ISKFLT: AND	00Fh
	ADD	A,L
	LD	L,A
	LD	A,0
	ADC	A,H
	LD	H,A
	LD	A,020h
	RET
;
IFDQSK: INC	HL
	LD	A,(HL)
	OR	A
	RET	Z
	CP	022h
	RET	Z
	JR	IFDQSK
;
VPUSH:	LD	C,L
	LD	B,H
	CALL	ILDRCH
	POP	HL
	LD	(PUSHJV),HL
PUSHAG: LD	HL,(INTFAC)
	LD	IY,(INTSSP)
	LD	(IY+0),0
	CALL	EXPRSN
	EX	AF,AF'
	LD	A,(IY+0)
	CP	003h
	JP	Z,TYPEMS
	EX	DE,HL
	LD	HL,0FFF8h
	ADD	HL,SP
	LD	SP,HL
	PUSH	BC
	CALL	CLRFAC
	LD	B,A
	LD	C,A
PUTSTRL:LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	PUTSTRL
	LD	D,C
	POP	BC
	LD	E,0FDh
	PUSH	DE
	EX	AF,AF'
	PUSH	AF
	CALL	MEMCHK
	POP	AF
PUSHL1: CP	02Ch
	JR	Z,PUSHAG
	LD	L,C
	LD	H,B
RETVCP: DEC	HL
	DEFB	0C3H		; JP ?
PUSHJV: DEFS	2
;
VPOP:	LD	C,L
	LD	B,H
	CALL	ILDRCH
	POP	HL
	LD	(PUSHJV),HL
POPLOP: CALL	GETVAC
	POP	DE
	CP	002h
	JR	Z,INTPOP
	CP	003h
	JP	Z,TYPEMS
	CP	D
	JR	NZ,STKEMP
	LD	A,E
	CP	0FDh
	JR	NZ,STKEMP
	LD	A,D
	EX	DE,HL
	LD	HL,00000h
	ADD	HL,SP
	PUSH	BC
	LD	B,A
POPTRL: LD	A,(HL)
	LD	(DE),A
	INC	HL
	INC	DE
	DJNZ	POPTRL
	POP	BC
INTPOR: LD	HL,8
	ADD	HL,SP
	LD	SP,HL
HEXCUL1: CALL	BCFTCH
	CP	02Ch
	JR	Z,POPLOP
	LD	L,C
	LD	H,B
	JP	RETVCP
;
STKEMP: LD	A,30
	JP	ERROR
;
INTPOP: LD	A,D
	CP	003h
	JR	Z,STKEMP
	LD	A,E
	CP	0FDh
	JR	NZ,STKEMP
	LD	A,D
	EX	DE,HL
	LD	HL,00000h
	ADD	HL,SP
	CALL	HLFLTO
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	DEC	HL
	JR	INTPOR
;
BUFCLR: PUSH	HL
	LD	HL,0
	LD	(LNG),HL
	LD	HL,CTBUF
	LD	(ADRES),HL
	XOR	A
	JR	CTRET'
;
CTINP:	PUSH	HL
	PUSH	BC
	DEFB	021H		; LD HL,?
ADRES:	DEFW	CTBUF
	DEFB	001H		; LD BC,?
LNG:	DEFS	2
	LD	A,B
	OR	C
	JR	NZ,CTINP1
	LD	HL,CTBUF
	LD	(ADRES),HL
	LD	(MTADRS),HL
	LD	BC,00100H
	LD	(LNG),BC
	LD	(MTBYTE),BC
	CALL	MLOAD
	JP	C,CTERR
CTINP1: LD	A,(HL)
	INC	HL
	DEC	BC
	LD	(ADRES),HL
	LD	(LNG),BC
CTRETN: POP	BC
CTRET': POP	HL
	RET
;
CTERR:	POP	HL
	POP	BC
	SCF
	RET
;
CTOUT:	PUSH	BC
	PUSH	HL
	LD	HL,(ADRES)
	LD	BC,(LNG)
	LD	(HL),A
	INC	HL
	INC	BC
	LD	(ADRES),HL
	LD	A,B
	CP	1
	JR	NZ,CTOUT1
	LD	HL,CTBUF
	LD	(MTADRS),HL
	LD	(MTBYTE),BC
	CALL	MSAVE
	LD	BC,0
CTOUT1: LD	(LNG),BC
	LD	(ADRES),HL
	OR	A
	JR	CTRETN
;
CTCLOS: PUSH	BC
	PUSH	HL
	LD	HL,CTBUF
	LD	(MTADRS),HL
	LD	HL,00100H
	LD	(MTBYTE),HL
	CALL	MSAVE
	JR	C,CTERR
	JR	CTRETN
;
STREXZ: LD	C,L
	LD	B,H
STREXX: LD	HL,(INTFAC)
	LD	IY,(INTSSP)
	LD	(IY+0),0
	CALL	STEXPR
	CALL	CONDMZ
	JP	CVDSAD
;
CTBUF:	DEFW	$FLOAT
	DEFW	$EDIT
	DEFW	ADDDEG   ; $CONV hard coding
	DEFW	00000h   ; $IOCS hard coding
	DEFW	$ERTXT
	DEFW	VSTART   ; $WORK hard coding 
	DEFW	LDIR1   ; $FUNC hard coding
	DEFS	242
USINGB: DEFS	26
;
;	CHAIN	,GRAPH
;
; GRAPH
;
;
DEFCHR: INC	HL
	LD	A,(GMODEF)
	CP	2
	JP	NC,IFCALL
	CALL	HLFTCH
	CP	028h
	JP	NZ,SERROR
	INC	HL
	LD	C,L
	LD	B,H
	CALL	IHLEXP
	CALL	CH29H
	CALL	HCHECK
	CP	080h
	JP	C,IFCALL
	CP	0E0h
	JP	NC,IFCALL
	AND	07Fh
	PUSH	AF
	CALL	BCFTCH
	CP	0F5h
	JP	NZ,SERROR
	CALL	STREXX
	CP	12
	JP	NZ,IFCALL
	LD	H,A
	POP	AF
	PUSH	BC
	PUSH	HL
	LD	L,A
	LD	H,0
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	BC,01000h
	ADD	HL,BC
	LD	C,L
	LD	B,H
	POP	HL
DEFCHL: LD	A,(DE)
	OUT	(C),A
	INC	DE
	INC	BC
	DEC	H
	JR	NZ,DEFCHL
	POP	HL
	DEC	HL
	RET
;
;
SOUND:	LD	B,H
	LD	C,L
	CALL	IHLEXP
	CALL	CH2CH
	CALL	HCHECK
	CP	14
	JP	NC,IFCALL
	PUSH	AF
	CALL	IHLEXP
	CALL	HCHECK
	POP	HL
	LD	L,A
	PUSH	BC
	LD	BC,04000h
	OUT	(C),H
	INC	C
	OUT	(C),L
	POP	BC
	JP	RETIRQ
;
BEEPOP: LD	B,H
	LD	C,L
	CALL	EDCEK
	JR	Z,BEEP
	CALL	IBYTE
	CP	128
	JP	NC,IFCALL
	LD	D,A
	LD	E,0
	DEC	BC
	CALL	EDCEK
	JR	Z,BEEPA
	CP	02Ch
	JP	NZ,SERROR
	INC	BC
	PUSH	DE
	CALL	IBYTE
	POP	DE
	CP	3
	JP	NC,IFCALL
	DEC	BC
	LD	E,A
BEEPA:	PUSH	BC
	CALL	SOUNDS		;D,E
	POP	HL
	RET
;
BEEP:	PUSH	BC
	CALL	BELL
	LD	BC,04000h
	LD	A,7
	OUT	(C),A
	INC	C
	IN	A,(C)
	OR	03Fh
	OUT	(C),A
	POP	HL
	RET
;
PLAY:	LD	C,L
	LD	B,H
	CALL	SETSSP
	LD	(IY+0),0
	CALL	EXPRSN
	LD	A,(IY+0)
	CP	003h
	JR	NZ,TEMPO
	CALL	CONDMZ
	CALL	CVDSAD
	PUSH	BC
	LD	B,A
	OR	A
	JR	Z,ESCPLY
	LD	HL,KEYBUF
	PUSH	HL
	LD	C,B
KBSTMS: LD	A,(DE)
	LD	(HL),A
	INC	DE
	INC	HL
	DJNZ	KBSTMS
	LD	(HL),03Ah
	LD	B,C
	POP	DE
	CALL	MUSIC
ESCPLY: POP	HL
	DEC	HL
	RET
;
TEMPO:	EX	DE,HL
	LD	HL,KEYBUF
	PUSH	HL
	LD	(IY+0),4
	LD	(HL),08Dh
	INC	HL
	LD	(HL),06Ah
	INC	HL
	LD	(HL),060h
	INC	HL
	LD	(HL),0
	POP	HL
	PUSH	BC
	CALL	DIV
	CALL	HLFLTO
	CALL	HCHECK
	OR	A
	JP	Z,IFCALL
	CALL	XTEMPO
	POP	BC
	JP	RETIRQ
;
;
COLOR:	LD	C,L
	LD	B,H
	CALL	IBYTE
	CP	9
	JP	NC,IFCALL
	LD	(COLORF),A
	DEC	BC
	LD	L,C
	LD	H,B
	RET
;
;
PRESET: CALL	PSETXY
	XOR	A
	LD	(GCOLOR),A
	JR	L33F0
PSET:    
	CALL	PSETXY		;(X,Y,C)
L33F0:	PUSH	BC
	CALL	PSETSB
	POP	HL
	RET
;
;
;
;  PSET(RESET(DE,HL)
PSETSB: CALL	CULADR
	RET	C
	PUSH	HL
	LD	HL,CULTBL
	ADD	HL,DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	EX	DE,HL
	EX	(SP),HL
	RET
;
CULTBL: DEFW	CULAD0		;TEXT0
	DEFW	CULAD1		;TEXT1
	DEFW	CULAD3		;GRAPHIC2,3
	DEFW	CULAD5		;GRAPHIC4,5
;
;
CULADR: PUSH	HL
SCRNYE: LD	BC, 04764h 	;LIMIT Y
	ADD	HL,BC
	JR	C,CULERR
	EX	DE,HL
	PUSH	HL
SCRNXE: LD	BC, 0472Ch 	;LIMIT X
	ADD	HL,BC
	POP	DE
CULERR: POP	HL
	RET	C
CALADR: JP	CALAD0
;
CALAD0: LD	BC,(CHRSTA)
	LD	A,L
	RES	0,L
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	AND	1
	SRL	E
	CCF
	RLA
	ADD	HL,DE
	ADD	HL,BC
	LD	DE,00000h
	OR	A
	RET
;
CULAD0: LD	C,L
	LD	B,H
	SET	3,B		;
	LD	E,4		;
	OUT	(C),E		;
	LD	E,1
	OR	A
	JR	Z,PATCH2
L3445:	RLC	E
	DEC	A
	JR	NZ,L3445
PATCH2:	LD	A,(GCOLOR)
	OR	A
	JP	Z,PRESOK
	DEC	A
	AND	7
	RLCA
	RLCA
	RLCA
	RLCA
	OR	E
	LD	E,A
	LD	D,00Fh
	JP	PSTRES
;
CALAD1: LD	BC,(CHRSTA)
	LD	A,L
	LD	L,0FFh
CALA21: INC	L
	SUB	3
	JR	NC,CALA21
	ADD	A,3
	SRL	E
	CCF
	RLA
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,DE
	ADD	HL,BC
	LD	DE,00002h
	OR	A
	RET
;
CULAD1: LD	C,L
	LD	B,H
	SET	3,B
	LD	D,00Ch
	OUT	(C),D
	LD	E,1
	OR	A
	JR	Z,PATCH3
L348A:	RLC	E
	DEC	A
	JR	NZ,L348A
PATCH3:	LD	A,(GCOLOR)
	OR	A
	JP	Z,PRESOK
	DEC	A
	CP	4
	JR	C,L349F
	SET	1,D
	OUT	(C),D
L349F:	AND	003h
	RRCA
	RRCA
	OR	E
	LD	E,A
	LD	D,03Fh
	JP	PSTRES
;
PRESOK: LD	C,L
	LD	B,H
	IN	L,(C)
	LD	A,E
	CPL
	AND	L
	OUT	(C),A
	RET
;
;
CALAD2:
CALAD3: ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	A,E
	SRL	E
	SRL	E
	ADD	HL,DE
	LD	DE,00004h
	OR	A
	RET
;
CULAD3: AND	003h
	INC	A
	LD	B,A
	LD	A,(GCOLOR)
	AND	003h
	LD	E,A
	LD	D,0FCh
CALA31: RRC	E
	RRC	E
	RRC	D
	RRC	D
	DJNZ	CALA31
	JP	PSTRES
;
CALAD4:
CALAD5: ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	A,E
	SRL	E
	SRL	E
	SRL	E
	ADD	HL,DE
	LD	DE,00006H
	OR	A
	RET
;
CULAD5: AND	7
	LD	E,080h
	OR	A
	JR	Z,L34FB
L34F6:	RRC	E
	DEC	A
	JR	NZ,L34F6
L34FB:	LD	A,(GCOLOR)
	AND	001h
	JP	Z,PRESOK
	LD	D,0FFh
;
PSTRES: LD	C,L
	LD	B,H
	IN	A,(C)
	AND	D
	OR	E
	OUT	(C),A
	RET
;
PSETXY: LD	C,L
	LD	B,H
	CALL	SETXY3
	CP	029h		;)
	JR	Z,COLFST
	CALL	CH2CH
	PUSH	DE
	PUSH	HL
	CALL	IHLEXP
	CP	029h		;)
	JP	NZ,SERROR
	CALL	HCHECK
	CP	9
	JP	NC,IFCALL
	POP	HL
	POP	DE
COLFSL: LD	(GCOLOR),A
	RET
COLFST: LD	A,(COLORF)
	JR	COLFSL
;
SETXY3: CALL	BCFTCH
	CP	028h		;(
	JP	NZ,SERROR
	CALL	IHLEXP
	PUSH	HL
	CALL	CH2CH
	CALL	IHLEXP
	POP	DE
	RET
;
;
SETXY2: CALL	SETXY3
	CALL	CH29H
BCFTC2: LD	A,(BC)
	CP	020h
	RET	NZ
	INC	BC
	JR	BCFTC2
;
;
EDCEKL: INC	BC
EDCEK:	LD	A,(BC)
	CP	020h
	JR	Z,EDCEKL
	OR	A
	RET	Z
	CP	03Ah
	RET
;
;
LINE@:	CALL	COLFST
	DEC	BC
	CALL	BCFTC2
	CP	0F9h		;-
	JR	NZ,NOMLIN
	LD	HL,(LINEXE+1)
	LD	(LINEXS+1),HL
	LD	HL,(LINEYE+1)
	LD	(LINEYS+1),HL
	JR	ENDLIN
NOMLIN: CALL	SETXY2
	LD	(LINEXS+1),DE
	LD	(LINEYS+1),HL
	CP	0F9h
	JR	NZ,LIMODE
ENDLIN: INC	BC
	CALL	SETXY2
	LD	(LINEXE+1),DE
	LD	(LINEYE+1),HL
	CP	0F9h		;-
	JP	Z,NINS		;CONNECT
LIMODE: CP	02Ch		;,
	JP	NZ,SERROR
	INC	BC
	CALL	BCFTC2
	CP	0C7h		;PSET
	JR	Z,MDST2
	CP	0C8h		;PRESET
	LD	A,0
	JR	Z,MDST22
CHRMD1: CALL	STREXX
	OR	A
	JR	Z,L35B4
	LD	A,(DE)
L35B4:	DEC	BC
	LD	(CHRCOD+1),A
	LD	HL,TEXTSB
	JR	MDST3
MDST2:	INC	BC
	LD	HL,PSETSB
MDST3:	LD	(LINEMD+1),HL
	LD	(BOXMD+1),HL
	LD	DE,LINESB
	CALL	EDCEK
	JR	Z,LINE1
	CALL	CH2CH
	INC	BC
	CALL	BCFTC2
	CP	042h		;B/BF
	JR	Z,BBFLMD
	CALL	IBYTE
	CP	9
	JP	NC,IFCALL
	DEC	BC
	DEC	BC
MDST22: LD	(GCOLOR),A
	INC	BC
	LD	DE,LINESB
	CALL	EDCEK
	JR	Z,LINE1
	CALL	CH2CH
	INC	BC
	CALL	BCFTC2
	CP	042h		;B/BF
	JP	NZ,SERROR
BBFLMD: LD	DE,BOX
	INC	BC
	LD	A,(BC)
	CP	046h		;F
	JR	NZ,LINE1
	INC	BC
	LD	DE,BOXFUL
LINE1:	LD	(LNBOXF+1),DE
	PUSH	BC
	CALL	LINES1
	POP	BC
	LD	L,C
	LD	H,B
	RET
;
LINES1: LD	HL,0
	LD	(YINC1+1),HL
	LD	(YINC3+1),HL
	LD	BC,08000h
	LD	(YMOD+1),BC
	LD	(XMOD+1),BC
LINEXS: LD	HL,0		;(XS
	ADD	HL,BC
	EX	DE,HL
LINEXE: LD	HL,255		;-,XE
	ADD	HL,BC
	OR	A
	SBC	HL,DE
	LD	DE,1
	JR	NC,LINEL0
	EX	DE,HL
	SBC	HL,DE
	LD	DE,0FFFFh
LINEL0: PUSH	HL
	LD	(XINC0+1),DE
	LD	A,E
LINEYS: LD	HL,0		;(,YS)
	ADD	HL,BC
	EX	DE,HL
LINEYE: LD	HL,192		;-,YE)
	ADD	HL,BC
	OR	A
	SBC	HL,DE
	LD	DE,1
	JR	NC,LINEL1
	EX	DE,HL
	SBC	HL,DE
	LD	DE,0FFFFh
LINEL1: LD	(YINC2+1),DE
	LD	B,A
	LD	C,E
	POP	DE
LNBOXF: JP	LINESB		;BOX/BOXFUL
LINESB: PUSH	HL
	SBC	HL,DE
	POP	HL
	PUSH	DE
	JR	Z,LINEL2
	JR	NC,LINEL3
	CALL	DIVH$D
	DEC	C
	LD	DE,0
	JR	Z,LINEL4
	XOR	A
	EX	DE,HL
	SBC	HL,DE
	LD	DE,07F7Fh
	LD	(YMOD+1),DE
	LD	DE,0FFFFh
LINEL4: LD	(YINC2+1),DE
	LD	(YINC3+1),HL
LINEL2: POP	BC
	EXX
XMOD:	LD	DE,08000h
YMOD:	LD	HL,08000h
	EXX
	LD	DE,(LINEXS+1)
	LD	HL,(LINEYS+1)
	INC	BC
LINELP: PUSH	BC
	PUSH	DE
	PUSH	HL
LINEMD: CALL	PSETSB		;PSETTX
	POP	HL
	POP	DE
	EXX
YINC3:	LD	BC,00000h
	ADD	HL,BC
	EXX
YINC2:	LD	BC,00001h
	ADC	HL,BC
	EXX
	EX	DE,HL
YINC1:	LD	BC,00000h
	ADD	HL,BC
	EX	DE,HL
	EXX
	EX	DE,HL
XINC0:	LD	BC,00001h
	ADC	HL,BC
	EX	DE,HL
	POP	BC
	DEC	BC
	LD	A,B
	OR	C
	JR	NZ,LINELP
	RET
;
LINEL3: LD	E,L
	LD	D,H
	EX	(SP),HL
	CALL	DIVH$D
	DEC	B
	LD	DE,0
	JR	Z,LINEL5
	XOR	A
	EX	DE,HL
	SBC	HL,DE
	LD	DE,07F7Fh
	LD	(XMOD+1),DE
	LD	DE,0FFFFh
LINEL5: LD	(XINC0+1),DE
	LD	(YINC1+1),HL
	JR	LINEL2
;
; BOX
BOX:	PUSH	DE
	PUSH	BC
	LD	A,023h
	DEC	C
	JR	Z,BOXYAD
	LD	A,02Bh
BOXYAD: LD	(XBOXAD),A
	PUSH	HL
	POP	BC
	LD	DE,(LINEXS+1)
	LD	HL,(LINEYS+1)
	PUSH	BC
	PUSH	HL
	CALL	LINEY
	POP	HL
	POP	BC
	LD	DE,(LINEXE+1)
	CALL	LINEY
	POP	BC
	LD	A,013h
	DEC	B
	JR	Z,BOXXAD
	LD	A,01Bh
BOXXAD: LD	(XBOXAD),A
	POP	BC
	INC	BC
	LD	DE,(LINEXS+1)
	LD	HL,(LINEYS+1)
	PUSH	BC
	PUSH	DE
	CALL	LINEX
	POP	DE
	POP	BC
	LD	HL,(LINEYE+1)
	JP	LINEX
LINEY:	LD	A,B
	OR	C
	RET	Z
	JP	BOXDEC
BOXLOP: PUSH	HL
	PUSH	DE
	PUSH	BC
BOXMD:	CALL	PSETSB		;PSETTX
	POP	BC
	POP	DE
	POP	HL
BOXDEC: DEC	BC
XBOXAD: NOP			;INC/DEL DEL/HL
LINEX:	LD	A,B
	OR	C
	JR	NZ,BOXLOP
	RET
;
;
; BOX FU
BOXFUL: LD	A,013h
	DEC	B
	JR	Z,FULAD1
	LD	A,01Bh
FULAD1: LD	(XBOXAD),A
	LD	A,023h
	DEC	C
	JR	Z,FULAD2
	LD	A,02Bh
FULAD2: LD	(FULINC),A
	PUSH	HL
	POP	BC
	INC	BC
	EX	DE,HL
	INC	HL
	LD	(LINEBC+1),HL
	LD	DE,(LINEXS+1)
	LD	HL,(LINEYS+1)
FULLOP: PUSH	DE
	PUSH	BC
LINEBC: LD	BC,00001h
	CALL	LINEX
	POP	BC
	POP	DE
FULINC: INC	HL
	DEC	BC
	LD	A,B
	OR	C
	JP	NZ,FULLOP
	RET
;
DIVH$D: LD	A,H
	OR	L
	RET	Z
	PUSH	BC
	LD	A,17
	EXX
	LD	HL,0
	LD	DE,0
	EXX
DIVLP:	PUSH	HL
	OR	A
	SBC	HL,DE
	EXX
	PUSH	HL
	SBC	HL,DE
	JR	C,DIV01
	EX	(SP),HL
	POP	HL
	EXX
	EX	(SP),HL
	EXX
	PUSH	HL
DIV01:	POP	HL
	EXX
	POP	HL
	CCF
	RL	C
	RL	B
	SLA	L
	RL	H
	EXX
	RL	L
	RL	H
	EXX
	DEC	A
	JR	NZ,DIVLP
	LD	L,C
	LD	H,B
	POP	BC
	RET
;
;
TEXTSB: XOR	A
	CP	D
	RET	NZ
	CP	H
	RET	NZ
	LD	D,L
	LD	A,E
	CP	32
	RET	NC
	LD	A,D
	CP	16
	RET	NC
	EX	DE,HL
	CALL	ADRCA2
CHRCOD: LD	A,041h		;"A"
	JP	BCOUTA
;
CIRCLE: LD	C,L
	LD	B,H
	CALL	SETXY2
	CALL	CH2CH
	INC	BC
	LD	(SINSX+1),DE
	LD	(SINSY+1),HL
	LD	A,(BC)
	CP	05Bh		;[
	JR	NZ,CIRRST
	INC	BC
	CALL	IHLEXP
	CALL	CH2CH
	PUSH	HL
	CALL	IHLEXP
	CP	05Dh		;]
	JP	NZ,SERROR
	POP	DE
	JR	CRRROK
CIRRST: CALL	IHLEXP
	DEC	BC
	LD	D,H
	LD	E,L
CRRROK: LD	(SINRX+1),DE
	LD	(SINRY+1),HL
	CALL	EDCEK
	LD	HL,10
	JR	Z,POLYE1
	CALL	CH2CH
	INC	BC
	CALL	IHLEXP
	LD	(SIND+1),HL
	DEC	BC
	CALL	EDCEK
	JR	Z,POLYE2
	INC	BC
	LD	A,(BC)
	CP	02Ch
	LD	A,(COLORF)
	JR	Z,SKPCOL
	CALL	IBYTE
	CP	9
	JP	NC,IFCALL
	DEC	BC
SKPCOL: LD	(GCOLOR),A
	LD	A,(BC)
	CALL	EDCEK
	JR	Z,POLYE3
	CALL	CH2CH
	INC	BC
	CALL	IHLEXP
	LD	(SINSTA+1),HL
	DEC	BC
	CALL	EDCEK
	JR	Z,POLYE4
	CALL	CH2CH
	INC	BC
	CALL	IHLEXP
	DEC	BC
	JR	POLYE5
;
POLYE1: LD	(SIND+1),HL
POLYE2: LD	A,(COLORF)
	LD	(GCOLOR),A
POLYE3: LD	HL,0
	LD	(SINSTA+1),HL
POLYE4: LD	HL,360
POLYE5: LD	(SINEND+1),HL
	PUSH	BC
	LD	HL,LINESB
	LD	(LNBOXF+1),HL
	LD	HL,PSETSB
	LD	(LINEMD+1),HL
	LD	HL,(SIND+1)
	LD	A,H
	OR	L
	JR	Z,POLYLN
	CALL	SINSTA
	POP	HL
	RET
POLYLN: LD	HL,(SINSX+1)
	LD	(LINEXS+1),HL
	LD	HL,(SINSY+1)
	LD	(LINEYS+1),HL
	LD	HL,(SINSTA+1)
	CALL	SINXYS
	CALL	LINES1
	POP	HL
	RET
;
SINSTA: LD	HL,0		;DEG START
	PUSH	HL
	CALL	SINXYS
CIRCLP: LD	HL,(LINEXE+1)
	LD	(LINEXS+1),HL
	LD	HL,(LINEYE+1)
	LD	(LINEYS+1),HL
	POP	HL
SIND:	LD	BC,00001h	;DEG STEP
	ADD	HL,BC
	PUSH	HL
	LD	BC,08000h
	ADD	HL,BC
SINEND: LD	DE,360		;DEG END
	EX	DE,HL
	ADD	HL,BC
	OR	A
	SBC	HL,DE
	POP	HL
	RET	C
	PUSH	HL
	CALL	SINXYS
	CALL	LINES1
	JR	CIRCLP
;
SINXYS: BIT	7,H		;HL=DEG
	JR	Z,SIN!
	LD	DE,360
L38C6:	ADD	HL,DE
	JR	NC,L38C6
	JR	SINOK
SIN!:	LD	DE,0FE98h	;-360
L38CE:	ADD	HL,DE
	JR	C,L38CE
	LD	DE,360
	ADD	HL,DE
SINOK:	LD	A,H
	OR	L
	JP	Z,SIN00
	LD	DE,1
	LD	BC,90
	SBC	HL,BC
	JP	Z,SIN90
	JR	C,SIN45
	SBC	HL,BC
	JP	Z,SIN180
	JR	C,SIN135
	SBC	HL,BC
	JP	Z,SIN270
	JR	C,SIN225
	LD	BC,00000h	;X>0,Y>0
	JR	SINOK1
SIN45:	EX	DE,HL		;0-90
	SBC	HL,DE
	LD	BC,000FFh	;X>0,Y<0
	JR	SINOK1
SIN135: ADD	HL,BC		;180-90
	LD	BC,0FFFFh	;X<0,Y<0
	JR	SINOK1
SIN225: EX	DE,HL
	SBC	HL,DE
	LD	BC,0FF00h	;X<0,Y>0
SINOK1: ADD	HL,HL
	EX	DE,HL
	LD	A,B
	LD	(XMULHI+1),A
	LD	A,C
	LD	(YMULHI+1),A
	LD	HL,SINTBL
	ADD	HL,DE
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	INC	B
	JR	NZ,SINXOK
	PUSH	DE
	LD	DE,0
	EX	DE,HL
	SBC	HL,DE
	POP	DE
SINXOK: LD	(XMULLO+1),HL
	LD	HL,COSTBL
	OR	A
	SBC	HL,DE
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	INC	C
	JR	NZ,SINYOK
	PUSH	DE
	LD	DE,0
	EX	DE,HL
	SBC	HL,DE
	POP	DE
SINYOK: LD	(YMULLO+1),HL
XMULHI: LD	L,0
	LD	H,L
	EXX
XMULLO: LD	HL,0
	EXX
	CALL	DEHLMX
	LD	(SINXAD+1),HL
YMULHI: LD	L,0
	LD	H,L
	EXX
YMULLO: LD	HL,0
	EXX
	CALL	DEHLMY
	LD	(SINYAD+1),HL
	JR	SINXAD
SIN00:	LD	BC,00100H	;X=1,Y=0
	JR	SINJST
SIN90:	LD	BC,000FFh	;X=0,Y=-1
	JR	SINJST
SIN180: LD	BC,0FF00h	;X=0,Y=0
	JR	SINJST
SIN270: LD	BC,00001h	;X=0,Y=1
SINJST: LD	A,B
	CALL	RMULAX
	LD	(SINXAD+1),HL
	LD	A,C
	CALL	RMULAY
	LD	(SINYAD+1),HL
SINXAD: LD	HL,00000h	;ADD X
WIDTH3: NOP			;40/ADD HL,HL
SINSX:
	LD	DE,00000h	;CENTER X
	ADD	HL,DE
	LD	(LINEXE+1),HL
SINSY:	LD	HL,00000h	;CENTER Y
SINYAD: LD	DE,00000h	;ADD Y
	ADD	HL,DE
	LD	(LINEYE+1),HL
	RET
;
RMULAY: LD	HL,0
	OR	A
	RET	Z
	EX	DE,HL
	LD	HL,(SINRY+1)
	JR	RMULXY
RMULAX: LD	HL,0
	OR	A
	RET	Z
	EX	DE,HL
	LD	HL,(SINRX+1)
RMULXY: INC	A
	RET	NZ
	EX	DE,HL
	SBC	HL,DE
	RET
;
DEHLMX: EXX
SINRX:	LD	BC,00001h	;XR
	JR	DEHLMS
DEHLMY: EXX
SINRY:	LD	BC,00001h	;YR
DEHLMS: LD	DE,0
	EXX
	LD	B,16
	LD	DE,0
MULOP1: EXX
	EX	DE,HL
	ADD	HL,HL
	EX	DE,HL
	EXX
	EX	DE,HL
	ADC	HL,HL
	EX	DE,HL
	EXX
	SLA	C
	RL	B
	JR	NC,MULOP2
	EX	DE,HL
	ADD	HL,DE
	EX	DE,HL
	EXX
	EX	DE,HL
	ADC	HL,DE
	EX	DE,HL
	EXX
MULOP2: EXX
	DJNZ	MULOP1
	LD	A,080h
	BIT	7,D
	EXX
	JR	Z,MULOP3
	CPL
MULOP3: LD	H,A
	LD	L,A
	ADD	HL,DE
	EXX
	LD	HL,0
	ADC	HL,DE
	RET
;
SINTBL: DEFW	0
	DEFW	00478H
	DEFW	008F0H
	DEFW	00D66H
	DEFW	011DCH
	DEFW	01650H
	DEFW	01AC3H
	DEFW	01F33H
	DEFW	023A1H
	DEFW	0280CH
	DEFW	02C75H
	DEFW	030D9H
	DEFW	0353AH
	DEFW	03997H
	DEFW	03DEFH
	DEFW	04242H
	DEFW	04691H
	DEFW	04AD9H
	DEFW	04F1CH
	DEFW	05359H
	DEFW	0578FH
	DEFW	05BBEH
	DEFW	05FE7H
	DEFW	06407H
	DEFW	06820H
	DEFW	06C2FH
	DEFW	07039H
	DEFW	07439H
	DEFW	07830H
	DEFW	07C1DH
	DEFW	08000H
	DEFW	083DAH
	DEFW	087A9H
	DEFW	08B6EH
	DEFW	08F28H
	DEFW	092D6H
	DEFW	09679H
	DEFW	09A11H
	DEFW	09D9CH
	DEFW	0A11BH
	DEFW	0A48EH
	DEFW	0A7F4H
	DEFW	0AB4CH
	DEFW	0AE98H
	DEFW	0B1F0H
	DEFW	0B58BH
	DEFW	0B840H
	DEFW	0BB50H
	DEFW	0BE3FH
	DEFW	0C135H
	DEFW	0C41CH
	DEFW	0C6F3H
	DEFW	0C9BBH
	DEFW	0CC74H
	DEFW	0CF1CH
	DEFW	0D1B4H
	DEFW	0D43CH
	DEFW	0D6B3H
    DEFW    0D91AH
	DEFW	0DB70H
	DEFW	0DDB4H
	DEFW	0DF40H
	DEFW	0E1E0H
	DEFW	0E497H
	DEFW	0E61BH
	DEFW	0E804H
	DEFW	0E9DEH
	DEFW	0EBA7H
	DEFW	0ED5CH
	DEFW	0EEFFH
	DEFW	0F090H
	DEFW	0F20EH
	DEFW	0F379H
	DEFW	0F4D1H
	DEFW	0F616H
	DEFW	0F747H
	DEFW	0F866H
	DEFW	0F971H
	DEFW	0FA68H
	DEFW	0FB4CH
	DEFW	0FC1DH
	DEFW	0FCD9H
	DEFW	0FD83H
	DEFW	0FE18H
	DEFW	0FE99H
	DEFW	0FF07H
	DEFW	0FF61H
	DEFW	0FFA7H
	DEFW	0FFD8H
	DEFW	0FFF6H
COSTBL: DEFW	0
;
PAINT:	LD	C,L
	LD	B,H
	CALL	SETXY2
	PUSH	HL		;Y
	PUSH	DE		;X
	LD	HL,PACOLB
	LD	D,9
	LD	A,(COLORF)
	LD	(HL),A
	CALL	PACOLS
	LD	HL,PACOLB
	LD	E,8
	LD	A,(HL)
PACINT: INC	HL
	LD	(HL),A
	DEC	E
	JR	NZ,PACINT
	LD	HL,PACOLB+1
	JR	L3AD1
PACOSL: CALL	PACOLS
L3AD1:	DEC	D
	JR	NZ,PACOSL
	LD	HL,PSETSB
	LD	(BOXMD+1),HL
	LD	A,013h
	LD	(XBOXAD),A
	LD	A,(PACOLB)
	LD	(GCOLOR),A
	POP	DE
	POP	HL
	PUSH	BC
	CALL	PAINTS
	POP	HL
	RET
;
PACOLS: CALL	EDCEK
	JR	Z,PACEND
	CALL	CH2CH
	INC	BC
	PUSH	DE
	PUSH	HL
	CALL	IBYTE
	POP	HL
	POP	DE
	CP	9
	JP	NC,IFCALL
	LD	(HL),A
	INC	HL
	DEC	BC
	RET
PACEND: LD	D,1
	RET
;
;
PAINTS: LD	BC,08000h
	PUSH	BC
	PUSH	HL
	PUSH	DE
;
PAIN01: POP	DE
	POP	HL
	XOR	A
	CP	E
	JR	NZ,PAIN02
	LD	A,080h
	CP	D
	JR	NZ,PAIN02
	JP	(HL)
;
PAIN02: CALL	POICEK
	JP	Z,PAIN01
PAIN03: DEC	DE		;X=X-1
	CALL	POICEK
	JR	NZ,PAIN03
	INC	DE
	LD	BC,00000h	;FLG CLR
	PUSH	DE
	EXX
	POP	DE		;DE'=STERT X (START의 오타?)
	EXX
PAIN11: CALL	POICEK
	JR	Z,PAIN04
	DEC	HL		;UP LINE CHECK
	CALL	POICEK
	JR	Z,PAIN05
	DEC	B
	JR	Z,PAIN06
	PUSH	HL		;NEXT POINT SET
	PUSH	DE
	CALL	MEMCHK		;SP CHK
PAIN06: LD	B,1		;UP FLAG SET
	JR	PAIN07
PAIN05: LD	B,0		;UP FLAG CLR
PAIN07: INC	HL		;
	INC	HL		;DOUN LINE CHECK (DOWN의 오타?)
	CALL	POICEK
	JR	Z,PAIN08
	DEC	C
	JR	Z,PAIN09
	PUSH	HL		;NEXT POINT SET
	PUSH	DE
	CALL	MEMCHK		;SP CHK
PAIN09: LD	C,1		;DOUN FLG SET
	JR	PAIN10
PAIN08: LD	C,0		;DOUN FLG CLR
PAIN10: DEC	HL
	INC	DE		;X=X+1
	JR	PAIN11
;
PAIN04: PUSH	HL
	PUSH	DE
	EXX
	POP	HL
	OR	A
	SBC	HL,DE
	LD	C,L
	LD	B,H
	POP	HL
	CALL	LINEX
	JP	PAIN01
;
POICEK: PUSH	BC
	PUSH	DE
	PUSH	HL
	CALL	CULADR
	JR	C,POIZER
	EX	DE,HL
	LD	BC,POITBL
	ADD	HL,BC
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	PUSH	BC
	RET
;
POIZER: XOR	A
POINRT: POP	HL
	POP	DE
	POP	BC
	RET
;
POITBL: DEFW	POIST0
	DEFW	POIST1
	DEFW	POIST3
	DEFW	POIST5
;
POIST0: LD	C,E
	LD	B,D
	IN	E,(C)
	RLCA
	RLCA
	RLCA
	AND	038h
	ADD	A,043h
	LD	(BTTST1+1),A
	XOR	A
BTTST1: BIT	0,E
	JR	Z,POINCK
	LD	A,E
	RRCA
	RRCA
	RRCA
	RRCA
	AND	00Fh
	INC	A
POINCK: LD	HL,PACOLB
	LD	B,9
POINC1: CP	(HL)
	JR	Z,POICKR
	INC	HL
	DJNZ	POINC1
POICKR: JP	POINRT
;
POIST1: LD	C,E
	LD	B,D
	IN	E,(C)
	RLCA
	RLCA
	RLCA
	AND	038h
	ADD	A,043h
	LD	(BTTST2+1),A
	XOR	A
BTTST2: BIT	0,E
	JR	Z,POINCK
	LD	A,E
	RLCA
	RLCA
	AND	3
	INC	A
	SET	3,B
	IN	D,(C)
	BIT	1,D
	JR	Z,POINCK
	ADD	A,4
	JR	POINCK
;
POIST3: LD	C,E
	LD	B,D
	IN	E,(C)
	AND	3
	JR	Z,POIS33
POIS3L: RL	E
	RL	E
	DEC	A
	JR	NZ,POIS3L
POIS33: XOR	A
	RL	E
	RLA
	RL	E
	RLA
	JR	POINCK
;
POIST5: LD	C,E
	LD	B,D
	IN	E,(C)
	AND	7
	JR	Z,POIS55
POIS5L: RL	E
	DEC	A
	JR	NZ,POIS5L
POIS55: XOR	A
	RL	E
	RLA
	JR	POINCK
;
;
PACOLB: DEFS	9
;
PATTEN: LD	A,(GMODEF)
	CP	4
	JP	C,IFCALL
	LD	C,L
	LD	B,H
	CALL	SETXY2
	CALL	CH2CH
	LD	(PATX+1),DE
	LD	(PATY+1),HL
	INC	BC
	CALL	IHLEXP
	CALL	CH2CH
	LD	A,H
	OR	A
	LD	DE,0FFE0h
	JR	Z,PATOK1
	CP	0FFh
	JP	NZ,IFCALL
	LD	DE,00020h
	LD	A,L
	NEG
	LD	L,A
PATOK1: LD	(PATYAD+1),DE
	LD	A,L
	OR	A
	JP	Z,IFCALL
	LD	(PATYLN+1),A
	CALL	STREXX
	PUSH	BC
	LD	B,A
	OR	A
	CALL	NZ,PATSUB
	POP	HL
	DEC	HL
	RET
;
PATSUB: EXX
PATX:	LD	DE,0
	LD	A,D
	OR	A
	RET	NZ
PATY:	LD	HL,0
	LD	A,H
	OR	A
	RET	NZ
	LD	A,L
	CP	192
	RET	NC
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	ADD	HL,HL
	LD	A,E
	SRL	E
	SRL	E
	SRL	E
	ADD	HL,DE
	LD	C,L
	LD	B,H
	AND	7
	LD	D,080h
	JR	Z,PATYLN
L3C81:	SRL	D
	DEC	A
	JR	NZ,L3C81
PATYLN: LD	E,1
	PUSH	BC
PATLP1: EXX
	LD	A,(DE)
	EXX
	CALL	PATST
PATYAD: LD	HL,00020h
	ADD	HL,BC
	LD	C,L
	LD	B,H
	EXX
	INC	DE
	DEC	B
	JR	Z,PATEND
	EXX
	DEC	E
	JR	NZ,PATLP1
	POP	BC
	INC	BC
	JR	PATYLN
PATEND: POP	BC
	RET
;
PATST:	PUSH	BC
	PUSH	DE
	LD	L,A
	LD	H,8
PATSTL: RLC	L
	JR	NC,L3CB2
	IN	A,(C)
	OR	D
	OUT	(C),A
L3CB2:	RRC	D
	JR	NC,L3CB7
	INC	BC
L3CB7:	DEC	H
	JR	NZ,PATSTL
	POP	DE
	POP	BC
	RET
;
;
;
HCOPY:	PUSH	HL
	LD	A,01Bh		;ESC
	CALL	PRINTR
	LD	A,041h		;A
	CALL	PRINTR
	LD	A,007h		;7
	CALL	PRINTR
	LD	A,(GMODEF)
	CP	2
	JR	NC,COPYGM
	LD	HL,COPYTX
	LD	DE,COPYTA
	LD	BC,(CHRSTA)
	JR	COPYM4
COPYGM: LD	HL,COPYGR
	LD	DE,COPYGA
	LD	BC,0
COPYM4: LD	(COPYM2+1),HL
	LD	(COPYM3+1),DE
	LD	D,0
HCOPY1: CALL	PRTESC
	LD	E,32
HCOPY2: PUSH	BC
	PUSH	DE
COPYM2: CALL	COPYGR
	LD	B,8
HCOPY3: XOR	A
	RLCA
	RLCA
	RLC	E
	JR	NC,L3D07
	ADD	A,3
L3D07:	RLCA
	RLCA
	RLC	D
	JR	NC,L3D0F
	ADD	A,3
L3D0F:	RLCA
	RLCA
	RLC	L
	JR	NC,L3D17
	ADD	A,3
L3D17:	RLCA
	RLCA
	RLC	H
	JR	NC,L3D1F
	ADD	A,3
L3D1F:	EXX
	PUSH	AF
	CALL	PRINTR
	POP	AF
	PUSH	AF
	CALL	PRINTR
	POP	AF
	CALL	PRINTR
	EXX
	DJNZ	HCOPY3
	POP	DE
	POP	BC
	INC	BC
	DEC	E
	JR	NZ,HCOPY2
COPYM3: CALL	COPYGA
	ADD	HL,BC
	LD	C,L
	LD	B,H
	LD	A,00Ah
	EXX
	CALL	PRINTR
	EXX
	INC	D
	LD	A,D
	CP	48
	JR	NZ,HCOPY1
	LD	A,01Bh
	CALL	PRINTR
	LD	A,032h
	CALL	PRINTR
	POP	HL
	RET
;
COPYGA: LD	HL,00060h
	RET
;
COPYTA: LD	A,D
COPYTL: SUB	3
	JR	NC,COPYTL
	CP	0FFh
	LD	HL,0
	RET	Z
	LD	HL,0FFE0h
	RET
;
PRTESC: EXX
	LD	A,01Bh
	CALL	PRINTR
	LD	A,04Ch		;L
	CALL	PRINTR
	LD	A,0
	CALL	PRINTR
	LD	A,3
	CALL	PRINTR
	EXX
	RET
;
COPYGR: IN	E,(C)
	LD	A,020h
	ADD	A,C
	LD	C,A
	IN	D,(C)
	LD	A,020h
	ADD	A,C
	LD	C,A
	IN	L,(C)
	LD	A,020h
	ADD	A,C
	LD	C,A
	IN	H,(C)
	RET
;
;
;
COPYTX: IN	H,(C)
	SET	3,B
	IN	A,(C)
	AND	00Fh
	SUB	4
	JR	C,ROMTX
	SUB	4
	JR	C,LGR22
	SUB	4
	JR	C,RAMTX
	LD	A,D
SUB3L:	SUB	3
	JR	NC,SUB3L
	ADD	A,3
	LD	B,A
	INC	B
	JR	L3DB7
LGR23L: RRC	H
	RRC	H
L3DB7:	DJNZ	LGR23L
LGR223: CALL	RRCHAS
	LD	E,A
	LD	D,A
	LD	L,A
	LD	H,A
	RET
;
LGR22:	LD	A,D
SUB3L1: SUB	3
	JR	NC,SUB3L1
	ADD	A,3
	JR	Z,LGR223
	CP	2
	JR	NZ,LGR232
	RRC	H
	RRC	H
	JR	LGR223
LGR232: CALL	RRCHAS
	LD	E,A
	LD	D,A
	CALL	RRCHAS
	LD	L,A
	LD	H,A
	RET
;
ROMTX:	LD	A,H
	AND	07Fh
	SUB	020h
	JR	NC,L3DE7
	XOR	A
L3DE7:	LD	H,A
	CALL	TXCULC
	LD	D,0
	ADD	HL,DE
	LD	DE,CGCHR
	ADD	HL,DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	RET
;
RAMTX:	CALL	TXCULC
	ADD	HL,BC
	LD	D,010h
	ADD	HL,DE
	LD	C,L
	LD	B,H
	IN	E,(C)
	INC	BC
	IN	D,(C)
	INC	BC
	IN	L,(C)
	INC	BC
	IN	H,(C)
	RET
;
TXCULC: LD	A,D
SUB3L2: SUB	3
	JR	NC,SUB3L2
	ADD	A,003h
	RLCA
	RLCA
	LD	E,A
	LD	A,H
	AND	07Fh
	LD	L,A
	LD	H,0
	ADD	HL,HL
	ADD	HL,HL
	LD	C,L
	LD	B,H
	ADD	HL,HL
	ADD	HL,BC
	RET
;
RRCHAS: XOR	A
	RRC	H
	JR	NC,L3E2E
	LD	A,00Fh
L3E2E:	RRC	H
	RET	NC
	ADD	A,0F0h
	RET

;
;	ORG	0524AH
;    
CGCHR:
;CHR$(&H20)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H21)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H22)
	DEFB	000H
	DEFB	000H
	DEFB	028H
	DEFB	028H
	DEFB	028H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H23)
	DEFB	000H
	DEFB	000H
	DEFB	024H
	DEFB	024H
	DEFB	07EH
	DEFB	024H
	DEFB	07EH
	DEFB	024H
	DEFB	024H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H24)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	03CH
	DEFB	050H
	DEFB	038H
	DEFB	014H
	DEFB	078H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H25)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	062H
	DEFB	064H
	DEFB	008H
	DEFB	010H
	DEFB	026H
	DEFB	046H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H26)
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	048H
	DEFB	048H
	DEFB	030H
	DEFB	04AH
	DEFB	044H
	DEFB	03AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H27)	'
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	010H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H28)	(
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	010H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	010H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H29)	)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	010H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	010H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2A)	*
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	054H
	DEFB	038H
	DEFB	07CH
	DEFB	038H
	DEFB	054H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2B)	+
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2C)	,
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	010H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2D)	-
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2E)	.
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	030H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H2F)	/
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	002H
	DEFB	004H
	DEFB	008H
	DEFB	010H
	DEFB	020H
	DEFB	040H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H30)	0
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	046H
	DEFB	05AH
	DEFB	062H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H31)	1
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	030H
	DEFB	050H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	07CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H32)	2
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	002H
	DEFB	00CH
	DEFB	030H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H33)	3
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	002H
	DEFB	03CH
	DEFB	002H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H34)	4
	DEFB	000H
	DEFB	000H
	DEFB	004H
	DEFB	00CH
	DEFB	014H
	DEFB	024H
	DEFB	07EH
	DEFB	004H
	DEFB	004H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H35)	5
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	040H
	DEFB	078H
	DEFB	004H
	DEFB	002H
	DEFB	044H
	DEFB	038H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H36)	6
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	020H
	DEFB	040H
	DEFB	07CH
	DEFB	042H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H37)	7
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	042H
	DEFB	004H
	DEFB	008H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H38)	8
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	042H
	DEFB	03CH
	DEFB	042H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H39)	9
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	042H
	DEFB	03EH
	DEFB	002H
	DEFB	004H
	DEFB	038H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3A)	:
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	030H
	DEFB	000H
	DEFB	030H
	DEFB	030H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3B)	;
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	030H
	DEFB	000H
	DEFB	030H
	DEFB	010H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3C)	<
	DEFB	000H
	DEFB	000H
	DEFB	00EH
	DEFB	018H
	DEFB	030H
	DEFB	060H
	DEFB	030H
	DEFB	018H
	DEFB	00EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3D)	=
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	000H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3E)	>
	DEFB	000H
	DEFB	000H
	DEFB	070H
	DEFB	018H
	DEFB	00CH
	DEFB	006H
	DEFB	00CH
	DEFB	018H
	DEFB	070H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H3F)	?
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	002H
	DEFB	00CH
	DEFB	010H
	DEFB	000H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H40)	@
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	04AH
	DEFB	056H
	DEFB	04CH
	DEFB	020H
	DEFB	01EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H41)	A
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	024H
	DEFB	042H
	DEFB	07EH
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H42)	B
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	042H
	DEFB	042H
	DEFB	07CH
	DEFB	042H
	DEFB	042H
	DEFB	07CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H43)	C
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	022H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H44)	D
	DEFB	000H
	DEFB	000H
	DEFB	078H
	DEFB	024H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	024H
	DEFB	078H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H45)	E
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	040H
	DEFB	040H
	DEFB	078H
	DEFB	040H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H46)	F
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	040H
	DEFB	040H
	DEFB	078H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H47)	G
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	040H
	DEFB	04EH
	DEFB	042H
	DEFB	022H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H48)	H
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	07EH
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H49)	I
	DEFB	000H
	DEFB	000H
	DEFB	038H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	038H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4A)	J
	DEFB	000H
	DEFB	000H
	DEFB	00EH
	DEFB	004H
	DEFB	004H
	DEFB	004H
	DEFB	004H
	DEFB	044H
	DEFB	038H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4B)	K
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	044H
	DEFB	048H
	DEFB	070H
	DEFB	048H
	DEFB	044H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4C)	L
	DEFB	000H
	DEFB	000H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4D)	M
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	066H
	DEFB	05AH
	DEFB	05AH
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4E)	N
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	062H
	DEFB	052H
	DEFB	04AH
	DEFB	046H
	DEFB	042H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H4F)	O
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	024H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	024H
	DEFB	018H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H50)	P
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	042H
	DEFB	042H
	DEFB	07CH
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H51)	Q
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	024H
	DEFB	042H
	DEFB	042H
	DEFB	04AH
	DEFB	024H
	DEFB	01AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H52)	R
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	042H
	DEFB	042H
	DEFB	07CH
	DEFB	048H
	DEFB	044H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H53)	S
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	040H
	DEFB	03CH
	DEFB	002H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H54)	T
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H55)	U
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H56)	V
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	024H
	DEFB	024H
	DEFB	018H
	DEFB	018H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H57)	W
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	05AH
	DEFB	05AH
	DEFB	066H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H58)	X
	DEFB	000H
	DEFB	000H
	DEFB	042H
	DEFB	042H
	DEFB	024H
	DEFB	018H
	DEFB	024H
	DEFB	042H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H59)	Y
	DEFB	000H
	DEFB	000H
	DEFB	044H
	DEFB	044H
	DEFB	044H
	DEFB	038H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H5A)	Z
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	002H
	DEFB	004H
	DEFB	018H
	DEFB	020H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H5B)	[
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H5C)
	DEFB	000H
	DEFB	080H
	DEFB	080H
	DEFB	040H
	DEFB	020H
	DEFB	010H
	DEFB	008H
	DEFB	004H
	DEFB	002H
	DEFB	001H
	DEFB	001H
	DEFB	000H
;
;CHR$(&H5D)	]
	DEFB	000H
	DEFB	000H
	DEFB	078H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	078H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H5E)	↑
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H5F)	←
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	040H
	DEFB	0FEH
	DEFB	040H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;
;
$CGBUF:
;
;CHR$(&H80)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H81)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	042H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H82)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	07EH
	DEFB	07EH
	DEFB	07EH
	DEFB	07EH
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H83)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	02AH
	DEFB	01CH
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H84)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	004H
	DEFB	07EH
	DEFB	004H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H85)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	0F0H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H86)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0F0H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H87)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01FH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H88)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	01FH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H89)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0FFH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H8A)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H8B)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	0FFH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H8C)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0FFH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H8D)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	0FFH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H8E)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0F0H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H8F)
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	01FH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H90)
	DEFB	000H
	DEFB	072H
	DEFB	08AH
	DEFB	08AH
	DEFB	072H
	DEFB	002H
	DEFB	03EH
	DEFB	002H
	DEFB	03EH
	DEFB	020H
	DEFB	03EH
	DEFB	000H
;
;CHR$(&H91)
	DEFB	000H
	DEFB	072H
	DEFB	08AH
	DEFB	072H
	DEFB	0FAH
	DEFB	02EH
	DEFB	042H
	DEFB	03EH
	DEFB	03EH
	DEFB	020H
	DEFB	03EH
	DEFB	000H
;
;CHR$(&H92)
	DEFB	000H
	DEFB	022H
	DEFB	022H
	DEFB	0FAH
	DEFB	002H
	DEFB	072H
	DEFB	08BH
	DEFB	08AH
	DEFB	072H
	DEFB	022H
	DEFB	0FAH
	DEFB	000H
;
;CHR$(&H93)
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	0FEH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
;
;CHR$(&H94)
	DEFB	000H
	DEFB	07CH
	DEFB	044H
	DEFB	07CH
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
	DEFB	07CH
	DEFB	004H
	DEFB	004H
	DEFB	004H
	DEFB	000H
;
;CHR$(&H95)
	DEFB	000H
	DEFB	07CH
	DEFB	004H
	DEFB	004H
	DEFB	000H
	DEFB	0FEH
	DEFB	000H
	DEFB	07CH
	DEFB	044H
	DEFB	044H
	DEFB	07CH
	DEFB	000H
;
;CHR$(&H96)
	DEFB	000H
	DEFB	07CH
	DEFB	040H
	DEFB	078H
	DEFB	040H
	DEFB	040H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
;
;CHR$(&H97)
	DEFB	000H
	DEFB	082H
	DEFB	08EH
	DEFB	082H
	DEFB	08EH
	DEFB	082H
	DEFB	0FAH
	DEFB	002H
	DEFB	040H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
;
;CHR$(&H98)
	DEFB	000H
	DEFB	002H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	052H
	DEFB	052H
	DEFB	08AH
	DEFB	08AH
	DEFB	002H
	DEFB	002H
	DEFB	000H
;
;CHR$(&H99)
	DEFB	000H
	DEFB	044H
	DEFB	07CH
	DEFB	044H
	DEFB	07CH
	DEFB	000H
	DEFB	0FEH
	DEFB	010H
	DEFB	050H
	DEFB	040H
	DEFB	07CH
	DEFB	000H
;
;CHR$(&H9A)
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
;
;CHR$(&H9B)
	DEFB	000H
	DEFB	001H
	DEFB	005H
	DEFB	0F5H
	DEFB	015H
	DEFB	015H
	DEFB	017H
	DEFB	025H
	DEFB	045H
	DEFB	085H
	DEFB	005H
	DEFB	000H
;
;CHR$(&H9C)
	DEFB	000H
	DEFB	001H
	DEFB	005H
	DEFB	0F5H
	DEFB	085H
	DEFB	085H
	DEFB	087H
	DEFB	085H
	DEFB	0F5H
	DEFB	005H
	DEFB	005H
	DEFB	000H
;
;CHR$(&H9D)
	DEFB	000H
	DEFB	002H
	DEFB	072H
	DEFB	08AH
	DEFB	08AH
	DEFB	08AH
	DEFB	072H
	DEFB	002H
	DEFB	042H
	DEFB	040H
	DEFB	07EH
	DEFB	000H
;
;CHR$(&H9E)
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	040H
	DEFB	040H
	DEFB	040H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
;
;CHR$(&H9F)
	DEFB	000H
	DEFB	002H
	DEFB	072H
	DEFB	08AH
	DEFB	072H
	DEFB	0FAH
	DEFB	02EH
	DEFB	042H
	DEFB	022H
	DEFB	020H
	DEFB	03EH
	DEFB	000H
;
;CHR$(&HA0)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03EH
	DEFB	022H
	DEFB	03EH
	DEFB	022H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA1)
	DEFB	000H
	DEFB	000H
	DEFB	03EH
	DEFB	022H
	DEFB	03EH
	DEFB	022H
	DEFB	03EH
	DEFB	022H
	DEFB	042H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA2)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	054H
	DEFB	054H
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA3)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	012H
	DEFB	0FCH
	DEFB	038H
	DEFB	034H
	DEFB	052H
	DEFB	091H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA4)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	010H
	DEFB	038H
	DEFB	054H
	DEFB	092H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA5)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	028H
	DEFB	07CH
	DEFB	092H
	DEFB	07CH
	DEFB	054H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA6)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA7)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	07EH
	DEFB	080H
	DEFB	07CH
	DEFB	050H
	DEFB	0FEH
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA8)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	0FCH
	DEFB	0A8H
	DEFB	0FEH
	DEFB	0A4H
	DEFB	0FEH
	DEFB	014H
	DEFB	004H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HA9)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	0FEH
	DEFB	014H
	DEFB	024H
	DEFB	048H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAA)
	DEFB	000H
	DEFB	000H
	DEFB	074H
	DEFB	024H
	DEFB	0F5H
	DEFB	065H
	DEFB	0B2H
	DEFB	0A4H
	DEFB	028H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAB)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	054H
	DEFB	092H
	DEFB	030H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAC)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAD)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAE)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	028H
	DEFB	07CH
	DEFB	082H
	DEFB	07CH
	DEFB	044H
	DEFB	07CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HAF)
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	044H
	DEFB	0A8H
	DEFB	010H
	DEFB	03EH
	DEFB	0E2H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&H90)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	07FH
	DEFB	008H
	DEFB	07FH
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB1)
	DEFB	000H
	DEFB	000H
	DEFB	006H
	DEFB	018H
	DEFB	020H
	DEFB	018H
	DEFB	006H
	DEFB	000H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB2)
	DEFB	000H
	DEFB	000H
	DEFB	030H
	DEFB	00CH
	DEFB	002H
	DEFB	00CH
	DEFB	030H
	DEFB	000H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB3)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	008H
	DEFB	03EH
	DEFB	008H
	DEFB	008H
	DEFB	000H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB4)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	014H
	DEFB	008H
	DEFB	014H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB5)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03EH
	DEFB	049H
	DEFB	07FH
	DEFB	049H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB6)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB7)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	014H
	DEFB	022H
	DEFB	07FH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB8)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07FH
	DEFB	022H
	DEFB	014H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HB9)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HBA)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	000H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HBB)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HBC)
	DEFB	00CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	060H
;
;CHR$(&HBD)
	DEFB	000H
	DEFB	00FH
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	048H
	DEFB	0A8H
	DEFB	018H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HBE)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07EH
	DEFB	020H
	DEFB	010H
	DEFB	020H
	DEFB	07EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HBF)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03EH
	DEFB	014H
	DEFB	014H
	DEFB	014H
	DEFB	014H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC0)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	090H
	DEFB	090H
	DEFB	060H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC1)
	DEFB	000H
	DEFB	020H
	DEFB	060H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC2)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	020H
	DEFB	040H
	DEFB	0F0H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC3)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	020H
	DEFB	090H
	DEFB	060H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC4)
	DEFB	000H
	DEFB	060H
	DEFB	0A0H
	DEFB	0A0H
	DEFB	0F0H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC5)
	DEFB	000H
	DEFB	0F0H
	DEFB	080H
	DEFB	0F0H
	DEFB	010H
	DEFB	0E0H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC6)
	DEFB	000H
	DEFB	060H
	DEFB	080H
	DEFB	0F0H
	DEFB	090H
	DEFB	060H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC7)
	DEFB	000H
	DEFB	0F0H
	DEFB	010H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC8)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	060H
	DEFB	090H
	DEFB	060H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HC9)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	0F0H
	DEFB	010H
	DEFB	060H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCA)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	002H
	DEFB	034H
	DEFB	048H
	DEFB	048H
	DEFB	036H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCB)
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	024H
	DEFB	038H
	DEFB	024H
	DEFB	024H
	DEFB	038H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCC)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	04EH
	DEFB	030H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCD)
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	024H
	DEFB	024H
	DEFB	03CH
	DEFB	024H
	DEFB	024H
	DEFB	018H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCE)
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	020H
	DEFB	020H
	DEFB	018H
	DEFB	024H
	DEFB	024H
	DEFB	018H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HCF)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	01CH
	DEFB	02AH
	DEFB	02AH
	DEFB	01CH
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD0)
	DEFB	080H
	DEFB	040H
	DEFB	040H
	DEFB	020H
	DEFB	010H
	DEFB	010H
	DEFB	008H
	DEFB	004H
	DEFB	004H
	DEFB	002H
	DEFB	001H
	DEFB	001H
;
;CHR$(&HD1)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD2)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	000H
	DEFB	000H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD3)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	000H
	DEFB	07CH
	DEFB	000H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD4)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	0FEH
	DEFB	0AAH
	DEFB	0AAH
	DEFB	0AAH
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD5)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	07CH
	DEFB	010H
	DEFB	07CH
	DEFB	014H
	DEFB	014H
	DEFB	0FEH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD6)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	0FEH
	DEFB	000H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD7)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	0FEH
	DEFB	020H
	DEFB	020H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD8)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	028H
	DEFB	044H
	DEFB	082H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HD9)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	020H
	DEFB	0FCH
	DEFB	024H
	DEFB	024H
	DEFB	044H
	DEFB	086H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDA)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	036H
	DEFB	049H
	DEFB	036H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDB)
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	020H
	DEFB	018H
	DEFB	024H
	DEFB	018H
	DEFB	004H
	DEFB	018H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDC)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	022H
	DEFB	014H
	DEFB	049H
	DEFB	014H
	DEFB	022H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDD)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	038H
	DEFB	000H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDE)
	DEFB	000H
	DEFB	060H
	DEFB	090H
	DEFB	06EH
	DEFB	011H
	DEFB	010H
	DEFB	010H
	DEFB	011H
	DEFB	00EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HDF)
	DEFB	001H
	DEFB	002H
	DEFB	002H
	DEFB	004H
	DEFB	008H
	DEFB	008H
	DEFB	010H
	DEFB	020H
	DEFB	020H
	DEFB	040H
	DEFB	080H
	DEFB	080H
;
;CHR$(&HE0)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	010H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE1)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03CH
	DEFB	002H
	DEFB	01EH
	DEFB	022H
	DEFB	01FH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE2)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	020H
	DEFB	02CH
	DEFB	032H
	DEFB	022H
	DEFB	032H
	DEFB	02CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE3)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	020H
	DEFB	022H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE4)
	DEFB	000H
	DEFB	000H
	DEFB	002H
	DEFB	002H
	DEFB	01AH
	DEFB	026H
	DEFB	022H
	DEFB	026H
	DEFB	01AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE5)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	03EH
	DEFB	020H
	DEFB	01EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE6)
	DEFB	000H
	DEFB	000H
	DEFB	00CH
	DEFB	010H
	DEFB	010H
	DEFB	07CH
	DEFB	010H
	DEFB	010H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE7)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01AH
	DEFB	026H
	DEFB	022H
	DEFB	026H
	DEFB	01AH
	DEFB	002H
	DEFB	01CH
	DEFB	000H
;
;CHR$(&HE8)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	020H
	DEFB	02CH
	DEFB	032H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HE9)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	000H
	DEFB	018H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HEA)
	DEFB	000H
	DEFB	000H
	DEFB	004H
	DEFB	000H
	DEFB	00CH
	DEFB	004H
	DEFB	004H
	DEFB	004H
	DEFB	024H
	DEFB	018H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HEB)
	DEFB	000H
	DEFB	000H
	DEFB	020H
	DEFB	020H
	DEFB	022H
	DEFB	024H
	DEFB	028H
	DEFB	034H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HEC)
	DEFB	000H
	DEFB	000H
	DEFB	018H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	008H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HED)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	076H
	DEFB	049H
	DEFB	049H
	DEFB	049H
	DEFB	049H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HEE)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	02CH
	DEFB	032H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HEF)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01CH
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	01CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF0)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	02CH
	DEFB	032H
	DEFB	022H
	DEFB	032H
	DEFB	02CH
	DEFB	020H
	DEFB	020H
	DEFB	000H
;
;CHR$(&HF1)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01AH
	DEFB	026H
	DEFB	022H
	DEFB	026H
	DEFB	01AH
	DEFB	002H
	DEFB	002H
	DEFB	000H
;
;CHR$(&HF2)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	02EH
	DEFB	030H
	DEFB	020H
	DEFB	020H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF3)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	01EH
	DEFB	020H
	DEFB	01CH
	DEFB	002H
	DEFB	03CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF4)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	010H
	DEFB	038H
	DEFB	010H
	DEFB	010H
	DEFB	012H
	DEFB	00CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF5)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	026H
	DEFB	01AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF6)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	014H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF7)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	049H
	DEFB	049H
	DEFB	049H
	DEFB	049H
	DEFB	036H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF8)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	014H
	DEFB	008H
	DEFB	014H
	DEFB	022H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HF9)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	022H
	DEFB	022H
	DEFB	022H
	DEFB	026H
	DEFB	01AH
	DEFB	002H
	DEFB	01CH
	DEFB	000H
;
;CHR$(&HFA)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	03EH
	DEFB	004H
	DEFB	008H
	DEFB	010H
	DEFB	03EH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HFB)
	DEFB	000H
	DEFB	000H
	DEFB	008H
	DEFB	010H
	DEFB	010H
	DEFB	020H
	DEFB	010H
	DEFB	010H
	DEFB	008H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HFC)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	054H
	DEFB	0FEH
	DEFB	054H
	DEFB	0FEH
	DEFB	054H
	DEFB	028H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HFD)
	DEFB	000H
	DEFB	000H
	DEFB	010H
	DEFB	008H
	DEFB	008H
	DEFB	004H
	DEFB	008H
	DEFB	008H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HFE)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	032H
	DEFB	04CH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
;CHR$(&HFF)
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	001H
	DEFB	03EH
	DEFB	054H
	DEFB	014H
	DEFB	014H
	DEFB	000H
	DEFB	000H
	DEFB	000H

;	ORG	05B4Ah
ADDDEG: PUSH	HL
	LD	HL,8
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	RET
;
OCTLER: PUSH	HL
	LD	HL,CHCKOC
	LD	(CHKVEC),HL
	LD	HL,00000h
	XOR	A
	JR	MID&OP
;
HEXPZM: PUSH	HL
	LD	HL,CHCKHX
	LD	(CHKVEC),HL
	LD	HL,ADHLCK
	LD	A,0CDh
MID&OP: LD	(MULVEC),HL
	LD	(VECSWT),A
	LD	HL,00000h
LOP&OP: CALL	DEFTCH
	CALL	SMALL'
	DEFB	0CDH	;CALL
CHKVEC: DEFW	CHCKHX
	JR	C,RET&OP
	CALL	ADHLCK
	CALL	ADHLCK
	CALL	ADHLCK
VECSWT: DEFB	0CDH
MULVEC: DEFW	ADHLCK
	ADD	A,L
	LD	L,A
	LD	A,0
	ADC	A,H
	JP	C,OVERFL1
	LD	H,A
	JR	LOP&OP
;
RET&OP: DEC	DE
	LD	C,E
	LD	B,D
	EX	DE,HL
	POP	HL
	CALL	FLTHEX
	LD	E,C
	LD	D,B
	RET
;
CHCKOC: SUB	030h
	RET	C
	CP	008h
	CCF
	RET
;
CHCKHX: SUB	030h
	RET	C
	CP	00Ah
	CCF
	RET	NC
	CP	011h
	RET	C
	SUB	007h
	CP	010h
	CCF
	RET
;
OVFLAG: LD	(IY+0),8
	XOR	A
	LD	(IY-1),A
	LD	C,A
	INC	C
	EX	DE,HL
	LD	B,8
	CALL	ZFILL
	EX	DE,HL
	CALL	DEFTCH
	CP	02Bh
	JR	Z,OVFLAG
	CP	02Dh
	JR	Z,SKIP2D
	JR	L008F
ZRSKIP: CALL	DEFTCH
L008F:	CP	030h
	JR	Z,ZRSKIP
	JR	CHCK26
SKIP2D: CALL	OVFLAG
	JP	TOGLE
;
CHCK26: CP	026h
	JR	NZ,MDLAG
	CALL	DEFTCH
	CALL	SMALL'
	CP	048h
	JP	Z,HEXPZM
	CP	04Fh
	CALL	Z,DEFTCH
	DEC	DE
	JP	OCTLER
;
FTCHL:	CALL	DEFTCH
MDLAG:	CP	02Eh
	JR	Z,POINTS
	CP	045h
	JP	Z,EXPON?
	CP	044h
	JP	Z,DEXPON
	CP	030h
	JR	C,TST23H
	CP	03Ah
	JR	NC,TST23H
	SUB	030h
	CALL	MULTEN
	INC	(IY-1)
	SET	6,(IY-1)
	CALL	MULDEC
	JR	FTCHL
;
POINTS: SET	7,(IY-1)
POINT:	CALL	DEFTCH
	CP	030h
	JR	C,PESC
	CP	03Ah
	JR	NC,PESC
	SUB	030h
	INC	C
	CALL	MULTEN
	BIT	6,(IY-1)
	JR	NZ,KMYSET
	OR	A
	JR	Z,POINT
	SET	6,(IY-1)
KMYSET: CALL	MULDEC
	INC	(IY-1)
	JR	POINT
;
PESC:	DEC	C
	JR	Z,TST23H
	CALL	DIVTEN
	JR	PESC
;
TST23H: CP	045h
	JP	Z,EXPON!
	CP	044h
	JP	Z,DEXPON
	CP	023h
	JR	NZ,TST21H
	LD	(IY+0),8
	SET	7,(IY-1)
	RET
;
TST21H: CP	021h
	JR	NZ,TST25H
	SET	7,(IY-1)
DGTUPQ: PUSH	DE
	PUSH	BC
	CALL	CSNG
	PUSH	HL
	INC	HL
	INC	HL
	INC	HL
	INC	HL
	LD	B,4
SNGCL1: LD	(HL),0
	INC	HL
	DJNZ	SNGCL1
	POP	HL
	POP	BC
	POP	DE
	LD	(IY+0),4
	RET
;
TST25H: CP	025h
	JR	NZ,TSTPRC
	CALL	INT
	RES	7,(IY-1)
	RET
;
TSTPRC: DEC	DE
	LD	A,(IY-1)
	AND	03Fh
	CP	008h
	RET	NC
	JR	DGTUPQ
;
EXPON?: LD	A,(DE)
	CP	04Ch
	JR	NZ,EXPON
	JR	TSTPRC
;
EXPON!: LD	A,(DE)
	CP	04Ch
	JR	NZ,EXPON
	JR	TSTPRC
;
DEXPON: LD	(IY+0),8
	JR	EXPCLM
EXPON:	LD	(IY+0),4
EXPCLM: SET	7,(IY-1)
	PUSH	HL
	LD	HL,MUL
	LD	(EXJPVC),HL
	LD	HL,00000h
FTREPT: CALL	DEFTCH
	CP	02Bh
	JR	Z,CBEGIN
	CP	02Dh
	JR	NZ,CLMIDL
	PUSH	HL
	LD	HL,DIV
	LD	(EXJPVC),HL
	POP	HL
CBEGIN: CALL	DEFTCH
CLMIDL: SUB	030h
	JR	C,ESCPER
	CP	00Ah
	JR	NC,ESCPER
	PUSH	DE
	CALL	ADHLCK
	LD	E,L
	LD	D,H
	CALL	ADHLCK
	CALL	ADHLCK
	CALL	ADDECK
	LD	E,A
	LD	D,000h
	CALL	ADDECK
	POP	DE
	JR	CBEGIN
ESCPER: DEC	DE
	LD	A,H
	OR	A
	JR	NZ,OVERF'
	LD	A,L
	POP	HL
	PUSH	DE
	PUSH	BC
	PUSH	HL
	LD	DE,ZFAC1
	PUSH	DE
	CALL	LDIR1
	POP	HL
	LD	B,A
	INC	B
	JR	MULLKM
EMLLPO: CALL	MULTEN
MULLKM: DJNZ	EMLLPO
	EX	DE,HL
	POP	HL
	DEFB	0CDH	;CALL
EXJPVC: DEFS	2
	POP	BC
	POP	DE
	RET
;
DIVTEN: PUSH	AF
	PUSH	BC
	PUSH	DE
	LD	DE,FLTEN
	CALL	DIV
	POP	DE
	POP	BC
	POP	AF
	RET
;
ADDECK: ADD	HL,DE
	RET	NC
	JR	OVERF'
;
ADHLCK: ADD	HL,HL
	RET	NC
OVERF': JP	OVERFL1
;
MULDEC: PUSH	DE
	PUSH	HL
	LD	HL,ZFAC1
	LD	E,A
	LD	D,0
	CALL	FLTHEX
	EX	DE,HL
	POP	HL
	PUSH	BC
	CALL	ADD
	POP	BC
	POP	DE
	RET
;
DEFTCH: LD	A,(DE)
	CP	020h
	INC	DE
	JR	Z,DEFTCH
	RET
;
CVNMFL: LD	A,(HL)
	OR	A
	JR	Z,ONLYZ#
	INC	HL
	LD	A,(HL)
	RES	7,(HL)
	DEC	HL
	RLCA
ONLYZ#: LD	A,020h
	JR	NC,PLUS
	LD	A,02Dh
PLUS:	PUSH	AF
	CALL	CVASFL
	POP	AF
	INC	B
	DEC	DE
	LD	(DE),A
	RET
;
ENORLP: LD	BC,0
ENORL': CALL	CMP
	JR	NC,NORRES
	CALL	MULTEN
	DEC	BC
	JR	ENORL'
NORRES: PUSH	HL
	LD	HL,0FFF8h
	ADD	HL,DE
	EX	DE,HL
	POP	HL
NORRE': CALL	CMP
	RET	C
	CALL	DIVTEN
	INC	BC
	JR	NORRE'
;
OKOMTR: LD	A,044h
	BIT	3,(IY+0)
	JR	NZ,PUTEMK
	INC	A
PUTEMK: LD	(DE),A
	INC	DE
	LD	A,H
	OR	A
	LD	A,02Bh
	JR	Z,EXPPLS
	LD	A,L
	CPL
	LD	L,A
	LD	A,H
	CPL
	LD	H,A
	INC	HL
	LD	A,02Dh
EXPPLS: LD	(DE),A
	INC	DE
	PUSH	DE
	LD	DE,ZFAC
	CALL	ASCHL
	POP	DE
	LD	A,(ZFAC+3)
	LD	(DE),A
	INC	DE
	LD	A,(ZFAC+4)
	LD	(DE),A
	RET
;
EXPASC: PUSH	HL
	LD	DE,ZFAC
	PUSH	DE
	CALL	LDIR8
	POP	HL
	LD	DE,FLONE
	CALL	ENORLP
	PUSH	BC
	CALL	CVASFL
	POP	HL
	PUSH	DE
	PUSH	BC
	LD	A,E
	ADD	A,B
	LD	E,A
	LD	A,000h
	ADC	A,D
	LD	D,A
	DEC	DE
	LD	A,(DE)
	CP	030h
	INC	DE
	JR	NZ,PUTEXP
	DEC	DE
	POP	BC
	DEC	B
	PUSH	BC
	INC	HL
PUTEXP: CALL	OKOMTR
	POP	BC
	POP	DE
	INC	B
	INC	B
	INC	B
	INC	B
	POP	HL
	RET
;
INTPAR: PUSH	HL
	CALL	DLTEN
	LD	DE,DGBUF+3
	CALL	ASCHL
	EX	DE,HL
	LD	B,5
FRSTCH: LD	A,(HL)
	CP	030h
	JR	NZ,BEGTRS
	INC	HL
	DJNZ	FRSTCH
BEGTRS: LD	C,B
MIDTRS: LD	A,(HL)
	INC	IX
	LD	(IX+0),A
	INC	HL
	DJNZ	MIDTRS
	POP	HL
	CALL	FRAC
	LD	DE,FLLAST
	JR	ESTST'
;
CVASFL: XOR	A
	CP	(HL)
	JP	Z,ASZERO
	LD	A,(IY+0)
	CP	008h
	JR	Z,DBLLCH
	LD	DE,SHLMT
	CALL	CMP
	JP	NC,EXPASC
	JR	NOEXP
DBLLCH: LD	DE,DHLMT
	CALL	CMP
	JP	NC,EXPASC
NOEXP:	LD	DE,FLLAST
	CALL	CMP
	JP	C,EXPASC
	PUSH	HL
	LD	DE,ZFAC1
	PUSH	DE
	CALL	LDIR8
	POP	HL
	CALL	CONDDG
	LD	IX,DGBUF
	LD	(IX+0),030h
	LD	A,(HL)
	CP	081h
	JR	C,FRACDG
	CP	091h
	JP	C,INTPAR
	LD	DE,CONTBL
	CALL	CONDSF
CVCONT: CALL	CMP
	JR	NC,DWNERC
	CALL	ADDDEG
	JR	CVCONT
;
ESTST': CALL	CONDDG
	LD	A,B
	SUB	C
	LD	B,A
DWNERC: CALL	MIDSGN
FRACDG: INC	IX
	LD	(IX+0),02Eh
FRCAGN: LD	DE,FLMAX
	CALL	CONDSF
	PUSH	BC
	PUSH	IX
	CALL	MUL
	POP	IX
	POP	BC
	CALL	GNXDGT
	LD	A,B
	OR	A
	JR	NZ,FRCAGN
	CALL	FRCADM
BCKSER: DEC	HL
	LD	A,(HL)
	CP	02Eh
	DEC	HL
	JR	Z,INTDIS
	INC	HL
	CP	030h
	JR	Z,BCKSER
INTDIS: LD	DE,DGBUF
	LD	A,(DE)
	CP	030h
	JR	NZ,LSTASA
	INC	DE
LSTASA: SBC	HL,DE
	LD	B,L
	INC	B
	POP	HL
	RET
;
ASZERO: LD	DE,DGBUF
	LD	A,030h
	LD	(DE),A
ASCONE: LD	B,1
	RET
;
FRCADM: PUSH	IX
	POP	HL
	LD	A,(HL)
	PUSH	HL
FRCASL: LD	(HL),030h
	CP	035h
	JR	C,ESCADD
ADDLOP: DEC	HL
	LD	A,(HL)
	CP	02Eh
	JR	Z,ADDLOP
	INC	A
	LD	(HL),A
	CP	03Ah
	JR	Z,FRCASL
ESCADD: POP	HL
	RET
;
USGNCV:
;
; ACC <- 1 EXP ON
; ACC <- 0 EXP OFF
; B <- INT PAR
; C <- FRAC PAR
;
; OUT:HL <- LASTPO
; KEYBUF+1 <- RESULT
;
	PUSH	BC
	CALL	USGCV'
	POP	BC
	LD	A,B
	CP	2
	RET	C
	DEC	B
	LD	DE,KEYBUF
RPSPAC: INC	DE
	LD	A,(DE)
	CP	030h
	RET	NZ
	LD	A,020h
	LD	(DE),A
	DJNZ	RPSPAC
	RET
;
EXPUSG: PUSH	BC
	LD	A,B
	CP	011h
	JP	NC,FOVER
	OR	A
	JR	Z,USNRIW
	DEC	A
USNRIW: CALL	CPSHIF
	LD	A,(HL)
	OR	A
	LD	BC,0
	CALL	NZ,ENORLP
	LD	E,C
	LD	D,B
	POP	BC
	LD	(EXPUBC),BC
	LD	(EXPUHL),HL
AGNEXP: PUSH	DE
	PUSH	BC
	LD	DE,ZFAC
	PUSH	DE
	CALL	LDIR8
	POP	HL
	POP	BC
	CALL	USGC''
	LD	DE,KEYBUF
	LD	A,(DE)
	CP	02Fh
	JR	NZ,NGPUDS
	INC	DE
	LD	A,(DE)
	CP	031h
	JR	NZ,WRITEL1
NGPUDS: POP	DE
	INC	DE
	DEFB	001H	; LD BC,?
EXPUBC: DEFS	2
	DEFB	021H	; LD HL,?
EXPUHL: DEFS	2
	CALL	DIVTEN
	JR	AGNEXP
;
WRITEL1: CP	02Eh
	JR	Z,NTPT2E
	LD	A,020h
	LD	(DE),A
NTPT2E: POP	DE
	EX	DE,HL
	CALL	OKOMTR
	INC	DE
	EX	DE,HL
	RET
;
USGC'': LD	A,02Fh
	JR	USG'''
;
USGCV': OR	A
	JR	NZ,EXPUSG
	LD	A,030h
USG''': LD	IX,KEYBUF
	LD	(IX+0),A
	LD	A,B
	OR	A
	JR	Z,FRACUS
	CP	17
	JR	C,STDGUS
STFLBL: INC	IX
	LD	(IX+0),030h
	DEC	A
	CP	16
	JR	NZ,STFLBL
STDGUS: INC	A
	CALL	CPSHIF
	CALL	CMP
	JR	NC,FOVER
	LD	B,0
	CALL	GTESTB
FRACUS: CALL	ONECMP
	JR	NC,FOVER
	LD	A,C
	OR	A
	JR	Z,NOFRAC
	INC	IX
	LD	(IX+0),02Eh
	LD	B,C
AGINFR: PUSH	BC
	PUSH	IX
	LD	DE,FLMAX
	CALL	CONDSF
	CALL	MUL
	POP	IX
	POP	BC
	CALL	GNXDGT
	LD	A,B
	OR	A
	JR	NZ,AGINFR
OVERRD: CALL	FRCADM
	LD	A,(KEYBUF)
	CP	031h
	RET	C
FOVER:	LD	A,21
	JP	ERROR
;
NOFRAC: INC	(HL)
	CALL	ONECMP
	INC	IX
	PUSH	IX
	POP	HL
	RET	C
	LD	(IX+0),039h
	JR	OVERRD
;
GTESTB: DEC	B
	RET	Z
GNXDGT: CALL	ADDDEG
MIDSGN: LD	A,(DE)
	CP	07Dh
	RET	Z
	INC	IX
	LD	(IX+0),030h
INTGDL: CALL	CMP
	JR	C,GTESTB
	INC	(IX+0)
	PUSH	IX
	PUSH	BC
	CALL	SUB
	POP	BC
	POP	IX
	JR	INTGDL
;
CPSHIF: ADD	A,A
	ADD	A,A
	ADD	A,A
	LD	B,A
	LD	DE,FLLAST
	LD	A,E
	SUB	B
	LD	E,A
	LD	A,D
	SBC	A,0
	LD	D,A
	RET
;
CONDSF: LD	A,(IY+0)
	CP	008h
	RET	Z
	PUSH	HL
	LD	HL,72
	ADD	HL,DE
	EX	DE,HL
	POP	HL
	RET
;
CONDDG: LD	A,(IY+0)
	LD	B,17
	CP	008h
	RET	Z
	LD	B,7
	RET
;
INTZRR: LD	B,(IY+0)
	EX	DE,HL
	CALL	ZFILL
INTBCK: POP	DE
	POP	HL
	POP	BC
	RET
;
B_FIX:
INT:	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	A,(HL)
	CP	081h
	JR	C,INTZRR
	BIT	3,(IY+0)
	JR	NZ,INTDBL
	CP	098h
	JR	NC,INTBCK
	INC	HL
	CALL	RCHLBC
	DEC	HL
	LD	B,0
INTSFL: SRL	E
	RR	D
	RR	C
	INC	A
	INC	B
	CP	098h
	JR	NZ,INTSFL
INTSBL: SLA	C
	RL	D
	RL	E
	DJNZ	INTSBL
INTBC': CALL	STHLBC
	JR	INTBCK
;
INTDBL: CP	0B8h
	JR	NC,INTBCK
	INC	HL
	CALL	RCHLBC
	PUSH	HL
	EXX
	POP	HL
	CALL	RCHLBC
	LD	B,(HL)
	EXX
	LD	B,000h
INDSFL: SRL	E
	RR	D
	RR	C
	EXX
	RR	E
	RR	D
	RR	C
	RR	B
	EXX
	INC	B
	INC	A
	CP	0B8h
	JR	NZ,INDSFL
IDSFBL: EXX
	SLA	B
	RL	C
	RL	D
	RL	E
	EXX
	RL	C
	RL	D
	RL	E
	DJNZ	IDSFBL
	EXX
	LD	(HL),B
	DEC	HL
MIDERF: CALL	STHLBC
	DEC	HL
	PUSH	HL
	EXX
	POP	HL
	JR	INTBC'
;
STHLBC: LD	(HL),C
	DEC	HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
	RET
;
RCHLBC: LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	LD	C,(HL)
	INC	HL
	RET
;
FRAC:	LD	A,(HL)
	OR	A
	RET	Z
	INC	HL
	LD	A,(HL)
	SET	7,(HL)
	DEC	HL
	PUSH	AF
	CALL	FRAC'
	POP	AF
	RLCA
	RET	C
	JP	RESNHL
;
FRAC':	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	A,(HL)
	CP	081h
	JP	C,INTBCK
	BIT	3,(IY+0)
	JR	NZ,FRCDBL
	CP	098h
	JP	NC,INTZRR
	INC	HL
	CALL	RCHLBC
	DEC	HL
FRCSBL: SLA	C
	RL	D
	RL	E
	DEC	A
	CP	080h
	JR	NZ,FRCSBL
	EX	AF,AF'
	LD	A,E
	OR	D
	OR	C
	JR	Z,ENDSFR
	EX	AF,AF'
FRCSB': BIT	7,E
	JR	NZ,ENDSFR
	SLA	C
	RL	D
	RL	E
	DEC	A
	JR	FRCSB'
;
ENDSFR: CALL	STHLBC
	DEC	HL
	LD	(HL),A
	JP	INTBCK
;
FRCDBL: CP	0B8h
	JP	NC,INTZRR
	INC	HL
	CALL	RCHLBC
	PUSH	HL
	EXX
	POP	HL
	CALL	RCHLBC
	LD	B,(HL)
IDFRBL: SLA	B
	RL	C
	RL	D
	RL	E
	EXX
	RL	C
	RL	D
	RL	E
	EXX
	DEC	A
	CP	080h
	JR	NZ,IDFRBL
	EX	AF,AF'
	LD	A,B
	OR	C
	OR	D
	OR	E
	EXX
	OR	C
	OR	D
	OR	E
	EXX
	JR	Z,ESCDFS
	EX	AF,AF'
	EXX
DSFL1': BIT	7,E
	EXX
	JR	NZ,ESCDFS
	SLA	B
	RL	C
	RL	D
	RL	E
	EXX
	RL	C
	RL	D
	RL	E
	DEC	A
	JR	DSFL1'
ESCDFS: LD	(HL),B
	DEC	HL
	CALL	STHLBC
	DEC	HL
	PUSH	HL
	EXX
	POP	HL
	CALL	STHLBC
	DEC	HL
	LD	(HL),A
	JP	INTBCK
;
MULTEN: PUSH	AF
	PUSH	BC
	PUSH	DE
	LD	DE,FLTEN
	CALL	MUL
	POP	DE
	POP	BC
	POP	AF
	RET
;
MOD_:	PUSH	HL
	PUSH	DE
	CALL	DIV
	CALL	FRAC
	CALL	MUL
	POP	DE
	POP	HL
	RET

HEXFLT: LD	A,(HL)
	CP	091h
	JR	C,HLFLT
HXZRRT: CCF
	LD	HL,00000h
	RET
;
DLTEN:
HLFLT:	INC	HL
	BIT	7,(HL)
	JR	Z,NORHLC
	CALL	NORHLC
	LD	A,H
	CPL
	LD	H,A
	LD	A,L
	CPL
	LD	L,A
	INC	HL
	RET
;
NORHLC: DEC	HL
	LD	A,(HL)
	CP	091h
	JP	NC,OVERFL1
TSTRNG: CP	081h
	JR	C,HXZRRT
	PUSH	AF
	INC	HL
	LD	A,(HL)
	INC	HL
	LD	L,(HL)
	LD	H,A
	POP	AF
	SET	7,H
HXFLSL: CP	090h
	RET	Z
	INC	A
	SRL	H
	RR	L
	JR	HXFLSL
;
STRCMP: LD	(IY+0),4
	CALL	CONDMZ
	EX	DE,HL
	CALL	CONDMZ
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	POP	HL
	PUSH	HL
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	EX	DE,HL
	PUSH	HL
	PUSH	DE
	LD	A,(DE)
	CP	(HL)
	JR	C,NOIV0
	LD	A,(HL)
NOIV0:	LD	B,A
	OR	A
	JR	Z,SCMPLN
	INC	HL
	INC	DE
	PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	POP	HL
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
SCMPLP: LD	A,(DE)
	CP	(HL)
	INC	HL
	INC	DE
	JR	NZ,PCMPRT
	DJNZ	SCMPLP
SCMPLN: POP	HL
	POP	DE
	LD	A,(DE)
	CP	(HL)
	JR	CMPRET
;
PCMPRT: POP	HL
	POP	DE
	JR	CMPRET
;
ONECMP: LD	DE,FLONE
CMP:	PUSH	BC
	PUSH	HL
	PUSH	DE
	LD	A,(IY+0)
	CP	003h
	JR	Z,STRCMP
	INC	HL
	INC	DE
	BIT	7,(HL)
	JR	NZ,HMISN
TSTCMP2:    
	LD	A,(DE)
	RLCA
	JR	C,CMPR''
	DEC	HL
	DEC	DE
TSTCMP: LD	C,0
	LD	B,(IY+0)
	EX	DE,HL
DCMPLO: LD	A,(DE)
	CP	(HL)
	JR	NZ,CMPRET
	INC	HL
	INC	DE
	DJNZ	DCMPLO
CMPRET: POP	DE
	POP	HL
	POP	BC
	RET
;
HMISN:	LD	A,(DE)
	RLCA
	JR	NC,CMPRE'
	DEC	HL
	DEC	DE
	EX	DE,HL
	JR	TSTCMP
;
CMPRE': XOR	A
	INC	A
	SCF
	JR	CMPRET
;
CMPR'': XOR	A
	INC	A
	JR	CMPRET
;
ZFILL:	XOR	A
FILL:	PUSH	DE
FILLOP: LD	(DE),A
	INC	DE
	DJNZ	FILLOP
	POP	DE
	RET
;
FLMAX:	DEFB	0B6H
	DEFB	00EH
	DEFB	01BH
	DEFB	0C9H
	DEFB	0BFH
	DEFB	004H
	DEFB	000H
	DEFB	000H
;
CONTBL: DEFB	0B2H
	DEFB	063H
	DEFB	05FH
	DEFB	0A9H
	DEFB	031H
	DEFB	0A0H
	DEFB	000H
	DEFB	000H
;
	DEFB	0AFH
	DEFB	035H
	DEFB	0E6H
	DEFB	020H
	DEFB	0F4H
	DEFB	080H
	DEFB	000H
	DEFB	000H
;
	DEFB	0ACH
	DEFB	011H
	DEFB	084H
	DEFB	0E7H
	DEFB	02AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	0A8H
	DEFB	068H
	DEFB	0D4H
	DEFB	0A5H
	DEFB	010H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	0A5H
	DEFB	03AH
	DEFB	043H
	DEFB	0B7H
	DEFB	040H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	0A2H
	DEFB	015H
	DEFB	002H
	DEFB	0F9H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	09EH
	DEFB	06EH
	DEFB	06BH
	DEFB	028H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	09BH
	DEFB	03EH
	DEFB	0BCH
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	098H
	DEFB	018H
	DEFB	096H
	DEFB	080H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
SNGMXO: DEFB	094H
	DEFB	074H
	DEFB	024H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	091H
	DEFB	043H
	DEFB	050H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	08EH
	DEFB	01CH
	DEFB	040H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	08AH
	DEFB	07AH
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
	DEFB	087H
	DEFB	048H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
;
FLTEN:
	DEFB	084H
	DEFB	020H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
FLONE:
	DEFB	081H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
	DEFB	000H
FLLAST:
	DEFB	07DH
	DEFB	04CH
	DEFB	0CCH
	DEFB	0CCH
	DEFB	0CCH
	DEFB	0CCH
	DEFB	0CCH
	DEFB	0CDH
ASCHL:
	PUSH	HL
	PUSH	DE
	PUSH	BC
	LD	C,0H
	PUSH	DE
	LD	B,0
	LD	DE,02710H
	CALL	CONV1
	LD	DE,003E8H
	CALL	CONV1
	LD	DE,00064H
	CALL	CONV1
	LD	DE,0000AH
	CALL	CONV1
	LD	A,L
	POP	DE
	OR	030H
	LD	(DE),A
	POP	BC
	POP	DE
	POP	HL
	RET
;
CONV1:	LD	A,0FFH
CONV2:	INC	A
	OR	A
	SBC	HL,DE
	JR	NC,CONV2
	ADD	HL,DE
	OR	A
	INC	B
	DEFB	0F6H	;OR ?
	DEFB	030H
	POP	DE
	EX	(SP),HL
	LD	(HL),A
	INC	HL
	EX	(SP),HL
	PUSH	DE
	INC	C
	RET
;
DHLMT:
	DEFB	0B6H
	DEFB	00EH
	DEFB	01BH
	DEFB	0C9H
	DEFB	0BFH
	DEFB	003H
	DEFB	0FFH
	DEFB	0FEH
;
SHLMT:
	DEFB	094H
	DEFB	074H
	DEFB	023H
	DEFB	0F8H
ZFAC:
	DEFS	8
ZFAC1:	DEFS	8
	DEFS	2
DGBUF:	DEFS	18
	DEFS	5

;	ORG	0631Bh

$EDIT:
SMALL:	LD	A,(DE)
SMALL': CP	061h
	RET	C
	CP	07Bh
	RET	NC
	SUB	020h
	RET
;
CVIMTX:
	PUSH	BC
	PUSH	DE
CPILLP: CALL	SPSTRE
	OR	A
	JR	Z,TREND
	INC	DE
	CP	080h		;80H 이상은 BASIC에 무시
	JR	NC,CPILLP
	CP	020h		;20H 이하도 무시
	JR	C,CPILLP
	DEC	DE
	CP	03Fh
	JR	Z,PRTCDE
	CP	022h
	JR	Z,STRING1
	CP	027h
	JR	Z,REMOPR
	CP	02Eh
	JR	Z,NUMJMP
	CP	026h
	JR	Z,NUMJMP
	CALL	TSTNAC
	JR	C,STATE
NUMJMP: CALL	NUMBER
	JR	CPILLP
PRTCDE: LD	(HL),08Ch
BACKLP: INC	HL
	INC	DE
	JR	CPILLP
TREND': EX	DE,HL
TREND:	LD	(HL),A
	POP	DE
	POP	BC
	RET
;
STRING1: CALL	DQTSTR
	JR	Z,TREND
	JR	CPILLP
;
REMOPR: LD	(HL),03Ah
	INC	HL
RMTRLP: LD	(HL),A
	INC	DE
	INC	HL
RMTRMD: LD	A,(DE)
	OR	A
	JR	NZ,RMTRLP
BACK:	JP	CPILLP
STORE': INC	HL
STORE:	CALL	SMALL
	LD	(HL),A
	INC	DE
	CP	041h		;대문자 체크
	JR	C,BACK1
	CP	05Bh
	JR	NC,BACK1
NOSLOP: CALL	SMALL
	CP	030h		;숫자 체크
	JR	C,BACK1
	CP	03Ah
	JR	NC,BACK1
	INC	HL
	LD	(HL),A
	INC	DE
	JR	NOSLOP
BACK1:	INC	HL
	JR	BACK
;
STATE:	LD	BC,CTBL1	;예약어가 저장된 곳
	CALL	MATCH
	JR	NC,GETHX
	LD	BC,CTBL2
	CALL	MATCH
	JR	C,STORE
	DEC	HL
	LD	A,(HL)
	LD	(HL),0FFh
	INC	HL
	LD	(HL),A
	CP	0C0h
	JR	NZ,BACK1
	INC	HL
	CALL	SPSTRE
	CP	03Dh
	JP	NZ,BACK
	LD	(HL),0F5h
	INC	HL
	INC	DE
	JR	LNOSLP1
;
GETHX:	LD	A,B
	CP	092h
	JR	Z,RMTRMD
	CP	08Fh
	JP	Z,DATAST1
	CP	0B8h
	JR	Z,ELSEST
	CP	0E1h
	JR	Z,LNOSLP1
	CP	0B6h
	JR	Z,LNOSLP1
	CP	093h
	JR	Z,LISTER
	CP	08Ah
	JP	NC,BACK
	CP	086h
	JR	Z,LSIT#?
	JR	NC,LISTER
LNOSLP1: CALL	SPSTRE
	CP	02Ch
	JR	Z,COMSTR
	CALL	TSTNAC
	JR	C,LBLGOT1
	CALL	CVBCAS
	CALL	HEX2
	JR	LNOSLP1
COMSTR: LD	(HL),A
	INC	HL
	INC	DE
	JR	LNOSLP1
;
LBLGOT1: CP	03Ah
	JP	Z,BACK
	OR	A
	JP	Z,BACK
	CP	022h
	JP	NZ,BACK
	CALL	DQTSTR
	JP	Z,TREND
	JR	LNOSLP1
;
LISTER: CALL	SPSTRE
LISTRM: CP	02Eh
	JR	Z,AFNUM
	CP	02Dh
	JR	Z,AFNUM
	CP	02Ch
	JR	Z,AFNUM
	CALL	TSTNAC
	JP	C,BACK
	CALL	CVBCAS
	CALL	HEX2
	JR	LISTER
;
AFNUM:	LD	(HL),A
	INC	HL
	INC	DE
	JR	LISTER
;
ELSEST: DEC	HL
	LD	(HL),03Ah
	INC	HL
	LD	(HL),A
	INC	HL
	JR	LNOSLP1
;
DATAST1: LD	A,(DE)
	OR	A
	JP	Z,TREND
	LD	(HL),A
	INC	HL
	INC	DE
DATAS: CP	03Ah
	JP	Z,CPILLP
	CP	022h
	JR	NZ,DATAST1
DQSTL:	CALL	DQTST'
	JP	Z,TREND
	JR	DATAST1		;DATAS'?
;
LSIT#?: LD	A,(DE)
	CP	023h
	JR	NZ,LISTER
	DEC	HL
	INC	(HL)
	INC	HL
	INC	DE
	INC	DE
	JR	LISTER
;
MATCH:	PUSH	HL
	PUSH	DE
	LD	L,C
	LD	H,B
	LD	B,080h
MSTART: POP	DE
	PUSH	DE
	INC	B
	LD	A,(HL)
	INC	A
	JR	Z,NOMTCH1
;
TESTMT: CALL	SMALL
	LD	C,(HL)
	INC	HL
	INC	DE
	CP	02Eh		;생략형 명령 처리
	JR	Z,SHORTN1
	SUB	C
	JR	Z,TESTMT
	CP	080h
	JR	Z,MTCHOK
	DEC	HL
SKIPTB: LD	A,(HL)
	RLCA
	INC	HL
	JR	NC,SKIPTB
	JR	MSTART
MTCHOK: POP	HL
	POP	HL
	LD	(HL),B
	INC	HL
	RET
;
NOMTCH1: POP	DE
	POP	HL
	SCF
	RET
;
SHORTN1: EX	AF,AF'
	LD	A,B
	CP	0EEh
	JR	NC,NO2EH
	EX	AF,AF'
	JR	MTCHOK
;
NO2EH:	EX	AF,AF'
	DEC	HL
	JR	SKIPTB
;
DQTSTR: LD	(HL),A
	INC	DE
	INC	HL
DQTST': LD	A,(DE)
	OR	A
	RET	Z
	CP	022h
	JR	NZ,DQTSTR
	LD	(HL),A
	INC	DE
	INC	HL
	INC	A
	DEC	A
	RET
;
SPSTRE: LD	A,(DE)
	CP	020h
	RET	NZ
	LD	(HL),A
	INC	DE
	INC	HL
	JR	SPSTRE
;
NUMBER: LD	A,(DE)
	CP	026h
	PUSH	HL
	INC	HL
	JR	NZ,NOT26H
	PUSH	DE
	INC	DE
	CALL	DEFTCH
	CALL	SMALL'
	POP	DE		;이 줄은 책에서 빠져있네요.
	PUSH	AF
	CALL	OVFLAG
	CALL	HEXFLT
	POP	AF
	CP	048h
	LD	A,011h
	JR	Z,SKIPHX
	DEC	A
SKIPHX: LD	C,L
	LD	B,H
	POP	HL
	LD	(HL),A
	INC	HL
	LD	(HL),C
	INC	HL
	LD	(HL),B
	INC	HL
	JR	BCKSPS
;
NOT26H: CALL	OVFLAG
	BIT	7,(IY-1)
	JR	NZ,FLOAT
	LD	A,(HL)
	CP	090h
	JR	NC,FLOAT
	CALL	HEXFLT
	PUSH	DE
	EX	DE,HL
	LD	HL,00009H
	OR	A
	SBC	HL,DE
	EX	DE,HL
	POP	DE
	LD	A,012h
	JR	C,HEX1
	LD	A,L
	INC	A
	POP	HL
	LD	(HL),A
	INC	HL
BCKSPS: DEC	DE
	LD	A,(DE)
	CP	020h
	JR	Z,BCKSPS
	INC	DE
	RET
;
HEX2:	LD	A,00Bh
	JR	PPOLNO
;
HEX1:	LD	C,L
	LD	B,H
	POP	HL
PPOLNO: LD	(HL),A
	INC	HL
	LD	(HL),C
	INC	HL
	LD	(HL),B
	INC	HL
	JR	BCKSPS
;
FLOAT:	LD	A,(IY+0)
	AND	00Fh
	OR	010h
	POP	HL
	LD	(HL),A
	INC	HL
	LD	C,(IY+0)
	LD	B,0
	ADD	HL,BC
	JR	BCKSPS
;
TSTNDE: LD	A,(DE)
TSTNAC: CP	030h
	RET	C
	CP	03Ah
	CCF
	RET
;
TREN':	LD	(DE),A
	POP	BC
	POP	DE
	POP	HL
	RET
;
CVTXIM: PUSH	HL
	PUSH	DE
	PUSH	BC
	LD	(CVCPPT),DE
CVTMLP: PUSH	HL
	PUSH	DE
	EX	DE,HL
	DEC	H
	LD	DE,26
	ADD	HL,DE
	DEFB	011H		; LD DE,?
CVCPPT: DEFS	2
	XOR	A
	SBC	HL,DE
	POP	DE
	POP	HL
	JP	NC,TREN'
	LD	A,(HL)
	OR	A
	JP	Z,TREN'
	CP	081h		;FUNCTION의 TOKEN
	JR	NC,TRASIM
	CP	020h
	JR	C,TRNUMB
	CP	022h
	JP	Z,DQUAT
	CP	03Ah
	JP	Z,CORON
BCEG:	LD	(DE),A
	INC	DE
MDLBK:	INC	HL
	JR	CVTMLP
TRASIM: CP	0FFh		;함수 앞에 FF가 붙으므로
	JR	Z,FUNCTR
	LD	BC,CTBL1
	PUSH	AF
	CALL	INVS
	POP	AF
	INC	HL
	CP	092h
	JP	Z,REM1
	CP	08Fh
	JP	Z,DTARCL
	JR	CVTMLP
;
FUNCTR: INC	HL
	LD	A,(HL)
	LD	BC,CTBL2
	CALL	INVS
	JR	MDLBK
;
TRNUMB: CP	010h
	JR	NC,RFLOAT
	CP	00Bh
	JR	NC,IMHORN
	DEC	A
	OR	030h
	JR	BCEG
;
IMHORN: CP	00Ch
	JP	Z,IMLNO
IMHEX:	PUSH	DE
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	PUSH	HL
	CP	010h
	JR	C,IMMID
	CP	012h
	JP	C,HEXOCT
IMMID:	EX	DE,HL
	LD	DE,FIVEBF
	CALL	ASCHL
	XOR	A
	LD	(FIVEBF+5),A
	LD	B,4
SKZRLP: LD	A,(DE)
	CP	030h
	JR	NZ,ESSKZR
	INC	DE
	DJNZ	SKZRLP
ESSKZR: LD	C,E
	LD	B,D
	POP	HL
	POP	DE
ZTRLW:	LD	A,(BC)
	OR	A
	JP	Z,CVTMLP
	LD	(DE),A
	INC	DE
	INC	BC
	JR	ZTRLW
RFLOAT: CP	013h
	JR	C,IMHEX
	AND	00Fh
	LD	(IY+0),A
	INC	HL
	PUSH	HL
	PUSH	DE
	CALL	CVASFL
	EX	DE,HL
	POP	DE
FLTRDL: LD	A,(HL)
	LD	(DE),A
	CP	02Eh
	JR	Z,NTPT21
	CP	045h
	JR	Z,NTPT21
	CP	044h
	JR	Z,NTPT23
	INC	HL
	INC	DE
	DJNZ	FLTRDL
	LD	A,(IY+0)
	CP	008h
	LD	A,021h
	JR	NZ,PUT21H
PUT23H: LD	A,023h
PUT21H: LD	(DE),A
	INC	DE
TSTED:	LD	C,(IY+0)
	LD	B,0
	POP	HL
	ADD	HL,BC
	JP	CVTMLP
;
FLTRP': LD	A,(HL)
	LD	(DE),A
	CP	044h
	JR	Z,NTPT23
NTPT21: INC	HL
	INC	DE
	DJNZ	FLTRP'
	LD	A,(IY+0)
	CP	008h
	JR	Z,PUT23H
	JR	TSTED
;
FLTR'': LD	A,(HL)
	LD	(DE),A
NTPT23: INC	HL
	INC	DE
	DJNZ	FLTR''
	JR	TSTED
;
IMLNO:	PUSH	DE
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	PUSH	HL
	EX	DE,HL
	INC	HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	JP	IMMID
;
DTARCL: LD	A,(HL)
	CP	022h
	JR	Z,DTA22S
MIDDST: LD	(DE),A
	CP	03Ah
	INC	HL
	INC	DE
	JP	Z,CVTMLP
	OR	A
	JP	Z,TREN'
	JR	DTARCL
;
DTA22S: LD	(DE),A
	INC	HL
	INC	DE
	LD	A,(HL)
	CP	022h
	JR	Z,MIDDST
	OR	A
	JR	Z,MIDDST
	JR	DTA22S
;
DQUAT:	LD	B,022h
	LD	(DE),A
	INC	HL
	INC	DE
DQUATL: LD	A,(HL)
	LD	(DE),A
	OR	A
	JP	Z,TREN'
	CP	B
	INC	HL
	INC	DE
	JP	Z,CVTMLP
	JR	DQUATL
;
REM1:	LD	B,0
	JR	DQUATL
;
CORON:	LD	(DE),A
	INC	HL
	LD	A,(HL)
	CP	027h
	JR	Z,REM1
	CP	0B8h
	JP	Z,CVTMLP
	INC	DE
	JP	CVTMLP
;
INVS:	DEC	A
	CP	080h
	JR	Z,ASSTR#
	EX	AF,AF'
SKIPTR: LD	A,(BC)
	RLCA
	INC	BC
	JP	NC,SKIPTR
	EX	AF,AF'
	JP	INVS
ASSTR#: LD	A,(BC)
	PUSH	AF
	AND	07Fh
	LD	(DE),A
	POP	AF
	INC	DE
	INC	BC
	RLCA
	JR	NC,ASSTR#
	RET
;
OCTALD: LD	A,04Fh
	EX	AF,AF'
	EX	DE,HL
	LD	DE,FIVEBF
	CALL	OCTHL
	LD	B,005h
	JR	SKHEXP
;
HEXOCT: CP	011h
	JR	NZ,OCTALD
	LD	A,048h
	EX	AF,AF'
	EX	DE,HL
	LD	DE,FIVEBF
	CALL	HEXHL
	LD	B,3
SKHEXP: LD	A,(DE)
	CP	030h
	JR	NZ,ESHEXR
	INC	DE
	DJNZ	SKHEXP
ESHEXR: LD	C,E
	LD	B,D
	POP	HL
	POP	DE
	LD	A,026h
	LD	(DE),A
	INC	DE
	EX	AF,AF'
	LD	(DE),A
	INC	DE
ZTRLWH: LD	A,(BC)
	OR	A
	JP	Z,CVTMLP
	LD	(DE),A
	INC	DE
	INC	BC
	JR	ZTRLWH
;
OCTHL:	PUSH	DE
	CALL	OCTCOV
	POP	DE
	RET
;
OCTCOV: LD	A,H
	RLA
	LD	A,0
	ADC	A,030h
	LD	(DE),A
	INC	DE
	LD	A,H
	RRCA
	RRCA
	RRCA
	RRCA
	CALL	OCTSTO
	LD	A,H
	RRCA
	CALL	OCTSTO
	LD	A,H
	AND	001h
	LD	H,L
	RL	H
	RLA
	RL	H
	RLA
	CALL	OCTSTO
	LD	A,L
	RRCA
	RRCA
	RRCA
	CALL	OCTSTO
	LD	A,L
OCTSTO: AND	007h
	ADD	A,030h
	LD	(DE),A
	INC	DE
	RET
;
HEXHL:	PUSH	DE
	CALL	HEXCOV
	XOR	A
	LD	(DE),A
	POP	DE
	RET
;
HEXCOV: LD	A,H
	CALL	HEXACC
	LD	A,L
HEXACC: PUSH	AF
	RRCA
	RRCA
	RRCA
	RRCA
	AND	00Fh
	CALL	HEXHLF
	POP	AF
	AND	00Fh
HEXHLF: ADD	A,030h
	CP	03Ah
	JR	C,SKIUTO
	ADD	A,007h
SKIUTO: LD	(DE),A
	INC	DE
	RET
;
CTBL1:	DEFM	'GOT'		;GOTO		81H
	DEFB	'O'+080H
	DEFM	'GOSU'		;GOSUB
	DEFB	'B'+080H
	DEFM	'RU'		;RUN
	DEFB	'N'+080H
	DEFM	'RETUR' 	;RETURN
	DEFB	'N'+080H
	DEFM	'RESTOR'	;RESTORE
	DEFB	'E'+080H
	DEFM	'LIS'		;LIST
	DEFB	'T'+080H
	DEFM	'LIST#' 	;LIST#1
	DEFB	'1'+080H
	DEFM	'AUT'		;AUTO
	DEFB	'O'+080H
	DEFM	'DELET' 	;DELETE
	DEFB	'E'+080H
	DEFM	'FO'		;FOR
	DEFB	'R'+080H
	DEFM	'NEX'		;NEXT
	DEFB	'T'+080H
	DEFM	'PRIN'		;PRINT
	DEFB	'T'+080H
	DEFM	'INPU'		;INPUT
	DEFB	'T'+080H
	DEFM	'I'		;IF
	DEFB	'F'+080H
	DEFM	'DAT'		;DATA
	DEFB	'A'+080H
	DEFM	'REA'		;READ		90H
	DEFB	'D'+080H
	DEFM	'DI'		;DIM
	DEFB	'M'+080H
	DEFM	'RE'		;REM
	DEFB	'M'+080H
	DEFM	'EDI'		;EDIT
	DEFB	'T'+080H
	DEFM	'STO'		;STOP
	DEFB	'P'+080H
	DEFM	'CON'		;CONT
	DEFB	'T'+080H
	DEFM	'CL'		;CLS
	DEFB	'S'+080H
	DEFM	'CLEA'		;CLEAR
	DEFB	'R'+080H
	DEFM	'O'		;ON
	DEFB	'N'+080H
	DEFM	'LE'		;LET
	DEFB	'T'+080H
	DEFM	'NE'		;NEW
	DEFB	'W'+080H
	DEFM	'POK'		;POKE
	DEFB	'E'+080H
	DEFM	'OF'		;OFF
	DEFB	'F'+080H
	DEFM	'WHIL'		;WHILE
	DEFB	'E'+080H
	DEFM	'WEN'		;WEND
	DEFB	'D'+080H
	DEFM	'REPEA' 	;REPEAT
	DEFB	'T'+080H
	DEFM	'UNTI'		;UNTIL		A0
	DEFB	'L'+080H
	DEFM	'TRAC'		;TRACE
	DEFB	'E'+080H
	DEFM	'EN'		;END
	DEFB	'D'+080H
	DEFM	'PLA'		;PLAY
	DEFB	'Y'+080H
	DEFM	'BEE'		;BEEP
	DEFB	'P'+080H
	DEFM	'DEFIN' 	;DEFINT
	DEFB	'T'+080H
	DEFM	'DEFSN' 	;DEFSNG
	DEFB	'G'+080H
	DEFM	'DEFDB' 	;DEFDBL
	DEFB	'L'+080H
	DEFM	'DEFST'		;DEFST
	DEFB	'R'+080H
	DEFM	'DE'		;DEF
	DEFB	'F'+080H
	DEFM	'DUM'		;DUMP
	DEFB	'P'+080H
	DEFM	'LOA'		;LOAD
	DEFB	'D'+080H
	DEFM	'SAV'		;SAVE
	DEFB	'E'+080H
	DEFM	'MERG'		;MERGE
	DEFB	'E'+080H
	DEFB	080H		;DEFM 'CONSO'
	;DEFB	'L'+080H
	DEFM	'OU'		;OUT
	DEFB	'T'+080H
	DEFM	'SEARC' 	;SEARCH 	B0
	DEFB	'H'+080H
	DEFM	'SOUN'		;SOUND
	DEFB	'D'+080H
    DEFB    080H
	DEFM	'SWA'		;SWAP
	DEFB	'P'+080H
	DEFB	080H			;DEFM 'ERAS'
	DEFM	'ERRO'		;ERROR
	DEFB	'R'+080H
	DEFM	'RESUM' 	;RESUME
	DEFB	'E'+080H
	DEFM	'RENU'		;RENUM
	DEFB	'M'+080H
	DEFM	'ELS'		;ELSE
	DEFB	'E'+080H
	DEFM	'CAL'		;CALL
	DEFB	'L'+080H
	DEFM	'LOCAT' 	;LOCATE
	DEFB	'E'+080H
	DEFB	080H			;DEFM 'MA'	;MAT
	;DEFB	'T'+080H
	DEFM	'MO'		;MON
	DEFB	'N'+080H
	DEFM	'HCOP'		;HCOPY
	DEFB	'Y'+080H
	DEFM	'KE'		;KEY
	DEFB	'Y'+080H
	DEFM	'PUS'		;PUSH
	DEFB	'H'+080H
	DEFM	'PO'		;POP		C0
	DEFB	'P'+080H
	DEFB	080H			;DEFM	'BAS'
	DEFM	'LABE'		;LABEL
	DEFB	'L'+080H
	DEFB	080H			;DEFM	'RANDOMIZ'
	DEFM	'SCREE' 	;SCREEN
	DEFB	'N'+080H
	DEFM	'LIN'		;LINE
	DEFB	'E'+080H
	DEFM	'COLO'		;COLOR
	DEFB	'R'+080H
	DEFM	'PSE'		;PSET
	DEFB	'T'+080H
	DEFM	'PRESE' 	;PRESET
	DEFB	'T'+080H
	DEFM	'CGINI' 	;CGINIT
	DEFB	'T'+080H
	DEFM	'PATTER'	;PATTERN
	DEFB	'N'+080H
	DEFM	'CIRCL' 	;CIRCLE
	DEFB	'E'+080H
	DEFM	'PAIN'		;PAINT
	DEFB	'T'+080H
	DEFM	'ROPE'		;ROPEN
	DEFB	'N'+080H
	DEFM	'WOPE'		;WOPEN
	DEFB	'N'+080H
	DEFM	'CLOS'		;CLOSE
	DEFB	'E'+080H
	DEFB	080H			;DEFM	'FILED'
	DEFB	080H			;DEFM	'GET'
	DEFB	080H			;DEFM	'PUT'
	DEFB	080H			;DEFM	'SET'
	DEFB	080H			;DEFM	'FILES'
	DEFB	080H			;DEFM	'RENAME'
	DEFB	080H			;DEFM	'KILL'
	DEFB	080H			;DEFM	'LSET'
	DEFB	080H			;DEFM	'RSET'
	DEFB	080H			;DEFM	'FORMAT
	DEFB	080H			;DEFM	'INIT'
	DEFB	080H			;EDFM	'CHAIN
	DEFB	080H			;DEFM	'PEN'
	DEFB	080H			;DEFM	'COM'
	DEFB	080H			;DEFM	'PAUSE'
	DEFM	'T'		;TO
	DEFB	'O'+080H
	DEFM	'STE'		;STEP
	DEFB	'P'+080H
	DEFM	'THE'		;THEN
	DEFB	'N'+080H
	DEFM	'USIN'		;USING
	DEFB	'G'+080H
	DEFB	080H
	DEFB	080H
	DEFB	080H
	DEFB	080H
	DEFM	'TA'		;TAB
	DEFB	'B'+080H
	DEFM	'SP'		;SPC
	DEFB	'C'+080H
	DEFB	080H
	DEFB	080H
	DEFM	'XO'		;XOR
	DEFB	'R'+080H
	DEFM	'O'		;OR
	DEFB	'R'+080H
	DEFM	'AN'		;AND
	DEFB	'D'+080H
	DEFM	'NO'		;NOT
	DEFB	'T'+080H
	DEFB	'>'		;><
	DEFB	'<'+080H
	DEFB	'<'		;<>
	DEFB	'>'+080H
	DEFM	'='		;=<
	DEFB	'<'+080H
	DEFM	'='		;=>
	DEFB	'>'+080H
	DEFB	'<'		;<=
	DEFB	'='+080H
    DEFB	'>'		;><
    DEFB	'='+080H	;=    
	DEFB	'='+080H	;=
	DEFB	'>'+080H	;>
	DEFB	'<'+080H	;<
	DEFB	'+'+080H	;+
	DEFB	'-'+080H	;-
	DEFM	'MO'		;MOD
	DEFB	'D'+080H
	DEFB	0FCH	    ;\
	DEFB	'/'+080H	;/
	DEFB	'*'+080H	;*
	DEFB	'^'+080H	;^
	DEFB	0FFH		;예약어 끝을 의미하는 DELIMETER

CTBL2:
	DEFM	'IN'		;81H INT
	DEFB	'T'+080H
	DEFM	'AB'		;ABS
	DEFB	'S'+080H
	DEFM	'SI'		;SIN
	DEFB	'N'+080H
	DEFM	'CO'		;COS
	DEFB	'S'+080H
	DEFM	'TA'		;TAN
	DEFB	'N'+080H
	DEFM	'LO'		;LOG
	DEFB	'G'+080H
	DEFM	'EX'		;EXP
	DEFB	'P'+080H
	DEFM	'SQ'		;SQR
	DEFB	'R'+080H
	DEFM	'RN'		;RND
	DEFB	'D'+080H
	DEFM	'PEE'		;PEEK
	DEFB	'K'+080H
	DEFM	'AT'		;ATN
	DEFB	'N'+080H
	DEFM	'SG'		;SGN
	DEFB	'N'+080H
	DEFM	'FRA'		;FRAC
	DEFB	'C'+080H
 	DEFM	'FI'		;FIX
 	DEFB	'X'+080H
	DEFM	'PA'		;PAI
	DEFB	'I'+080H
	DEFM	'RA'		;RAD	90H
	DEFB	'D'+080H
	DEFM	'IN'		;INP
	DEFB	'P'+080H
	DEFM	'CDB'		;CDBL
	DEFB	'L'+080H
	DEFM	'CSN'		;CSNG
	DEFB	'G'+080H
	DEFM	'CIN'		;CINT
	DEFB	'T'+080H
	DEFB	080H			;DEFM	'DSK'	;DSKF
	DEFB	080H			;DEFM	'EO'	;EOF
	DEFB	080H			;DEFM	'FPO'	;FPOS
	DEFB	080H			;DEFM	'LO'	;LOC
	DEFB	080H			;DEFM	'LO'	;LOF
	DEFM	'PO'		;POS
	DEFB	'S'+080H
	DEFM	'LPO'		;LPOS
	DEFB	'S'+080H
	DEFM	'FA'		;FAC
	DEFB	'C'+080H
	DEFM	'SU'		;SUM
	DEFB	'M'+080H
	DEFB	080H			;DEFM	'RE'	;REV
	DEFB	080H		;DUMMY
	DEFM	'CHR'		;CHR$	A0
	DEFB	'$'+080H
	DEFM	'STR'		;STR$
	DEFB	'$'+080H
	DEFM	'HEX'		;HEX$
	DEFB	'$'+080H
	DEFM	'OCT'		;OCT$
	DEFB	'$'+080H
	DEFM	'MKI'		;MKI$
	DEFB	'$'+080H
	DEFM	'MKS'		;MKS$
	DEFB	'$'+080H
	DEFM	'MKD'		;MKD$
	DEFB	'$'+080H
	DEFM	'SPACE' 	;SPACE$
	DEFB	'$'+080H
	DEFB	080H		;DUMMY
	DEFM	'AS'		;ASC	A9
	DEFB	'C'+080H
	DEFM	'LE'		;LEN
	DEFB	'N'+080H
	DEFM	'VA'		;VAL
	DEFB	'L'+080H
	DEFM	'CV'		;CVS
	DEFB	'S'+080H
	DEFM	'CV'		;CVD
	DEFB	'D'+080H
	DEFM	'CV'		;CVI
	DEFB	'I'+080H
	DEFM	'STA'		;STAT
	DEFB	'T'+080H
	DEFM	'PA'		;PAR(ITY)	B0H
	DEFB	'R'+080H
	DEFB	080H		;DUMMY B1H
	DEFM	'LEFT'		;LEFT$
	DEFB	'$'+080H
	DEFM	'RIGHT' 	;RIGHT$
	DEFB	'$'+080H
	DEFM	'MID'    	;MID$
	DEFB	'$'+080H
	DEFM	'INKEY' 	;INKEY$
	DEFB	'$'+080H
	DEFM	'INST'		;INSTR
	DEFB	'R'+080H
	DEFM	'FR'		;FRE
	DEFB	'E'+080H
	DEFM	'MEM'		;MEM$
	DEFB	'$'+080H
	DEFM	'SCRN'		;SCRN$
	DEFB	'$'+080H
	DEFM	'VARPT' 	;VARPTR
	DEFB	'R'+080H
	DEFM	'STRING'	;STRING$
	DEFB	'$'+080H
	DEFB	080H			;DEFM	'TIME'
	DEFM	'F'		;FN
	DEFB	'N'+080H
	DEFM	'US'		;USR
	DEFB	'R'+080H
	DEFM	'ER'		;ERR
	DEFB	'R'+080H
	DEFM	'ER'		;ERL
	DEFB	'L'+080H
	DEFM	'CSRLI' 	;CSRLIN
	DEFB	'N'+080H
	DEFB	0FFH
;
FIVEBF: DEFS	6
	DEFB	000H
;
;	ORG	069B2H
$ERTXT:
ERRTXT:
	DEFB	000H
	DEFM	'NEXT WITHOUT FOR'

	DEFB	000H
	DEFM	'SYNTAX ERROR'

	DEFB	000H
	DEFM	'RETURN WITHOUT GOSUB'

	DEFB	000H
	DEFM	'OUT OF DATA'

	DEFB	000H
	DEFM	'ILLEGAL FUNCTION CALL'

	DEFB	000H
	DEFM	'OVERFLOW'

	DEFB	000H
	DEFM	'OUT OF MEMORY'

	DEFB	000H
UDLMES:
	DEFM	'UNDEFINED LINE NUMBER'

	DEFB	000H
	DEFM	'SUBSCRIPT OUT OF RANGE'

	DEFB	000H
	DEFM	'DUPLICATE DEFINITION'

	DEFB	000H
	DEFM	'DIVISION BY ZERO'

	DEFB	000H
	DEFM	'ILLEGAL DIRECT'

	DEFB	000H
	DEFM	'TYPE MISMATCH'

	DEFB	000H
	DEFM	'HUBASIC'

	DEFB	000H
	DEFM	'STRING TOO LONG'

	DEFB	000H
	DEFM	'EXPRESSION TOO COMPLEX'
	
	DEFB	000H
	DEFM	"CAN'T CONTINUE"

	DEFB	000H
	DEFM	'UNDEFINED USER FUNCTION'

	DEFB	000H
	DEFM	'NO RESUME'

	DEFB	000H
	DEFM	'RESUME WITHOUT ERROR'

	DEFB	000H
	DEFM	'FORMAT OVER'

	DEFB	000H
	DEFM	'MISSING OPERAND'

	DEFB	000H
	DEFM	'REPEAT WITHOUT UNTIL'

	DEFB	000H
	DEFM	'UNTIL WITHOUT REPEAT'

	DEFB	000H
	DEFM	'WHILE WITHOUT WEND'

	DEFB	000H
	DEFM	'WEND WITHOUT WHILE'

	DEFB	000H
	DEFM	'TAPE READ ERROR'

	DEFB	000H
	DEFM	'DEVICE UNAVAILABLE'

	DEFB	000H
	DEFM	'STATEMENT NOT INSTALL'

	DEFB	000H
	DEFM	'STACK EMPTY'

	DEFB	000H
	DEFM	'FILE ERROR'

	DEFB	000H

;	ORG	06BC0h
$FLOAT:
B_ABS:
RESNHL: INC	HL
	RES	7,(HL)
	DEC	HL
	RET
;
STROMT: LD	A,(IY+0)
	CP	003h
	JP	Z,TYPEMS
	RET
;
ONESUB: LD	DE,FLONE
SUB:	CALL	STROMT
	CALL	TOGLE
	CALL	ADD
	PUSH	AF
	CALL	TOGLE
	XOR	A
	CP	(HL)
	JR	Z,ZERO3
	POP	AF
	CCF
	RET
;
ZERO3:	POP	AF
	XOR	A
	INC	HL
	LD	(HL),A
	DEC	HL
	RET

TOGLE:	INC	HL
	LD	A,(HL)
	XOR	080h
	LD	(HL),A
	DEC	HL
	RET
;
CONDM': PUSH	HL
	PUSH	DE
	JR	MIDCMZ
;
CONDMZ: PUSH	HL
	PUSH	DE
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	INC	HL
	OR	A
	SBC	HL,DE
	JR	Z,MTCHPO
RTCDMZ: POP	DE
	POP	HL
	RET
;
MTCHPO: EX	DE,HL
MIDCMZ: LD	A,(HL)
	OR	A
	JR	Z,RTCDMZ
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	HL,(STRTOP)
	SBC	HL,DE
	JR	NC,RTCDMZ
	EX	DE,HL
	DEC	HL
	LD	(HL),0
	DEC	HL
	LD	(HL),A
	POP	DE
	POP	HL
	RET
;
STROVF: LD	A,15
	JP	ERROR
;
STRADE: POP	DE
	POP	HL
	CALL	CONDMZ
	PUSH	HL
	PUSH	DE
	LD	HL,ZFAC
	CALL	LDIR8
	POP	HL
	PUSH	HL
	LD	E,L
	LD	D,H
	INC	DE
	INC	DE
	LD	(HL),E
	INC	HL
	LD	(HL),D
	EX	DE,HL
	INC	HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	DEC	HL
	DEC	HL
	EX	DE,HL
	DEC	HL
	LD	(HL),D
	DEC	HL
	LD	(HL),E
SRADE': POP	HL
	POP	DE
	RET
;
STRADD: PUSH	DE
	PUSH	HL
	LD	C,(HL)
	INC	HL
	LD	B,(HL)
	EX	DE,HL
	LD	E,(HL)
	INC	HL
	LD	D,(HL)
	LD	L,C
	LD	H,B
	LD	A,(HL)
	EX	AF,AF'
	LD	A,(DE)
	ADD	A,(HL)
	JR	C,STROVF
	JR	Z,SRADE'
	LD	HL,ZFAC
	CALL	CLRFAC
	PUSH	HL
	PUSH	DE
	LD	E,L
	LD	D,H
	INC	HL
	INC	HL
	EX	DE,HL
	LD	(HL),E
	INC	HL
	LD	(HL),D
	EX	DE,HL
	LD	(HL),A
	LD	E,L
	LD	D,H
	EX	AF,AF'
	PUSH	AF
	CALL	GETSTR
	INC	HL
	LD	A,(HL)
	INC	HL
	LD	H,(HL)
	LD	L,A
	INC	BC
	LD	A,(BC)
	LD	E,A
	INC	BC
	LD	A,(BC)
	LD	D,A
	POP	AF
	OR	A
	JR	Z,NXTADS
	LD	B,A
FSTTRL: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	FSTTRL
NXTADS: POP	BC
	LD	A,(BC)
	EX	AF,AF'
	INC	BC
	LD	A,(BC)
	LD	E,A
	INC	BC
	LD	A,(BC)
	LD	D,A
	EX	AF,AF'
	OR	A
	JR	Z,STRADS
	LD	B,A
SNDTRL: LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	SNDTRL
STRADS: POP	DE
	POP	HL
	PUSH	HL
	CALL	CONDMZ
	JP	STRADE
;
ADD:	LD	A,(IY+0)
	CP	003h
	JR	Z,STRADD
	PUSH	DE
	PUSH	HL
	INC	HL
	LD	A,(HL)
	RLCA
	JR	C,HMINS
	INC	DE
	LD	A,(DE)
	RLCA
	JR	C,DMINS
	DEC	DE
	DEC	HL
	CALL	FADD
	POP	HL
	POP	DE
	JP	RESNHL
;
HMINS:	LD	A,(DE)
	OR	A
	JR	Z,MINCR
	INC	DE
	LD	A,(DE)
	RLCA
	JR	NC,HMDP
	DEC	DE
	DEC	HL
	CALL	FADD
MINCR:	POP	HL
	INC	HL
	LD	A,(HL)
	DEC	HL
	OR	A
	JR	Z,MZRT
	SCF
MZRT:	POP	DE
	RET
;
HMDP:	DEC	DE
	DEC	HL
	CALL	FSUB
	POP	HL
	JR	C,MZRT
	POP	DE
	JP	RESNHL
;
DMINS:	DEC	DE
	DEC	HL
	CALL	FSUB
	POP	HL
	JR	NC,OKM
	CALL	RESNHL
ZRO:	POP	DE
	OR	A
	RET

OKM:	XOR	A
	CP	(HL)
	JR	Z,ZRO
	POP	DE
	SCF
	RET
;
FADD:	LD	A,0B7h
	LD	(INST1),A
	BIT	2,(IY+0)
	JP	NZ,SFADD
	XOR	A
	CP	(HL)
	JP	Z,TRANS
	LD	A,(DE)
	OR	A
	RET	Z
	SUB	(HL)
	JR	NC,ANSHIF
	NEG
	CP	56
	RET	NC
	LD	(HLBUF),HL
	EX	DE,HL
	JR	FADDS
ANSHIF: CP	56
	JP	NC,TRANS
	LD	(HLBUF),HL
FADDS:	CALL	FADD1
	PUSH	IX
	EX	(SP),HL
	LD	A,D
	ADD	A,H
	LD	D,A
	LD	A,L
	ADC	A,E
	LD	E,A
	POP	HL
	LD	A,B
	EXX
	ADC	A,B
	EXX
	LD	B,A
	LD	A,C
	EXX
	ADC	A,C
	EXX
	LD	C,A
	LD	A,H
	EXX
	ADC	A,H
	EXX
	LD	H,A
	LD	A,L
	EXX
	ADC	A,L
	EXX
	LD	L,A
	EXX
	EX	AF,AF'
	LD	B,A
	EX	AF,AF'
	LD	A,B
	ADC	A,D
	LD	D,A
	JP	NC,STORE1
	INC	E
	JP	Z,OVERFL1
	EXX
	SCF
	RRA
	RR	L
	RR	H
	RR	C
	RR	B
	RR	E
	RR	D
	EXX
	LD	D,A
STORE1:	LD	BC,00008h
	DEFB	021H		;LD HL,?
HLBUF:	DEFS	2
	ADD	HL,BC
	LD	(SPBF),SP
	LD	SP,HL
	EXX
	PUSH	DE
	PUSH	BC
	PUSH	HL
	EXX
	PUSH	DE
FLEXIT: LD	SP,(SPBF)
INST1:	DEFS	1
	EI
	RET
;
FADD1:	DI
	LD	(SPBF),SP
	LD	C,A
	AND	007h
	INC	A
	LD	B,A
	LD	A,C
	AND	038h
	LD	(JPVEC),A
	LD	SP,HL
	EX	AF,AF'
	EXX
	POP	AF
	SET	7,A
	POP	HL
	POP	BC
	POP	DE
	DEFB	018H		;JR ?
JPVEC:	DEFS	1
	JP	CLR1
FADDL1: XOR	A
	JP	CLR1
	DEFB	000H
	LD	D,E
	LD	E,B
	LD	B,C
	LD	C,H
	LD	H,L
	LD	L,A
	JR	FADDL1
	LD	D,B
	LD	E,C
	LD	B,H
	LD	C,L
	LD	H,A
	XOR	A
	JR	CLR2$
	LD	D,C
	LD	E,H
	LD	B,L
	LD	C,A
	XOR	A
	JP	CLR3
	LD	D,H
	LD	E,L
	LD	B,A
	XOR	A
	JP	CLR4
	DEFB	000H
	LD	D,L
	LD	E,A
	XOR	A
	JP	CLR5
	DEFW	0
	LD	D,A
	XOR	A
	LD	E,A
CLR5:	LD	B,A
CLR4:	LD	C,A
CLR3:	LD	H,A
CLR2$:	LD	L,A
CLR1:	EX	AF,AF'
	RRCA
	RRCA
	ADD	A,0EBh
	LD	(JPVEC2),A
	EX	AF,AF'
	JP	SHIFST
	OR	A
	RRA
	RR	L
	RR	H
	RR	C
	RR	B
	RR	E
	RR	D
SHIFST: EXX
	SCF
	CCF
	DEC	B
	EXX
	DEFB	020H	;JR NZ,?
JPVEC2: DEFS	1
	EXX
	EX	DE,HL
	LD	SP,HL
	POP	DE
	SET	7,D
	POP	HL
	POP	BC
	POP	IX
	LD	SP,(SPBF)
	EXX
	SCF
	EX	AF,AF'
	RET
;
FSUB:	BIT	3,(IY+0)
	JP	Z,SSUB
FSUB1:	XOR	A
	CP	(HL)
	JP	Z,NEGTIV
	LD	A,(DE)
	OR	A
	RET	Z
	SUB	(HL)
	JR	NC,SNSHIF
	NEG
	CP	56
	CCF
	RET	C
	LD	(HLBUF),HL
	EX	DE,HL
	CALL	DSUB1
	CCF
	RET
;
SNSHIF: CP	56
	JP	NC,NEGTIV
	LD	(HLBUF),HL
DSUB1:	PUSH	AF
	PUSH	HL
	PUSH	DE
	LD	A,(DE)
	CP	(HL)
	JR	NZ,NE_
	INC	DE
	INC	HL
	LD	A,(DE)
	SET	7,A
	CP	(HL)
	JR	Z,CMPCON
	RES	7,A
	CP	(HL)
	JR	NZ,NE_
CMPCON: INC	HL
	INC	DE
	LD	B,6
CMPL:	LD	A,(DE)
	CP	(HL)
	JP	NZ,NE_
	INC	HL
	INC	DE
	DJNZ	CMPL
	JP	ZERO
NE_:	POP	DE
	POP	HL
	POP	AF
	CALL	FADD1
	PUSH	IX
	EX	(SP),HL
	LD	A,H
	SUB	D
	LD	D,A
	LD	A,L
	SBC	A,E
	LD	E,A
	POP	HL
	EXX
	LD	A,B
	EXX
	SBC	A,B
	LD	B,A
	EXX
	LD	A,C
	EXX
	SBC	A,C
	LD	C,A
	EXX
	LD	A,H
	EXX
	SBC	A,H
	LD	H,A
	EXX
	LD	A,L
	EXX
	SBC	A,L
	LD	L,A
	EXX
	EX	AF,AF'
	LD	B,A
	EX	AF,AF'
	LD	A,D
	SBC	A,B
	LD	D,A
	LD	A,0B7h
	LD	(INST1),A
	EXX
	CALL	C,MINUS
	EXX
DSSFL2: BIT	7,D
	JP	NZ,STORE1
	EXX
	OR	A
	RL	D
	RL	E
	RL	B
	RL	C
	RL	H
	RL	L
	EXX
	RL	D
	DEC	E
	JR	NZ,DSSFL2
	JP	STORE1	
;
MINUS:	EXX
	LD	A,03Fh
	LD	(INST1),A
	LD	A,D
	CPL
	LD	D,A
	EXX
	LD	A,D
	CPL
	LD	D,A
	LD	A,E
	CPL
	LD	E,A
	LD	A,B
	CPL
	LD	B,A
	LD	A,C
	CPL
	LD	C,A
	LD	A,H
	CPL
	LD	H,A
	LD	A,L
	CPL
	LD	L,A
	INC	D
	RET	NZ
	INC	E
	RET	NZ
	INC	B
	RET	NZ
	INC	C
	RET	NZ
	INC	H
	RET	NZ
	INC	L
	RET	NZ
	EXX
	INC	D
	EXX
	RET
;
NEGTIV: OR	A
TRANS:	LD	C,(IY+0)
	LD	B,0
	EX	DE,HL
	LDIR
	RET
;
ZERO:	POP	DE
	POP	HL
	POP	AF
ZERO':	LD	B,(IY+0)
	XOR	A
ZFILL0:	LD	(HL),A
	INC	HL
	DJNZ	ZFILL0
	RET
;
OVERFL1: LD	A,6
	EI
	JP	ERROR
;
SFADD:	XOR	A
	CP	(HL)
	JP	Z,TRANS
	LD	A,(DE)
	OR	A
	RET	Z
	SUB	(HL)
	JR	NC,SNSH
	NEG
	CP	24
	RET	NC
	LD	(SHLBUF),HL
	EX	DE,HL
	JP	SADD1
SNSH:	CP	24
	JP	NC,TRANS
	LD	(SHLBUF),HL
SADD1:	LD	(SPBF),SP
	DI
	LD	C,A
	AND	007h
	INC	A
	LD	B,A
	LD	A,C
	AND	038h
	LD	C,A
	LD	(SJVEC),A
	LD	SP,HL
	EXX
	POP	DE
	SET	7,D
	POP	HL
	DEFB	018H	;JR ?
SJVEC:	DEFS	1
	LD	C,0
	JP	SCL0
	DEFS	3
	LD	C,H
	LD	H,L
	LD	L,D
	XOR	A
	JP	SCL1
	DEFS	1
	LD	C,L
	LD	H,D
	XOR	A
	LD	L,A
SCL1:	LD	D,A
SCL0:	EXX
	LD	A,C
	RRCA
	RRCA
	ADD	A,0F5h
	LD	(SJVEC2),A
	LD	A,B
	EXX
	LD	B,A
	JP	SSIFST
	RR	D
	RR	L
	RR	H
	RR	C
SSIFST: OR	A
	DEFB	010H		;DJNZ ?
SJVEC2: DEFS	1
	RL	C
	EXX
	EX	DE,HL
	LD	SP,HL
	POP	DE
	SET	7,D
	EXX
	POP	BC
	LD	A,H
	ADC	A,B
	LD	H,A
	LD	A,C
	ADC	A,L
	LD	L,A
	EXX
	LD	A,D
	EXX
	ADC	A,D
	LD	D,A
	EXX
	LD	A,E
	EXX
	LD	E,A
	JP	NC,SSTRE
	RR	D
	RR	L
	RR	H
	INC	E
SSTRE:	EXX
	LD	BC,00004h
	DEFB	021H		;LD HL,?
SHLBUF: DEFS	2
	ADD	HL,BC
	LD	SP,HL
	EXX
	PUSH	HL
	PUSH	DE
	JP	FLEXIT
;
SSUB:	PUSH	HL
	PUSH	DE
	LD	A,(DE)
	CP	(HL)
	JR	C,NSSUB0
	LD	A,(HL)
NSSUB0: CP	080h
	LD	A,000h
	JR	NC,OSETER
	PUSH	HL
	INC	HL
	INC	HL
	INC	HL
	LD	C,(HL)
	POP	HL
	EX	DE,HL
	INC	HL
	INC	HL
	INC	HL
	LD	A,(HL)
	EX	DE,HL
	CP	C
	JR	C,OSETER
	LD	A,C
OSETER: LD	DE,WRKFC
	LD	BC,00004h
	LDIR
	LD	B,4
ZFSSUB: LD	(DE),A
	INC	DE
	DJNZ	ZFSSUB
	POP	DE
	PUSH	DE
	EX	DE,HL
	LD	DE,WRKFC1
	LD	BC,00004h
	LDIR
	LD	B,4
ZFSSU1: LD	(DE),A
	INC	DE
	DJNZ	ZFSSU1
	LD	HL,WRKFC
	LD	DE,WRKFC1
	DEC	IY
	LD	(IY+0),008h
	CALL	FSUB1
	INC	IY
	POP	DE
	POP	HL
	PUSH	HL
	PUSH	DE
	EX	DE,HL
	LD	HL,WRKFC
	LD	BC,00004h
	LDIR
	POP	DE
	POP	HL
	RET
;
MUL:	CALL	STROMT
	DI
	PUSH	DE
	PUSH	HL
	LD	(SPBF),SP
	BIT	3,(IY+0)
	JP	NZ,DMUL
	LD	SP,HL
	LD	A,(DE)
	OR	A
	JP	Z,UNDRFL
	XOR	A
	EXX
	POP	DE
	SET	7,D
	CP	E
	JP	Z,UNDRFL
	POP	HL
	EXX
	EX	DE,HL
	LD	SP,HL
	POP	DE
	SET	7,D
	CP	E
	JP	Z,UNDRFL
	POP	HL
	LD	BC,05F00h
	LD	SP,WRKFC+6
	PUSH	BC
	PUSH	BC
	LD	C,A
	LD	B,A
	PUSH	BC
	EXX
	PUSH	DE
	LD	E,A
	EXX
	CP	H
	LD	IX,WRKFC+4
	JR	Z,SML1
	LD	C,H
	CALL	SMULTS
SML1:	DEC	IX
	CP	L
	JR	Z,SML2
	LD	C,L
	CALL	SMULTS
SML2:	DEC	IX
	LD	C,D
	CALL	SMULTS
	POP	HL
	LD	A,E
	ADD	A,L
	LD	L,A
	LD	A,000h
	ADC	A,A
	LD	H,A
	POP	BC
	POP	DE
SMSF:	BIT	7,C
	JR	NZ,EXPCUL
	RL	D
	RL	E
	RL	B
	RL	C
	DEC	HL
EXPCUL: LD	A,L
	SUB	080h
	LD	L,A
	LD	A,H
	SBC	A,000h
	JP	C,UNDRFL
	JP	NZ,OVERFL1
	LD	A,L
	DEFB	031H		;LD SP,?
SPBF:	DEFS	2
	POP	HL
	LD	(HL),A
	INC	HL
	LD	A,(HL)
	EX	(SP),HL
	INC	HL
	XOR	(HL)
	DEC	HL
	EX	(SP),HL
	DEC	HL
	PUSH	HL
	INC	HL
	RLCA
	JR	C,SMSTS
	RES	7,C
SMSTS:	LD	(HL),C
	INC	HL
	LD	(HL),B
	INC	HL
	LD	(HL),E
	POP	HL
	POP	DE
	EI
	RET
;
SMULTS: LD	B,8
SMULTP: RR	C
	EXX
	JP	NC,SMLP1
	LD	SP,IX
	POP	BC
	PUSH	HL
	LD	A,H
	ADD	A,B
	LD	H,A
	LD	A,L
	ADC	A,C
	LD	L,A
	EX	(SP),HL
	DEC	SP
	DEC	SP
	EX	(SP),HL
	LD	A,H
	ADC	A,D
	LD	H,A
	LD	A,L
	ADC	A,E
	LD	L,A
	EX	(SP),HL
SMLP1:	OR	A
	RL	H
	RL	L
	RL	D
	RL	E
	EXX
	DJNZ	SMULTP
	EXX
	LD	H,L
	LD	L,D
	LD	D,E
	XOR	A
	LD	E,A
	EXX
	LD	SP,WRKFC-4
	RET
;
UNDRFL: LD	SP,(SPBF)
	POP	HL
	PUSH	HL
	CALL	ZERO'
	POP	HL
	POP	DE
	EI
	RET
;
DVBYZR: LD	A,11
	JP	ERROR
;
DIV:	CALL	STROMT
	DI
	XOR	A
	PUSH	DE
	PUSH	HL
	LD	(SPBF),SP
	BIT	3,(IY+0)
	JP	NZ,DDIV
	LD	SP,HL
	EXX
	POP	DE
	SET	7,D
	CP	E
	JR	Z,UNDRFL
	LD	E,A
	POP	HL
	EXX
	EX	DE,HL
	LD	SP,HL
	POP	DE
	SET	7,D
	CP	E
	JR	Z,DVBYZR
	LD	E,A
	POP	HL
	LD	SP,(SPBF)
	LD	IX,WRKFC-1
	LD	C,4
SDLOP2: INC	IX
	LD	B,8
SDLOP1: EXX
	RL	(IX+0)
	LD	A,H
	EXX
	SUB	H
	EXX
	LD	H,A
	LD	A,L
	EXX
	SBC	A,L
	EXX
	LD	L,A
	LD	A,D
	EXX
	SBC	A,D
	EXX
	LD	D,A
	LD	A,E
	EXX
	SBC	A,E
	EXX
	LD	E,A
	SET	0,(IX+0)
	JR	NC,SDCNT
	RES	0,(IX+0)
	EXX
	LD	A,H
	EXX
	ADD	A,H
	LD	H,A
	EXX
	LD	A,L
	EXX
	ADC	A,L
	LD	L,A
	EXX
	LD	A,D
	EXX
	ADC	A,D
	LD	D,A
	EXX
	LD	A,E
	EXX
	ADC	A,E
	LD	E,A
SDCNT:	SLA	H
	RL	L
	RL	D
	RL	E
	EXX
	DJNZ	SDLOP1
	DEC	C
	JR	NZ,SDLOP2
	LD	HL,WRKFC+3
	LD	A,067h
	ADD	A,(HL)
	LD	(HL),A
	LD	B,3
ADLP:	DEC	HL
	LD	A,0
	ADC	A,(HL)
	LD	(HL),A
	DJNZ	ADLP
	XOR	A
	BIT	7,(HL)
	JR	NZ,SDEXPC
	LD	HL,WRKFC+3
	RL	(HL)
	LD	B,003h
NOSDLP: DEC	HL
	RL	(HL)
	DJNZ	NOSDLP
	SCF
SDEXPC: POP	HL
	POP	DE
	PUSH	DE
	PUSH	HL
	LD	A,(HL)
	CCF
	ADC	A,080h
	LD	C,A
	LD	A,0
	ADC	A,A
	LD	B,A
	EX	DE,HL
	LD	A,C
	SUB	(HL)
	EX	DE,HL
	LD	C,A
	LD	A,B
	SBC	A,0
	JP	C,UNDRFL
	JP	NZ,OVERFL1
	LD	(HL),C
	INC	HL
	INC	DE
	LD	A,(DE)
	XOR	(HL)
	RLCA
	LD	B,3
DDTRL:	LD	DE,WRKFC
SDTRL:	LD	A,(DE)
	LD	(HL),A
	INC	HL
	INC	DE
	DJNZ	SDTRL
	POP	HL
	JR	C,SDMIN
	CALL	RESNHL
SDMIN:	POP	DE
	EI
	RET
;
DMUL:	LD	SP,HL
	LD	A,(DE)
	OR	A
	JP	Z,UNDRFL
	XOR	A
	EXX
	POP	DE
	SET	7,D
	CP	E
	JP	Z,UNDRFL
	LD	E,A
	POP	BC
	POP	HL
	POP	IX
	EXX
	LD	SP,WRKFC+14
	LD	BC,05F00h
	PUSH	BC
	PUSH	BC
	PUSH	BC
	PUSH	BC
	LD	B,A
	PUSH	BC
	PUSH	BC
	PUSH	BC
	LD	SP,(SPBF)
	EX	DE,HL
	LD	B,6
	LD	DE,00007h
	ADD	HL,DE
	LD	DE,WRKFC+13
DMULLP: CALL	BLCKAD
	DEC	DE
	DEC	HL
	DJNZ	DMULLP
	LD	A,(HL)
	SET	7,A
	CALL	BLCKA1
	LD	HL,WRKFC
	BIT	7,(HL)
	SCF
	JR	NZ,DMNOSH
	LD	HL,WRKFC+7
	LD	B,008h
DMSFL:	RL	(HL)
	DEC	HL
	DJNZ	DMSFL
	OR	A
DMNOSH: POP	HL
	POP	DE
	PUSH	DE
	PUSH	HL
	LD	A,(DE)
	LD	C,A
	ADC	A,(HL)
	LD	C,A
	LD	A,0
	ADC	A,A
	LD	B,A
	LD	A,C
	SUB	081h
	LD	C,A
	LD	A,B
	SBC	A,0
	JP	M,UNDRFL
	JP	NZ,OVERFL1
	LD	(HL),C
	INC	DE
	INC	HL
	LD	A,(DE)
	XOR	(HL)
	RLCA
	LD	DE,WRKFC
	JR	C,SMSKP1
	EX	DE,HL
	RES	7,(HL)
	EX	DE,HL
SMSKP1: LD	B,007h
DMTRL:	LD	A,(DE)
	LD	(HL),A
	INC	DE
	INC	HL
	DJNZ	DMTRL
	POP	HL
	POP	DE
	EI
	RET
;
BLCKAD: LD	A,(HL)
	OR	A
	RET	Z
BLCKA1: PUSH	HL
	PUSH	BC
	PUSH	DE
	LD	B,8
BLADLP: RRCA
	PUSH	AF
	JP	NC,DMSKIP
	LD	A,(DE)
	PUSH	IX
	EX	(SP),HL
	ADD	A,H
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	ADC	A,L
	LD	(DE),A
	POP	HL
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,H
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,L
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,B
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,C
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,D
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	EXX
	ADC	A,E
	EXX
	LD	(DE),A
	DEC	DE
	LD	A,(DE)
	ADC	A,0
	LD	(DE),A
;
DMSKIP: EXX
	PUSH	IX
	EX	(SP),HL
	LD	A,H
	ADD	A,A
	LD	H,A
	LD	A,L
	RLA
	LD	L,A
	EX	(SP),HL
	POP	IX
	RL	H
	RL	L
	RL	B
	RL	C
	RL	D
	RL	E
	EXX
	POP	AF
	POP	DE
	PUSH	DE
	DJNZ	BLADLP
	EXX
	LD	A,H
	PUSH	IX
	EX	(SP),HL
	LD	H,L
	LD	L,A
	EX	(SP),HL
	POP	IX
	LD	H,L
	LD	L,B
	LD	B,C
	LD	C,D
	LD	D,E
	LD	E,0
	EXX
	POP	DE
	POP	BC
	POP	HL
	RET
;
DDIV:	LD	SP,HL
	EXX
	POP	DE
	SET	7,D
	CP	E
	JP	Z,UNDRFL
	LD	E,A
	POP	BC
	POP	HL
	POP	IX
	EXX
	EX	DE,HL
	LD	SP,(SPBF)
	CP	(HL)
	JP	Z,DVBYZR
	LD	DE,00007h
	ADD	HL,DE
	EX	DE,HL
	LD	HL,WRKFC-1
	LD	C,8
DDLOP2: INC	HL
	LD	B,8
DDLOP1: RL	(HL)
	PUSH	DE
	EX	DE,HL
	PUSH	BC
	PUSH	IX
	POP	BC
	LD	A,B
	SUB	(HL)
	LD	B,A
	DEC	HL
	LD	A,C
	SBC	A,(HL)
	LD	C,A
	PUSH	BC
	POP	IX
	POP	BC
	DEC	HL
	EXX
	LD	A,H
	EXX
	SBC	A,(HL)
	EXX
	LD	H,A
	LD	A,L
	EXX
	DEC	HL
	SBC	A,(HL)
	EXX
	LD	L,A
	LD	A,B
	EXX
	DEC	HL
	SBC	A,(HL)
	EXX
	LD	B,A
	LD	A,C
	EXX
	DEC	HL
	SBC	A,(HL)
	EXX
	LD	C,A
	LD	A,D
	EXX
	DEC	HL
	PUSH	BC
	LD	C,(HL)
	SET	7,C
	SBC	A,C
	POP	BC
	EXX
	LD	D,A
	LD	A,E
	SBC	A,0
	LD	E,A
	EXX
	EX	DE,HL
	POP	DE
	PUSH	DE
	SET	0,(HL)
	JR	NC,DDCNT
	RES	0,(HL)
	EX	DE,HL
	PUSH	BC
	PUSH	IX
	POP	BC
	LD	A,B
	ADD	A,(HL)
	LD	B,A
	DEC	HL
	LD	A,C
	ADC	A,(HL)
	LD	C,A
	PUSH	BC
	POP	IX
	POP	BC
	DEC	HL
	LD	A,(HL)
	EXX
	ADC	A,H
	LD	H,A
	EXX
	DEC	HL
	LD	A,(HL)
	EXX
	ADC	A,L
	LD	L,A
	EXX
	DEC	HL
	LD	A,(HL)
	EXX
	ADC	A,B
	LD	B,A
	EXX
	DEC	HL
	LD	A,(HL)
	EXX
	ADC	A,C
	LD	C,A
	EXX
	DEC	HL
	LD	A,(HL)
	EXX
	SET	7,A
	ADC	A,D
	LD	D,A
	LD	A,E
	ADC	A,0
	LD	E,A
	EXX
	EX	DE,HL
DDCNT:	POP	DE
	PUSH	IX
	EX	(SP),HL
	SLA	H
	RL	L
	EX	(SP),HL
	POP	IX
	EXX
	RL	H
	RL	L
	RL	B
	RL	C
	RL	D
	RL	E
	EXX
	DEC	B
	JP	NZ,DDLOP1
	DEC	C
	JP	NZ,DDLOP2
	LD	HL,WRKFC+7
	LD	A,067h
	ADD	A,(HL)
	LD	(HL),A
	LD	B,007h
DDADLP: DEC	HL
	LD	A,000h
	ADC	A,(HL)
	LD	(HL),A
	DJNZ	DDADLP
	XOR	A
	BIT	7,(HL)
	JR	NZ,DDEXPC
	LD	HL,WRKFC+8
	LD	B,8
DDNSLP: DEC	HL
	RL	(HL)
	DJNZ	DDNSLP
	SCF
DDEXPC: POP	HL
	POP	DE
	PUSH	DE
	PUSH	HL
	LD	A,(HL)
	CCF
	ADC	A,080h
	LD	C,A
	LD	A,0
	ADC	A,A
	LD	B,A
	EX	DE,HL
	LD	A,C
	SUB	(HL)
	EX	DE,HL
	LD	C,A
	LD	A,B
	SBC	A,0
	JP	C,UNDRFL
	JP	NZ,OVERFL1
	LD	(HL),C
	INC	HL
	INC	DE
	LD	A,(DE)
	XOR	(HL)
	RLCA
	LD	B,7
	JP	DDTRL
;
	DEFS	4
WRKFC:	DEFS	8
WRKFC1: DEFS	8
;    ORG 073A3H
LDIR1:   	LD	HL,FLONE      	;!b
LDIR8:   	LD	BC,00008h      	;
           	LDIR              	;
           	RET               	;

ONEADD:   	LD	DE,FLONE      	;b
           	JP	ADD        	;l
L073B2h:   	EX	DE,HL          	;
           	LD	HL,00008h      	;!
           	ADD	HL,DE         	;
           	EX	DE,HL          	;
           	RET               	;

B_SQR:     	XOR	A             	;
           	CP	(HL)           	;
           	RET	Z             	;
           	INC	HL            	;#
           	BIT	7,(HL)        	;~
           	DEC	HL            	;+
           	JP	NZ,IFCALL     	;6
           	PUSH	BC           	;
           	LD	DE,00008h      	;
           	PUSH	HL           	;
           	ADD	HL,DE         	;
           	LD	(L073D1h+1),HL    	;"s
           	ADD	HL,DE         	;
           	LD	(L073E4h+1),HL    	;"s
           	POP	HL            	;
L073D1h:   	LD	DE,00000h      	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	A,(HL)         	;~
           	CP	082h           	;
           	ADC	A,081h        	;
           	DEC	A             	;=
           	RRA               	;
           	LD	(HL),A         	;w
L073E2h:   	POP	HL            	;
           	PUSH	HL           	;
L073E4h:  	LD	DE,00000h      	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	DE,(L073D1h+1)    	;[s
           	CALL	DIV      	;p
           	CALL	ADD      	;l
           	DEC	(HL)          	;5
           	CALL	CMP      	;a
           	JR	Z,L07401h      	;(
           	CALL	LDIR8      	;s
           	JR	L073E2h        	;
L07401h:   	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	POP	BC            	;
           	RET               	;

B_SUM:     	CALL	B_FIX        	;` 7409
           	LD	A,(HL)         	;~
           	OR	A              	;
           	RET	Z             	;
           	INC	HL            	;#
           	BIT	7,(HL)        	;~
           	DEC	HL            	;+
           	JP	NZ,IFCALL     	;6
           	PUSH	BC           	;
           	CALL	L073B2h      	;s
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	CALL	ONEADD      	;s
           	EX	DE,HL          	;
           	POP	HL            	;
           	CALL	MUL      	;o
           	DEC	(HL)          	;5
           	POP	BC            	;
           	RET               	;

B_FACG:   	PUSH	BC           	;
           	CALL	B_FIX        	;`
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JR	Z,L07437h      	;(
           	CP	082h           	;
           	JR	NC,L0743Fh     	;0
L07437h:   	PUSH	HL           	;
           	EX	DE,HL          	;
           	CALL	LDIR1      	;s
           	POP	HL            	;
           	POP	BC            	;
           	RET               	;

L0743Fh:   	PUSH	HL           	;
           	CALL	HEXFLT      	;]a
           	XOR	A             	;
           	CP	H              	;
           	JP	NZ,OVERFL1     	;n
           	LD	A,L            	;}
           	CP	022h           	;"
           	JP	NC,OVERFL1     	;n
           	LD	B,L            	;E
           	POP	DE            	;
           	LD	HL,00008h      	;!
           	ADD	HL,DE         	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	PUSH	BC           	;
           	EX	DE,HL          	;
           	CALL	LDIR1      	;s
           	POP	BC            	;
           	POP	DE            	;
           	POP	HL            	;
L0745Eh:   	PUSH	BC           	;
           	CALL	MUL      	;o
           	PUSH	HL           	;
           	EX	DE,HL          	;
           	CALL	ONESUB      	;k
           	EX	DE,HL          	;
           	POP	HL            	;
           	POP	BC            	;
           	DJNZ	L0745Eh      	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	POP	BC            	;
           	RET               	;

L07473h:   	LD	A,(HL)         	;~
           	LD	C,H            	;L
L07475h:  	ADD	A,B           	;
           	DEC	HL            	;+
B_ATN:     	PUSH	BC           	;
           	INC	HL            	;#
           	LD	A,(HL)         	;~
           	RES	7,(HL)        	;
           	DEC	HL            	;+
           	PUSH	AF           	;
           	CALL	L07488h      	;t
           	POP	AF            	;
           	POP	BC            	;
           	RLCA              	;
           	RET	NC            	;
           	JP	TOGLE        	;k
L07488h:   	CALL	ONECMP      	;a
           	JR	C,L074ADh      	;8 
           	CALL	L073B2h      	;s
           	PUSH	DE           	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR1      	;s
           	POP	HL            	;
           	POP	DE            	;
           	CALL	DIV      	;p
           	CALL	L074ADh      	;t
           	LD	DE,PAITBL      	;xw
           	INC	(HL)          	;4
           	CALL	SUB      	;k
           	DEC	(HL)          	;5
           	JP	B_ABS          	;k
L074ADh:   	LD	A,0FFh         	;>
           	LD	(L07602h+1),A     	;2v
           	LD	DE,L07473h      	;st
           	CALL	CMP      	;a
           	JR	C,L07509h      	;8O
           	LD	DE,L07475h      	;ut
           	CALL	CMP      	;a
           	PUSH	AF           	;
           	CALL	L073B2h      	;s
           	POP	AF            	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	JR	C,L074E1h      	;8
           	CALL	ONEADD      	;s
           	EX	(SP),HL        	;
           	CALL	SUB      	;k
           	POP	DE            	;
           	CALL	DIV      	;p
           	CALL	L07509h      	;u
           	LD	DE,SINTBL3      	;Jw
           	JP	ADD        	;l
L074E1h:   	LD	DE,L07501h      	;u
           	CALL	MUL      	;o
           	CALL	ONEADD      	;s
           	EX	(SP),HL        	;
           	LD	DE,L07501h      	;u
           	CALL	SUB      	;k
           	POP	DE            	;
           	CALL	DIV      	;p
           	CALL	L07509h      	;u
           	INC	(HL)          	;4
           	LD	DE,SINTBL3      	;Jw
           	CALL	ADD      	;l
           	DEC	(HL)          	;5
           	RET               	;

L07501h:   	LD	A,A            	;
           	LD	D,H            	;T
           	INC	DE            	;
L0E7CFh     EQU    0E7CFh
           	CALL	Z,L0E7CFh    	;
           	LD	A,C            	;y
           	SUB	B             	;
L07509h:   	PUSH	BC           	;
           	PUSH	HL           	;
           	LD	(L075F2h+1),HL    	;"u
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	LD	(L075E2h+1),HL    	;"u
           	ADD	HL,DE         	;
           	LD	(L075C8h),HL    	;"u
           	ADD	HL,DE         	;
           	LD	(L075DAh+1),HL    	;"u
           	EX	DE,HL          	;
           	POP	HL            	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	E,L            	;]
           	LD	D,H            	;T
           	CALL	MUL      	;o
           	LD	DE,(L075C8h)    	;[u
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
           	LD	A,(IY+0)       	;~
           	DEC	A             	;=
           	CP	003h           	;
           	LD	B,A            	;G
           	LD	HL,L076FAh      	;!v
           	JP	Z,L075D5h      	;u
           	LD	B,00Ah         	;
           	JP	L075D5h        	;u
B_COS:     	PUSH	BC           	;
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JP	Z,L07437h      	;7t
           	LD	DE,SINTBL3      	;Jw
           	DEC	(HL)          	;5
           	CALL	SUB      	;k
           	INC	(HL)          	;4
           	CALL	TOGLE      	;k
           	POP	BC            	;
B_SIN:     	PUSH	BC           	;
           	PUSH	HL           	;
           	INC	HL            	;#
           	LD	A,(HL)         	;~
           	RES	7,(HL)        	;
           	AND	080h          	;
           	CPL               	;/
           	LD	(L07602h+1),A     	;2v
           	DEC	HL            	;+
           	CALL	L073B2h      	;s
           	LD	HL,SINTBL3      	;!Jw
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	INC	(HL)          	;4
           	INC	(HL)          	;4
           	INC	(HL)          	;4
           	EX	DE,HL          	;
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	CMP      	;a
           	CALL	NC,MOD_   	;Oa
           	EX	DE,HL          	;
           	DEC	(HL)          	;5
           	EX	DE,HL          	;
           	CALL	CMP      	;a
           	JR	C,L0758Eh      	;8
           	CALL	SUB      	;k
           	LD	A,(L07602h+1)     	;:v
           	XOR	080h          	;
           	LD	(L07602h+1),A     	;2v
L0758Eh:   	EX	DE,HL          	;
           	DEC	(HL)          	;5
           	EX	DE,HL          	;
           	CALL	CMP      	;a
           	JR	C,L0759Eh      	;8
           	DEC	(HL)          	;5
           	CALL	SUB      	;k
           	INC	(HL)          	;4
           	CALL	B_ABS        	;k
L0759Eh:   	LD	(L075F2h+1),HL    	;"u
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	LD	(L075E2h+1),HL    	;"u
           	ADD	HL,DE         	;
           	LD	(L075C8h),HL    	;"u
           	ADD	HL,DE         	;
           	LD	(L075DAh+1),HL    	;"u
           	EX	DE,HL          	;
           	POP	HL            	;
           	PUSH	DE           	;
           	LD	DE,SINTBL3      	;Jw
           	CALL	CMP      	;a
           	JR	NC,L0761Bh     	;0`
           	POP	DE            	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	E,L            	;]
           	LD	D,H            	;T
           	CALL	MUL      	;o
			DEFB 011h			; LD DE, xxxx
L075C8h:			
           	DEFW 0  			;
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
           	LD	B,(IY+0)       	;F
           	LD	HL,SINTBL1      	;!zv
L075D5h:   	PUSH	BC           	;
           	PUSH	HL           	;
           	LD	HL,(L075C8h)    	;*u
L075DAh:   	LD	DE,00000h      	;
           	CALL	MUL      	;o
           	POP	HL            	;
           	PUSH	HL           	;
L075E2h:  	LD	DE,00000h      	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	DE,(L075C8h)    	;[u
           	CALL	MUL      	;o
           	EX	DE,HL          	;
L075F2h:   	LD	HL,00000h      	;!
           	CALL	ADD      	;l
           	POP	HL            	;
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	POP	BC            	;
           	DJNZ	L075D5h      	;
           	POP	HL            	;
           	POP	BC            	;
L07602h:	LD	A,000h         	;>
           	INC	HL            	;#
           	XOR	(HL)          	;
           	CPL               	;/
           	LD	(HL),A         	;w
           	DEC	HL            	;+
           	LD	A,(IY+0)       	;~
           	CP	008h           	;
           	LD	A,(HL)         	;~
           	JR	Z,L07617h      	;(
           	CP	06Ch           	;l
L07613h:   	RET	NC            	;
           	JP	CLRFAC        	;(
L07617h:   	CP	04Dh           	;M
           	JR	L07613h        	;
L0761Bh:   	DEC	(HL)          	;5
           	LD	DE,SINTBL3      	;Jw
           	CALL	SUB      	;k
           	INC	(HL)          	;4
           	CALL	B_ABS        	;k
           	POP	DE            	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	E,L            	;]
           	LD	D,H            	;T
           	CALL	MUL      	;o
           	LD	DE,(L075C8h)    	;[u
           	CALL	LDIR1      	;s
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR1      	;s
           	LD	B,(IY+0)       	;F
           	LD	HL,SINTBL2     	;!v
L07644h:   	JR	L075D5h        	;
B_TAN:
           	PUSH	BC           	;
           	PUSH	HL           	;
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	LD	(L0766Dh+1),HL    	;"nv
           	ADD	HL,DE         	;
           	LD	(L07662h+1),HL    	;"cv
           	EX	DE,HL          	;
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
           	LD	HL,(L0766Dh+1)    	;*nv
           	EX	DE,HL          	;
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
L07662h:   	LD	HL,00000h      	;!
           	CALL	B_SIN        	;Wu
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
L0766Dh:   	LD	HL,00000h      	;!
           	CALL	B_COS        	;Eu
           	EX	DE,HL          	;
           	POP	HL            	;
           	CALL	DIV      	;p
           	POP	BC            	;
           	RET               	;
SINTBL1:
			DEFB 07Eh, 0AAh, 0AAh, 0AAh, 0AAh, 0AAh, 0AAh, 0ABh
			DEFB 07Ah, 008h, 088h, 088h, 088h, 088h, 088h, 089h
			DEFB 074h, 0D0h, 00Dh, 000h, 0D0h, 00Dh, 000h, 0D0h
			DEFB 06Eh, 038h, 0EFh, 01Dh, 02Ah, 0B6h, 039h, 09Ch
			DEFB 067h, 0D7h, 032h, 02Bh, 03Fh, 0AAh, 027h, 01Ch
			DEFB 060h, 030h, 092h, 030h, 09Dh, 043h, 068h, 04Ch
			DEFB 058h, 0D7h, 03Fh, 09Fh, 039h, 09Dh, 0C0h, 0F9h
			DEFB 050h, 04Ah, 096h, 03Bh, 081h, 085h, 06Ah, 053h
SINTBL2:
			DEFB 080h, 080h, 000h, 000h, 000h, 000h, 000h, 000h
			DEFB 07Ch, 02Ah, 0AAh, 0AAh, 0AAh, 0AAh, 0AAh, 0ABh
			DEFB 077h, 0B6h, 00Bh, 060h, 0B6h, 00Bh, 060h, 0B7h
			DEFB 071h, 050h, 00Dh, 000h, 0D0h, 00Dh, 000h, 0D1h
			DEFB 06Bh, 093h, 0F2h, 07Dh, 0BBh, 0C4h, 0FAh, 0E4h
			DEFB 064h, 00Fh, 076h, 0C7h, 07Fh, 0C6h, 0C4h, 0BEh
			DEFB 05Ch, 0C9h, 0CBh, 0A5h, 046h, 003h, 0E4h, 0EAh
			DEFB 054h, 057h, 03Fh, 09Fh, 039h, 09Dh, 0C0h, 0F9h
L076FAh:	DEFB 07Fh, 0AAh, 0AAh, 0AAh, 0AAh, 0AAh, 0AAh, 0ABh
			DEFB 07Eh, 04Ch, 0CCh, 0CCh, 0CCh, 0CCh, 0CCh, 0CDh
			DEFB 07Eh, 092h, 049h, 024h, 092h, 049h, 024h, 093h
			DEFB 07Dh, 063h, 08Eh, 038h, 0E3h, 08Eh, 038h, 0E4h
			DEFB 07Dh, 0BAh, 02Eh, 08Bh, 0A2h, 0E8h, 0BAh, 02Fh
			DEFB 07Dh, 01Dh, 089h, 0D8h, 09Dh, 089h, 0D8h, 09Eh
			DEFB 07Dh, 088h, 088h, 088h, 088h, 088h, 088h, 089h
			DEFB 07Ch, 070h, 0F0h, 0F0h, 0F0h, 0F0h, 0F0h, 0F1h
			DEFB 07Ch, 0D7h, 094h, 035h, 0E5h, 00Dh, 079h, 044h
			DEFB 07Ch, 043h, 00Ch, 030h, 0C3h, 00Ch, 030h, 0C4h
SINTBL3:	DEFB 080h, 049h, 00Fh, 0DAh, 0A2h, 021h, 068h, 0C2h
;    ORG 07752h
B_SGN:      LD A,(HL)
            OR A
            RET Z
         	INC	HL            	;#
         	BIT	7,(HL)        	;~
         	DEC	HL            	;+
         	JR	NZ,L07764h     	;     
L0775Bh:   	PUSH	HL           	;
           	EX	DE,HL          	;
           	PUSH	BC           	;
           	CALL	LDIR1      	;s
           	POP	BC            	;
           	POP	HL            	;
           	RET               	;

L07764h:   	CALL	L0775Bh      	;[w
           	JP	TOGLE        	;k
B_RAD:     	LD	DE,07780h      	;w
           	JR	L07772h        	;h
B_PAI:     	LD	DE,PAITBL      	;xw
L07772h:   	PUSH	BC           	;
           	CALL	MUL      	;o
           	POP	BC            	;
           	RET               	;
PAITBL:
			DEFB 082h, 049h, 00Fh, 0DAh
			DEFB 0A2h, 021h, 068h, 0C2h
			DEFB 07Bh, 00Eh, 0FAh, 035h
			DEFB 012h, 094h, 0E9h, 0C9h

B_INP:    	PUSH	HL           	;
           	PUSH	BC           	;
           	CALL	HLFLT      	;ga
           	LD	B,H            	;D
           	LD	C,L            	;M
           	IN	A,(C)          	;x
           	LD	E,A            	;_
           	LD	D,000h         	;
           	POP	BC            	;
           	POP	HL            	;
           	JP	FLTHEX        	;)
B_RND:     	PUSH	BC           	;
           	LD	DE,(L077C8h)    	;[w
           	LD	A,R            	;_
           	XOR	D             	;
           	RRC	A             	;
           	RRC	A             	;
           	RRC	A             	;
           	LD	D,A            	;W
           	LD	A,R            	;_
           	XOR	E             	;
           	RLC	A             	;
           	RLC	A             	;
           	LD	E,D            	;Z
           	LD	D,A            	;W
           	LD	(L077C8h),DE    	;Sw
           	PUSH	HL           	;
           	INC	HL            	;#
           	RES	7,D           	;
           	LD	(HL),D         	;r
           	INC	HL            	;#
           	LD	(HL),E         	;s
           	INC	HL            	;#
           	LD	A,R            	;_
           	LD	(HL),A         	;w
           	POP	HL            	;
           	LD	(HL),081h      	;6
           	CALL	ONESUB     	;k
           	POP	BC            	;
           	RET               	;

L077C8h:	DEFW 04193h			;      	SUB	E;LD	B,C         
B_EXP:     	PUSH	BC           	;
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JP	Z,L07437h      	;7t
           	INC	HL            	;#
           	LD	A,(HL)         	;~
           	LD	(L07896h+1),A     	;2x
           	RES	7,(HL)        	;
           	DEC	HL            	;+
           	LD	DE,07A2Fh      	;/z
           	CALL	MUL      	;o
           	PUSH	HL           	;
           	CALL	L073B2h      	;s
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	CALL	B_FIX        	;`
           	PUSH	HL           	;
           	CALL	HLFLT      	;ga
           	XOR	A             	;
           	CP	H              	;
           	JP	NZ,OVERFL1     	;n
           	LD	A,L            	;}
           	LD	(L0788Bh+1),A     	;2x
           	POP	DE            	;
           	POP	HL            	;
           	PUSH	HL           	;
           	CALL	SUB      	;k
           	PUSH	DE           	;
           	PUSH	HL           	;
           	CALL	LDIR1      	;s
           	POP	DE            	;
           	POP	HL            	;
           	DEC	(HL)          	;5
           	EX	DE,HL          	;
           	XOR	A             	;
           	LD	B,008h         	;
L07809h:   	PUSH	BC           	;
           	PUSH	AF           	;
           	CALL	CMP      	;a
           	JR	C,L07817h      	;8
           	CALL	SUB      	;k
           	POP	AF            	;
           	SET	7,A           	;
           	PUSH	AF           	;
L07817h:   	POP	AF            	;
           	RLC	A             	;
           	EX	DE,HL          	;
           	DEC	(HL)          	;5
           	EX	DE,HL          	;
           	POP	BC            	;
           	DJNZ	L07809h      	;
           	LD	(L07876h+1),A     	;2wx
           	PUSH	DE           	;
           	LD	DE,L07A27h      	;'z
           	CALL	MUL      	;o
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	BIT	3,(IY+0)      	;^
           	JP	Z,L078ADh      	;x
           	INC	(HL)          	;4
           	LD	DE,FLTEN      	;b
           	CALL	ADD      	;l
           	DEC	(HL)          	;5
           	POP	DE            	;
L07840h:   	PUSH	DE           	;
           	CALL	MUL      	;o
           	LD	DE,FLTEN      	;b
           	DEC	(HL)          	;5
           	CALL	ADD      	;l
           	INC	(HL)          	;4
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	MUL      	;o
           	LD	DE,L07A1Fh      	;z
           	CALL	MUL      	;o
           	INC	(HL)          	;4
           	CALL	ONEADD      	;s
           	DEC	(HL)          	;5
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	MUL      	;o
           	CALL	ONEADD      	;s
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	MUL      	;o
L07869h:   	CALL	ONEADD      	;s
           	EX	(SP),HL        	;
           	EX	DE,HL          	;
           	PUSH	DE           	;
           	CALL	LDIR1      	;s
           	POP	HL            	;
           	LD	DE,LOGTBL1      	;y
L07876h:   	LD	A,000h         	;>
           	LD	B,008h         	;
L0787Ah:   	RLC	A             	;
           	JR	NC,L07885h     	;0
           	PUSH	AF           	;
           	PUSH	BC           	;
           	CALL	MUL      	;o
           	POP	BC            	;
           	POP	AF            	;
L07885h:   	CALL	ADDDEG      	;J[
           	DJNZ	L0787Ah      	;
           	LD	A,(HL)         	;~
L0788Bh:	ADD	A,000h        	;
           	JP	C,OVERFL1      	;n
           	LD	(HL),A         	;w
           	POP	DE            	;
           	CALL	MUL      	;o
           	POP	BC            	;
L07896h:   	LD	A,000h         	;>
           	RLC	A             	;
           	RET	NC            	;
           	PUSH	BC           	;
           	PUSH	DE           	;
           	PUSH	HL           	;
           	CALL	LDIR8      	;s
           	POP	DE            	;
           	PUSH	DE           	;
           	CALL	LDIR1      	;s
           	POP	HL            	;
           	POP	DE            	;
           	CALL	DIV      	;p
           	POP	BC            	;
           	RET               	;

L078ADh:   	POP	DE            	;
           	PUSH	DE           	;
           	CALL	MUL      	;o
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JR	Z,L078B7h      	;(
           	DEC	(HL)          	;5
L078B7h:   	CALL	ADD      	;l
           	JP	L07869h        	;ix
B_LOG:     	PUSH	BC           	;
           	INC	HL            	;#
           	LD	A,(HL)         	;~
           	RLC	A             	;
           	JP	C,IFCALL      	;6
           	DEC	HL            	;+
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JP	Z,IFCALL      	;6
           	SUB	081h          	;
           	LD	(L0790Bh+1),A     	;2y
           	LD	(HL),081h      	;6
           	XOR	A             	;
           	LD	B,008h         	;
           	LD	DE,LOGTBL1      	;y
L078D8h:   	PUSH	BC           	;
           	PUSH	AF           	;
           	CALL	CMP      	;a
           	JR	C,L078EEh      	;8
           	PUSH	HL           	;
           	LD	HL,00040h      	;!@
           	ADD	HL,DE         	;
           	EX	DE,HL          	;
           	EX	(SP),HL        	;
           	CALL	MUL      	;o
           	POP	DE            	;
           	POP	AF            	;
           	SET	7,A           	;
           	PUSH	AF           	;
L078EEh:   	POP	AF            	;
           	RLC	A             	;
           	CALL	ADDDEG      	;J[
           	POP	BC            	;
           	DJNZ	L078D8h      	;
           	LD	(L07943h+1),HL    	;"Dy
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	LD	E,A            	;_
           	LD	D,000h         	;
           	CALL	FLTHEX      	;)
           	LD	A,(HL)         	;~
           	OR	A              	;
           	JR	Z,L0790Bh      	;(
           	SUB	008h          	;
           	LD	(HL),A         	;w
L0790Bh:   	LD	A,000h         	;>
           	CP	080h           	;
           	JR	C,L07913h      	;8
           	NEG               	;D
L07913h:   	PUSH	HL           	;
           	LD	DE,00008h      	;
           	ADD	HL,DE         	;
           	LD	(L07940h+1),HL    	;"Ay
           	LD	E,A            	;_
           	LD	D,000h         	;
           	CALL	FLTHEX      	;)
           	LD	A,(L0790Bh+1)     	;:y
           	AND	080h          	;
           	INC	HL            	;#
           	OR	(HL)           	;
           	LD	(HL),A         	;w
           	DEC	HL            	;+
           	EX	DE,HL          	;
           	POP	HL            	;
           	CALL	ADD      	;l
           	LD	A,(IY+0)       	;~
           	LD	DE,L07A37h      	;7z
           	CP	004h           	;
           	JR	Z,L0793Ch      	;(
           	LD	DE,L07A27h      	;'z
L0793Ch:   	CALL	MUL      	;o
           	PUSH	HL           	;
L07940h:  	LD	DE,00000h      	;
L07943h:    LD	HL,00000h      	;!
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	CALL	ONEADD      	;s
           	EX	(SP),HL        	;
           	CALL	SUB      	;k
           	POP	DE            	;
           	CALL	DIV      	;p
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	PUSH	DE           	;
           	LD	E,L            	;]
           	LD	D,H            	;T
           	CALL	MUL      	;o
           	POP	DE            	;
           	PUSH	HL           	;
           	PUSH	DE           	;
           	CALL	LDIR8      	;s
           	POP	HL            	;
           	LD	DE,LOGTBL0      	;y
           	CALL	ADD      	;l
           	EX	DE,HL          	;
           	POP	HL            	;
           	CALL	MUL      	;o
           	LD	DE,FLTEN      	;b
           	INC	(HL)          	;4
           	CALL	ADD      	;l
           	DEC	(HL)          	;5
           	EX	DE,HL          	;
           	LD	HL,(L07943h+1)    	;*Dy
           	CALL	MUL      	;o
           	LD	DE,LOGTBL      	;y
           	CALL	MUL      	;o
           	POP	DE            	;
           	CALL	ADD      	;l
           	POP	BC            	;
           	RET               	;
LOGTBL:
			DEFB 07Fh, 04Ch, 0CCh, 0CCh, 0CCh, 0CCh, 0CCh, 0CDh
LOGTBL0:	DEFB 081h, 055h, 055h, 055h, 055h, 055h, 055h, 055h
LOGTBL1:	DEFB 081h, 035h, 004h, 0F3h, 033h, 0F9h, 0DEh, 065h
			DEFB 081h, 018h, 037h, 0F0h, 051h, 08Dh, 0B8h, 0AAh
			DEFB 081h, 00Bh, 095h, 0C1h, 0E3h, 0EAh, 08Bh, 0D7h
			DEFB 081h, 005h, 0AAh, 0C3h, 067h, 0CCh, 048h, 07Bh
			DEFB 081h, 002h, 0CDh, 086h, 098h, 0ACh, 02Bh, 0A2h
			DEFB 081h, 001h, 064h, 0D1h, 0F3h, 0BCh, 003h, 008h
			DEFB 081h, 000h, 0B1h, 0EDh, 04Fh, 0D9h, 099h, 0ACh
			DEFB 081h, 000h, 058h, 0D7h, 0D2h, 0D5h, 0E5h, 0F7h
			DEFB 080h, 035h, 004h, 0F3h, 033h, 0F9h, 0DEh, 065h
			DEFB 080h, 057h, 044h, 0FCh, 0CAh, 0D6h, 09Dh, 06Bh
			DEFB 080h, 06Ah, 0C0h, 0C6h, 0E7h, 0DDh, 024h, 03Ah
			DEFB 080h, 075h, 025h, 07Dh, 015h, 024h, 086h, 0CDh
			DEFB 080h, 07Ah, 083h, 0B2h, 0DBh, 072h, 02Ah, 003h
			DEFB 080h, 07Dh, 03Eh, 00Ch, 00Ch, 0F4h, 086h, 0C1h
			DEFB 080h, 07Eh, 09Eh, 011h, 05Ch, 07Bh, 08Fh, 088h
			DEFB 080h, 07Fh, 04Eh, 0CBh, 059h, 051h, 01Eh, 0C9h
L07A1Fh:	DEFB 07Ah, 008h, 088h, 088h, 088h, 088h, 088h, 089h
L07A27h:	DEFB 080h, 031h, 072h, 017h, 0F7h, 0D1h, 0CFh, 07Ah
			DEFB 081h, 038h, 0AAh, 03Bh, 029h, 05Ch, 017h, 0F1h
L07A37h:	DEFB 080h, 031h, 072h, 018h

;    ORG 07A3BH
VSTART: DEFW 07C9Dh
STRPTR:	DEFW 0
STKLMT: DEFW 0
STRTOP: DEFW 0   ; EQU  07a41h
INTSSP:	DEFW 0
STRBTM:	DEFW 0
MEMEND: DEFW 0
MEMMAX: DEFW 0   ;  EQU  07a49h
INTFAC: DEFW 0   ;  EQU  07a4bh
        DEFW 0
IMDBUF  EQU  07b4eh 
TEXTST  EQU  07c4eh
;	ORG 07A4FH
KEYBUF: DEFB 00Ch
		DEFM 'SAMSUNG HUBASIC V1.0'
		DEFB 00Dh
		DEFM 'COPYRIGHT (C) 1982'
		DEFB 00Dh
		DEFM '       BY HUDSON SOFT'
		DEFB 00Dh
		DEFS 07B00h-$, 0

